<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = { title: "TiddlyWiki", major: 2, minor: 9, revision: 2, date: new Date("February 12, 2019"), extensions: {} };

//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2012

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.

" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> ace-Plugin.js - a reusable non-linear personal web notebook </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>

</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;
</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]
</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' role='banner' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea' role='main'&gt;
&lt;div id='messageArea' class='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard { background:[[ColorPalette::PrimaryPale]]; }
.wizard__title    { color:[[ColorPalette::PrimaryDark]]; border:none; }
.wizard__subtitle { color:[[ColorPalette::Foreground]]; border:none; }
.wizardStep { background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]]; }
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

.messageArea { border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
.messageToolbar__button { color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none; }
.messageToolbar__button_withIcon { background:inherit; }
.messageToolbar__button_withIcon:active { background:inherit; border:none; }
.messageToolbar__icon { fill:[[ColorPalette::TertiaryDark]]; }
.messageToolbar__icon:hover { fill:[[ColorPalette::Foreground]]; }

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard { padding:0.1em 2em 0; }
.wizard__title    { font-size:2em; }
.wizard__subtitle { font-size:1.2em; }
.wizard__title, .wizard__subtitle { font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em; }
.wizardStep { padding:1em; }
.wizardFooter { padding:0.8em 0.4em 0.8em 0; }
.wizardFooter .status { padding:0.2em 0.7em; margin-left:0.3em; }
.wizardFooter .button { margin:0.5em 0 0; font-size:1.2em; padding:0.2em 0.5em; }

.messageArea { position:fixed; top:2em; right:0; margin:0.5em; padding:0.7em 1em; z-index:2000; }
.messageToolbar { text-align:right; padding:0.2em 0; }
.messageToolbar__button { text-decoration:underline; }
.messageToolbar__icon { height: 1em; }
.messageArea__text a { text-decoration:underline; }

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; box-sizing: border-box; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel { display:none; z-index:100; position:absolute; width:90%; margin-left:3em; }
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, .messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/
</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>

</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div tiddler="ColorPalette" modifier="Okido" created="202003131422" modified="202003131430" tags="" acerow="15" acecolumn="11">!Primary colors are modified\nBackground: #fff\nForeground: #000\nPrimaryPale: #69F\nPrimaryLight: #1829E3\nPrimaryMid: #03C\nPrimaryDark: #009\nSecondaryPale: #ffc\nSecondaryLight: #fe8\nSecondaryMid: #db4\nSecondaryDark: #841\nTertiaryPale: #eee\nTertiaryLight: #ccc\nTertiaryMid: #999\nTertiaryDark: #666\nError: #f88\n</div>
<div tiddler="DefaultTiddlers" modifier="Okido" created="202002021924" modified="202002080848" tags="">[[Example]]\n[[ace-Plugin.js]]</div>
<div tiddler="EditTemplate" modifier="&quot;Okido&quot;" created="202002021916" modified="202002021916" tags="">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;\n&lt;div macro='annotations'&gt;&lt;/div&gt;\n&lt;div id='acehidetweditor' class='editor' macro='edit text'&gt;&lt;/div&gt;&lt;div id='aceViewer' contenteditable='true' spellcheck='true' &gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="Example" modifier="Okido" created="202002051942" modified="202003141304" tags="example" acerow="0" acecolumn="0" changecount="10">&lt;script show&gt;\n\n  /* jshint asi:true */\n  /* Last updated 05-02-2020 */\n  /* Click aceEdit to open in ace.js editor mode and close with aceDone */\n\n  &quot;use strict&quot;\n\n  const a = 'Example'\n  const b = ' ace.js + TWc'\n  wikify(`{{{\sn ${JSON.stringify(&quot;TEST: &quot; + a + b)} \sn}}}`, place)\n\n&lt;/script&gt;</div>
<div tiddler="GettingStarted" modifier="&quot;Okido&quot;" created="202002021917" modified="202002021917" tags="">To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:\n* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* [[MainMenu]]: The menu (usually on the left)\n* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;\n</div>
<div tiddler="InlineJavascriptPlugin" modifier="Okido" created="200512130544" modified="201910231424" tags="systemConfig excludeLists themebroker emptywiki pdfmaketwcgit nwsavergithub nwhivegithub nwhiveplugin actionplugin calibsrc">/***\n|Name|InlineJavascriptPlugin|\n|Source|http://www.TiddlyTools.com/#InlineJavascriptPlugin|\n|Documentation|http://www.TiddlyTools.com/#InlineJavascriptPluginInfo|\n|Version|1.9.6|\n|Author|Eric Shulman|\n|License|http://www.TiddlyTools.com/#LegalStatements|\n|~CoreVersion|2.1|\n|Type|plugin|\n|Description|Insert Javascript executable code directly into your tiddler content.|\n''Call directly into TW core utility routines, define new functions, calculate values, add dynamically-generated TiddlyWiki-formatted output'' into tiddler content, or perform any other programmatic actions each time the tiddler is rendered.\n!!!!!Documentation\n&gt;see [[InlineJavascriptPluginInfo]]\n!!!!!Revisions\n&lt;&lt;&lt;\n2010.12.15 1.9.6 allow (but ignore) type=&quot;...&quot; syntax\n|please see [[InlineJavascriptPluginInfo]] for additional revision details|\n2005.11.08 1.0.0 initial release\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.InlineJavascriptPlugin= {major: 1, minor: 9, revision: 6, date: new Date(2010,12,15)};\n\nconfig.formatters.push( {\n	name: &quot;inlineJavascript&quot;,\n	match: &quot;\s\s&lt;script&quot;,\n	lookahead: &quot;\s\s&lt;script(?: type=\s\s\s&quot;[^\s\s\s&quot;]*\s\s\s&quot;)?(?: src=\s\s\s&quot;([^\s\s\s&quot;]*)\s\s\s&quot;)?(?: label=\s\s\s&quot;([^\s\s\s&quot;]*)\s\s\s&quot;)?(?: title=\s\s\s&quot;([^\s\s\s&quot;]*)\s\s\s&quot;)?(?: key=\s\s\s&quot;([^\s\s\s&quot;]*)\s\s\s&quot;)?( show)?\s\s&gt;((?:.|\s\sn)*?)\s\s&lt;/script\s\s&gt;&quot;,\n	handler: function(w) {\n		var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n		lookaheadRegExp.lastIndex = w.matchStart;\n		var lookaheadMatch = lookaheadRegExp.exec(w.source)\n		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {\n			var src=lookaheadMatch[1];\n			var label=lookaheadMatch[2];\n			var tip=lookaheadMatch[3];\n			var key=lookaheadMatch[4];\n			var show=lookaheadMatch[5];\n			var code=lookaheadMatch[6];\n			if (src) { // external script library\n				var script = document.createElement(&quot;script&quot;); script.src = src;\n				document.body.appendChild(script); document.body.removeChild(script);\n			}\n			if (code) { // inline code\n				if (show) // display source in tiddler\n					wikify(&quot;{{{\sn&quot;+lookaheadMatch[0]+&quot;\sn}}}\sn&quot;,w.output);\n				if (label) { // create 'onclick' command link\n					var link=createTiddlyElement(w.output,&quot;a&quot;,null,&quot;tiddlyLinkExisting&quot;,wikifyPlainText(label));\n					var fixup=code.replace(/document.write\ss*\s(/gi,'place.bufferedHTML+=(');\n					link.code=&quot;function _out(place,tiddler){&quot;+fixup+&quot;\sn};_out(this,this.tiddler);&quot;\n					link.tiddler=w.tiddler;\n					link.onclick=function(){\n						this.bufferedHTML=&quot;&quot;;\n						try{ var r=eval(this.code);\n							if(this.bufferedHTML.length || (typeof(r)===&quot;string&quot;)&amp;&amp;r.length)\n								var s=this.parentNode.insertBefore(document.createElement(&quot;span&quot;),this.nextSibling);\n							if(this.bufferedHTML.length)\n								s.innerHTML=this.bufferedHTML;\n							if((typeof(r)===&quot;string&quot;)&amp;&amp;r.length) {\n								wikify(r,s,null,this.tiddler);\n								return false;\n							} else return r!==undefined?r:false;\n						} catch(e){alert(e.description||e.toString());return false;}\n					};\n					link.setAttribute(&quot;title&quot;,tip||&quot;&quot;);\n					var URIcode='javascript:void(eval(decodeURIComponent(%22(function(){try{';\n					URIcode+=encodeURIComponent(encodeURIComponent(code.replace(/\sn/g,' ')));\n					URIcode+='}catch(e){alert(e.description||e.toString())}})()%22)))';\n					link.setAttribute(&quot;href&quot;,URIcode);\n					link.style.cursor=&quot;pointer&quot;;\n					if (key) link.accessKey=key.substr(0,1); // single character only\n				}\n				else { // run script immediately\n					var fixup=code.replace(/document.write\ss*\s(/gi,'place.innerHTML+=(');\n					var c=&quot;function _out(place,tiddler){&quot;+fixup+&quot;\sn};_out(w.output,w.tiddler);&quot;;\n					try	 { var out=eval(c); }\n					catch(e) { out=e.description?e.description:e.toString(); }\n					if (out &amp;&amp; out.length) wikify(out,w.output,w.highlightRegExp,w.tiddler);\n				}\n			}\n			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n		}\n	}\n} )\n//}}}\n\n// // Backward-compatibility for TW2.1.x and earlier\n//{{{\nif (typeof(wikifyPlainText)==&quot;undefined&quot;) window.wikifyPlainText=function(text,limit,tiddler) {\n	if(limit &gt; 0) text = text.substr(0,limit);\n	var wikifier = new Wikifier(text,formatter,null,tiddler);\n	return wikifier.wikifyPlain();\n}\n//}}}\n\n// // GLOBAL FUNCTION: $(...) -- 'shorthand' convenience syntax for document.getElementById()\n//{{{\nif (typeof($)=='undefined') { function $(id) { return document.getElementById(id.replace(/^#/,'')); } }\n//}}}</div>
<div tiddler="MainMenu" modifier="Okido" created="202002021925" modified="202003131411" tags="" acerow="5" acecolumn="49">[[Example]]\n[[ace-Plugin.js]]\n[[ToolbarCommands]]\n[[EditTemplate]]\n[[MainMenu]]\n[[Github|https://github.com/nwOkido/ace-Plugin.js]]\n</div>
<div tiddler="SiteTitle" modifier="&quot;Okido&quot;" created="202002021921" modified="202002021921" tags="">ace-Plugin.js</div>
<div tiddler="SystemSettings" modifier="Okido" created="202001061903" modified="202002051940" tags="systemsettings">chkHttpReadOnly: false;</div>
<div tiddler="ToolbarCommands" modifier="&quot;Okido&quot;" created="202002021915" modified="202002021915" tags="">|~ViewToolbar|closeTiddler closeOthers +editTiddler aceEdit &gt; fields permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|</div>
<div tiddler="ace-Plugin.js" modifier="Okido" created="202002031756" modified="202003141304" tags="systemConfig aceplugin" changecount="2" acerow="NaN" acecolumn="0">/***\n|Name|ace-Plugin.js |\n|Version|1.4.8.7 |\n|Description|ace.js for Tiddlywiki |\n|Status|EXPERIMENTAL - SUBJECT TO CHANGE - You need a modern browser or nw.js|\n!!!Documentation\n&lt;&lt;&lt;\nThis plugin gives you the ace.js editor in Tiddlywiki classic.\nVersioning numbering follows ace.js versioning followed by one digit for the plugin version.\n''Key definition:''\nOpen key command menu: F1\nSearch: CTRL + F\nSearch and replace: CTRL + H\nSettings menu: CTRL + - + ,\nJavascript snippets show up in a modal box, select with arrow up and down and confirm with TAB\n&lt;&lt;&lt;\n!!!Usage\n&lt;&lt;&lt;\nOne can use the ace-Plugin.js as a standalone plugin, this provides a lot of functionality.\nIf you require all possible functionality than you have to download ace.js and copy the folder src-min-noconflict to a folder with the name ace that is in the same folder as your Tiddlywiki.\nFor the ace.js website have a look [[here|https://ace.c9.io]].\nThere is a known conflict with the YourSearchPlugin, YourSearchPlugin modifies the array prototype, this causes loss of the snippet insertion function.\nThere is a YourSearchPlugin-Fork v2.1.8 that resolves this problem.\nIf you work over HTTP make sure the enable editing, put the following code in SystemSettings:\n{{{\nchkHttpReadOnly: false;\n}}}\n&lt;&lt;&lt;\n!!!Configuration\n&lt;&lt;&lt;\n!!!Modify EditTemplate\nModify the default EditTemplate code:\n{{{\n&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\n}}}\nModify the default code to:\n{{{\n&lt;div class='editor' macro='edit text' id='acehidetweditor'&gt;&lt;/div&gt;\n&lt;div id='aceViewer' contenteditable='true' spellcheck='true'&gt;&lt;/div&gt;\n}}}\n\n!!!Modify ToolBarCommands\nModify ToolbarCommands, it must contain aceEdit, like:\n|~ViewToolbar|copyTiddler deleteTiddler closeTiddler intelliTagsEdit closeOthers +editTiddler aceEdit &gt; fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|\n\n!!!Choose to escape script tags when editing script code\n&lt;&lt;option chkEscapeScriptTags&gt;&gt; Escape script tags when edited with ace-Plugin.js and InlineJavascriptPlugin.\nOr add the following code to a tiddler that is tagged with systemConfig.\n{{{\n  config.options.chkEscapeScriptTags = true; \n}}}\n!!!Set the heigth of the edit box\n&lt;&lt;option txtaceBoxLines&gt;&gt; Set the heigth of edit box in number of lines.\nOr add the following code to a tiddler that is tagged with systemConfig.\n{{{\n  config.options.txtaceBoxLines = &quot;50&quot;; \n}}}\n!!!Set the fontsize\n&lt;&lt;option txtaceFontSize&gt;&gt; Set the fontsize in pt or em, example 12pt or 1.2em.\nOr add the following code to a tiddler that is tagged with systemConfig.\n{{{\n  config.options.txtaceFontSize = &quot;12pt&quot;; \n}}}\n!!!Set the number of spaces for softtab\n&lt;&lt;option txtaceSoftTab&gt;&gt; Set the number of spaces to use for one tab.\nOr add the following code to a tiddler that is tagged with systemConfig.\n{{{\n  config.options.txtaceSoftTab = &quot;2&quot;; \n}}}\n&lt;&lt;&lt;\n!!!Revisions\n&lt;&lt;&lt;\n14-03-2020 1.4.8.7 Fixed Tiddler titles that have a dot or special character, this causes jQuery id's to turn in faulty selectors, fixed wrong edit box placement when several tiddlers are opened for editing, fontsize and softtabs can now be set \n07-03-2020 1.4.8.6 Added multi sessions to edit multiple open tiddlers at the same time \n23-02-2020 1.4.8.5 Added functionality to keep the last cursor position and the max height of the edit box can be set\n23-02-2020 1.4.8.4 Improved the configuration instructions, fixed the loss of field values, Reto Stauss thanks for reporting\n16-02-2020 1.4.8.3 Added information for opening menu's\n08-02-2020 1.4.8.2 Resolved a plugin conflict with snippet insertion\n04-02-2020 1.4.8.1 Added version number and cleaned up the code, removed vb edit mode\n02-02-2020 1.4.8.0 Combined all loose code parts into one plugin \n&lt;&lt;&lt;\n!!!License\n{{{\nLicense for ace.js\n}}}\n&lt;&lt;&lt;\nCopyright (c) 2010, Ajax.org B.V.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n    * Neither the name of Ajax.org B.V. nor the\n      names of its contributors may be used to endorse or promote products\n      derived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n&lt;&lt;&lt;\n{{{\nLicense for the Tiddlywiki plugin part\n}}}\n&lt;&lt;&lt;\nThe MIT License (MIT)\n\nCopyright (c) 2020 Okido\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n&lt;&lt;&lt;\n!!!Code\n***/\n  \n//{{{\n\n/* Code filename: ace.js */\n(function(){function o(n){var i=e;n&amp;&amp;(e[n]||(e[n]={}),i=e[n]);if(!i.define||!i.define.packaged)t.original=i.define,i.define=t,i.define.packaged=!0;if(!i.require||!i.require.packaged)r.original=i.require,i.require=r,i.require.packaged=!0}var ACE_NAMESPACE = &quot;ace&quot;,e=function(){return this}();!e&amp;&amp;typeof window!=&quot;undefined&quot;&amp;&amp;(e=window);if(!ACE_NAMESPACE&amp;&amp;typeof requirejs!=&quot;undefined&quot;)return;var t=function(e,n,r){if(typeof e!=&quot;string&quot;){t.original?t.original.apply(this,arguments):(console.error(&quot;dropping module because define wasn't a string.&quot;),console.trace());return}arguments.length==2&amp;&amp;(r=n),t.modules[e]||(t.payloads[e]=r,t.modules[e]=null)};t.modules={},t.payloads={};var n=function(e,t,n){if(typeof t==&quot;string&quot;){var i=s(e,t);if(i!=undefined)return n&amp;&amp;n(),i}else if(Object.prototype.toString.call(t)===&quot;[object Array]&quot;){var o=[];for(var u=0,a=t.length;u&lt;a;++u){var f=s(e,t[u]);if(f==undefined&amp;&amp;r.original)return;o.push(f)}return n&amp;&amp;n.apply(null,o)||!0}},r=function(e,t){var i=n(&quot;&quot;,e,t);return i==undefined&amp;&amp;r.original?r.original.apply(this,arguments):i},i=function(e,t){if(t.indexOf(&quot;!&quot;)!==-1){var n=t.split(&quot;!&quot;);return i(e,n[0])+&quot;!&quot;+i(e,n[1])}if(t.charAt(0)==&quot;.&quot;){var r=e.split(&quot;/&quot;).slice(0,-1).join(&quot;/&quot;);t=r+&quot;/&quot;+t;while(t.indexOf(&quot;.&quot;)!==-1&amp;&amp;s!=t){var s=t;t=t.replace(/\s/\s.\s//,&quot;/&quot;).replace(/[^\s/]+\s/\s.\s.\s//,&quot;&quot;)}}return t},s=function(e,r){r=i(e,r);var s=t.modules[r];if(!s){s=t.payloads[r];if(typeof s==&quot;function&quot;){var o={},u={id:r,uri:&quot;&quot;,exports:o,packaged:!0},a=function(e,t){return n(r,e,t)},f=s(a,o,u);o=f||u.exports,t.modules[r]=o,delete t.payloads[r]}s=t.modules[r]=o||s}return s};o(ACE_NAMESPACE)})(),ace.define(&quot;ace/lib/regexp&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;function o(e){return(e.global?&quot;g&quot;:&quot;&quot;)+(e.ignoreCase?&quot;i&quot;:&quot;&quot;)+(e.multiline?&quot;m&quot;:&quot;&quot;)+(e.extended?&quot;x&quot;:&quot;&quot;)+(e.sticky?&quot;y&quot;:&quot;&quot;)}function u(e,t,n){if(Array.prototype.indexOf)return e.indexOf(t,n);for(var r=n||0;r&lt;e.length;r++)if(e[r]===t)return r;return-1}var r={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},i=r.exec.call(/()??/,&quot;&quot;)[1]===undefined,s=function(){var e=/^/g;return r.test.call(e,&quot;&quot;),!e.lastIndex}();if(s&amp;&amp;i)return;RegExp.prototype.exec=function(e){var t=r.exec.apply(this,arguments),n,a;if(typeof e==&quot;string&quot;&amp;&amp;t){!i&amp;&amp;t.length&gt;1&amp;&amp;u(t,&quot;&quot;)&gt;-1&amp;&amp;(a=RegExp(this.source,r.replace.call(o(this),&quot;g&quot;,&quot;&quot;)),r.replace.call(e.slice(t.index),a,function(){for(var e=1;e&lt;arguments.length-2;e++)arguments[e]===undefined&amp;&amp;(t[e]=undefined)}));if(this._xregexp&amp;&amp;this._xregexp.captureNames)for(var f=1;f&lt;t.length;f++)n=this._xregexp.captureNames[f-1],n&amp;&amp;(t[n]=t[f]);!s&amp;&amp;this.global&amp;&amp;!t[0].length&amp;&amp;this.lastIndex&gt;t.index&amp;&amp;this.lastIndex--}return t},s||(RegExp.prototype.test=function(e){var t=r.exec.call(this,e);return t&amp;&amp;this.global&amp;&amp;!t[0].length&amp;&amp;this.lastIndex&gt;t.index&amp;&amp;this.lastIndex--,!!t})}),ace.define(&quot;ace/lib/es5-shim&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){function r(){}function w(e){try{return Object.defineProperty(e,&quot;sentinel&quot;,{}),&quot;sentinel&quot;in e}catch(t){}}function H(e){return e=+e,e!==e?e=0:e!==0&amp;&amp;e!==1/0&amp;&amp;e!==-1/0&amp;&amp;(e=(e&gt;0||-1)*Math.floor(Math.abs(e))),e}function B(e){var t=typeof e;return e===null||t===&quot;undefined&quot;||t===&quot;boolean&quot;||t===&quot;number&quot;||t===&quot;string&quot;}function j(e){var t,n,r;if(B(e))return e;n=e.valueOf;if(typeof n==&quot;function&quot;){t=n.call(e);if(B(t))return t}r=e.toString;if(typeof r==&quot;function&quot;){t=r.call(e);if(B(t))return t}throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!=&quot;function&quot;)throw new TypeError(&quot;Function.prototype.bind called on incompatible &quot;+n);var i=u.call(arguments,1),s=function(){if(this instanceof s){var e=n.apply(this,i.concat(u.call(arguments)));return Object(e)===e?e:this}return n.apply(t,i.concat(u.call(arguments)))};return n.prototype&amp;&amp;(r.prototype=n.prototype,s.prototype=new r,r.prototype=null),s});var i=Function.prototype.call,s=Array.prototype,o=Object.prototype,u=s.slice,a=i.bind(o.toString),f=i.bind(o.hasOwnProperty),l,c,h,p,d;if(d=f(o,&quot;__defineGetter__&quot;))l=i.bind(o.__defineGetter__),c=i.bind(o.__defineSetter__),h=i.bind(o.__lookupGetter__),p=i.bind(o.__lookupSetter__);if([1,2].splice(0).length!=2)if(!function(){function e(e){var t=new Array(e+2);return t[0]=t[1]=0,t}var t=[],n;t.splice.apply(t,e(20)),t.splice.apply(t,e(26)),n=t.length,t.splice(5,0,&quot;XXX&quot;),n+1==t.length;if(n+1==t.length)return!0}())Array.prototype.splice=function(e,t){var n=this.length;e&gt;0?e&gt;n&amp;&amp;(e=n):e==void 0?e=0:e&lt;0&amp;&amp;(e=Math.max(n+e,0)),e+t&lt;n||(t=n-e);var r=this.slice(e,e+t),i=u.call(arguments,2),s=i.length;if(e===n)s&amp;&amp;this.push.apply(this,i);else{var o=Math.min(t,n-e),a=e+o,f=a+s-o,l=n-a,c=n-o;if(f&lt;a)for(var h=0;h&lt;l;++h)this[f+h]=this[a+h];else if(f&gt;a)for(h=l;h--;)this[f+h]=this[a+h];if(s&amp;&amp;e===c)this.length=c,this.push.apply(this,i);else{this.length=c+s;for(h=0;h&lt;s;++h)this[e+h]=i[h]}}return r};else{var v=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?v.apply(this,[e===void 0?0:e,t===void 0?this.length-e:t].concat(u.call(arguments,2))):[]}}Array.isArray||(Array.isArray=function(t){return a(t)==&quot;[object Array]&quot;});var m=Object(&quot;a&quot;),g=m[0]!=&quot;a&quot;||!(0 in m);Array.prototype.forEach||(Array.prototype.forEach=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=arguments[1],s=-1,o=r.length&gt;&gt;&gt;0;if(a(t)!=&quot;[object Function]&quot;)throw new TypeError;while(++s&lt;o)s in r&amp;&amp;t.call(i,r[s],s,n)}),Array.prototype.map||(Array.prototype.map=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0,s=Array(i),o=arguments[1];if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);for(var u=0;u&lt;i;u++)u in r&amp;&amp;(s[u]=t.call(o,r[u],u,n));return s}),Array.prototype.filter||(Array.prototype.filter=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0,s=[],o,u=arguments[1];if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);for(var f=0;f&lt;i;f++)f in r&amp;&amp;(o=r[f],t.call(u,o,f,n)&amp;&amp;s.push(o));return s}),Array.prototype.every||(Array.prototype.every=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0,s=arguments[1];if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);for(var o=0;o&lt;i;o++)if(o in r&amp;&amp;!t.call(s,r[o],o,n))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0,s=arguments[1];if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);for(var o=0;o&lt;i;o++)if(o in r&amp;&amp;t.call(s,r[o],o,n))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0;if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);if(!i&amp;&amp;arguments.length==1)throw new TypeError(&quot;reduce of empty array with no initial value&quot;);var s=0,o;if(arguments.length&gt;=2)o=arguments[1];else do{if(s in r){o=r[s++];break}if(++s&gt;=i)throw new TypeError(&quot;reduce of empty array with no initial value&quot;)}while(!0);for(;s&lt;i;s++)s in r&amp;&amp;(o=t.call(void 0,o,r[s],s,n));return o}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(t){var n=F(this),r=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):n,i=r.length&gt;&gt;&gt;0;if(a(t)!=&quot;[object Function]&quot;)throw new TypeError(t+&quot; is not a function&quot;);if(!i&amp;&amp;arguments.length==1)throw new TypeError(&quot;reduceRight of empty array with no initial value&quot;);var s,o=i-1;if(arguments.length&gt;=2)s=arguments[1];else do{if(o in r){s=r[o--];break}if(--o&lt;0)throw new TypeError(&quot;reduceRight of empty array with no initial value&quot;)}while(!0);do o in this&amp;&amp;(s=t.call(void 0,s,r[o],o,n));while(o--);return s});if(!Array.prototype.indexOf||[0,1].indexOf(1,2)!=-1)Array.prototype.indexOf=function(t){var n=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):F(this),r=n.length&gt;&gt;&gt;0;if(!r)return-1;var i=0;arguments.length&gt;1&amp;&amp;(i=H(arguments[1])),i=i&gt;=0?i:Math.max(0,r+i);for(;i&lt;r;i++)if(i in n&amp;&amp;n[i]===t)return i;return-1};if(!Array.prototype.lastIndexOf||[0,1].lastIndexOf(0,-3)!=-1)Array.prototype.lastIndexOf=function(t){var n=g&amp;&amp;a(this)==&quot;[object String]&quot;?this.split(&quot;&quot;):F(this),r=n.length&gt;&gt;&gt;0;if(!r)return-1;var i=r-1;arguments.length&gt;1&amp;&amp;(i=Math.min(i,H(arguments[1]))),i=i&gt;=0?i:r-Math.abs(i);for(;i&gt;=0;i--)if(i in n&amp;&amp;t===n[i])return i;return-1};Object.getPrototypeOf||(Object.getPrototypeOf=function(t){return t.__proto__||(t.constructor?t.constructor.prototype:o)});if(!Object.getOwnPropertyDescriptor){var y=&quot;Object.getOwnPropertyDescriptor called on a non-object: &quot;;Object.getOwnPropertyDescriptor=function(t,n){if(typeof t!=&quot;object&quot;&amp;&amp;typeof t!=&quot;function&quot;||t===null)throw new TypeError(y+t);if(!f(t,n))return;var r,i,s;r={enumerable:!0,configurable:!0};if(d){var u=t.__proto__;t.__proto__=o;var i=h(t,n),s=p(t,n);t.__proto__=u;if(i||s)return i&amp;&amp;(r.get=i),s&amp;&amp;(r.set=s),r}return r.value=t[n],r}}Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(t){return Object.keys(t)});if(!Object.create){var b;Object.prototype.__proto__===null?b=function(){return{__proto__:null}}:b=function(){var e={};for(var t in e)e[t]=null;return e.constructor=e.hasOwnProperty=e.propertyIsEnumerable=e.isPrototypeOf=e.toLocaleString=e.toString=e.valueOf=e.__proto__=null,e},Object.create=function(t,n){var r;if(t===null)r=b();else{if(typeof t!=&quot;object&quot;)throw new TypeError(&quot;typeof prototype[&quot;+typeof t+&quot;] != 'object'&quot;);var i=function(){};i.prototype=t,r=new i,r.__proto__=t}return n!==void 0&amp;&amp;Object.defineProperties(r,n),r}}if(Object.defineProperty){var E=w({}),S=typeof document==&quot;undefined&quot;||w(document.createElement(&quot;div&quot;));if(!E||!S)var x=Object.defineProperty}if(!Object.defineProperty||x){var T=&quot;Property description must be an object: &quot;,N=&quot;Object.defineProperty called on non-object: &quot;,C=&quot;getters &amp; setters can not be defined on this javascript engine&quot;;Object.defineProperty=function(t,n,r){if(typeof t!=&quot;object&quot;&amp;&amp;typeof t!=&quot;function&quot;||t===null)throw new TypeError(N+t);if(typeof r!=&quot;object&quot;&amp;&amp;typeof r!=&quot;function&quot;||r===null)throw new TypeError(T+r);if(x)try{return x.call(Object,t,n,r)}catch(i){}if(f(r,&quot;value&quot;))if(d&amp;&amp;(h(t,n)||p(t,n))){var s=t.__proto__;t.__proto__=o,delete t[n],t[n]=r.value,t.__proto__=s}else t[n]=r.value;else{if(!d)throw new TypeError(C);f(r,&quot;get&quot;)&amp;&amp;l(t,n,r.get),f(r,&quot;set&quot;)&amp;&amp;c(t,n,r.set)}return t}}Object.defineProperties||(Object.defineProperties=function(t,n){for(var r in n)f(n,r)&amp;&amp;Object.defineProperty(t,r,n[r]);return t}),Object.seal||(Object.seal=function(t){return t}),Object.freeze||(Object.freeze=function(t){return t});try{Object.freeze(function(){})}catch(k){Object.freeze=function(t){return function(n){return typeof n==&quot;function&quot;?n:t(n)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(t){return t}),Object.isSealed||(Object.isSealed=function(t){return!1}),Object.isFrozen||(Object.isFrozen=function(t){return!1}),Object.isExtensible||(Object.isExtensible=function(t){if(Object(t)===t)throw new TypeError;var n=&quot;&quot;;while(f(t,n))n+=&quot;?&quot;;t[n]=!0;var r=f(t,n);return delete t[n],r});if(!Object.keys){var L=!0,A=[&quot;toString&quot;,&quot;toLocaleString&quot;,&quot;valueOf&quot;,&quot;hasOwnProperty&quot;,&quot;isPrototypeOf&quot;,&quot;propertyIsEnumerable&quot;,&quot;constructor&quot;],O=A.length;for(var M in{toString:null})L=!1;Object.keys=function I(e){if(typeof e!=&quot;object&quot;&amp;&amp;typeof e!=&quot;function&quot;||e===null)throw new TypeError(&quot;Object.keys called on a non-object&quot;);var I=[];for(var t in e)f(e,t)&amp;&amp;I.push(t);if(L)for(var n=0,r=O;n&lt;r;n++){var i=A[n];f(e,i)&amp;&amp;I.push(i)}return I}}Date.now||(Date.now=function(){return(new Date).getTime()});var _=&quot;	\sn\sx0b\sf\sr \su00a0\su1680\su2000\su2001\su2002\su2003\su2004\su2005\su2006\su2007\su2008\su2009\su200a\su202f\su205f\su3000\su2028\su2029\sufeff&quot;;if(!String.prototype.trim){_=&quot;[&quot;+_+&quot;]&quot;;var D=new RegExp(&quot;^&quot;+_+_+&quot;*&quot;),P=new RegExp(_+_+&quot;*$&quot;);String.prototype.trim=function(){return String(this).replace(D,&quot;&quot;).replace(P,&quot;&quot;)}}var F=function(e){if(e==null)throw new TypeError(&quot;can't convert &quot;+e+&quot; to object&quot;);return Object(e)}}),ace.define(&quot;ace/lib/fixoldbrowsers&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/regexp&quot;,&quot;ace/lib/es5-shim&quot;],function(e,t,n){&quot;use strict&quot;;e(&quot;./regexp&quot;),e(&quot;./es5-shim&quot;),typeof Element!=&quot;undefined&quot;&amp;&amp;!Element.prototype.remove&amp;&amp;Object.defineProperty(Element.prototype,&quot;remove&quot;,{enumerable:!1,writable:!0,configurable:!0,value:function(){this.parentNode&amp;&amp;this.parentNode.removeChild(this)}})}),ace.define(&quot;ace/lib/useragent&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.OS={LINUX:&quot;LINUX&quot;,MAC:&quot;MAC&quot;,WINDOWS:&quot;WINDOWS&quot;},t.getOS=function(){return t.isMac?t.OS.MAC:t.isLinux?t.OS.LINUX:t.OS.WINDOWS};var r=typeof navigator==&quot;object&quot;?navigator:{},i=(/mac|win|linux/i.exec(r.platform)||[&quot;other&quot;])[0].toLowerCase(),s=r.userAgent||&quot;&quot;,o=r.appName||&quot;&quot;;t.isWin=i==&quot;win&quot;,t.isMac=i==&quot;mac&quot;,t.isLinux=i==&quot;linux&quot;,t.isIE=o==&quot;Microsoft Internet Explorer&quot;||o.indexOf(&quot;MSAppHost&quot;)&gt;=0?parseFloat((s.match(/(?:MSIE |Trident\s/[0-9]+[\s.0-9]+;.*rv:)([0-9]+[\s.0-9]+)/)||[])[1]):parseFloat((s.match(/(?:Trident\s/[0-9]+[\s.0-9]+;.*rv:)([0-9]+[\s.0-9]+)/)||[])[1]),t.isOldIE=t.isIE&amp;&amp;t.isIE&lt;9,t.isGecko=t.isMozilla=s.match(/ Gecko\s/\sd+/),t.isOpera=typeof opera==&quot;object&quot;&amp;&amp;Object.prototype.toString.call(window.opera)==&quot;[object Opera]&quot;,t.isWebKit=parseFloat(s.split(&quot;WebKit/&quot;)[1])||undefined,t.isChrome=parseFloat(s.split(&quot; Chrome/&quot;)[1])||undefined,t.isEdge=parseFloat(s.split(&quot; Edge/&quot;)[1])||undefined,t.isAIR=s.indexOf(&quot;AdobeAIR&quot;)&gt;=0,t.isAndroid=s.indexOf(&quot;Android&quot;)&gt;=0,t.isChromeOS=s.indexOf(&quot; CrOS &quot;)&gt;=0,t.isIOS=/iPad|iPhone|iPod/.test(s)&amp;&amp;!window.MSStream,t.isIOS&amp;&amp;(t.isMac=!0),t.isMobile=t.isIOS||t.isAndroid}),ace.define(&quot;ace/lib/dom&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./useragent&quot;),i=&quot;http://www.w3.org/1999/xhtml&quot;;t.buildDom=function o(e,t,n){if(typeof e==&quot;string&quot;&amp;&amp;e){var r=document.createTextNode(e);return t&amp;&amp;t.appendChild(r),r}if(!Array.isArray(e))return e;if(typeof e[0]!=&quot;string&quot;||!e[0]){var i=[];for(var s=0;s&lt;e.length;s++){var u=o(e[s],t,n);u&amp;&amp;i.push(u)}return i}var a=document.createElement(e[0]),f=e[1],l=1;f&amp;&amp;typeof f==&quot;object&quot;&amp;&amp;!Array.isArray(f)&amp;&amp;(l=2);for(var s=l;s&lt;e.length;s++)o(e[s],a,n);return l==2&amp;&amp;Object.keys(f).forEach(function(e){var t=f[e];e===&quot;class&quot;?a.className=Array.isArray(t)?t.join(&quot; &quot;):t:typeof t==&quot;function&quot;||e==&quot;value&quot;?a[e]=t:e===&quot;ref&quot;?n&amp;&amp;(n[t]=a):t!=null&amp;&amp;a.setAttribute(e,t)}),t&amp;&amp;t.appendChild(a),a},t.getDocumentHead=function(e){return e||(e=document),e.head||e.getElementsByTagName(&quot;head&quot;)[0]||e.documentElement},t.createElement=function(e,t){return document.createElementNS?document.createElementNS(t||i,e):document.createElement(e)},t.removeChildren=function(e){e.innerHTML=&quot;&quot;},t.createTextNode=function(e,t){var n=t?t.ownerDocument:document;return n.createTextNode(e)},t.createFragment=function(e){var t=e?e.ownerDocument:document;return t.createDocumentFragment()},t.hasCssClass=function(e,t){var n=(e.className+&quot;&quot;).split(/\ss+/g);return n.indexOf(t)!==-1},t.addCssClass=function(e,n){t.hasCssClass(e,n)||(e.className+=&quot; &quot;+n)},t.removeCssClass=function(e,t){var n=e.className.split(/\ss+/g);for(;;){var r=n.indexOf(t);if(r==-1)break;n.splice(r,1)}e.className=n.join(&quot; &quot;)},t.toggleCssClass=function(e,t){var n=e.className.split(/\ss+/g),r=!0;for(;;){var i=n.indexOf(t);if(i==-1)break;r=!1,n.splice(i,1)}return r&amp;&amp;n.push(t),e.className=n.join(&quot; &quot;),r},t.setCssClass=function(e,n,r){r?t.addCssClass(e,n):t.removeCssClass(e,n)},t.hasCssString=function(e,t){var n=0,r;t=t||document;if(r=t.querySelectorAll(&quot;style&quot;))while(n&lt;r.length)if(r[n++].id===e)return!0},t.importCssString=function(n,r,i){var s=i;if(!i||!i.getRootNode)s=document;else{s=i.getRootNode();if(!s||s==i)s=document}var o=s.ownerDocument||s;if(r&amp;&amp;t.hasCssString(r,s))return null;r&amp;&amp;(n+=&quot;\sn/*# sourceURL=ace/css/&quot;+r+&quot; */&quot;);var u=t.createElement(&quot;style&quot;);u.appendChild(o.createTextNode(n)),r&amp;&amp;(u.id=r),s==o&amp;&amp;(s=t.getDocumentHead(o)),s.insertBefore(u,s.firstChild)},t.importCssStylsheet=function(e,n){t.buildDom([&quot;link&quot;,{rel:&quot;stylesheet&quot;,href:e}],t.getDocumentHead(n))},t.scrollbarWidth=function(e){var n=t.createElement(&quot;ace_inner&quot;);n.style.width=&quot;100%&quot;,n.style.minWidth=&quot;0px&quot;,n.style.height=&quot;200px&quot;,n.style.display=&quot;block&quot;;var r=t.createElement(&quot;ace_outer&quot;),i=r.style;i.position=&quot;absolute&quot;,i.left=&quot;-10000px&quot;,i.overflow=&quot;hidden&quot;,i.width=&quot;200px&quot;,i.minWidth=&quot;0px&quot;,i.height=&quot;150px&quot;,i.display=&quot;block&quot;,r.appendChild(n);var s=e.documentElement;s.appendChild(r);var o=n.offsetWidth;i.overflow=&quot;scroll&quot;;var u=n.offsetWidth;return o==u&amp;&amp;(u=r.clientWidth),s.removeChild(r),o-u},typeof document==&quot;undefined&quot;&amp;&amp;(t.importCssString=function(){}),t.computedStyle=function(e,t){return window.getComputedStyle(e,&quot;&quot;)||{}},t.setStyle=function(e,t,n){e[t]!==n&amp;&amp;(e[t]=n)},t.HAS_CSS_ANIMATION=!1,t.HAS_CSS_TRANSFORMS=!1,t.HI_DPI=r.isWin?typeof window!=&quot;undefined&quot;&amp;&amp;window.devicePixelRatio&gt;=1.5:!0;if(typeof document!=&quot;undefined&quot;){var s=document.createElement(&quot;div&quot;);t.HI_DPI&amp;&amp;s.style.transform!==undefined&amp;&amp;(t.HAS_CSS_TRANSFORMS=!0),!r.isEdge&amp;&amp;typeof s.style.animationName!=&quot;undefined&quot;&amp;&amp;(t.HAS_CSS_ANIMATION=!0),s=null}t.HAS_CSS_TRANSFORMS?t.translate=function(e,t,n){e.style.transform=&quot;translate(&quot;+Math.round(t)+&quot;px, &quot;+Math.round(n)+&quot;px)&quot;}:t.translate=function(e,t,n){e.style.top=Math.round(n)+&quot;px&quot;,e.style.left=Math.round(t)+&quot;px&quot;}}),ace.define(&quot;ace/lib/oop&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},t.mixin=function(e,t){for(var n in t)e[n]=t[n];return e},t.implement=function(e,n){t.mixin(e,n)}}),ace.define(&quot;ace/lib/keys&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./oop&quot;),i=function(){var e={MODIFIER_KEYS:{16:&quot;Shift&quot;,17:&quot;Ctrl&quot;,18:&quot;Alt&quot;,224:&quot;Meta&quot;,91:&quot;MetaLeft&quot;,92:&quot;MetaRight&quot;,93:&quot;ContextMenu&quot;},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,&quot;super&quot;:8,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:&quot;Backspace&quot;,9:&quot;Tab&quot;,13:&quot;Return&quot;,19:&quot;Pause&quot;,27:&quot;Esc&quot;,32:&quot;Space&quot;,33:&quot;PageUp&quot;,34:&quot;PageDown&quot;,35:&quot;End&quot;,36:&quot;Home&quot;,37:&quot;Left&quot;,38:&quot;Up&quot;,39:&quot;Right&quot;,40:&quot;Down&quot;,44:&quot;Print&quot;,45:&quot;Insert&quot;,46:&quot;Delete&quot;,96:&quot;Numpad0&quot;,97:&quot;Numpad1&quot;,98:&quot;Numpad2&quot;,99:&quot;Numpad3&quot;,100:&quot;Numpad4&quot;,101:&quot;Numpad5&quot;,102:&quot;Numpad6&quot;,103:&quot;Numpad7&quot;,104:&quot;Numpad8&quot;,105:&quot;Numpad9&quot;,&quot;-13&quot;:&quot;NumpadEnter&quot;,112:&quot;F1&quot;,113:&quot;F2&quot;,114:&quot;F3&quot;,115:&quot;F4&quot;,116:&quot;F5&quot;,117:&quot;F6&quot;,118:&quot;F7&quot;,119:&quot;F8&quot;,120:&quot;F9&quot;,121:&quot;F10&quot;,122:&quot;F11&quot;,123:&quot;F12&quot;,144:&quot;Numlock&quot;,145:&quot;Scrolllock&quot;},PRINTABLE_KEYS:{32:&quot; &quot;,48:&quot;0&quot;,49:&quot;1&quot;,50:&quot;2&quot;,51:&quot;3&quot;,52:&quot;4&quot;,53:&quot;5&quot;,54:&quot;6&quot;,55:&quot;7&quot;,56:&quot;8&quot;,57:&quot;9&quot;,59:&quot;;&quot;,61:&quot;=&quot;,65:&quot;a&quot;,66:&quot;b&quot;,67:&quot;c&quot;,68:&quot;d&quot;,69:&quot;e&quot;,70:&quot;f&quot;,71:&quot;g&quot;,72:&quot;h&quot;,73:&quot;i&quot;,74:&quot;j&quot;,75:&quot;k&quot;,76:&quot;l&quot;,77:&quot;m&quot;,78:&quot;n&quot;,79:&quot;o&quot;,80:&quot;p&quot;,81:&quot;q&quot;,82:&quot;r&quot;,83:&quot;s&quot;,84:&quot;t&quot;,85:&quot;u&quot;,86:&quot;v&quot;,87:&quot;w&quot;,88:&quot;x&quot;,89:&quot;y&quot;,90:&quot;z&quot;,107:&quot;+&quot;,109:&quot;-&quot;,110:&quot;.&quot;,186:&quot;;&quot;,187:&quot;=&quot;,188:&quot;,&quot;,189:&quot;-&quot;,190:&quot;.&quot;,191:&quot;/&quot;,192:&quot;`&quot;,219:&quot;[&quot;,220:&quot;\s\s&quot;,221:&quot;]&quot;,222:&quot;'&quot;,111:&quot;/&quot;,106:&quot;*&quot;}},t,n;for(n in e.FUNCTION_KEYS)t=e.FUNCTION_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);for(n in e.PRINTABLE_KEYS)t=e.PRINTABLE_KEYS[n].toLowerCase(),e[t]=parseInt(n,10);return r.mixin(e,e.MODIFIER_KEYS),r.mixin(e,e.PRINTABLE_KEYS),r.mixin(e,e.FUNCTION_KEYS),e.enter=e[&quot;return&quot;],e.escape=e.esc,e.del=e[&quot;delete&quot;],e[173]=&quot;-&quot;,function(){var t=[&quot;cmd&quot;,&quot;ctrl&quot;,&quot;alt&quot;,&quot;shift&quot;];for(var n=Math.pow(2,t.length);n--;)e.KEY_MODS[n]=t.filter(function(t){return n&amp;e.KEY_MODS[t]}).join(&quot;-&quot;)+&quot;-&quot;}(),e.KEY_MODS[0]=&quot;&quot;,e.KEY_MODS[-1]=&quot;input-&quot;,e}();r.mixin(t,i),t.keyCodeToString=function(e){var t=i[e];return typeof t!=&quot;string&quot;&amp;&amp;(t=String.fromCharCode(e)),t.toLowerCase()}}),ace.define(&quot;ace/lib/event&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/keys&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;function a(){u=!1;try{document.createComment(&quot;&quot;).addEventListener(&quot;test&quot;,function(){},{get passive(){u={passive:!1}}})}catch(e){}}function f(){return u==undefined&amp;&amp;a(),u}function c(e,t,n){var u=l(t);if(!i.isMac&amp;&amp;s){t.getModifierState&amp;&amp;(t.getModifierState(&quot;OS&quot;)||t.getModifierState(&quot;Win&quot;))&amp;&amp;(u|=8);if(s.altGr){if((3&amp;u)==3)return;s.altGr=0}if(n===18||n===17){var a=&quot;location&quot;in t?t.location:t.keyLocation;if(n===17&amp;&amp;a===1)s[n]==1&amp;&amp;(o=t.timeStamp);else if(n===18&amp;&amp;u===3&amp;&amp;a===2){var f=t.timeStamp-o;f&lt;50&amp;&amp;(s.altGr=!0)}}}n in r.MODIFIER_KEYS&amp;&amp;(n=-1);if(!u&amp;&amp;n===13){var a=&quot;location&quot;in t?t.location:t.keyLocation;if(a===3){e(t,u,-n);if(t.defaultPrevented)return}}if(i.isChromeOS&amp;&amp;u&amp;8){e(t,u,n);if(t.defaultPrevented)return;u&amp;=-9}return!!u||n in r.FUNCTION_KEYS||n in r.PRINTABLE_KEYS?e(t,u,n):!1}function h(){s=Object.create(null)}var r=e(&quot;./keys&quot;),i=e(&quot;./useragent&quot;),s=null,o=0,u;t.addListener=function(e,t,n){return e.addEventListener(t,n,f())},t.removeListener=function(e,t,n){return e.removeEventListener(t,n,f())},t.stopEvent=function(e){return t.stopPropagation(e),t.preventDefault(e),!1},t.stopPropagation=function(e){e.stopPropagation&amp;&amp;e.stopPropagation()},t.preventDefault=function(e){e.preventDefault&amp;&amp;e.preventDefault()},t.getButton=function(e){return e.type==&quot;dblclick&quot;?0:e.type==&quot;contextmenu&quot;||i.isMac&amp;&amp;e.ctrlKey&amp;&amp;!e.altKey&amp;&amp;!e.shiftKey?2:e.button},t.capture=function(e,n,r){function i(e){n&amp;&amp;n(e),r&amp;&amp;r(e),t.removeListener(document,&quot;mousemove&quot;,n,!0),t.removeListener(document,&quot;mouseup&quot;,i,!0),t.removeListener(document,&quot;dragstart&quot;,i,!0)}return t.addListener(document,&quot;mousemove&quot;,n,!0),t.addListener(document,&quot;mouseup&quot;,i,!0),t.addListener(document,&quot;dragstart&quot;,i,!0),i},t.addMouseWheelListener=function(e,n){&quot;onmousewheel&quot;in e?t.addListener(e,&quot;mousewheel&quot;,function(e){var t=8;e.wheelDeltaX!==undefined?(e.wheelX=-e.wheelDeltaX/t,e.wheelY=-e.wheelDeltaY/t):(e.wheelX=0,e.wheelY=-e.wheelDelta/t),n(e)}):&quot;onwheel&quot;in e?t.addListener(e,&quot;wheel&quot;,function(e){var t=.35;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=e.deltaX*t||0,e.wheelY=e.deltaY*t||0;break;case e.DOM_DELTA_LINE:case e.DOM_DELTA_PAGE:e.wheelX=(e.deltaX||0)*5,e.wheelY=(e.deltaY||0)*5}n(e)}):t.addListener(e,&quot;DOMMouseScroll&quot;,function(e){e.axis&amp;&amp;e.axis==e.HORIZONTAL_AXIS?(e.wheelX=(e.detail||0)*5,e.wheelY=0):(e.wheelX=0,e.wheelY=(e.detail||0)*5),n(e)})},t.addMultiMouseDownListener=function(e,n,r,s){function c(e){t.getButton(e)!==0?o=0:e.detail&gt;1?(o++,o&gt;4&amp;&amp;(o=1)):o=1;if(i.isIE){var c=Math.abs(e.clientX-u)&gt;5||Math.abs(e.clientY-a)&gt;5;if(!f||c)o=1;f&amp;&amp;clearTimeout(f),f=setTimeout(function(){f=null},n[o-1]||600),o==1&amp;&amp;(u=e.clientX,a=e.clientY)}e._clicks=o,r[s](&quot;mousedown&quot;,e);if(o&gt;4)o=0;else if(o&gt;1)return r[s](l[o],e)}var o=0,u,a,f,l={2:&quot;dblclick&quot;,3:&quot;tripleclick&quot;,4:&quot;quadclick&quot;};Array.isArray(e)||(e=[e]),e.forEach(function(e){t.addListener(e,&quot;mousedown&quot;,c)})};var l=function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)};t.getModifierString=function(e){return r.KEY_MODS[l(e)]},t.addCommandKeyListener=function(e,n){var r=t.addListener;if(i.isOldGecko||i.isOpera&amp;&amp;!(&quot;KeyboardEvent&quot;in window)){var o=null;r(e,&quot;keydown&quot;,function(e){o=e.keyCode}),r(e,&quot;keypress&quot;,function(e){return c(n,e,o)})}else{var u=null;r(e,&quot;keydown&quot;,function(e){s[e.keyCode]=(s[e.keyCode]||0)+1;var t=c(n,e,e.keyCode);return u=e.defaultPrevented,t}),r(e,&quot;keypress&quot;,function(e){u&amp;&amp;(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)&amp;&amp;(t.stopEvent(e),u=null)}),r(e,&quot;keyup&quot;,function(e){s[e.keyCode]=null}),s||(h(),r(window,&quot;focus&quot;,h))}};if(typeof window==&quot;object&quot;&amp;&amp;window.postMessage&amp;&amp;!i.isOldIE){var p=1;t.nextTick=function(e,n){n=n||window;var r=&quot;zero-timeout-message-&quot;+p++,i=function(s){s.data==r&amp;&amp;(t.stopPropagation(s),t.removeListener(n,&quot;message&quot;,i),e())};t.addListener(n,&quot;message&quot;,i),n.postMessage(r,&quot;*&quot;)}}t.$idleBlocked=!1,t.onIdle=function(e,n){return setTimeout(function r(){t.$idleBlocked?setTimeout(r,100):e()},n)},t.$idleBlockId=null,t.blockIdle=function(e){t.$idleBlockId&amp;&amp;clearTimeout(t.$idleBlockId),t.$idleBlocked=!0,t.$idleBlockId=setTimeout(function(){t.$idleBlocked=!1},e||100)},t.nextFrame=typeof window==&quot;object&quot;&amp;&amp;(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),t.nextFrame?t.nextFrame=t.nextFrame.bind(window):t.nextFrame=function(e){setTimeout(e,17)}}),ace.define(&quot;ace/range&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r=function(e,t){return e.row-t.row||e.column-t.column},i=function(e,t,n,r){this.start={row:e,column:t},this.end={row:n,column:r}};(function(){this.isEqual=function(e){return this.start.row===e.start.row&amp;&amp;this.end.row===e.end.row&amp;&amp;this.start.column===e.start.column&amp;&amp;this.end.column===e.end.column},this.toString=function(){return&quot;Range: [&quot;+this.start.row+&quot;/&quot;+this.start.column+&quot;] -&gt; [&quot;+this.end.row+&quot;/&quot;+this.end.column+&quot;]&quot;},this.contains=function(e,t){return this.compare(e,t)==0},this.compareRange=function(e){var t,n=e.end,r=e.start;return t=this.compare(n.row,n.column),t==1?(t=this.compare(r.row,r.column),t==1?2:t==0?1:0):t==-1?-2:(t=this.compare(r.row,r.column),t==-1?-1:t==1?42:0)},this.comparePoint=function(e){return this.compare(e.row,e.column)},this.containsRange=function(e){return this.comparePoint(e.start)==0&amp;&amp;this.comparePoint(e.end)==0},this.intersects=function(e){var t=this.compareRange(e);return t==-1||t==0||t==1},this.isEnd=function(e,t){return this.end.row==e&amp;&amp;this.end.column==t},this.isStart=function(e,t){return this.start.row==e&amp;&amp;this.start.column==t},this.setStart=function(e,t){typeof e==&quot;object&quot;?(this.start.column=e.column,this.start.row=e.row):(this.start.row=e,this.start.column=t)},this.setEnd=function(e,t){typeof e==&quot;object&quot;?(this.end.column=e.column,this.end.row=e.row):(this.end.row=e,this.end.column=t)},this.inside=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)||this.isStart(e,t)?!1:!0:!1},this.insideStart=function(e,t){return this.compare(e,t)==0?this.isEnd(e,t)?!1:!0:!1},this.insideEnd=function(e,t){return this.compare(e,t)==0?this.isStart(e,t)?!1:!0:!1},this.compare=function(e,t){return!this.isMultiLine()&amp;&amp;e===this.start.row?t&lt;this.start.column?-1:t&gt;this.end.column?1:0:e&lt;this.start.row?-1:e&gt;this.end.row?1:this.start.row===e?t&gt;=this.start.column?0:-1:this.end.row===e?t&lt;=this.end.column?0:1:0},this.compareStart=function(e,t){return this.start.row==e&amp;&amp;this.start.column==t?-1:this.compare(e,t)},this.compareEnd=function(e,t){return this.end.row==e&amp;&amp;this.end.column==t?1:this.compare(e,t)},this.compareInside=function(e,t){return this.end.row==e&amp;&amp;this.end.column==t?1:this.start.row==e&amp;&amp;this.start.column==t?-1:this.compare(e,t)},this.clipRows=function(e,t){if(this.end.row&gt;t)var n={row:t+1,column:0};else if(this.end.row&lt;e)var n={row:e,column:0};if(this.start.row&gt;t)var r={row:t+1,column:0};else if(this.start.row&lt;e)var r={row:e,column:0};return i.fromPoints(r||this.start,n||this.end)},this.extend=function(e,t){var n=this.compare(e,t);if(n==0)return this;if(n==-1)var r={row:e,column:t};else var s={row:e,column:t};return i.fromPoints(r||this.start,s||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&amp;&amp;this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return i.fromPoints(this.start,this.end)},this.collapseRows=function(){return this.end.column==0?new i(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new i(this.start.row,0,this.end.row,0)},this.toScreenRange=function(e){var t=e.documentToScreenPosition(this.start),n=e.documentToScreenPosition(this.end);return new i(t.row,t.column,n.row,n.column)},this.moveBy=function(e,t){this.start.row+=e,this.start.column+=t,this.end.row+=e,this.end.column+=t}}).call(i.prototype),i.fromPoints=function(e,t){return new i(e.row,e.column,t.row,t.column)},i.comparePoints=r,i.comparePoints=function(e,t){return e.row-t.row||e.column-t.column},t.Range=i}),ace.define(&quot;ace/lib/lang&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.last=function(e){return e[e.length-1]},t.stringReverse=function(e){return e.split(&quot;&quot;).reverse().join(&quot;&quot;)},t.stringRepeat=function(e,t){var n=&quot;&quot;;while(t&gt;0){t&amp;1&amp;&amp;(n+=e);if(t&gt;&gt;=1)e+=e}return n};var r=/^\ss\ss*/,i=/\ss\ss*$/;t.stringTrimLeft=function(e){return e.replace(r,&quot;&quot;)},t.stringTrimRight=function(e){return e.replace(i,&quot;&quot;)},t.copyObject=function(e){var t={};for(var n in e)t[n]=e[n];return t},t.copyArray=function(e){var t=[];for(var n=0,r=e.length;n&lt;r;n++)e[n]&amp;&amp;typeof e[n]==&quot;object&quot;?t[n]=this.copyObject(e[n]):t[n]=e[n];return t},t.deepCopy=function s(e){if(typeof e!=&quot;object&quot;||!e)return e;var t;if(Array.isArray(e)){t=[];for(var n=0;n&lt;e.length;n++)t[n]=s(e[n]);return t}if(Object.prototype.toString.call(e)!==&quot;[object Object]&quot;)return e;t={};for(var n in e)t[n]=s(e[n]);return t},t.arrayToMap=function(e){var t={};for(var n=0;n&lt;e.length;n++)t[e[n]]=1;return t},t.createMap=function(e){var t=Object.create(null);for(var n in e)t[n]=e[n];return t},t.arrayRemove=function(e,t){for(var n=0;n&lt;=e.length;n++)t===e[n]&amp;&amp;e.splice(n,1)},t.escapeRegExp=function(e){return e.replace(/([.*+?^${}()|[\s]\s/\s\s])/g,&quot;\s\s$1&quot;)},t.escapeHTML=function(e){return(&quot;&quot;+e).replace(/&amp;/g,&quot;&amp;#38;&quot;).replace(/&quot;/g,&quot;&amp;#34;&quot;).replace(/'/g,&quot;&amp;#39;&quot;).replace(/&lt;/g,&quot;&amp;#60;&quot;)},t.getMatchOffsets=function(e,t){var n=[];return e.replace(t,function(e){n.push({offset:arguments[arguments.length-2],length:e.length})}),n},t.deferredCall=function(e){var t=null,n=function(){t=null,e()},r=function(e){return r.cancel(),t=setTimeout(n,e||0),r};return r.schedule=r,r.call=function(){return this.cancel(),e(),r},r.cancel=function(){return clearTimeout(t),t=null,r},r.isPending=function(){return t},r},t.delayedCall=function(e,t){var n=null,r=function(){n=null,e()},i=function(e){n==null&amp;&amp;(n=setTimeout(r,e||t))};return i.delay=function(e){n&amp;&amp;clearTimeout(n),n=setTimeout(r,e||t)},i.schedule=i,i.call=function(){this.cancel(),e()},i.cancel=function(){n&amp;&amp;clearTimeout(n),n=null},i.isPending=function(){return n},i}}),ace.define(&quot;ace/clipboard&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r;n.exports={lineMode:!1,pasteCancelled:function(){return r&amp;&amp;r&gt;Date.now()-50?!0:r=!1},cancel:function(){r=Date.now()}}}),ace.define(&quot;ace/keyboard/textinput&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/lang&quot;,&quot;ace/clipboard&quot;,&quot;ace/lib/keys&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/event&quot;),i=e(&quot;../lib/useragent&quot;),s=e(&quot;../lib/dom&quot;),o=e(&quot;../lib/lang&quot;),u=e(&quot;../clipboard&quot;),a=i.isChrome&lt;18,f=i.isIE,l=i.isChrome&gt;63,c=400,h=e(&quot;../lib/keys&quot;),p=h.KEY_MODS,d=i.isIOS,v=d?/\ss/:/\sn/,m=function(e,t){function W(){S=!0,n.blur(),n.focus(),S=!1}function V(e){e.keyCode==27&amp;&amp;n.value.length&lt;n.selectionStart&amp;&amp;(y||(x=n.value),T=N=-1,A()),X()}function J(){clearTimeout($),$=setTimeout(function(){w&amp;&amp;(n.style.cssText=w,w=&quot;&quot;),t.renderer.$isMousePressed=!1,t.renderer.$keepTextAreaAtCursor&amp;&amp;t.renderer.$moveTextAreaToCursor()},0)}function Q(e,t,n){var r=null,i=!1;n.addEventListener(&quot;keydown&quot;,function(e){r&amp;&amp;clearTimeout(r),i=!0},!0),n.addEventListener(&quot;keyup&quot;,function(e){r=setTimeout(function(){i=!1},100)},!0);var s=function(e){if(document.activeElement!==n)return;if(i||y||t.$mouseHandler.isMousePressed)return;if(m)return;var r=n.selectionStart,s=n.selectionEnd,o=null,u=0;if(r==0)o=h.up;else if(r==1)o=h.home;else if(s&gt;N&amp;&amp;x[s]==&quot;\sn&quot;)o=h.end;else if(r&lt;T&amp;&amp;x[r-1]==&quot; &quot;)o=h.left,u=p.option;else if(r&lt;T||r==T&amp;&amp;N!=T&amp;&amp;r==s)o=h.left;else if(s&gt;N&amp;&amp;x.slice(0,s).split(&quot;\sn&quot;).length&gt;2)o=h.down;else if(s&gt;N&amp;&amp;x[s-1]==&quot; &quot;)o=h.right,u=p.option;else if(s&gt;N||s==N&amp;&amp;N!=T&amp;&amp;r==s)o=h.right;r!==s&amp;&amp;(u|=p.shift);if(o){var a=t.onCommandKey({},u,o);if(!a&amp;&amp;t.commands){o=h.keyCodeToString(o);var f=t.commands.findKeyCommand(u,o);f&amp;&amp;t.execCommand(f)}T=r,N=s,A(&quot;&quot;)}};document.addEventListener(&quot;selectionchange&quot;,s),t.on(&quot;destroy&quot;,function(){document.removeEventListener(&quot;selectionchange&quot;,s)})}var n=s.createElement(&quot;textarea&quot;);n.className=&quot;ace_text-input&quot;,n.setAttribute(&quot;wrap&quot;,&quot;off&quot;),n.setAttribute(&quot;autocorrect&quot;,&quot;off&quot;),n.setAttribute(&quot;autocapitalize&quot;,&quot;off&quot;),n.setAttribute(&quot;spellcheck&quot;,!1),n.style.opacity=&quot;0&quot;,e.insertBefore(n,e.firstChild);var m=!1,g=!1,y=!1,b=!1,w=&quot;&quot;;i.isMobile||(n.style.fontSize=&quot;1px&quot;);var E=!1,S=!1,x=&quot;&quot;,T=0,N=0,C=0;try{var k=document.activeElement===n}catch(L){}r.addListener(n,&quot;blur&quot;,function(e){if(S)return;t.onBlur(e),k=!1}),r.addListener(n,&quot;focus&quot;,function(e){if(S)return;k=!0;if(i.isEdge)try{if(!document.hasFocus())return}catch(e){}t.onFocus(e),i.isEdge?setTimeout(A):A()}),this.$focusScroll=!1,this.focus=function(){if(w||l||this.$focusScroll==&quot;browser&quot;)return n.focus({preventScroll:!0});var e=n.style.top;n.style.position=&quot;fixed&quot;,n.style.top=&quot;0px&quot;;try{var t=n.getBoundingClientRect().top!=0}catch(r){return}var i=[];if(t){var s=n.parentElement;while(s&amp;&amp;s.nodeType==1)i.push(s),s.setAttribute(&quot;ace_nocontext&quot;,!0),!s.parentElement&amp;&amp;s.getRootNode?s=s.getRootNode().host:s=s.parentElement}n.focus({preventScroll:!0}),t&amp;&amp;i.forEach(function(e){e.removeAttribute(&quot;ace_nocontext&quot;)}),setTimeout(function(){n.style.position=&quot;&quot;,n.style.top==&quot;0px&quot;&amp;&amp;(n.style.top=e)},0)},this.blur=function(){n.blur()},this.isFocused=function(){return k},t.on(&quot;beforeEndOperation&quot;,function(){if(t.curOp&amp;&amp;t.curOp.command.name==&quot;insertstring&quot;)return;y&amp;&amp;(x=n.value=&quot;&quot;,z()),A()});var A=d?function(e){if(!k||m&amp;&amp;!e||b)return;e||(e=&quot;&quot;);var r=&quot;\sn ab&quot;+e+&quot;cde fg\sn&quot;;r!=n.value&amp;&amp;(n.value=x=r);var i=4,s=4+(e.length||(t.selection.isEmpty()?0:1));(T!=i||N!=s)&amp;&amp;n.setSelectionRange(i,s),T=i,N=s}:function(){if(y||b)return;if(!k&amp;&amp;!D)return;y=!0;var e=t.selection,r=e.getRange(),i=e.cursor.row,s=r.start.column,o=r.end.column,u=t.session.getLine(i);if(r.start.row!=i){var a=t.session.getLine(i-1);s=r.start.row&lt;i-1?0:s,o+=a.length+1,u=a+&quot;\sn&quot;+u}else if(r.end.row!=i){var f=t.session.getLine(i+1);o=r.end.row&gt;i+1?f.length:o,o+=u.length+1,u=u+&quot;\sn&quot;+f}u.length&gt;c&amp;&amp;(s&lt;c&amp;&amp;o&lt;c?u=u.slice(0,c):(u=&quot;\sn&quot;,s=0,o=1));var l=u+&quot;\sn\sn&quot;;l!=x&amp;&amp;(n.value=x=l,T=N=l.length),D&amp;&amp;(T=n.selectionStart,N=n.selectionEnd);if(N!=o||T!=s||n.selectionEnd!=N)try{n.setSelectionRange(s,o),T=s,N=o}catch(h){}y=!1};k&amp;&amp;t.onFocus();var O=function(e){return e.selectionStart===0&amp;&amp;e.selectionEnd&gt;=x.length&amp;&amp;e.value===x&amp;&amp;x&amp;&amp;e.selectionEnd!==N},M=function(e){if(y)return;m?m=!1:O(n)&amp;&amp;(t.selectAll(),A())},_=null;this.setInputHandler=function(e){_=e},this.getInputHandler=function(){return _};var D=!1,P=function(e,r){D&amp;&amp;(D=!1);if(g)return A(),e&amp;&amp;t.onPaste(e),g=!1,&quot;&quot;;var i=n.selectionStart,s=n.selectionEnd,o=T,u=x.length-N,a=e,f=e.length-i,l=e.length-s,c=0;while(o&gt;0&amp;&amp;x[c]==e[c])c++,o--;a=a.slice(c),c=1;while(u&gt;0&amp;&amp;x.length-c&gt;T-1&amp;&amp;x[x.length-c]==e[e.length-c])c++,u--;f-=c-1,l-=c-1;var h=a.length-c+1;return h&lt;0&amp;&amp;(o=-h,h=0),a=a.slice(0,h),!r&amp;&amp;!a&amp;&amp;!f&amp;&amp;!o&amp;&amp;!u&amp;&amp;!l?&quot;&quot;:(b=!0,a&amp;&amp;!o&amp;&amp;!u&amp;&amp;!f&amp;&amp;!l||E?t.onTextInput(a):t.onTextInput(a,{extendLeft:o,extendRight:u,restoreStart:f,restoreEnd:l}),b=!1,x=e,T=i,N=s,C=l,a)},H=function(e){if(y)return U();if(e&amp;&amp;e.inputType){if(e.inputType==&quot;historyUndo&quot;)return t.execCommand(&quot;undo&quot;);if(e.inputType==&quot;historyRedo&quot;)return t.execCommand(&quot;redo&quot;)}var r=n.value,i=P(r,!0);(r.length&gt;c+100||v.test(i))&amp;&amp;A()},B=function(e,t,n){var r=e.clipboardData||window.clipboardData;if(!r||a)return;var i=f||n?&quot;Text&quot;:&quot;text/plain&quot;;try{return t?r.setData(i,t)!==!1:r.getData(i)}catch(e){if(!n)return B(e,t,!0)}},j=function(e,i){var s=t.getCopyText();if(!s)return r.preventDefault(e);B(e,s)?(d&amp;&amp;(A(s),m=s,setTimeout(function(){m=!1},10)),i?t.onCut():t.onCopy(),r.preventDefault(e)):(m=!0,n.value=s,n.select(),setTimeout(function(){m=!1,A(),i?t.onCut():t.onCopy()}))},F=function(e){j(e,!0)},I=function(e){j(e,!1)},q=function(e){var s=B(e);if(u.pasteCancelled())return;typeof s==&quot;string&quot;?(s&amp;&amp;t.onPaste(s,e),i.isIE&amp;&amp;setTimeout(A),r.preventDefault(e)):(n.value=&quot;&quot;,g=!0)};r.addCommandKeyListener(n,t.onCommandKey.bind(t)),r.addListener(n,&quot;select&quot;,M),r.addListener(n,&quot;input&quot;,H),r.addListener(n,&quot;cut&quot;,F),r.addListener(n,&quot;copy&quot;,I),r.addListener(n,&quot;paste&quot;,q),(!(&quot;oncut&quot;in n)||!(&quot;oncopy&quot;in n)||!(&quot;onpaste&quot;in n))&amp;&amp;r.addListener(e,&quot;keydown&quot;,function(e){if(i.isMac&amp;&amp;!e.metaKey||!e.ctrlKey)return;switch(e.keyCode){case 67:I(e);break;case 86:q(e);break;case 88:F(e)}});var R=function(e){if(y||!t.onCompositionStart||t.$readOnly)return;y={};if(E)return;setTimeout(U,0),t.on(&quot;mousedown&quot;,W);var r=t.getSelectionRange();r.end.row=r.start.row,r.end.column=r.start.column,y.markerRange=r,y.selectionStart=T,t.onCompositionStart(y),y.useTextareaForIME?(n.value=&quot;&quot;,x=&quot;&quot;,T=0,N=0):(n.msGetInputContext&amp;&amp;(y.context=n.msGetInputContext()),n.getInputContext&amp;&amp;(y.context=n.getInputContext()))},U=function(){if(!y||!t.onCompositionUpdate||t.$readOnly)return;if(E)return W();if(y.useTextareaForIME)t.onCompositionUpdate(n.value);else{var e=n.value;P(e),y.markerRange&amp;&amp;(y.context&amp;&amp;(y.markerRange.start.column=y.selectionStart=y.context.compositionStartOffset),y.markerRange.end.column=y.markerRange.start.column+N-y.selectionStart+C)}},z=function(e){if(!t.onCompositionEnd||t.$readOnly)return;y=!1,t.onCompositionEnd(),t.off(&quot;mousedown&quot;,W),e&amp;&amp;H()},X=o.delayedCall(U,50).schedule.bind(null,null);r.addListener(n,&quot;compositionstart&quot;,R),r.addListener(n,&quot;compositionupdate&quot;,U),r.addListener(n,&quot;keyup&quot;,V),r.addListener(n,&quot;keydown&quot;,X),r.addListener(n,&quot;compositionend&quot;,z),this.getElement=function(){return n},this.setCommandMode=function(e){E=e,n.readOnly=!1},this.setReadOnly=function(e){E||(n.readOnly=e)},this.setCopyWithEmptySelection=function(e){},this.onContextMenu=function(e){D=!0,A(),t._emit(&quot;nativecontextmenu&quot;,{target:t,domEvent:e}),this.moveToMouse(e,!0)},this.moveToMouse=function(e,o){w||(w=n.style.cssText),n.style.cssText=(o?&quot;z-index:100000;&quot;:&quot;&quot;)+(i.isIE?&quot;opacity:0.1;&quot;:&quot;&quot;)+&quot;text-indent: -&quot;+(T+N)*t.renderer.characterWidth*.5+&quot;px;&quot;;var u=t.container.getBoundingClientRect(),a=s.computedStyle(t.container),f=u.top+(parseInt(a.borderTopWidth)||0),l=u.left+(parseInt(u.borderLeftWidth)||0),c=u.bottom-f-n.clientHeight-2,h=function(e){s.translate(n,e.clientX-l-2,Math.min(e.clientY-f-2,c))};h(e);if(e.type!=&quot;mousedown&quot;)return;t.renderer.$isMousePressed=!0,clearTimeout($),i.isWin&amp;&amp;r.capture(t.container,h,J)},this.onContextMenuClose=J;var $,K=function(e){t.textInput.onContextMenu(e),J()};r.addListener(n,&quot;mouseup&quot;,K),r.addListener(n,&quot;mousedown&quot;,function(e){e.preventDefault(),J()}),r.addListener(t.renderer.scroller,&quot;contextmenu&quot;,K),r.addListener(n,&quot;contextmenu&quot;,K),d&amp;&amp;Q(e,t,n)};t.TextInput=m}),ace.define(&quot;ace/mouse/default_handlers&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;function o(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler(&quot;mousedown&quot;,this.onMouseDown.bind(e)),t.setDefaultHandler(&quot;dblclick&quot;,this.onDoubleClick.bind(e)),t.setDefaultHandler(&quot;tripleclick&quot;,this.onTripleClick.bind(e)),t.setDefaultHandler(&quot;quadclick&quot;,this.onQuadClick.bind(e)),t.setDefaultHandler(&quot;mousewheel&quot;,this.onMouseWheel.bind(e));var n=[&quot;select&quot;,&quot;startSelect&quot;,&quot;selectEnd&quot;,&quot;selectAllEnd&quot;,&quot;selectByWordsEnd&quot;,&quot;selectByLinesEnd&quot;,&quot;dragWait&quot;,&quot;dragWaitEnd&quot;,&quot;focusWait&quot;];n.forEach(function(t){e[t]=this[t]},this),e.selectByLines=this.extendSelectionBy.bind(e,&quot;getLineRange&quot;),e.selectByWords=this.extendSelectionBy.bind(e,&quot;getWordRange&quot;)}function u(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}function a(e,t){if(e.start.row==e.end.row)var n=2*t.column-e.start.column-e.end.column;else if(e.start.row==e.end.row-1&amp;&amp;!e.start.column&amp;&amp;!e.end.column)var n=t.column-4;else var n=2*t.row-e.start.row-e.end.row;return n&lt;0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}var r=e(&quot;../lib/useragent&quot;),i=0,s=550;(function(){this.onMouseDown=function(e){var t=e.inSelection(),n=e.getDocumentPosition();this.mousedownEvent=e;var i=this.editor,s=e.getButton();if(s!==0){var o=i.getSelectionRange(),u=o.isEmpty();(u||s==1)&amp;&amp;i.selection.moveToPosition(n),s==2&amp;&amp;(i.textInput.onContextMenu(e.domEvent),r.isMozilla||e.preventDefault());return}this.mousedownEvent.time=Date.now();if(t&amp;&amp;!i.isFocused()){i.focus();if(this.$focusTimeout&amp;&amp;!this.$clickSelection&amp;&amp;!i.inMultiSelectMode){this.setState(&quot;focusWait&quot;),this.captureMouse(e);return}}return this.captureMouse(e),this.startSelect(n,e.domEvent._clicks&gt;1),e.preventDefault()},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var n=this.editor;if(!this.mousedownEvent)return;this.mousedownEvent.getShiftKey()?n.selection.selectToPosition(e):t||n.selection.moveToPosition(e),t||this.select(),n.renderer.scroller.setCapture&amp;&amp;n.renderer.scroller.setCapture(),n.setStyle(&quot;ace_selecting&quot;),this.setState(&quot;select&quot;)},this.select=function(){var e,t=this.editor,n=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var r=this.$clickSelection.comparePoint(n);if(r==-1)e=this.$clickSelection.end;else if(r==1)e=this.$clickSelection.start;else{var i=a(this.$clickSelection,n);n=i.cursor,e=i.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(n),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,n=this.editor,r=n.renderer.screenToTextCoordinates(this.x,this.y),i=n.selection[e](r.row,r.column);if(this.$clickSelection){var s=this.$clickSelection.comparePoint(i.start),o=this.$clickSelection.comparePoint(i.end);if(s==-1&amp;&amp;o&lt;=0){t=this.$clickSelection.end;if(i.end.row!=r.row||i.end.column!=r.column)r=i.start}else if(o==1&amp;&amp;s&gt;=0){t=this.$clickSelection.start;if(i.start.row!=r.row||i.start.column!=r.column)r=i.end}else if(s==-1&amp;&amp;o==1)r=i.end,t=i.start;else{var u=a(this.$clickSelection,r);r=u.cursor,t=u.anchor}n.selection.setSelectionAnchor(t.row,t.column)}n.selection.selectToPosition(r),n.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle(&quot;ace_selecting&quot;),this.editor.renderer.scroller.releaseCapture&amp;&amp;this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e=u(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y),t=Date.now();(e&gt;i||t-this.mousedownEvent.time&gt;this.$focusTimeout)&amp;&amp;this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),n=this.editor,r=n.session,i=r.getBracketRange(t);i?(i.isEmpty()&amp;&amp;(i.start.column--,i.end.column++),this.setState(&quot;select&quot;)):(i=n.selection.getWordRange(t.row,t.column),this.setState(&quot;selectByWords&quot;)),this.$clickSelection=i,this.select()},this.onTripleClick=function(e){var t=e.getDocumentPosition(),n=this.editor;this.setState(&quot;selectByLines&quot;);var r=n.getSelectionRange();r.isMultiLine()&amp;&amp;r.contains(t.row,t.column)?(this.$clickSelection=n.selection.getLineRange(r.start.row),this.$clickSelection.end=n.selection.getLineRange(r.end.row).end):this.$clickSelection=n.selection.getLineRange(t.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState(&quot;selectAll&quot;)},this.onMouseWheel=function(e){if(e.getAccelKey())return;e.getShiftKey()&amp;&amp;e.wheelY&amp;&amp;!e.wheelX&amp;&amp;(e.wheelX=e.wheelY,e.wheelY=0);var t=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var n=this.$lastScroll,r=e.domEvent.timeStamp,i=r-n.t,o=i?e.wheelX/i:n.vx,u=i?e.wheelY/i:n.vy;i&lt;s&amp;&amp;(o=(o+n.vx)/2,u=(u+n.vy)/2);var a=Math.abs(o/u),f=!1;a&gt;=1&amp;&amp;t.renderer.isScrollableBy(e.wheelX*e.speed,0)&amp;&amp;(f=!0),a&lt;=1&amp;&amp;t.renderer.isScrollableBy(0,e.wheelY*e.speed)&amp;&amp;(f=!0);if(f)n.allowed=r;else if(r-n.allowed&lt;s){var l=Math.abs(o)&lt;=1.5*Math.abs(n.vx)&amp;&amp;Math.abs(u)&lt;=1.5*Math.abs(n.vy);l?(f=!0,n.allowed=r):n.allowed=0}n.t=r,n.vx=o,n.vy=u;if(f)return t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()}}).call(o.prototype),t.DefaultHandlers=o}),ace.define(&quot;ace/tooltip&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;function s(e){this.isOpen=!1,this.$element=null,this.$parentNode=e}var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/dom&quot;);(function(){this.$init=function(){return this.$element=i.createElement(&quot;div&quot;),this.$element.className=&quot;ace_tooltip&quot;,this.$element.style.display=&quot;none&quot;,this.$parentNode.appendChild(this.$element),this.$element},this.getElement=function(){return this.$element||this.$init()},this.setText=function(e){this.getElement().textContent=e},this.setHtml=function(e){this.getElement().innerHTML=e},this.setPosition=function(e,t){this.getElement().style.left=e+&quot;px&quot;,this.getElement().style.top=t+&quot;px&quot;},this.setClassName=function(e){i.addCssClass(this.getElement(),e)},this.show=function(e,t,n){e!=null&amp;&amp;this.setText(e),t!=null&amp;&amp;n!=null&amp;&amp;this.setPosition(t,n),this.isOpen||(this.getElement().style.display=&quot;block&quot;,this.isOpen=!0)},this.hide=function(){this.isOpen&amp;&amp;(this.getElement().style.display=&quot;none&quot;,this.isOpen=!1)},this.getHeight=function(){return this.getElement().offsetHeight},this.getWidth=function(){return this.getElement().offsetWidth},this.destroy=function(){this.isOpen=!1,this.$element&amp;&amp;this.$element.parentNode&amp;&amp;this.$element.parentNode.removeChild(this.$element)}}).call(s.prototype),t.Tooltip=s}),ace.define(&quot;ace/mouse/default_gutter_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event&quot;,&quot;ace/tooltip&quot;],function(e,t,n){&quot;use strict&quot;;function u(e){function l(){var r=u.getDocumentPosition().row,s=n.$annotations[r];if(!s)return c();var o=t.session.getLength();if(r==o){var a=t.renderer.pixelToScreenCoordinates(0,u.y).row,l=u.$pos;if(a&gt;t.session.documentToScreenRow(l.row,l.column))return c()}if(f==s)return;f=s.text.join(&quot;&lt;br/&gt;&quot;),i.setHtml(f),i.show(),t._signal(&quot;showGutterTooltip&quot;,i),t.on(&quot;mousewheel&quot;,c);if(e.$tooltipFollowsMouse)h(u);else{var p=u.domEvent.target,d=p.getBoundingClientRect(),v=i.getElement().style;v.left=d.right+&quot;px&quot;,v.top=d.bottom+&quot;px&quot;}}function c(){o&amp;&amp;(o=clearTimeout(o)),f&amp;&amp;(i.hide(),f=null,t._signal(&quot;hideGutterTooltip&quot;,i),t.removeEventListener(&quot;mousewheel&quot;,c))}function h(e){i.setPosition(e.x,e.y)}var t=e.editor,n=t.renderer.$gutterLayer,i=new a(t.container);e.editor.setDefaultHandler(&quot;guttermousedown&quot;,function(r){if(!t.isFocused()||r.getButton()!=0)return;var i=n.getRegion(r);if(i==&quot;foldWidgets&quot;)return;var s=r.getDocumentPosition().row,o=t.session.selection;if(r.getShiftKey())o.selectTo(s,0);else{if(r.domEvent.detail==2)return t.selectAll(),r.preventDefault();e.$clickSelection=t.selection.getLineRange(s)}return e.setState(&quot;selectByLines&quot;),e.captureMouse(r),r.preventDefault()});var o,u,f;e.editor.setDefaultHandler(&quot;guttermousemove&quot;,function(t){var n=t.domEvent.target||t.domEvent.srcElement;if(r.hasCssClass(n,&quot;ace_fold-widget&quot;))return c();f&amp;&amp;e.$tooltipFollowsMouse&amp;&amp;h(t),u=t;if(o)return;o=setTimeout(function(){o=null,u&amp;&amp;!e.isMousePressed?l():c()},50)}),s.addListener(t.renderer.$gutter,&quot;mouseout&quot;,function(e){u=null;if(!f||o)return;o=setTimeout(function(){o=null,c()},50)}),t.on(&quot;changeSession&quot;,c)}function a(e){o.call(this,e)}var r=e(&quot;../lib/dom&quot;),i=e(&quot;../lib/oop&quot;),s=e(&quot;../lib/event&quot;),o=e(&quot;../tooltip&quot;).Tooltip;i.inherits(a,o),function(){this.setPosition=function(e,t){var n=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight,i=this.getWidth(),s=this.getHeight();e+=15,t+=15,e+i&gt;n&amp;&amp;(e-=e+i-n),t+s&gt;r&amp;&amp;(t-=20+s),o.prototype.setPosition.call(this,e,t)}}.call(a.prototype),t.GutterHandler=u}),ace.define(&quot;ace/mouse/mouse_event&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/event&quot;),i=e(&quot;../lib/useragent&quot;),s=t.MouseEvent=function(e,t){this.domEvent=e,this.editor=t,this.x=this.clientX=e.clientX,this.y=this.clientY=e.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1};(function(){this.stopPropagation=function(){r.stopPropagation(this.domEvent),this.propagationStopped=!0},this.preventDefault=function(){r.preventDefault(this.domEvent),this.defaultPrevented=!0},this.stop=function(){this.stopPropagation(),this.preventDefault()},this.getDocumentPosition=function(){return this.$pos?this.$pos:(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY),this.$pos)},this.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var e=this.editor,t=e.getSelectionRange();if(t.isEmpty())this.$inSelection=!1;else{var n=this.getDocumentPosition();this.$inSelection=t.contains(n.row,n.column)}return this.$inSelection},this.getButton=function(){return r.getButton(this.domEvent)},this.getShiftKey=function(){return this.domEvent.shiftKey},this.getAccelKey=i.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(s.prototype)}),ace.define(&quot;ace/mouse/dragdrop_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;function f(e){function T(e,n){var r=Date.now(),i=!n||e.row!=n.row,s=!n||e.column!=n.column;if(!S||i||s)t.moveCursorToPosition(e),S=r,x={x:p,y:d};else{var o=l(x.x,x.y,p,d);o&gt;a?S=null:r-S&gt;=u&amp;&amp;(t.renderer.scrollCursorIntoView(),S=null)}}function N(e,n){var r=Date.now(),i=t.renderer.layerConfig.lineHeight,s=t.renderer.layerConfig.characterWidth,u=t.renderer.scroller.getBoundingClientRect(),a={x:{left:p-u.left,right:u.right-p},y:{top:d-u.top,bottom:u.bottom-d}},f=Math.min(a.x.left,a.x.right),l=Math.min(a.y.top,a.y.bottom),c={row:e.row,column:e.column};f/s&lt;=2&amp;&amp;(c.column+=a.x.left&lt;a.x.right?-3:2),l/i&lt;=1&amp;&amp;(c.row+=a.y.top&lt;a.y.bottom?-1:1);var h=e.row!=c.row,v=e.column!=c.column,m=!n||e.row!=n.row;h||v&amp;&amp;!m?E?r-E&gt;=o&amp;&amp;t.renderer.scrollCursorIntoView(c):E=r:E=null}function C(){var e=g;g=t.renderer.screenToTextCoordinates(p,d),T(g,e),N(g,e)}function k(){m=t.selection.toOrientedRange(),h=t.session.addMarker(m,&quot;ace_selection&quot;,t.getSelectionStyle()),t.clearSelection(),t.isFocused()&amp;&amp;t.renderer.$cursorLayer.setBlinking(!1),clearInterval(v),C(),v=setInterval(C,20),y=0,i.addListener(document,&quot;mousemove&quot;,O)}function L(){clearInterval(v),t.session.removeMarker(h),h=null,t.selection.fromOrientedRange(m),t.isFocused()&amp;&amp;!w&amp;&amp;t.$resetCursorStyle(),m=null,g=null,y=0,E=null,S=null,i.removeListener(document,&quot;mousemove&quot;,O)}function O(){A==null&amp;&amp;(A=setTimeout(function(){A!=null&amp;&amp;h&amp;&amp;L()},20))}function M(e){var t=e.types;return!t||Array.prototype.some.call(t,function(e){return e==&quot;text/plain&quot;||e==&quot;Text&quot;})}function _(e){var t=[&quot;copy&quot;,&quot;copymove&quot;,&quot;all&quot;,&quot;uninitialized&quot;],n=[&quot;move&quot;,&quot;copymove&quot;,&quot;linkmove&quot;,&quot;all&quot;,&quot;uninitialized&quot;],r=s.isMac?e.altKey:e.ctrlKey,i=&quot;uninitialized&quot;;try{i=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var o=&quot;none&quot;;return r&amp;&amp;t.indexOf(i)&gt;=0?o=&quot;copy&quot;:n.indexOf(i)&gt;=0?o=&quot;move&quot;:t.indexOf(i)&gt;=0&amp;&amp;(o=&quot;copy&quot;),o}var t=e.editor,n=r.createElement(&quot;img&quot;);n.src=&quot;data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==&quot;,s.isOpera&amp;&amp;(n.style.cssText=&quot;width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;&quot;);var f=[&quot;dragWait&quot;,&quot;dragWaitEnd&quot;,&quot;startDrag&quot;,&quot;dragReadyEnd&quot;,&quot;onMouseDrag&quot;];f.forEach(function(t){e[t]=this[t]},this),t.addEventListener(&quot;mousedown&quot;,this.onMouseDown.bind(e));var c=t.container,h,p,d,v,m,g,y=0,b,w,E,S,x;this.onDragStart=function(e){if(this.cancelDrag||!c.draggable){var r=this;return setTimeout(function(){r.startSelect(),r.captureMouse(e)},0),e.preventDefault()}m=t.getSelectionRange();var i=e.dataTransfer;i.effectAllowed=t.getReadOnly()?&quot;copy&quot;:&quot;copyMove&quot;,s.isOpera&amp;&amp;(t.container.appendChild(n),n.scrollTop=0),i.setDragImage&amp;&amp;i.setDragImage(n,0,0),s.isOpera&amp;&amp;t.container.removeChild(n),i.clearData(),i.setData(&quot;Text&quot;,t.session.getTextRange()),w=!0,this.setState(&quot;drag&quot;)},this.onDragEnd=function(e){c.draggable=!1,w=!1,this.setState(null);if(!t.getReadOnly()){var n=e.dataTransfer.dropEffect;!b&amp;&amp;n==&quot;move&quot;&amp;&amp;t.session.remove(t.getSelectionRange()),t.$resetCursorStyle()}this.editor.unsetStyle(&quot;ace_dragging&quot;),this.editor.renderer.setCursorStyle(&quot;&quot;)},this.onDragEnter=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return p=e.clientX,d=e.clientY,h||k(),y++,e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragOver=function(e){if(t.getReadOnly()||!M(e.dataTransfer))return;return p=e.clientX,d=e.clientY,h||(k(),y++),A!==null&amp;&amp;(A=null),e.dataTransfer.dropEffect=b=_(e),i.preventDefault(e)},this.onDragLeave=function(e){y--;if(y&lt;=0&amp;&amp;h)return L(),b=null,i.preventDefault(e)},this.onDrop=function(e){if(!g)return;var n=e.dataTransfer;if(w)switch(b){case&quot;move&quot;:m.contains(g.row,g.column)?m={start:g,end:g}:m=t.moveText(m,g);break;case&quot;copy&quot;:m=t.moveText(m,g,!0)}else{var r=n.getData(&quot;Text&quot;);m={start:g,end:t.session.insert(g,r)},t.focus(),b=null}return L(),i.preventDefault(e)},i.addListener(c,&quot;dragstart&quot;,this.onDragStart.bind(e)),i.addListener(c,&quot;dragend&quot;,this.onDragEnd.bind(e)),i.addListener(c,&quot;dragenter&quot;,this.onDragEnter.bind(e)),i.addListener(c,&quot;dragover&quot;,this.onDragOver.bind(e)),i.addListener(c,&quot;dragleave&quot;,this.onDragLeave.bind(e)),i.addListener(c,&quot;drop&quot;,this.onDrop.bind(e));var A=null}function l(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var r=e(&quot;../lib/dom&quot;),i=e(&quot;../lib/event&quot;),s=e(&quot;../lib/useragent&quot;),o=200,u=200,a=5;(function(){this.dragWait=function(){var e=Date.now()-this.mousedownEvent.time;e&gt;this.editor.getDragDelay()&amp;&amp;this.startDrag()},this.dragWaitEnd=function(){var e=this.editor.container;e.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.$resetCursorStyle(),this.editor.unsetStyle(&quot;ace_dragging&quot;),this.editor.renderer.setCursorStyle(&quot;&quot;),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor,t=e.container;t.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle(&quot;ace_dragging&quot;);var n=s.isWin?&quot;default&quot;:&quot;move&quot;;e.renderer.setCursorStyle(n),this.setState(&quot;dragReady&quot;)},this.onMouseDrag=function(e){var t=this.editor.container;if(s.isIE&amp;&amp;this.state==&quot;dragReady&quot;){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n&gt;3&amp;&amp;t.dragDrop()}if(this.state===&quot;dragWait&quot;){var n=l(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);n&gt;0&amp;&amp;(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))}},this.onMouseDown=function(e){if(!this.$dragEnabled)return;this.mousedownEvent=e;var t=this.editor,n=e.inSelection(),r=e.getButton(),i=e.domEvent.detail||1;if(i===1&amp;&amp;r===0&amp;&amp;n){if(e.editor.inMultiSelectMode&amp;&amp;(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var o=e.domEvent.target||e.domEvent.srcElement;&quot;unselectable&quot;in o&amp;&amp;(o.unselectable=&quot;on&quot;);if(t.getDragDelay()){if(s.isWebKit){this.cancelDrag=!0;var u=t.container;u.draggable=!0}this.setState(&quot;dragWait&quot;)}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}).call(f.prototype),t.DragdropHandler=f}),ace.define(&quot;ace/mouse/touch_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/mouse/mouse_event&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./mouse_event&quot;).MouseEvent,i=e(&quot;../lib/event&quot;),s=e(&quot;../lib/dom&quot;);t.addTouchListeners=function(e,t){function b(){var e=window.navigator&amp;&amp;window.navigator.clipboard,r=!1,i=function(){var n=t.getCopyText(),i=t.session.getUndoManager().hasUndo();y.replaceChild(s.buildDom(r?[&quot;span&quot;,!n&amp;&amp;[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;selectall&quot;},&quot;Select All&quot;],n&amp;&amp;[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;copy&quot;},&quot;Copy&quot;],n&amp;&amp;[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;cut&quot;},&quot;Cut&quot;],e&amp;&amp;[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;paste&quot;},&quot;Paste&quot;],i&amp;&amp;[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;undo&quot;},&quot;Undo&quot;],[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;find&quot;},&quot;Find&quot;],[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;openCommandPallete&quot;},&quot;Pallete&quot;]]:[&quot;span&quot;]),y.firstChild)},o=function(n){var s=n.target.getAttribute(&quot;action&quot;);if(s==&quot;more&quot;||!r)return r=!r,i();if(s==&quot;paste&quot;)e.readText().then(function(e){t.execCommand(s,e)});else if(s){if(s==&quot;cut&quot;||s==&quot;copy&quot;)e?e.writeText(t.getCopyText()):document.execCommand(&quot;copy&quot;);t.execCommand(s)}y.firstChild.style.display=&quot;none&quot;,r=!1,s!=&quot;openCommandPallete&quot;&amp;&amp;t.focus()};y=s.buildDom([&quot;div&quot;,{&quot;class&quot;:&quot;ace_mobile-menu&quot;,ontouchstart:function(e){n=&quot;menu&quot;,e.stopPropagation(),e.preventDefault(),t.textInput.focus()},ontouchend:function(e){e.stopPropagation(),e.preventDefault(),o(e)},onclick:o},[&quot;span&quot;],[&quot;span&quot;,{&quot;class&quot;:&quot;ace_mobile-button&quot;,action:&quot;more&quot;},&quot;...&quot;]],t.container)}function w(){y||b();var e=t.selection.cursor,n=t.renderer.textToScreenCoordinates(e.row,e.column),r=t.container.getBoundingClientRect();y.style.top=n.pageY-r.top-3+&quot;px&quot;,y.style.right=&quot;10px&quot;,y.style.display=&quot;&quot;,y.firstChild.style.display=&quot;none&quot;,t.on(&quot;input&quot;,E)}function E(e){y&amp;&amp;(y.style.display=&quot;none&quot;),t.off(&quot;input&quot;,E)}function S(){l=null,clearTimeout(l);var e=t.selection.getRange(),r=e.contains(p.row,p.column);if(e.isEmpty()||!r)t.selection.moveToPosition(p),t.selection.selectWord();n=&quot;wait&quot;,w()}function x(){l=null,clearTimeout(l),t.selection.moveToPosition(p);var e=d&gt;=2?t.selection.getLineRange(p.row):t.session.getBracketRange(p);e&amp;&amp;!e.isEmpty()?t.selection.setRange(e):t.selection.selectWord(),n=&quot;wait&quot;}function T(){h+=60,c=setInterval(function(){h--&lt;=0&amp;&amp;(clearInterval(c),c=null),Math.abs(v)&lt;.01&amp;&amp;(v=0),Math.abs(m)&lt;.01&amp;&amp;(m=0),h&lt;20&amp;&amp;(v=.9*v),h&lt;20&amp;&amp;(m=.9*m);var e=t.session.getScrollTop();t.renderer.scrollBy(10*v,10*m),e==t.session.getScrollTop()&amp;&amp;(h=0)},10)}var n=&quot;scroll&quot;,o,u,a,f,l,c,h=0,p,d=0,v=0,m=0,g,y;i.addListener(e,&quot;contextmenu&quot;,function(e){if(!g)return;var n=t.textInput.getElement();n.focus()}),i.addListener(e,&quot;touchstart&quot;,function(e){var i=e.touches;if(l||i.length&gt;1){clearTimeout(l),l=null,a=-1,n=&quot;zoom&quot;;return}g=t.$mouseHandler.isMousePressed=!0;var s=t.renderer.layerConfig.lineHeight,c=t.renderer.layerConfig.lineHeight,y=e.timeStamp;f=y;var b=i[0],w=b.clientX,E=b.clientY;Math.abs(o-w)+Math.abs(u-E)&gt;s&amp;&amp;(a=-1),o=e.clientX=w,u=e.clientY=E,v=m=0;var T=new r(e,t);p=T.getDocumentPosition();if(y-a&lt;500&amp;&amp;i.length==1&amp;&amp;!h)d++,e.preventDefault(),e.button=0,x();else{d=0;var N=t.selection.cursor,C=t.selection.isEmpty()?N:t.selection.anchor,k=t.renderer.$cursorLayer.getPixelPosition(N,!0),L=t.renderer.$cursorLayer.getPixelPosition(C,!0),A=t.renderer.scroller.getBoundingClientRect(),O=function(e,t){return e/=c,t=t/s-.75,e*e+t*t};if(e.clientX&lt;A.left){n=&quot;zoom&quot;;return}var M=O(e.clientX-A.left-k.left,e.clientY-A.top-k.top),_=O(e.clientX-A.left-L.left,e.clientY-A.top-L.top);M&lt;3.5&amp;&amp;_&lt;3.5&amp;&amp;(n=M&gt;_?&quot;cursor&quot;:&quot;anchor&quot;),_&lt;3.5?n=&quot;anchor&quot;:M&lt;3.5?n=&quot;cursor&quot;:n=&quot;scroll&quot;,l=setTimeout(S,450)}a=y}),i.addListener(e,&quot;touchend&quot;,function(e){g=t.$mouseHandler.isMousePressed=!1,c&amp;&amp;clearInterval(c),n==&quot;zoom&quot;?(n=&quot;&quot;,h=0):l?(t.selection.moveToPosition(p),h=0,w()):n==&quot;scroll&quot;?(T(),e.preventDefault(),E()):w(),clearTimeout(l),l=null}),i.addListener(e,&quot;touchmove&quot;,function(e){l&amp;&amp;(clearTimeout(l),l=null);var i=e.touches;if(i.length&gt;1||n==&quot;zoom&quot;)return;var s=i[0],a=o-s.clientX,c=u-s.clientY;if(n==&quot;wait&quot;){if(!(a*a+c*c&gt;4))return e.preventDefault();n=&quot;cursor&quot;}o=s.clientX,u=s.clientY,e.clientX=s.clientX,e.clientY=s.clientY;var h=e.timeStamp,p=h-f;f=h;if(n==&quot;scroll&quot;){var d=new r(e,t);d.speed=1,d.wheelX=a,d.wheelY=c,10*Math.abs(a)&lt;Math.abs(c)&amp;&amp;(a=0),10*Math.abs(c)&lt;Math.abs(a)&amp;&amp;(c=0),p!=0&amp;&amp;(v=a/p,m=c/p),t._emit(&quot;mousewheel&quot;,d),d.propagationStopped||(v=m=0)}else{var g=new r(e,t),y=g.getDocumentPosition();n==&quot;cursor&quot;?t.selection.moveCursorToPosition(y):n==&quot;anchor&quot;&amp;&amp;t.selection.setSelectionAnchor(y.row,y.column),t.renderer.scrollCursorIntoView(y),e.preventDefault()}})}}),ace.define(&quot;ace/lib/net&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./dom&quot;);t.get=function(e,t){var n=new XMLHttpRequest;n.open(&quot;GET&quot;,e,!0),n.onreadystatechange=function(){n.readyState===4&amp;&amp;t(n.responseText)},n.send(null)},t.loadScript=function(e,t){var n=r.getDocumentHead(),i=document.createElement(&quot;script&quot;);i.src=e,n.appendChild(i),i.onload=i.onreadystatechange=function(e,n){if(n||!i.readyState||i.readyState==&quot;loaded&quot;||i.readyState==&quot;complete&quot;)i=i.onload=i.onreadystatechange=null,n||t()}},t.qualifyURL=function(e){var t=document.createElement(&quot;a&quot;);return t.href=e,t.href}}),ace.define(&quot;ace/lib/event_emitter&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r={},i=function(){this.propagationStopped=!0},s=function(){this.defaultPrevented=!0};r._emit=r._dispatchEvent=function(e,t){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var n=this._eventRegistry[e]||[],r=this._defaultHandlers[e];if(!n.length&amp;&amp;!r)return;if(typeof t!=&quot;object&quot;||!t)t={};t.type||(t.type=e),t.stopPropagation||(t.stopPropagation=i),t.preventDefault||(t.preventDefault=s),n=n.slice();for(var o=0;o&lt;n.length;o++){n[o](t,this);if(t.propagationStopped)break}if(r&amp;&amp;!t.defaultPrevented)return r(t,this)},r._signal=function(e,t){var n=(this._eventRegistry||{})[e];if(!n)return;n=n.slice();for(var r=0;r&lt;n.length;r++)n[r](t,this)},r.once=function(e,t){var n=this;this.addEventListener(e,function r(){n.removeEventListener(e,r),t.apply(null,arguments)});if(!t)return new Promise(function(e){t=e})},r.setDefaultHandler=function(e,t){var n=this._defaultHandlers;n||(n=this._defaultHandlers={_disabled_:{}});if(n[e]){var r=n[e],i=n._disabled_[e];i||(n._disabled_[e]=i=[]),i.push(r);var s=i.indexOf(t);s!=-1&amp;&amp;i.splice(s,1)}n[e]=t},r.removeDefaultHandler=function(e,t){var n=this._defaultHandlers;if(!n)return;var r=n._disabled_[e];if(n[e]==t)r&amp;&amp;this.setDefaultHandler(e,r.pop());else if(r){var i=r.indexOf(t);i!=-1&amp;&amp;r.splice(i,1)}},r.on=r.addEventListener=function(e,t,n){this._eventRegistry=this._eventRegistry||{};var r=this._eventRegistry[e];return r||(r=this._eventRegistry[e]=[]),r.indexOf(t)==-1&amp;&amp;r[n?&quot;unshift&quot;:&quot;push&quot;](t),t},r.off=r.removeListener=r.removeEventListener=function(e,t){this._eventRegistry=this._eventRegistry||{};var n=this._eventRegistry[e];if(!n)return;var r=n.indexOf(t);r!==-1&amp;&amp;n.splice(r,1)},r.removeAllListeners=function(e){this._eventRegistry&amp;&amp;(this._eventRegistry[e]=[])},t.EventEmitter=r}),ace.define(&quot;ace/lib/app_config&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;no use strict&quot;;function o(e){typeof console!=&quot;undefined&quot;&amp;&amp;console.warn&amp;&amp;console.warn.apply(console,arguments)}function u(e,t){var n=new Error(e);n.data=t,typeof console==&quot;object&quot;&amp;&amp;console.error&amp;&amp;console.error(n),setTimeout(function(){throw n})}var r=e(&quot;./oop&quot;),i=e(&quot;./event_emitter&quot;).EventEmitter,s={setOptions:function(e){Object.keys(e).forEach(function(t){this.setOption(t,e[t])},this)},getOptions:function(e){var t={};if(!e){var n=this.$options;e=Object.keys(n).filter(function(e){return!n[e].hidden})}else Array.isArray(e)||(t=e,e=Object.keys(t));return e.forEach(function(e){t[e]=this.getOption(e)},this),t},setOption:function(e,t){if(this[&quot;$&quot;+e]===t)return;var n=this.$options[e];if(!n)return o('misspelled option &quot;'+e+'&quot;');if(n.forwardTo)return this[n.forwardTo]&amp;&amp;this[n.forwardTo].setOption(e,t);n.handlesSet||(this[&quot;$&quot;+e]=t),n&amp;&amp;n.set&amp;&amp;n.set.call(this,t)},getOption:function(e){var t=this.$options[e];return t?t.forwardTo?this[t.forwardTo]&amp;&amp;this[t.forwardTo].getOption(e):t&amp;&amp;t.get?t.get.call(this):this[&quot;$&quot;+e]:o('misspelled option &quot;'+e+'&quot;')}},a=function(){this.$defaultOptions={}};(function(){r.implement(this,i),this.defineOptions=function(e,t,n){return e.$options||(this.$defaultOptions[t]=e.$options={}),Object.keys(n).forEach(function(t){var r=n[t];typeof r==&quot;string&quot;&amp;&amp;(r={forwardTo:r}),r.name||(r.name=t),e.$options[r.name]=r,&quot;initialValue&quot;in r&amp;&amp;(e[&quot;$&quot;+r.name]=r.initialValue)}),r.implement(e,s),this},this.resetOptions=function(e){Object.keys(e.$options).forEach(function(t){var n=e.$options[t];&quot;value&quot;in n&amp;&amp;e.setOption(t,n.value)})},this.setDefaultValue=function(e,t,n){if(!e){for(e in this.$defaultOptions)if(this.$defaultOptions[e][t])break;if(!this.$defaultOptions[e][t])return!1}var r=this.$defaultOptions[e]||(this.$defaultOptions[e]={});r[t]&amp;&amp;(r.forwardTo?this.setDefaultValue(r.forwardTo,t,n):r[t].value=n)},this.setDefaultValues=function(e,t){Object.keys(t).forEach(function(n){this.setDefaultValue(e,n,t[n])},this)},this.warn=o,this.reportError=u}).call(a.prototype),t.AppConfig=a}),ace.define(&quot;ace/config&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/net&quot;,&quot;ace/lib/app_config&quot;],function(e,t,n){&quot;no use strict&quot;;function l(r){if(!u||!u.document)return;a.packaged=r||e.packaged||n.packaged||u.define&amp;&amp;define.packaged;var i={},s=&quot;&quot;,o=document.currentScript||document._currentScript,f=o&amp;&amp;o.ownerDocument||document,l=f.getElementsByTagName(&quot;script&quot;);for(var h=0;h&lt;l.length;h++){var p=l[h],d=p.src||p.getAttribute(&quot;src&quot;);if(!d)continue;var v=p.attributes;for(var m=0,g=v.length;m&lt;g;m++){var y=v[m];y.name.indexOf(&quot;data-ace-&quot;)===0&amp;&amp;(i[c(y.name.replace(/^data-ace-/,&quot;&quot;))]=y.value)}var b=d.match(/^(.*)\s/ace(\s-\sw+)?\s.js(\s?|$)/);b&amp;&amp;(s=b[1])}s&amp;&amp;(i.base=i.base||s,i.packaged=!0),i.basePath=i.base,i.workerPath=i.workerPath||i.base,i.modePath=i.modePath||i.base,i.themePath=i.themePath||i.base,delete i.base;for(var w in i)typeof i[w]!=&quot;undefined&quot;&amp;&amp;t.set(w,i[w])}function c(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}var r=e(&quot;./lib/lang&quot;),i=e(&quot;./lib/oop&quot;),s=e(&quot;./lib/net&quot;),o=e(&quot;./lib/app_config&quot;).AppConfig;n.exports=t=new o;var u=function(){return this||typeof window!=&quot;undefined&quot;&amp;&amp;window}(),a={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:&quot;&quot;,suffix:&quot;.js&quot;,$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1};t.get=function(e){if(!a.hasOwnProperty(e))throw new Error(&quot;Unknown config key: &quot;+e);return a[e]},t.set=function(e,t){if(a.hasOwnProperty(e))a[e]=t;else if(this.setDefaultValue(&quot;&quot;,e,t)==0)throw new Error(&quot;Unknown config key: &quot;+e)},t.all=function(){return r.copyObject(a)},t.$modes={},t.moduleUrl=function(e,t){if(a.$moduleUrls[e])return a.$moduleUrls[e];var n=e.split(&quot;/&quot;);t=t||n[n.length-2]||&quot;&quot;;var r=t==&quot;snippets&quot;?&quot;/&quot;:&quot;-&quot;,i=n[n.length-1];if(t==&quot;worker&quot;&amp;&amp;r==&quot;-&quot;){var s=new RegExp(&quot;^&quot;+t+&quot;[\s\s-_]|[\s\s-_]&quot;+t+&quot;$&quot;,&quot;g&quot;);i=i.replace(s,&quot;&quot;)}(!i||i==t)&amp;&amp;n.length&gt;1&amp;&amp;(i=n[n.length-2]);var o=a[t+&quot;Path&quot;];return o==null?o=a.basePath:r==&quot;/&quot;&amp;&amp;(t=r=&quot;&quot;),o&amp;&amp;o.slice(-1)!=&quot;/&quot;&amp;&amp;(o+=&quot;/&quot;),o+t+r+i+this.get(&quot;suffix&quot;)},t.setModuleUrl=function(e,t){return a.$moduleUrls[e]=t},t.$loading={},t.loadModule=function(n,r){var i,o;Array.isArray(n)&amp;&amp;(o=n[0],n=n[1]);try{i=e(n)}catch(u){}if(i&amp;&amp;!t.$loading[n])return r&amp;&amp;r(i);t.$loading[n]||(t.$loading[n]=[]),t.$loading[n].push(r);if(t.$loading[n].length&gt;1)return;var a=function(){e([n],function(e){t._emit(&quot;load.module&quot;,{name:n,module:e});var r=t.$loading[n];t.$loading[n]=null,r.forEach(function(t){t&amp;&amp;t(e)})})};if(!t.get(&quot;packaged&quot;))return a();s.loadScript(t.moduleUrl(n,o),a),f()};var f=function(){!a.basePath&amp;&amp;!a.workerPath&amp;&amp;!a.modePath&amp;&amp;!a.themePath&amp;&amp;!Object.keys(a.$moduleUrls).length&amp;&amp;(console.error(&quot;Unable to infer path to ace from script src,&quot;,&quot;use ace.config.set('basePath', 'path') to enable dynamic loading of modes and themes&quot;,&quot;or with webpack use ace/webpack-resolver&quot;),f=function(){})};t.init=l,t.version=&quot;1.4.8&quot;}),ace.define(&quot;ace/mouse/mouse_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;,&quot;ace/mouse/default_handlers&quot;,&quot;ace/mouse/default_gutter_handler&quot;,&quot;ace/mouse/mouse_event&quot;,&quot;ace/mouse/dragdrop_handler&quot;,&quot;ace/mouse/touch_handler&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/event&quot;),i=e(&quot;../lib/useragent&quot;),s=e(&quot;./default_handlers&quot;).DefaultHandlers,o=e(&quot;./default_gutter_handler&quot;).GutterHandler,u=e(&quot;./mouse_event&quot;).MouseEvent,a=e(&quot;./dragdrop_handler&quot;).DragdropHandler,f=e(&quot;./touch_handler&quot;).addTouchListeners,l=e(&quot;../config&quot;),c=function(e){var t=this;this.editor=e,new s(this),new o(this),new a(this);var n=function(t){var n=!document.hasFocus||!document.hasFocus()||!e.isFocused()&amp;&amp;document.activeElement==(e.textInput&amp;&amp;e.textInput.getElement());n&amp;&amp;window.focus(),e.focus()},u=e.renderer.getMouseEventTarget();r.addListener(u,&quot;click&quot;,this.onMouseEvent.bind(this,&quot;click&quot;)),r.addListener(u,&quot;mousemove&quot;,this.onMouseMove.bind(this,&quot;mousemove&quot;)),r.addMultiMouseDownListener([u,e.renderer.scrollBarV&amp;&amp;e.renderer.scrollBarV.inner,e.renderer.scrollBarH&amp;&amp;e.renderer.scrollBarH.inner,e.textInput&amp;&amp;e.textInput.getElement()].filter(Boolean),[400,300,250],this,&quot;onMouseEvent&quot;),r.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,&quot;mousewheel&quot;)),f(e.container,e);var l=e.renderer.$gutter;r.addListener(l,&quot;mousedown&quot;,this.onMouseEvent.bind(this,&quot;guttermousedown&quot;)),r.addListener(l,&quot;click&quot;,this.onMouseEvent.bind(this,&quot;gutterclick&quot;)),r.addListener(l,&quot;dblclick&quot;,this.onMouseEvent.bind(this,&quot;gutterdblclick&quot;)),r.addListener(l,&quot;mousemove&quot;,this.onMouseEvent.bind(this,&quot;guttermousemove&quot;)),r.addListener(u,&quot;mousedown&quot;,n),r.addListener(l,&quot;mousedown&quot;,n),i.isIE&amp;&amp;e.renderer.scrollBarV&amp;&amp;(r.addListener(e.renderer.scrollBarV.element,&quot;mousedown&quot;,n),r.addListener(e.renderer.scrollBarH.element,&quot;mousedown&quot;,n)),e.on(&quot;mousemove&quot;,function(n){if(t.state||t.$dragDelay||!t.$dragEnabled)return;var r=e.renderer.screenToTextCoordinates(n.x,n.y),i=e.session.selection.getRange(),s=e.renderer;!i.isEmpty()&amp;&amp;i.insideStart(r.row,r.column)?s.setCursorStyle(&quot;default&quot;):s.setCursorStyle(&quot;&quot;)})};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new u(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&amp;&amp;this.editor._eventRegistry.mousemove;if(!n||!n.length)return;this.editor._emit(e,new u(t,this.editor))},this.onMouseWheel=function(e,t){var n=new u(t,this.editor);n.speed=this.$scrollSpeed*2,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var n=this.editor,s=this.editor.renderer;s.$isMousePressed=!0;var o=this,a=function(e){if(!e)return;if(i.isWebKit&amp;&amp;!e.which&amp;&amp;o.releaseMouse)return o.releaseMouse();o.x=e.clientX,o.y=e.clientY,t&amp;&amp;t(e),o.mouseEvent=new u(e,o.editor),o.$mouseMoved=!0},f=function(e){n.off(&quot;beforeEndOperation&quot;,c),clearInterval(h),l(),o[o.state+&quot;End&quot;]&amp;&amp;o[o.state+&quot;End&quot;](e),o.state=&quot;&quot;,o.isMousePressed=s.$isMousePressed=!1,s.$keepTextAreaAtCursor&amp;&amp;s.$moveTextAreaToCursor(),o.$onCaptureMouseMove=o.releaseMouse=null,e&amp;&amp;o.onMouseEvent(&quot;mouseup&quot;,e),n.endOperation()},l=function(){o[o.state]&amp;&amp;o[o.state](),o.$mouseMoved=!1};if(i.isOldIE&amp;&amp;e.domEvent.type==&quot;dblclick&quot;)return setTimeout(function(){f(e)});var c=function(e){if(!o.releaseMouse)return;n.curOp.command.name&amp;&amp;n.curOp.selectionChanged&amp;&amp;(o[o.state+&quot;End&quot;]&amp;&amp;o[o.state+&quot;End&quot;](),o.state=&quot;&quot;,o.releaseMouse())};n.on(&quot;beforeEndOperation&quot;,c),n.startOperation({command:{name:&quot;mouse&quot;}}),o.$onCaptureMouseMove=a,o.releaseMouse=r.capture(this.editor.container,a,f);var h=setInterval(l,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var e=function(t){if(t&amp;&amp;t.domEvent&amp;&amp;t.domEvent.type!=&quot;contextmenu&quot;)return;this.editor.off(&quot;nativecontextmenu&quot;,e),t&amp;&amp;t.domEvent&amp;&amp;r.stopEvent(t.domEvent)}.bind(this);setTimeout(e,10),this.editor.on(&quot;nativecontextmenu&quot;,e)}}).call(c.prototype),l.defineOptions(c.prototype,&quot;mouseHandler&quot;,{scrollSpeed:{initialValue:2},dragDelay:{initialValue:i.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=c}),ace.define(&quot;ace/mouse/fold_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;function i(e){e.on(&quot;click&quot;,function(t){var n=t.getDocumentPosition(),i=e.session,s=i.getFoldAt(n.row,n.column,1);s&amp;&amp;(t.getAccelKey()?i.removeFold(s):i.expandFold(s),t.stop());var o=t.domEvent&amp;&amp;t.domEvent.target;o&amp;&amp;r.hasCssClass(o,&quot;ace_inline_button&quot;)&amp;&amp;r.hasCssClass(o,&quot;ace_toggle_wrap&quot;)&amp;&amp;(i.setOption(&quot;wrap&quot;,!i.getUseWrapMode()),e.renderer.scrollCursorIntoView())}),e.on(&quot;gutterclick&quot;,function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n==&quot;foldWidgets&quot;){var r=t.getDocumentPosition().row,i=e.session;i.foldWidgets&amp;&amp;i.foldWidgets[r]&amp;&amp;e.session.onFoldWidgetClick(r,t),e.isFocused()||e.focus(),t.stop()}}),e.on(&quot;gutterdblclick&quot;,function(t){var n=e.renderer.$gutterLayer.getRegion(t);if(n==&quot;foldWidgets&quot;){var r=t.getDocumentPosition().row,i=e.session,s=i.getParentFoldRangeData(r,!0),o=s.range||s.firstRange;if(o){r=o.start.row;var u=i.getFoldAt(r,i.getLine(r).length,1);u?i.removeFold(u):(i.addFold(&quot;...&quot;,o),e.renderer.scrollCursorIntoView({row:o.start.row,column:0}))}t.stop()}})}var r=e(&quot;../lib/dom&quot;);t.FoldHandler=i}),ace.define(&quot;ace/keyboard/keybinding&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/keys&quot;,&quot;ace/lib/event&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/keys&quot;),i=e(&quot;../lib/event&quot;),s=function(e){this.$editor=e,this.$data={editor:e},this.$handlers=[],this.setDefaultHandler(e.commands)};(function(){this.setDefaultHandler=function(e){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=e,this.addKeyboardHandler(e,0)},this.setKeyboardHandler=function(e){var t=this.$handlers;if(t[t.length-1]==e)return;while(t[t.length-1]&amp;&amp;t[t.length-1]!=this.$defaultHandler)this.removeKeyboardHandler(t[t.length-1]);this.addKeyboardHandler(e,1)},this.addKeyboardHandler=function(e,t){if(!e)return;typeof e==&quot;function&quot;&amp;&amp;!e.handleKeyboard&amp;&amp;(e.handleKeyboard=e);var n=this.$handlers.indexOf(e);n!=-1&amp;&amp;this.$handlers.splice(n,1),t==undefined?this.$handlers.push(e):this.$handlers.splice(t,0,e),n==-1&amp;&amp;e.attach&amp;&amp;e.attach(this.$editor)},this.removeKeyboardHandler=function(e){var t=this.$handlers.indexOf(e);return t==-1?!1:(this.$handlers.splice(t,1),e.detach&amp;&amp;e.detach(this.$editor),!0)},this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},this.getStatusText=function(){var e=this.$data,t=e.editor;return this.$handlers.map(function(n){return n.getStatusText&amp;&amp;n.getStatusText(t,e)||&quot;&quot;}).filter(Boolean).join(&quot; &quot;)},this.$callKeyboardHandlers=function(e,t,n,r){var s,o=!1,u=this.$editor.commands;for(var a=this.$handlers.length;a--;){s=this.$handlers[a].handleKeyboard(this.$data,e,t,n,r);if(!s||!s.command)continue;s.command==&quot;null&quot;?o=!0:o=u.exec(s.command,this.$editor,s.args,r),o&amp;&amp;r&amp;&amp;e!=-1&amp;&amp;s.passEvent!=1&amp;&amp;s.command.passEvent!=1&amp;&amp;i.stopEvent(r);if(o)break}return!o&amp;&amp;e==-1&amp;&amp;(s={command:&quot;insertstring&quot;},o=u.exec(&quot;insertstring&quot;,this.$editor,t)),o&amp;&amp;this.$editor._signal&amp;&amp;this.$editor._signal(&quot;keyboardActivity&quot;,s),o},this.onCommandKey=function(e,t,n){var i=r.keyCodeToString(n);return this.$callKeyboardHandlers(t,i,n,e)},this.onTextInput=function(e){return this.$callKeyboardHandlers(-1,e)}}).call(s.prototype),t.KeyBinding=s}),ace.define(&quot;ace/lib/bidiutil&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;function F(e,t,n,r){var i=s?d:p,c=null,h=null,v=null,m=0,g=null,y=null,b=-1,w=null,E=null,T=[];if(!r)for(w=0,r=[];w&lt;n;w++)r[w]=R(e[w]);o=s,u=!1,a=!1,f=!1,l=!1;for(E=0;E&lt;n;E++){c=m,T[E]=h=q(e,r,T,E),m=i[c][h],g=m&amp;240,m&amp;=15,t[E]=v=i[m][5];if(g&gt;0)if(g==16){for(w=b;w&lt;E;w++)t[w]=1;b=-1}else b=-1;y=i[m][6];if(y)b==-1&amp;&amp;(b=E);else if(b&gt;-1){for(w=b;w&lt;E;w++)t[w]=v;b=-1}r[E]==S&amp;&amp;(t[E]=0),o|=v}if(l)for(w=0;w&lt;n;w++)if(r[w]==x){t[w]=s;for(var C=w-1;C&gt;=0;C--){if(r[C]!=N)break;t[C]=s}}}function I(e,t,n){if(o&lt;e)return;if(e==1&amp;&amp;s==m&amp;&amp;!f){n.reverse();return}var r=n.length,i=0,u,a,l,c;while(i&lt;r){if(t[i]&gt;=e){u=i+1;while(u&lt;r&amp;&amp;t[u]&gt;=e)u++;for(a=i,l=u-1;a&lt;l;a++,l--)c=n[a],n[a]=n[l],n[l]=c;i=u}i++}}function q(e,t,n,r){var i=t[r],o,c,h,p;switch(i){case g:case y:u=!1;case E:case w:return i;case b:return u?w:b;case T:return u=!0,a=!0,y;case N:return E;case C:if(r&lt;1||r+1&gt;=t.length||(o=n[r-1])!=b&amp;&amp;o!=w||(c=t[r+1])!=b&amp;&amp;c!=w)return E;return u&amp;&amp;(c=w),c==o?c:E;case k:o=r&gt;0?n[r-1]:S;if(o==b&amp;&amp;r+1&lt;t.length&amp;&amp;t[r+1]==b)return b;return E;case L:if(r&gt;0&amp;&amp;n[r-1]==b)return b;if(u)return E;p=r+1,h=t.length;while(p&lt;h&amp;&amp;t[p]==L)p++;if(p&lt;h&amp;&amp;t[p]==b)return b;return E;case A:h=t.length,p=r+1;while(p&lt;h&amp;&amp;t[p]==A)p++;if(p&lt;h){var d=e[r],v=d&gt;=1425&amp;&amp;d&lt;=2303||d==64286;o=t[p];if(v&amp;&amp;(o==y||o==T))return y}if(r&lt;1||(o=t[r-1])==S)return E;return n[r-1];case S:return u=!1,f=!0,s;case x:return l=!0,E;case O:case M:case D:case P:case _:u=!1;case H:return E}}function R(e){var t=e.charCodeAt(0),n=t&gt;&gt;8;return n==0?t&gt;191?g:B[t]:n==5?/[\su0591-\su05f4]/.test(e)?y:g:n==6?/[\su0610-\su061a\su064b-\su065f\su06d6-\su06e4\su06e7-\su06ed]/.test(e)?A:/[\su0660-\su0669\su066b-\su066c]/.test(e)?w:t==1642?L:/[\su06f0-\su06f9]/.test(e)?b:T:n==32&amp;&amp;t&lt;=8287?j[t&amp;255]:n==254?t&gt;=65136?T:E:E}function U(e){return e&gt;=&quot;\su064b&quot;&amp;&amp;e&lt;=&quot;\su0655&quot;}var r=[&quot;\su0621&quot;,&quot;\su0641&quot;],i=[&quot;\su063a&quot;,&quot;\su064a&quot;],s=0,o=0,u=!1,a=!1,f=!1,l=!1,c=!1,h=!1,p=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],d=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],v=0,m=1,g=0,y=1,b=2,w=3,E=4,S=5,x=6,T=7,N=8,C=9,k=10,L=11,A=12,O=13,M=14,_=15,D=16,P=17,H=18,B=[H,H,H,H,H,H,H,H,H,x,S,x,N,S,H,H,H,H,H,H,H,H,H,H,H,H,H,H,S,S,S,x,N,E,E,L,L,L,E,E,E,E,E,k,C,k,C,C,b,b,b,b,b,b,b,b,b,b,C,E,E,E,E,E,E,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,E,E,E,E,E,E,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,E,E,E,E,H,H,H,H,H,H,S,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,H,C,E,L,L,L,L,E,E,E,E,g,E,E,H,E,E,L,L,b,b,E,g,E,E,E,b,g,E,E,E,E,E],j=[N,N,N,N,N,N,N,N,N,N,N,H,H,H,g,y,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,N,S,O,M,_,D,P,C,L,L,L,L,L,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,C,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,E,N];t.L=g,t.R=y,t.EN=b,t.ON_R=3,t.AN=4,t.R_H=5,t.B=6,t.RLE=7,t.DOT=&quot;\su00b7&quot;,t.doBidiReorder=function(e,n,r){if(e.length&lt;2)return{};var i=e.split(&quot;&quot;),o=new Array(i.length),u=new Array(i.length),a=[];s=r?m:v,F(i,a,i.length,n);for(var f=0;f&lt;o.length;o[f]=f,f++);I(2,a,o),I(1,a,o);for(var f=0;f&lt;o.length-1;f++)n[f]===w?a[f]=t.AN:a[f]===y&amp;&amp;(n[f]&gt;T&amp;&amp;n[f]&lt;O||n[f]===E||n[f]===H)?a[f]=t.ON_R:f&gt;0&amp;&amp;i[f-1]===&quot;\su0644&quot;&amp;&amp;/\su0622|\su0623|\su0625|\su0627/.test(i[f])&amp;&amp;(a[f-1]=a[f]=t.R_H,f++);i[i.length-1]===t.DOT&amp;&amp;(a[i.length-1]=t.B),i[0]===&quot;\su202b&quot;&amp;&amp;(a[0]=t.RLE);for(var f=0;f&lt;o.length;f++)u[f]=a[o[f]];return{logicalFromVisual:o,bidiLevels:u}},t.hasBidiCharacters=function(e,t){var n=!1;for(var r=0;r&lt;e.length;r++)t[r]=R(e.charAt(r)),!n&amp;&amp;(t[r]==y||t[r]==T||t[r]==w)&amp;&amp;(n=!0);return n},t.getVisualFromLogicalIdx=function(e,t){for(var n=0;n&lt;t.logicalFromVisual.length;n++)if(t.logicalFromVisual[n]==e)return n;return 0}}),ace.define(&quot;ace/bidihandler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/bidiutil&quot;,&quot;ace/lib/lang&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/bidiutil&quot;),i=e(&quot;./lib/lang&quot;),s=/[\su0590-\su05f4\su0600-\su06ff\su0700-\su08ac\su202B]/,o=function(e){this.session=e,this.bidiMap={},this.currentRow=null,this.bidiUtil=r,this.charWidths=[],this.EOL=&quot;\su00ac&quot;,this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line=&quot;&quot;,this.wrapIndent=0,this.EOF=&quot;\su00b6&quot;,this.RLE=&quot;\su202b&quot;,this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=s.test(e.getValue())};(function(){this.isBidiRow=function(e,t,n){return this.seenBidi?(e!==this.currentRow&amp;&amp;(this.currentRow=e,this.updateRowLine(t,n),this.updateBidiMap()),this.bidiMap.bidiLevels):!1},this.onChange=function(e){this.seenBidi?this.currentRow=null:e.action==&quot;insert&quot;&amp;&amp;s.test(e.lines.join(&quot;\sn&quot;))&amp;&amp;(this.seenBidi=!0,this.currentRow=null)},this.getDocumentRow=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var n=this.session.$getRowCacheIndex(t,this.currentRow);n&gt;=0&amp;&amp;(e=this.session.$docRowCache[n])}return e},this.getSplitIndex=function(){var e=0,t=this.session.$screenRowCache;if(t.length){var n,r=this.session.$getRowCacheIndex(t,this.currentRow);while(this.currentRow-e&gt;0){n=this.session.$getRowCacheIndex(t,this.currentRow-e-1);if(n!==r)break;r=n,e++}}else e=this.currentRow;return e},this.updateRowLine=function(e,t){e===undefined&amp;&amp;(e=this.getDocumentRow());var n=e===this.session.getLength()-1,s=n?this.EOF:this.EOL;this.wrapIndent=0,this.line=this.session.getLine(e),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE;if(this.session.$useWrapMode){var o=this.session.$wrapData[e];o&amp;&amp;(t===undefined&amp;&amp;(t=this.getSplitIndex()),t&gt;0&amp;&amp;o.length?(this.wrapIndent=o.indent,this.wrapOffset=this.wrapIndent*this.charWidths[r.L],this.line=t&lt;o.length?this.line.substring(o[t-1],o[t]):this.line.substring(o[o.length-1])):this.line=this.line.substring(0,o[t])),t==o.length&amp;&amp;(this.line+=this.showInvisibles?s:r.DOT)}else this.line+=this.showInvisibles?s:r.DOT;var u=this.session,a=0,f;this.line=this.line.replace(/\st|[\su1100-\su2029, \su202F-\suFFE6]/g,function(e,t){return e===&quot;	&quot;||u.isFullWidth(e.charCodeAt(0))?(f=e===&quot;	&quot;?u.getScreenTabSize(t+a):2,a+=f-1,i.stringRepeat(r.DOT,f)):e}),this.isRtlDir&amp;&amp;(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==r.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},this.updateBidiMap=function(){var e=[];r.hasBidiCharacters(this.line,e)||this.isRtlDir?this.bidiMap=r.doBidiReorder(this.line,e,this.isRtlDir):this.bidiMap={}},this.markAsDirty=function(){this.currentRow=null},this.updateCharacterWidths=function(e){if(this.characterWidth===e.$characterSize.width)return;this.fontMetrics=e;var t=this.characterWidth=e.$characterSize.width,n=e.$measureCharWidth(&quot;\su05d4&quot;);this.charWidths[r.L]=this.charWidths[r.EN]=this.charWidths[r.ON_R]=t,this.charWidths[r.R]=this.charWidths[r.AN]=n,this.charWidths[r.R_H]=n*.45,this.charWidths[r.B]=this.charWidths[r.RLE]=0,this.currentRow=null},this.setShowInvisibles=function(e){this.showInvisibles=e,this.currentRow=null},this.setEolChar=function(e){this.EOL=e},this.setContentWidth=function(e){this.contentWidth=e},this.isRtlLine=function(e){return this.$isRtl?!0:e!=undefined?this.session.getLine(e).charAt(0)==this.RLE:this.isRtlDir},this.setRtlDirection=function(e,t){var n=e.getCursorPosition();for(var r=e.selection.getSelectionAnchor().row;r&lt;=n.row;r++)!t&amp;&amp;e.session.getLine(r).charAt(0)===e.session.$bidiHandler.RLE?e.session.doc.removeInLine(r,0,1):t&amp;&amp;e.session.getLine(r).charAt(0)!==e.session.$bidiHandler.RLE&amp;&amp;e.session.doc.insert({column:0,row:r},e.session.$bidiHandler.RLE)},this.getPosLeft=function(e){e-=this.wrapIndent;var t=this.line.charAt(0)===this.RLE?1:0,n=e&gt;t?this.session.getOverwrite()?e:e-1:t,i=r.getVisualFromLogicalIdx(n,this.bidiMap),s=this.bidiMap.bidiLevels,o=0;!this.session.getOverwrite()&amp;&amp;e&lt;=t&amp;&amp;s[i]%2!==0&amp;&amp;i++;for(var u=0;u&lt;i;u++)o+=this.charWidths[s[u]];return!this.session.getOverwrite()&amp;&amp;e&gt;t&amp;&amp;s[i]%2===0&amp;&amp;(o+=this.charWidths[s[i]]),this.wrapIndent&amp;&amp;(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&amp;&amp;(o+=this.rtlLineOffset),o},this.getSelections=function(e,t){var n=this.bidiMap,r=n.bidiLevels,i,s=[],o=0,u=Math.min(e,t)-this.wrapIndent,a=Math.max(e,t)-this.wrapIndent,f=!1,l=!1,c=0;this.wrapIndent&amp;&amp;(o+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var h,p=0;p&lt;r.length;p++)h=n.logicalFromVisual[p],i=r[p],f=h&gt;=u&amp;&amp;h&lt;a,f&amp;&amp;!l?c=o:!f&amp;&amp;l&amp;&amp;s.push({left:c,width:o-c}),o+=this.charWidths[i],l=f;f&amp;&amp;p===r.length&amp;&amp;s.push({left:c,width:o-c});if(this.isRtlDir)for(var d=0;d&lt;s.length;d++)s[d].left+=this.rtlLineOffset;return s},this.offsetToCol=function(e){this.isRtlDir&amp;&amp;(e-=this.rtlLineOffset);var t=0,e=Math.max(e,0),n=0,r=0,i=this.bidiMap.bidiLevels,s=this.charWidths[i[r]];this.wrapIndent&amp;&amp;(e-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);while(e&gt;n+s/2){n+=s;if(r===i.length-1){s=0;break}s=this.charWidths[i[++r]]}return r&gt;0&amp;&amp;i[r-1]%2!==0&amp;&amp;i[r]%2===0?(e&lt;n&amp;&amp;r--,t=this.bidiMap.logicalFromVisual[r]):r&gt;0&amp;&amp;i[r-1]%2===0&amp;&amp;i[r]%2!==0?t=1+(e&gt;n?this.bidiMap.logicalFromVisual[r]:this.bidiMap.logicalFromVisual[r-1]):this.isRtlDir&amp;&amp;r===i.length-1&amp;&amp;s===0&amp;&amp;i[r-1]%2===0||!this.isRtlDir&amp;&amp;r===0&amp;&amp;i[r]%2!==0?t=1+this.bidiMap.logicalFromVisual[r]:(r&gt;0&amp;&amp;i[r-1]%2!==0&amp;&amp;s!==0&amp;&amp;r--,t=this.bidiMap.logicalFromVisual[r]),t===0&amp;&amp;this.isRtlDir&amp;&amp;t++,t+this.wrapIndent}}).call(o.prototype),t.BidiHandler=o}),ace.define(&quot;ace/selection&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/lang&quot;),s=e(&quot;./lib/event_emitter&quot;).EventEmitter,o=e(&quot;./range&quot;).Range,u=function(e){this.session=e,this.doc=e.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var t=this;this.cursor.on(&quot;change&quot;,function(e){t.$cursorChanged=!0,t.$silent||t._emit(&quot;changeCursor&quot;),!t.$isEmpty&amp;&amp;!t.$silent&amp;&amp;t._emit(&quot;changeSelection&quot;),!t.$keepDesiredColumnOnChange&amp;&amp;e.old.column!=e.value.column&amp;&amp;(t.$desiredColumn=null)}),this.anchor.on(&quot;change&quot;,function(){t.$anchorChanged=!0,!t.$isEmpty&amp;&amp;!t.$silent&amp;&amp;t._emit(&quot;changeSelection&quot;)})};(function(){r.implement(this,s),this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&amp;&amp;this.anchor.column==this.lead.column},this.isMultiLine=function(){return!this.$isEmpty&amp;&amp;this.anchor.row!=this.cursor.row},this.getCursor=function(){return this.lead.getPosition()},this.setSelectionAnchor=function(e,t){this.$isEmpty=!1,this.anchor.setPosition(e,t)},this.getAnchor=this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},this.getSelectionLead=function(){return this.lead.getPosition()},this.isBackwards=function(){var e=this.anchor,t=this.lead;return e.row&gt;t.row||e.row==t.row&amp;&amp;e.column&gt;t.column},this.getRange=function(){var e=this.anchor,t=this.lead;return this.$isEmpty?o.fromPoints(t,t):this.isBackwards()?o.fromPoints(t,e):o.fromPoints(e,t)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit(&quot;changeSelection&quot;))},this.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},this.setRange=this.setSelectionRange=function(e,t){var n=t?e.end:e.start,r=t?e.start:e.end;this.$setSelection(n.row,n.column,r.row,r.column)},this.$setSelection=function(e,t,n,r){if(this.$silent)return;var i=this.$isEmpty,s=this.inMultiSelectMode;this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(e,t),this.cursor.setPosition(n,r),this.$isEmpty=!o.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&amp;&amp;this._emit(&quot;changeCursor&quot;),(this.$cursorChanged||this.$anchorChanged||i!=this.$isEmpty||s)&amp;&amp;this._emit(&quot;changeSelection&quot;)},this.$moveSelection=function(e){var t=this.lead;this.$isEmpty&amp;&amp;this.setSelectionAnchor(t.row,t.column),e.call(this)},this.selectTo=function(e,t){this.$moveSelection(function(){this.moveCursorTo(e,t)})},this.selectToPosition=function(e){this.$moveSelection(function(){this.moveCursorToPosition(e)})},this.moveTo=function(e,t){this.clearSelection(),this.moveCursorTo(e,t)},this.moveToPosition=function(e){this.clearSelection(),this.moveCursorToPosition(e)},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.getWordRange=function(e,t){if(typeof t==&quot;undefined&quot;){var n=e||this.lead;e=n.row,t=n.column}return this.session.getWordRange(e,t)},this.selectWord=function(){this.setSelectionRange(this.getWordRange())},this.selectAWord=function(){var e=this.getCursor(),t=this.session.getAWordRange(e.row,e.column);this.setSelectionRange(t)},this.getLineRange=function(e,t){var n=typeof e==&quot;number&quot;?e:this.lead.row,r,i=this.session.getFoldLine(n);return i?(n=i.start.row,r=i.end.row):r=n,t===!0?new o(n,0,r,this.session.getLine(r).length):new o(n,0,r+1,0)},this.selectLine=function(){this.setSelectionRange(this.getLineRange())},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.wouldMoveIntoSoftTab=function(e,t,n){var r=e.column,i=e.column+t;return n&lt;0&amp;&amp;(r=e.column-t,i=e.column),this.session.isTabStop(e)&amp;&amp;this.doc.getLine(e.row).slice(r,i).split(&quot; &quot;).length-1==t},this.moveCursorLeft=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,-1))this.moveCursorTo(t.start.row,t.start.column);else if(e.column===0)e.row&gt;0&amp;&amp;this.moveCursorTo(e.row-1,this.doc.getLine(e.row-1).length);else{var n=this.session.getTabSize();this.wouldMoveIntoSoftTab(e,n,-1)&amp;&amp;!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-n):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){var e=this.lead.getPosition(),t;if(t=this.session.getFoldAt(e.row,e.column,1))this.moveCursorTo(t.end.row,t.end.column);else if(this.lead.column==this.doc.getLine(this.lead.row).length)this.lead.row&lt;this.doc.getLength()-1&amp;&amp;this.moveCursorTo(this.lead.row+1,0);else{var n=this.session.getTabSize(),e=this.lead;this.wouldMoveIntoSoftTab(e,n,1)&amp;&amp;!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,n):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var e=this.lead.row,t=this.lead.column,n=this.session.documentToScreenRow(e,t),r=this.session.screenToDocumentPosition(n,0),i=this.session.getDisplayLine(e,null,r.row,r.column),s=i.match(/^\ss*/);s[0].length!=t&amp;&amp;!this.session.$useEmacsStyleLineStart&amp;&amp;(r.column+=s[0].length),this.moveCursorToPosition(r)},this.moveCursorLineEnd=function(){var e=this.lead,t=this.session.getDocumentLastRowColumnPosition(e.row,e.column);if(this.lead.column==t.column){var n=this.session.getLine(t.row);if(t.column==n.length){var r=n.search(/\ss+$/);r&gt;0&amp;&amp;(t.column=r)}}this.moveCursorTo(t.row,t.column)},this.moveCursorFileEnd=function(){var e=this.doc.getLength()-1,t=this.doc.getLine(e).length;this.moveCursorTo(e,t)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorLongWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;var i=this.session.getFoldAt(e,t,1);if(i){this.moveCursorTo(i.end.row,i.end.column);return}this.session.nonTokenRe.exec(r)&amp;&amp;(t+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,r=n.substring(t));if(t&gt;=n.length){this.moveCursorTo(e,n.length),this.moveCursorRight(),e&lt;this.doc.getLength()-1&amp;&amp;this.moveCursorWordRight();return}this.session.tokenRe.exec(r)&amp;&amp;(t+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)},this.moveCursorLongWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1)){this.moveCursorTo(n.start.row,n.start.column);return}var r=this.session.getFoldStringAt(e,t,-1);r==null&amp;&amp;(r=this.doc.getLine(e).substring(0,t));var s=i.stringReverse(r);this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(s)&amp;&amp;(t-=this.session.nonTokenRe.lastIndex,s=s.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0);if(t&lt;=0){this.moveCursorTo(e,0),this.moveCursorLeft(),e&gt;0&amp;&amp;this.moveCursorWordLeft();return}this.session.tokenRe.exec(s)&amp;&amp;(t-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(e,t)},this.$shortWordEndIndex=function(e){var t=0,n,r=/\ss/,i=this.session.tokenRe;i.lastIndex=0;if(this.session.tokenRe.exec(e))t=this.session.tokenRe.lastIndex;else{while((n=e[t])&amp;&amp;r.test(n))t++;if(t&lt;1){i.lastIndex=0;while((n=e[t])&amp;&amp;!i.test(n)){i.lastIndex=0,t++;if(r.test(n)){if(t&gt;2){t--;break}while((n=e[t])&amp;&amp;r.test(n))t++;if(t&gt;2)break}}}}return i.lastIndex=0,t},this.moveCursorShortWordRight=function(){var e=this.lead.row,t=this.lead.column,n=this.doc.getLine(e),r=n.substring(t),i=this.session.getFoldAt(e,t,1);if(i)return this.moveCursorTo(i.end.row,i.end.column);if(t==n.length){var s=this.doc.getLength();do e++,r=this.doc.getLine(e);while(e&lt;s&amp;&amp;/^\ss*$/.test(r));/^\ss+/.test(r)||(r=&quot;&quot;),t=0}var o=this.$shortWordEndIndex(r);this.moveCursorTo(e,t+o)},this.moveCursorShortWordLeft=function(){var e=this.lead.row,t=this.lead.column,n;if(n=this.session.getFoldAt(e,t,-1))return this.moveCursorTo(n.start.row,n.start.column);var r=this.session.getLine(e).substring(0,t);if(t===0){do e--,r=this.doc.getLine(e);while(e&gt;0&amp;&amp;/^\ss*$/.test(r));t=r.length,/\ss+$/.test(r)||(r=&quot;&quot;)}var s=i.stringReverse(r),o=this.$shortWordEndIndex(s);return this.moveCursorTo(e,t-o)},this.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},this.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},this.moveCursorBy=function(e,t){var n=this.session.documentToScreenPosition(this.lead.row,this.lead.column),r;t===0&amp;&amp;(e!==0&amp;&amp;(this.session.$bidiHandler.isBidiRow(n.row,this.lead.row)?(r=this.session.$bidiHandler.getPosLeft(n.column),n.column=Math.round(r/this.session.$bidiHandler.charWidths[0])):r=n.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?n.column=this.$desiredColumn:this.$desiredColumn=n.column);if(e!=0&amp;&amp;this.session.lineWidgets&amp;&amp;this.session.lineWidgets[this.lead.row]){var i=this.session.lineWidgets[this.lead.row];e&lt;0?e-=i.rowsAbove||0:e&gt;0&amp;&amp;(e+=i.rowCount-(i.rowsAbove||0))}var s=this.session.screenToDocumentPosition(n.row+e,n.column,r);e!==0&amp;&amp;t===0&amp;&amp;s.row===this.lead.row&amp;&amp;s.column===this.lead.column,this.moveCursorTo(s.row,s.column+t,t===0)},this.moveCursorToPosition=function(e){this.moveCursorTo(e.row,e.column)},this.moveCursorTo=function(e,t,n){var r=this.session.getFoldAt(e,t,1);r&amp;&amp;(e=r.start.row,t=r.start.column),this.$keepDesiredColumnOnChange=!0;var i=this.session.getLine(e);/[\suDC00-\suDFFF]/.test(i.charAt(t))&amp;&amp;i.charAt(t-1)&amp;&amp;(this.lead.row==e&amp;&amp;this.lead.column==t+1?t-=1:t+=1),this.lead.setPosition(e,t),this.$keepDesiredColumnOnChange=!1,n||(this.$desiredColumn=null)},this.moveCursorToScreen=function(e,t,n){var r=this.session.screenToDocumentPosition(e,t);this.moveCursorTo(r.row,r.column,n)},this.detach=function(){this.lead.detach(),this.anchor.detach(),this.session=this.doc=null},this.fromOrientedRange=function(e){this.setSelectionRange(e,e.cursor==e.start),this.$desiredColumn=e.desiredColumn||this.$desiredColumn},this.toOrientedRange=function(e){var t=this.getRange();return e?(e.start.column=t.start.column,e.start.row=t.start.row,e.end.column=t.end.column,e.end.row=t.end.row):e=t,e.cursor=this.isBackwards()?e.start:e.end,e.desiredColumn=this.$desiredColumn,e},this.getRangeOfMovements=function(e){var t=this.getCursor();try{e(this);var n=this.getCursor();return o.fromPoints(t,n)}catch(r){return o.fromPoints(t,t)}finally{this.moveCursorToPosition(t)}},this.toJSON=function(){if(this.rangeCount)var e=this.ranges.map(function(e){var t=e.clone();return t.isBackwards=e.cursor==e.start,t});else{var e=this.getRange();e.isBackwards=this.isBackwards()}return e},this.fromJSON=function(e){if(e.start==undefined){if(this.rangeList&amp;&amp;e.length&gt;1){this.toSingleRange(e[0]);for(var t=e.length;t--;){var n=o.fromPoints(e[t].start,e[t].end);e[t].isBackwards&amp;&amp;(n.cursor=n.start),this.addRange(n,!0)}return}e=e[0]}this.rangeList&amp;&amp;this.toSingleRange(e),this.setSelectionRange(e,e.isBackwards)},this.isEqual=function(e){if((e.length||this.rangeCount)&amp;&amp;e.length!=this.rangeCount)return!1;if(!e.length||!this.ranges)return this.getRange().isEqual(e);for(var t=this.ranges.length;t--;)if(!this.ranges[t].isEqual(e[t]))return!1;return!0}}).call(u.prototype),t.Selection=u}),ace.define(&quot;ace/tokenizer&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./config&quot;),i=2e3,s=function(e){this.states=e,this.regExps={},this.matchMappings={};for(var t in this.states){var n=this.states[t],r=[],i=0,s=this.matchMappings[t]={defaultToken:&quot;text&quot;},o=&quot;g&quot;,u=[];for(var a=0;a&lt;n.length;a++){var f=n[a];f.defaultToken&amp;&amp;(s.defaultToken=f.defaultToken),f.caseInsensitive&amp;&amp;(o=&quot;gi&quot;);if(f.regex==null)continue;f.regex instanceof RegExp&amp;&amp;(f.regex=f.regex.toString().slice(1,-1));var l=f.regex,c=(new RegExp(&quot;(?:(&quot;+l+&quot;)|(.))&quot;)).exec(&quot;a&quot;).length-2;Array.isArray(f.token)?f.token.length==1||c==1?f.token=f.token[0]:c-1!=f.token.length?(this.reportError(&quot;number of classes and regexp groups doesn't match&quot;,{rule:f,groupCount:c-1}),f.token=f.token[0]):(f.tokenArray=f.token,f.token=null,f.onMatch=this.$arrayTokens):typeof f.token==&quot;function&quot;&amp;&amp;!f.onMatch&amp;&amp;(c&gt;1?f.onMatch=this.$applyToken:f.onMatch=f.token),c&gt;1&amp;&amp;(/\s\s\sd/.test(f.regex)?l=f.regex.replace(/\s\s([0-9]+)/g,function(e,t){return&quot;\s\s&quot;+(parseInt(t,10)+i+1)}):(c=1,l=this.removeCapturingGroups(f.regex)),!f.splitRegex&amp;&amp;typeof f.token!=&quot;string&quot;&amp;&amp;u.push(f)),s[i]=a,i+=c,r.push(l),f.onMatch||(f.onMatch=null)}r.length||(s[0]=0,r.push(&quot;$&quot;)),u.forEach(function(e){e.splitRegex=this.createSplitterRegexp(e.regex,o)},this),this.regExps[t]=new RegExp(&quot;(&quot;+r.join(&quot;)|(&quot;)+&quot;)|($)&quot;,o)}};(function(){this.$setMaxTokenCount=function(e){i=e|0},this.$applyToken=function(e){var t=this.splitRegex.exec(e).slice(1),n=this.token.apply(this,t);if(typeof n==&quot;string&quot;)return[{type:n,value:e}];var r=[];for(var i=0,s=n.length;i&lt;s;i++)t[i]&amp;&amp;(r[r.length]={type:n[i],value:t[i]});return r},this.$arrayTokens=function(e){if(!e)return[];var t=this.splitRegex.exec(e);if(!t)return&quot;text&quot;;var n=[],r=this.tokenArray;for(var i=0,s=r.length;i&lt;s;i++)t[i+1]&amp;&amp;(n[n.length]={type:r[i],value:t[i+1]});return n},this.removeCapturingGroups=function(e){var t=e.replace(/\s\s.|\s[(?:\s\s.|[^\s\s\s]])*|\s(\s?[:=!]|(\s()/g,function(e,t){return t?&quot;(?:&quot;:e});return t},this.createSplitterRegexp=function(e,t){if(e.indexOf(&quot;(?=&quot;)!=-1){var n=0,r=!1,i={};e.replace(/(\s\s.)|(\s((?:\s?[=!])?)|(\s))|([\s[\s]])/g,function(e,t,s,o,u,a){return r?r=u!=&quot;]&quot;:u?r=!0:o?(n==i.stack&amp;&amp;(i.end=a+1,i.stack=-1),n--):s&amp;&amp;(n++,s.length!=1&amp;&amp;(i.stack=n,i.start=a)),e}),i.end!=null&amp;&amp;/^\s)*$/.test(e.substr(i.end))&amp;&amp;(e=e.substring(0,i.start)+e.substr(i.end))}return e.charAt(0)!=&quot;^&quot;&amp;&amp;(e=&quot;^&quot;+e),e.charAt(e.length-1)!=&quot;$&quot;&amp;&amp;(e+=&quot;$&quot;),new RegExp(e,(t||&quot;&quot;).replace(&quot;g&quot;,&quot;&quot;))},this.getLineTokens=function(e,t){if(t&amp;&amp;typeof t!=&quot;string&quot;){var n=t.slice(0);t=n[0],t===&quot;#tmp&quot;&amp;&amp;(n.shift(),t=n.shift())}else var n=[];var r=t||&quot;start&quot;,s=this.states[r];s||(r=&quot;start&quot;,s=this.states[r]);var o=this.matchMappings[r],u=this.regExps[r];u.lastIndex=0;var a,f=[],l=0,c=0,h={type:null,value:&quot;&quot;};while(a=u.exec(e)){var p=o.defaultToken,d=null,v=a[0],m=u.lastIndex;if(m-v.length&gt;l){var g=e.substring(l,m-v.length);h.type==p?h.value+=g:(h.type&amp;&amp;f.push(h),h={type:p,value:g})}for(var y=0;y&lt;a.length-2;y++){if(a[y+1]===undefined)continue;d=s[o[y]],d.onMatch?p=d.onMatch(v,r,n,e):p=d.token,d.next&amp;&amp;(typeof d.next==&quot;string&quot;?r=d.next:r=d.next(r,n),s=this.states[r],s||(this.reportError(&quot;state doesn't exist&quot;,r),r=&quot;start&quot;,s=this.states[r]),o=this.matchMappings[r],l=m,u=this.regExps[r],u.lastIndex=m),d.consumeLineEnd&amp;&amp;(l=m);break}if(v)if(typeof p==&quot;string&quot;)!!d&amp;&amp;d.merge===!1||h.type!==p?(h.type&amp;&amp;f.push(h),h={type:p,value:v}):h.value+=v;else if(p){h.type&amp;&amp;f.push(h),h={type:null,value:&quot;&quot;};for(var y=0;y&lt;p.length;y++)f.push(p[y])}if(l==e.length)break;l=m;if(c++&gt;i){c&gt;2*e.length&amp;&amp;this.reportError(&quot;infinite loop with in ace tokenizer&quot;,{startState:t,line:e});while(l&lt;e.length)h.type&amp;&amp;f.push(h),h={value:e.substring(l,l+=500),type:&quot;overflow&quot;};r=&quot;start&quot;,n=[];break}}return h.type&amp;&amp;f.push(h),n.length&gt;1&amp;&amp;n[0]!==r&amp;&amp;n.unshift(&quot;#tmp&quot;,r),{tokens:f,state:n.length?n:r}},this.reportError=r.reportError}).call(s.prototype),t.Tokenizer=s}),ace.define(&quot;ace/mode/text_highlight_rules&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/lang&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/lang&quot;),i=function(){this.$rules={start:[{token:&quot;empty_line&quot;,regex:&quot;^$&quot;},{defaultToken:&quot;text&quot;}]}};(function(){this.addRules=function(e,t){if(!t){for(var n in e)this.$rules[n]=e[n];return}for(var n in e){var r=e[n];for(var i=0;i&lt;r.length;i++){var s=r[i];if(s.next||s.onMatch)typeof s.next==&quot;string&quot;&amp;&amp;s.next.indexOf(t)!==0&amp;&amp;(s.next=t+s.next),s.nextState&amp;&amp;s.nextState.indexOf(t)!==0&amp;&amp;(s.nextState=t+s.nextState)}this.$rules[t+n]=r}},this.getRules=function(){return this.$rules},this.embedRules=function(e,t,n,i,s){var o=typeof e==&quot;function&quot;?(new e).getRules():e;if(i)for(var u=0;u&lt;i.length;u++)i[u]=t+i[u];else{i=[];for(var a in o)i.push(t+a)}this.addRules(o,t);if(n){var f=Array.prototype[s?&quot;push&quot;:&quot;unshift&quot;];for(var u=0;u&lt;i.length;u++)f.apply(this.$rules[i[u]],r.deepCopy(n))}this.$embeds||(this.$embeds=[]),this.$embeds.push(t)},this.getEmbeds=function(){return this.$embeds};var e=function(e,t){return(e!=&quot;start&quot;||t.length)&amp;&amp;t.unshift(this.nextState,e),this.nextState},t=function(e,t){return t.shift(),t.shift()||&quot;start&quot;};this.normalizeRules=function(){function i(s){var o=r[s];o.processed=!0;for(var u=0;u&lt;o.length;u++){var a=o[u],f=null;Array.isArray(a)&amp;&amp;(f=a,a={}),!a.regex&amp;&amp;a.start&amp;&amp;(a.regex=a.start,a.next||(a.next=[]),a.next.push({defaultToken:a.token},{token:a.token+&quot;.end&quot;,regex:a.end||a.start,next:&quot;pop&quot;}),a.token=a.token+&quot;.start&quot;,a.push=!0);var l=a.next||a.push;if(l&amp;&amp;Array.isArray(l)){var c=a.stateName;c||(c=a.token,typeof c!=&quot;string&quot;&amp;&amp;(c=c[0]||&quot;&quot;),r[c]&amp;&amp;(c+=n++)),r[c]=l,a.next=c,i(c)}else l==&quot;pop&quot;&amp;&amp;(a.next=t);a.push&amp;&amp;(a.nextState=a.next||a.push,a.next=e,delete a.push);if(a.rules)for(var h in a.rules)r[h]?r[h].push&amp;&amp;r[h].push.apply(r[h],a.rules[h]):r[h]=a.rules[h];var p=typeof a==&quot;string&quot;?a:a.include;p&amp;&amp;(Array.isArray(p)?f=p.map(function(e){return r[e]}):f=r[p]);if(f){var d=[u,1].concat(f);a.noEscape&amp;&amp;(d=d.filter(function(e){return!e.next})),o.splice.apply(o,d),u--}a.keywordMap&amp;&amp;(a.token=this.createKeywordMapper(a.keywordMap,a.defaultToken||&quot;text&quot;,a.caseInsensitive),delete a.defaultToken)}}var n=0,r=this.$rules;Object.keys(r).forEach(i,this)},this.createKeywordMapper=function(e,t,n,r){var i=Object.create(null);return Object.keys(e).forEach(function(t){var s=e[t];n&amp;&amp;(s=s.toLowerCase());var o=s.split(r||&quot;|&quot;);for(var u=o.length;u--;)i[o[u]]=t}),Object.getPrototypeOf(i)&amp;&amp;(i.__proto__=null),this.$keywordList=Object.keys(i),e=null,n?function(e){return i[e.toLowerCase()]||t}:function(e){return i[e]||t}},this.getKeywords=function(){return this.$keywords}}).call(i.prototype),t.TextHighlightRules=i}),ace.define(&quot;ace/mode/behaviour&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r=function(){this.$behaviours={}};(function(){this.add=function(e,t,n){switch(undefined){case this.$behaviours:this.$behaviours={};case this.$behaviours[e]:this.$behaviours[e]={}}this.$behaviours[e][t]=n},this.addBehaviours=function(e){for(var t in e)for(var n in e[t])this.add(t,n,e[t][n])},this.remove=function(e){this.$behaviours&amp;&amp;this.$behaviours[e]&amp;&amp;delete this.$behaviours[e]},this.inherit=function(e,t){if(typeof e==&quot;function&quot;)var n=(new e).getBehaviours(t);else var n=e.getBehaviours(t);this.addBehaviours(n)},this.getBehaviours=function(e){if(!e)return this.$behaviours;var t={};for(var n=0;n&lt;e.length;n++)this.$behaviours[e[n]]&amp;&amp;(t[e[n]]=this.$behaviours[e[n]]);return t}}).call(r.prototype),t.Behaviour=r}),ace.define(&quot;ace/token_iterator&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./range&quot;).Range,i=function(e,t,n){this.$session=e,this.$row=t,this.$rowTokens=e.getTokens(t);var r=e.getTokenAt(t,n);this.$tokenIndex=r?r.index:-1};(function(){this.stepBackward=function(){this.$tokenIndex-=1;while(this.$tokenIndex&lt;0){this.$row-=1;if(this.$row&lt;0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},this.stepForward=function(){this.$tokenIndex+=1;var e;while(this.$tokenIndex&gt;=this.$rowTokens.length){this.$row+=1,e||(e=this.$session.getLength());if(this.$row&gt;=e)return this.$row=e-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},this.getCurrentTokenRow=function(){return this.$row},this.getCurrentTokenColumn=function(){var e=this.$rowTokens,t=this.$tokenIndex,n=e[t].start;if(n!==undefined)return n;n=0;while(t&gt;0)t-=1,n+=e[t].value.length;return n},this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},this.getCurrentTokenRange=function(){var e=this.$rowTokens[this.$tokenIndex],t=this.getCurrentTokenColumn();return new r(this.$row,t,this.$row,t+e.value.length)}}).call(i.prototype),t.TokenIterator=i}),ace.define(&quot;ace/mode/behaviour/cstyle&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/mode/behaviour&quot;,&quot;ace/token_iterator&quot;,&quot;ace/lib/lang&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../lib/oop&quot;),i=e(&quot;../behaviour&quot;).Behaviour,s=e(&quot;../../token_iterator&quot;).TokenIterator,o=e(&quot;../../lib/lang&quot;),u=[&quot;text&quot;,&quot;paren.rparen&quot;,&quot;rparen&quot;,&quot;paren&quot;,&quot;punctuation.operator&quot;],a=[&quot;text&quot;,&quot;paren.rparen&quot;,&quot;rparen&quot;,&quot;paren&quot;,&quot;punctuation.operator&quot;,&quot;comment&quot;],f,l={},c={'&quot;':'&quot;',&quot;'&quot;:&quot;'&quot;},h=function(e){var t=-1;e.multiSelect&amp;&amp;(t=e.selection.index,l.rangeCount!=e.multiSelect.rangeCount&amp;&amp;(l={rangeCount:e.multiSelect.rangeCount}));if(l[t])return f=l[t];f=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:&quot;&quot;,maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:&quot;&quot;,maybeInsertedLineEnd:&quot;&quot;}},p=function(e,t,n,r){var i=e.end.row-e.start.row;return{text:n+t+r,selection:[0,e.start.column+1,i,e.end.column+(i?0:1)]}},d=function(e){this.add(&quot;braces&quot;,&quot;insertion&quot;,function(t,n,r,i,s){var u=r.getCursorPosition(),a=i.doc.getLine(u.row);if(s==&quot;{&quot;){h(r);var l=r.getSelectionRange(),c=i.doc.getTextRange(l);if(c!==&quot;&quot;&amp;&amp;c!==&quot;{&quot;&amp;&amp;r.getWrapBehavioursEnabled())return p(l,c,&quot;{&quot;,&quot;}&quot;);if(d.isSaneInsertion(r,i))return/[\s]\s}\s)]/.test(a[u.column])||r.inMultiSelectMode||e&amp;&amp;e.braces?(d.recordAutoInsert(r,i,&quot;}&quot;),{text:&quot;{}&quot;,selection:[1,1]}):(d.recordMaybeInsert(r,i,&quot;{&quot;),{text:&quot;{&quot;,selection:[1,1]})}else if(s==&quot;}&quot;){h(r);var v=a.substring(u.column,u.column+1);if(v==&quot;}&quot;){var m=i.$findOpeningBracket(&quot;}&quot;,{column:u.column+1,row:u.row});if(m!==null&amp;&amp;d.isAutoInsertedClosing(u,a,s))return d.popAutoInsertedClosing(),{text:&quot;&quot;,selection:[1,1]}}}else{if(s==&quot;\sn&quot;||s==&quot;\sr\sn&quot;){h(r);var g=&quot;&quot;;d.isMaybeInsertedClosing(u,a)&amp;&amp;(g=o.stringRepeat(&quot;}&quot;,f.maybeInsertedBrackets),d.clearMaybeInsertedClosing());var v=a.substring(u.column,u.column+1);if(v===&quot;}&quot;){var y=i.findMatchingBracket({row:u.row,column:u.column+1},&quot;}&quot;);if(!y)return null;var b=this.$getIndent(i.getLine(y.row))}else{if(!g){d.clearMaybeInsertedClosing();return}var b=this.$getIndent(a)}var w=b+i.getTabString();return{text:&quot;\sn&quot;+w+&quot;\sn&quot;+b+g,selection:[1,w.length,1,w.length]}}d.clearMaybeInsertedClosing()}}),this.add(&quot;braces&quot;,&quot;deletion&quot;,function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&amp;&amp;s==&quot;{&quot;){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.end.column,i.end.column+1);if(u==&quot;}&quot;)return i.end.column++,i;f.maybeInsertedBrackets--}}),this.add(&quot;parens&quot;,&quot;insertion&quot;,function(e,t,n,r,i){if(i==&quot;(&quot;){h(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==&quot;&quot;&amp;&amp;n.getWrapBehavioursEnabled())return p(s,o,&quot;(&quot;,&quot;)&quot;);if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,&quot;)&quot;),{text:&quot;()&quot;,selection:[1,1]}}else if(i==&quot;)&quot;){h(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f==&quot;)&quot;){var l=r.$findOpeningBracket(&quot;)&quot;,{column:u.column+1,row:u.row});if(l!==null&amp;&amp;d.isAutoInsertedClosing(u,a,i))return d.popAutoInsertedClosing(),{text:&quot;&quot;,selection:[1,1]}}}}),this.add(&quot;parens&quot;,&quot;deletion&quot;,function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&amp;&amp;s==&quot;(&quot;){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u==&quot;)&quot;)return i.end.column++,i}}),this.add(&quot;brackets&quot;,&quot;insertion&quot;,function(e,t,n,r,i){if(i==&quot;[&quot;){h(n);var s=n.getSelectionRange(),o=r.doc.getTextRange(s);if(o!==&quot;&quot;&amp;&amp;n.getWrapBehavioursEnabled())return p(s,o,&quot;[&quot;,&quot;]&quot;);if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,&quot;]&quot;),{text:&quot;[]&quot;,selection:[1,1]}}else if(i==&quot;]&quot;){h(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row),f=a.substring(u.column,u.column+1);if(f==&quot;]&quot;){var l=r.$findOpeningBracket(&quot;]&quot;,{column:u.column+1,row:u.row});if(l!==null&amp;&amp;d.isAutoInsertedClosing(u,a,i))return d.popAutoInsertedClosing(),{text:&quot;&quot;,selection:[1,1]}}}}),this.add(&quot;brackets&quot;,&quot;deletion&quot;,function(e,t,n,r,i){var s=r.doc.getTextRange(i);if(!i.isMultiLine()&amp;&amp;s==&quot;[&quot;){h(n);var o=r.doc.getLine(i.start.row),u=o.substring(i.start.column+1,i.start.column+2);if(u==&quot;]&quot;)return i.end.column++,i}}),this.add(&quot;string_dquotes&quot;,&quot;insertion&quot;,function(e,t,n,r,i){var s=r.$mode.$quotes||c;if(i.length==1&amp;&amp;s[i]){if(this.lineCommentStart&amp;&amp;this.lineCommentStart.indexOf(i)!=-1)return;h(n);var o=i,u=n.getSelectionRange(),a=r.doc.getTextRange(u);if(a!==&quot;&quot;&amp;&amp;(a.length!=1||!s[a])&amp;&amp;n.getWrapBehavioursEnabled())return p(u,a,o,o);if(!a){var f=n.getCursorPosition(),l=r.doc.getLine(f.row),d=l.substring(f.column-1,f.column),v=l.substring(f.column,f.column+1),m=r.getTokenAt(f.row,f.column),g=r.getTokenAt(f.row,f.column+1);if(d==&quot;\s\s&quot;&amp;&amp;m&amp;&amp;/escape/.test(m.type))return null;var y=m&amp;&amp;/string|escape/.test(m.type),b=!g||/string|escape/.test(g.type),w;if(v==o)w=y!==b,w&amp;&amp;/string\s.end/.test(g.type)&amp;&amp;(w=!1);else{if(y&amp;&amp;!b)return null;if(y&amp;&amp;b)return null;var E=r.$mode.tokenRe;E.lastIndex=0;var S=E.test(d);E.lastIndex=0;var x=E.test(d);if(S||x)return null;if(v&amp;&amp;!/[\ss;,.})\s]\s\s]/.test(v))return null;var T=l[f.column-2];if(!(d!=o||T!=o&amp;&amp;!E.test(T)))return null;w=!0}return{text:w?o+o:&quot;&quot;,selection:[1,1]}}}}),this.add(&quot;string_dquotes&quot;,&quot;deletion&quot;,function(e,t,n,r,i){var s=r.$mode.$quotes||c,o=r.doc.getTextRange(i);if(!i.isMultiLine()&amp;&amp;s.hasOwnProperty(o)){h(n);var u=r.doc.getLine(i.start.row),a=u.substring(i.start.column+1,i.start.column+2);if(a==o)return i.end.column++,i}})};d.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),r=new s(t,n.row,n.column);if(!this.$matchTokenType(r.getCurrentToken()||&quot;text&quot;,u)){if(/[)}\s]]/.test(e.session.getLine(n.row)[n.column]))return!0;var i=new s(t,n.row,n.column+1);if(!this.$matchTokenType(i.getCurrentToken()||&quot;text&quot;,u))return!1}return r.stepForward(),r.getCurrentTokenRow()!==n.row||this.$matchTokenType(r.getCurrentToken()||&quot;text&quot;,a)},d.$matchTokenType=function(e,t){return t.indexOf(e.type||e)&gt;-1},d.recordAutoInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isAutoInsertedClosing(r,i,f.autoInsertedLineEnd[0])||(f.autoInsertedBrackets=0),f.autoInsertedRow=r.row,f.autoInsertedLineEnd=n+i.substr(r.column),f.autoInsertedBrackets++},d.recordMaybeInsert=function(e,t,n){var r=e.getCursorPosition(),i=t.doc.getLine(r.row);this.isMaybeInsertedClosing(r,i)||(f.maybeInsertedBrackets=0),f.maybeInsertedRow=r.row,f.maybeInsertedLineStart=i.substr(0,r.column)+n,f.maybeInsertedLineEnd=i.substr(r.column),f.maybeInsertedBrackets++},d.isAutoInsertedClosing=function(e,t,n){return f.autoInsertedBrackets&gt;0&amp;&amp;e.row===f.autoInsertedRow&amp;&amp;n===f.autoInsertedLineEnd[0]&amp;&amp;t.substr(e.column)===f.autoInsertedLineEnd},d.isMaybeInsertedClosing=function(e,t){return f.maybeInsertedBrackets&gt;0&amp;&amp;e.row===f.maybeInsertedRow&amp;&amp;t.substr(e.column)===f.maybeInsertedLineEnd&amp;&amp;t.substr(0,e.column)==f.maybeInsertedLineStart},d.popAutoInsertedClosing=function(){f.autoInsertedLineEnd=f.autoInsertedLineEnd.substr(1),f.autoInsertedBrackets--},d.clearMaybeInsertedClosing=function(){f&amp;&amp;(f.maybeInsertedBrackets=0,f.maybeInsertedRow=-1)},r.inherits(d,i),t.CstyleBehaviour=d}),ace.define(&quot;ace/unicode&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],i=0,s=[];for(var o=0;o&lt;r.length;o+=2)s.push(i+=r[o]),r[o+1]&amp;&amp;s.push(45,i+=r[o+1]);t.wordChars=String.fromCharCode.apply(null,s)}),ace.define(&quot;ace/mode/text&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/config&quot;,&quot;ace/tokenizer&quot;,&quot;ace/mode/text_highlight_rules&quot;,&quot;ace/mode/behaviour/cstyle&quot;,&quot;ace/unicode&quot;,&quot;ace/lib/lang&quot;,&quot;ace/token_iterator&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../config&quot;),i=e(&quot;../tokenizer&quot;).Tokenizer,s=e(&quot;./text_highlight_rules&quot;).TextHighlightRules,o=e(&quot;./behaviour/cstyle&quot;).CstyleBehaviour,u=e(&quot;../unicode&quot;),a=e(&quot;../lib/lang&quot;),f=e(&quot;../token_iterator&quot;).TokenIterator,l=e(&quot;../range&quot;).Range,c=function(){this.HighlightRules=s};(function(){this.$defaultBehaviour=new o,this.tokenRe=new RegExp(&quot;^[&quot;+u.wordChars+&quot;\s\s$_]+&quot;,&quot;g&quot;),this.nonTokenRe=new RegExp(&quot;^(?:[^&quot;+u.wordChars+&quot;\s\s$_]|\s\ss])+&quot;,&quot;g&quot;),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new i(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart=&quot;&quot;,this.blockComment=&quot;&quot;,this.toggleCommentLines=function(e,t,n,r){function w(e){for(var t=n;t&lt;=r;t++)e(i.getLine(t),t)}var i=t.doc,s=!0,o=!0,u=Infinity,f=t.getTabSize(),l=!1;if(!this.lineCommentStart){if(!this.blockComment)return!1;var c=this.blockComment.start,h=this.blockComment.end,p=new RegExp(&quot;^(\s\ss*)(?:&quot;+a.escapeRegExp(c)+&quot;)&quot;),d=new RegExp(&quot;(?:&quot;+a.escapeRegExp(h)+&quot;)\s\ss*$&quot;),v=function(e,t){if(g(e,t))return;if(!s||/\sS/.test(e))i.insertInLine({row:t,column:e.length},h),i.insertInLine({row:t,column:u},c)},m=function(e,t){var n;(n=e.match(d))&amp;&amp;i.removeInLine(t,e.length-n[0].length,e.length),(n=e.match(p))&amp;&amp;i.removeInLine(t,n[1].length,n[0].length)},g=function(e,n){if(p.test(e))return!0;var r=t.getTokens(n);for(var i=0;i&lt;r.length;i++)if(r[i].type===&quot;comment&quot;)return!0}}else{if(Array.isArray(this.lineCommentStart))var p=this.lineCommentStart.map(a.escapeRegExp).join(&quot;|&quot;),c=this.lineCommentStart[0];else var p=a.escapeRegExp(this.lineCommentStart),c=this.lineCommentStart;p=new RegExp(&quot;^(\s\ss*)(?:&quot;+p+&quot;) ?&quot;),l=t.getUseSoftTabs();var m=function(e,t){var n=e.match(p);if(!n)return;var r=n[1].length,s=n[0].length;!b(e,r,s)&amp;&amp;n[0][s-1]==&quot; &quot;&amp;&amp;s--,i.removeInLine(t,r,s)},y=c+&quot; &quot;,v=function(e,t){if(!s||/\sS/.test(e))b(e,u,u)?i.insertInLine({row:t,column:u},y):i.insertInLine({row:t,column:u},c)},g=function(e,t){return p.test(e)},b=function(e,t,n){var r=0;while(t--&amp;&amp;e.charAt(t)==&quot; &quot;)r++;if(r%f!=0)return!1;var r=0;while(e.charAt(n++)==&quot; &quot;)r++;return f&gt;2?r%f!=f-1:r%f==0}}var E=Infinity;w(function(e,t){var n=e.search(/\sS/);n!==-1?(n&lt;u&amp;&amp;(u=n),o&amp;&amp;!g(e,t)&amp;&amp;(o=!1)):E&gt;e.length&amp;&amp;(E=e.length)}),u==Infinity&amp;&amp;(u=E,s=!1,o=!1),l&amp;&amp;u%f!=0&amp;&amp;(u=Math.floor(u/f)*f),w(o?m:v)},this.toggleBlockComment=function(e,t,n,r){var i=this.blockComment;if(!i)return;!i.start&amp;&amp;i[0]&amp;&amp;(i=i[0]);var s=new f(t,r.row,r.column),o=s.getCurrentToken(),u=t.selection,a=t.selection.toOrientedRange(),c,h;if(o&amp;&amp;/comment/.test(o.type)){var p,d;while(o&amp;&amp;/comment/.test(o.type)){var v=o.value.indexOf(i.start);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;p=new l(m,g,m,g+i.start.length);break}o=s.stepBackward()}var s=new f(t,r.row,r.column),o=s.getCurrentToken();while(o&amp;&amp;/comment/.test(o.type)){var v=o.value.indexOf(i.end);if(v!=-1){var m=s.getCurrentTokenRow(),g=s.getCurrentTokenColumn()+v;d=new l(m,g,m,g+i.end.length);break}o=s.stepForward()}d&amp;&amp;t.remove(d),p&amp;&amp;(t.remove(p),c=p.start.row,h=-i.start.length)}else h=i.start.length,c=n.start.row,t.insert(n.end,i.end),t.insert(n.start,i.start);a.start.row==c&amp;&amp;(a.start.column+=h),a.end.row==c&amp;&amp;(a.end.column+=h),t.selection.fromOrientedRange(a)},this.getNextLineIndent=function(e,t,n){return this.$getIndent(t)},this.checkOutdent=function(e,t,n){return!1},this.autoOutdent=function(e,t,n){},this.$getIndent=function(e){return e.match(/^\ss*/)[0]},this.createWorker=function(e){return null},this.createModeDelegates=function(e){this.$embeds=[],this.$modes={};for(var t in e)if(e[t]){var n=e[t],i=n.prototype.$id,s=r.$modes[i];s||(r.$modes[i]=s=new n),r.$modes[t]||(r.$modes[t]=s),this.$embeds.push(t),this.$modes[t]=s}var o=[&quot;toggleBlockComment&quot;,&quot;toggleCommentLines&quot;,&quot;getNextLineIndent&quot;,&quot;checkOutdent&quot;,&quot;autoOutdent&quot;,&quot;transformAction&quot;,&quot;getCompletions&quot;];for(var t=0;t&lt;o.length;t++)(function(e){var n=o[t],r=e[n];e[o[t]]=function(){return this.$delegator(n,arguments,r)}})(this)},this.$delegator=function(e,t,n){var r=t[0]||&quot;start&quot;;if(typeof r!=&quot;string&quot;){if(Array.isArray(r[2])){var i=r[2][r[2].length-1],s=this.$modes[i];if(s)return s[e].apply(s,[r[1]].concat([].slice.call(t,1)))}r=r[0]||&quot;start&quot;}for(var o=0;o&lt;this.$embeds.length;o++){if(!this.$modes[this.$embeds[o]])continue;var u=r.split(this.$embeds[o]);if(!u[0]&amp;&amp;u[1]){t[0]=u[1];var s=this.$modes[this.$embeds[o]];return s[e].apply(s,t)}}var a=n.apply(this,t);return n?a:undefined},this.transformAction=function(e,t,n,r,i){if(this.$behaviour){var s=this.$behaviour.getBehaviours();for(var o in s)if(s[o][t]){var u=s[o][t].apply(this,arguments);if(u)return u}}},this.getKeywords=function(e){if(!this.completionKeywords){var t=this.$tokenizer.rules,n=[];for(var r in t){var i=t[r];for(var s=0,o=i.length;s&lt;o;s++)if(typeof i[s].token==&quot;string&quot;)/keyword|support|storage/.test(i[s].token)&amp;&amp;n.push(i[s].regex);else if(typeof i[s].token==&quot;object&quot;)for(var u=0,a=i[s].token.length;u&lt;a;u++)if(/keyword|support|storage/.test(i[s].token[u])){var r=i[s].regex.match(/\s(.+?\s)/g)[u];n.push(r.substr(1,r.length-2))}}this.completionKeywords=n}return e?n.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(e,t,n,r){var i=this.$keywordList||this.$createKeywordList();return i.map(function(e){return{name:e,value:e,score:0,meta:&quot;keyword&quot;}})},this.$id=&quot;ace/mode/text&quot;}).call(c.prototype),t.Mode=c}),ace.define(&quot;ace/apply_delta&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;function r(e,t){throw console.log(&quot;Invalid Delta:&quot;,e),&quot;Invalid Delta: &quot;+t}function i(e,t){return t.row&gt;=0&amp;&amp;t.row&lt;e.length&amp;&amp;t.column&gt;=0&amp;&amp;t.column&lt;=e[t.row].length}function s(e,t){t.action!=&quot;insert&quot;&amp;&amp;t.action!=&quot;remove&quot;&amp;&amp;r(t,&quot;delta.action must be 'insert' or 'remove'&quot;),t.lines instanceof Array||r(t,&quot;delta.lines must be an Array&quot;),(!t.start||!t.end)&amp;&amp;r(t,&quot;delta.start/end must be an present&quot;);var n=t.start;i(e,t.start)||r(t,&quot;delta.start must be contained in document&quot;);var s=t.end;t.action==&quot;remove&quot;&amp;&amp;!i(e,s)&amp;&amp;r(t,&quot;delta.end must contained in document for 'remove' actions&quot;);var o=s.row-n.row,u=s.column-(o==0?n.column:0);(o!=t.lines.length-1||t.lines[o].length!=u)&amp;&amp;r(t,&quot;delta.range must match delta lines&quot;)}t.applyDelta=function(e,t,n){var r=t.start.row,i=t.start.column,s=e[r]||&quot;&quot;;switch(t.action){case&quot;insert&quot;:var o=t.lines;if(o.length===1)e[r]=s.substring(0,i)+t.lines[0]+s.substring(i);else{var u=[r,1].concat(t.lines);e.splice.apply(e,u),e[r]=s.substring(0,i)+e[r],e[r+t.lines.length-1]+=s.substring(i)}break;case&quot;remove&quot;:var a=t.end.column,f=t.end.row;r===f?e[r]=s.substring(0,i)+s.substring(a):e.splice(r,f-r+1,s.substring(0,i)+e[f].substring(a))}}}),ace.define(&quot;ace/anchor&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/event_emitter&quot;).EventEmitter,s=t.Anchor=function(e,t,n){this.$onChange=this.onChange.bind(this),this.attach(e),typeof n==&quot;undefined&quot;?this.setPosition(t.row,t.column):this.setPosition(t,n)};(function(){function e(e,t,n){var r=n?e.column&lt;=t.column:e.column&lt;t.column;return e.row&lt;t.row||e.row==t.row&amp;&amp;r}function t(t,n,r){var i=t.action==&quot;insert&quot;,s=(i?1:-1)*(t.end.row-t.start.row),o=(i?1:-1)*(t.end.column-t.start.column),u=t.start,a=i?u:t.end;return e(n,u,r)?{row:n.row,column:n.column}:e(a,n,!r)?{row:n.row+s,column:n.column+(n.row==a.row?o:0)}:{row:u.row,column:u.column}}r.implement(this,i),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(e){if(e.start.row==e.end.row&amp;&amp;e.start.row!=this.row)return;if(e.start.row&gt;this.row)return;var n=t(e,{row:this.row,column:this.column},this.$insertRight);this.setPosition(n.row,n.column,!0)},this.setPosition=function(e,t,n){var r;n?r={row:e,column:t}:r=this.$clipPositionToDocument(e,t);if(this.row==r.row&amp;&amp;this.column==r.column)return;var i={row:this.row,column:this.column};this.row=r.row,this.column=r.column,this._signal(&quot;change&quot;,{old:i,value:r})},this.detach=function(){this.document.removeEventListener(&quot;change&quot;,this.$onChange)},this.attach=function(e){this.document=e||this.document,this.document.on(&quot;change&quot;,this.$onChange)},this.$clipPositionToDocument=function(e,t){var n={};return e&gt;=this.document.getLength()?(n.row=Math.max(0,this.document.getLength()-1),n.column=this.document.getLine(n.row).length):e&lt;0?(n.row=0,n.column=0):(n.row=e,n.column=Math.min(this.document.getLine(n.row).length,Math.max(0,t))),t&lt;0&amp;&amp;(n.column=0),n}}).call(s.prototype)}),ace.define(&quot;ace/document&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/apply_delta&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/range&quot;,&quot;ace/anchor&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./apply_delta&quot;).applyDelta,s=e(&quot;./lib/event_emitter&quot;).EventEmitter,o=e(&quot;./range&quot;).Range,u=e(&quot;./anchor&quot;).Anchor,a=function(e){this.$lines=[&quot;&quot;],e.length===0?this.$lines=[&quot;&quot;]:Array.isArray(e)?this.insertMergedLines({row:0,column:0},e):this.insert({row:0,column:0},e)};(function(){r.implement(this,s),this.setValue=function(e){var t=this.getLength()-1;this.remove(new o(0,0,t,this.getLine(t).length)),this.insert({row:0,column:0},e)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(e,t){return new u(this,e,t)},&quot;aaa&quot;.split(/a/).length===0?this.$split=function(e){return e.replace(/\sr\sn|\sr/g,&quot;\sn&quot;).split(&quot;\sn&quot;)}:this.$split=function(e){return e.split(/\sr\sn|\sr|\sn/)},this.$detectNewLine=function(e){var t=e.match(/^.*?(\sr\sn|\sr|\sn)/m);this.$autoNewLine=t?t[1]:&quot;\sn&quot;,this._signal(&quot;changeNewLineMode&quot;)},this.getNewLineCharacter=function(){switch(this.$newLineMode){case&quot;windows&quot;:return&quot;\sr\sn&quot;;case&quot;unix&quot;:return&quot;\sn&quot;;default:return this.$autoNewLine||&quot;\sn&quot;}},this.$autoNewLine=&quot;&quot;,this.$newLineMode=&quot;auto&quot;,this.setNewLineMode=function(e){if(this.$newLineMode===e)return;this.$newLineMode=e,this._signal(&quot;changeNewLineMode&quot;)},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(e){return e==&quot;\sr\sn&quot;||e==&quot;\sr&quot;||e==&quot;\sn&quot;},this.getLine=function(e){return this.$lines[e]||&quot;&quot;},this.getLines=function(e,t){return this.$lines.slice(e,t+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(e){return this.getLinesForRange(e).join(this.getNewLineCharacter())},this.getLinesForRange=function(e){var t;if(e.start.row===e.end.row)t=[this.getLine(e.start.row).substring(e.start.column,e.end.column)];else{t=this.getLines(e.start.row,e.end.row),t[0]=(t[0]||&quot;&quot;).substring(e.start.column);var n=t.length-1;e.end.row-e.start.row==n&amp;&amp;(t[n]=t[n].substring(0,e.end.column))}return t},this.insertLines=function(e,t){return console.warn(&quot;Use of document.insertLines is deprecated. Use the insertFullLines method instead.&quot;),this.insertFullLines(e,t)},this.removeLines=function(e,t){return console.warn(&quot;Use of document.removeLines is deprecated. Use the removeFullLines method instead.&quot;),this.removeFullLines(e,t)},this.insertNewLine=function(e){return console.warn(&quot;Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead.&quot;),this.insertMergedLines(e,[&quot;&quot;,&quot;&quot;])},this.insert=function(e,t){return this.getLength()&lt;=1&amp;&amp;this.$detectNewLine(t),this.insertMergedLines(e,this.$split(t))},this.insertInLine=function(e,t){var n=this.clippedPos(e.row,e.column),r=this.pos(e.row,e.column+t.length);return this.applyDelta({start:n,end:r,action:&quot;insert&quot;,lines:[t]},!0),this.clonePos(r)},this.clippedPos=function(e,t){var n=this.getLength();e===undefined?e=n:e&lt;0?e=0:e&gt;=n&amp;&amp;(e=n-1,t=undefined);var r=this.getLine(e);return t==undefined&amp;&amp;(t=r.length),t=Math.min(Math.max(t,0),r.length),{row:e,column:t}},this.clonePos=function(e){return{row:e.row,column:e.column}},this.pos=function(e,t){return{row:e,column:t}},this.$clipPosition=function(e){var t=this.getLength();return e.row&gt;=t?(e.row=Math.max(0,t-1),e.column=this.getLine(t-1).length):(e.row=Math.max(0,e.row),e.column=Math.min(Math.max(e.column,0),this.getLine(e.row).length)),e},this.insertFullLines=function(e,t){e=Math.min(Math.max(e,0),this.getLength());var n=0;e&lt;this.getLength()?(t=t.concat([&quot;&quot;]),n=0):(t=[&quot;&quot;].concat(t),e--,n=this.$lines[e].length),this.insertMergedLines({row:e,column:n},t)},this.insertMergedLines=function(e,t){var n=this.clippedPos(e.row,e.column),r={row:n.row+t.length-1,column:(t.length==1?n.column:0)+t[t.length-1].length};return this.applyDelta({start:n,end:r,action:&quot;insert&quot;,lines:t}),this.clonePos(r)},this.remove=function(e){var t=this.clippedPos(e.start.row,e.start.column),n=this.clippedPos(e.end.row,e.end.column);return this.applyDelta({start:t,end:n,action:&quot;remove&quot;,lines:this.getLinesForRange({start:t,end:n})}),this.clonePos(t)},this.removeInLine=function(e,t,n){var r=this.clippedPos(e,t),i=this.clippedPos(e,n);return this.applyDelta({start:r,end:i,action:&quot;remove&quot;,lines:this.getLinesForRange({start:r,end:i})},!0),this.clonePos(r)},this.removeFullLines=function(e,t){e=Math.min(Math.max(0,e),this.getLength()-1),t=Math.min(Math.max(0,t),this.getLength()-1);var n=t==this.getLength()-1&amp;&amp;e&gt;0,r=t&lt;this.getLength()-1,i=n?e-1:e,s=n?this.getLine(i).length:0,u=r?t+1:t,a=r?0:this.getLine(u).length,f=new o(i,s,u,a),l=this.$lines.slice(e,t+1);return this.applyDelta({start:f.start,end:f.end,action:&quot;remove&quot;,lines:this.getLinesForRange(f)}),l},this.removeNewLine=function(e){e&lt;this.getLength()-1&amp;&amp;e&gt;=0&amp;&amp;this.applyDelta({start:this.pos(e,this.getLine(e).length),end:this.pos(e+1,0),action:&quot;remove&quot;,lines:[&quot;&quot;,&quot;&quot;]})},this.replace=function(e,t){e instanceof o||(e=o.fromPoints(e.start,e.end));if(t.length===0&amp;&amp;e.isEmpty())return e.start;if(t==this.getTextRange(e))return e.end;this.remove(e);var n;return t?n=this.insert(e.start,t):n=e.start,n},this.applyDeltas=function(e){for(var t=0;t&lt;e.length;t++)this.applyDelta(e[t])},this.revertDeltas=function(e){for(var t=e.length-1;t&gt;=0;t--)this.revertDelta(e[t])},this.applyDelta=function(e,t){var n=e.action==&quot;insert&quot;;if(n?e.lines.length&lt;=1&amp;&amp;!e.lines[0]:!o.comparePoints(e.start,e.end))return;n&amp;&amp;e.lines.length&gt;2e4?this.$splitAndapplyLargeDelta(e,2e4):(i(this.$lines,e,t),this._signal(&quot;change&quot;,e))},this.$splitAndapplyLargeDelta=function(e,t){var n=e.lines,r=n.length-t+1,i=e.start.row,s=e.start.column;for(var o=0,u=0;o&lt;r;o=u){u+=t-1;var a=n.slice(o,u);a.push(&quot;&quot;),this.applyDelta({start:this.pos(i+o,s),end:this.pos(i+u,s=0),action:e.action,lines:a},!0)}e.lines=n.slice(o),e.start.row=i+o,e.start.column=s,this.applyDelta(e,!0)},this.revertDelta=function(e){this.applyDelta({start:this.clonePos(e.start),end:this.clonePos(e.end),action:e.action==&quot;insert&quot;?&quot;remove&quot;:&quot;insert&quot;,lines:e.lines.slice()})},this.indexToPosition=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length;for(var i=t||0,s=n.length;i&lt;s;i++){e-=n[i].length+r;if(e&lt;0)return{row:i,column:e+n[i].length+r}}return{row:s-1,column:e+n[s-1].length+r}},this.positionToIndex=function(e,t){var n=this.$lines||this.getAllLines(),r=this.getNewLineCharacter().length,i=0,s=Math.min(e.row,n.length);for(var o=t||0;o&lt;s;++o)i+=n[o].length+r;return i+e.column}}).call(a.prototype),t.Document=a}),ace.define(&quot;ace/background_tokenizer&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/event_emitter&quot;).EventEmitter,s=function(e,t){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=e;var n=this;this.$worker=function(){if(!n.running)return;var e=new Date,t=n.currentLine,r=-1,i=n.doc,s=t;while(n.lines[t])t++;var o=i.getLength(),u=0;n.running=!1;while(t&lt;o){n.$tokenizeRow(t),r=t;do t++;while(n.lines[t]);u++;if(u%5===0&amp;&amp;new Date-e&gt;20){n.running=setTimeout(n.$worker,20);break}}n.currentLine=t,r==-1&amp;&amp;(r=t),s&lt;=r&amp;&amp;n.fireUpdateEvent(s,r)}};(function(){r.implement(this,i),this.setTokenizer=function(e){this.tokenizer=e,this.lines=[],this.states=[],this.start(0)},this.setDocument=function(e){this.doc=e,this.lines=[],this.states=[],this.stop()},this.fireUpdateEvent=function(e,t){var n={first:e,last:t};this._signal(&quot;update&quot;,{data:n})},this.start=function(e){this.currentLine=Math.min(e||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},this.$updateOnChange=function(e){var t=e.start.row,n=e.end.row-t;if(n===0)this.lines[t]=null;else if(e.action==&quot;remove&quot;)this.lines.splice(t,n+1,null),this.states.splice(t,n+1,null);else{var r=Array(n+1);r.unshift(t,1),this.lines.splice.apply(this.lines,r),this.states.splice.apply(this.states,r)}this.currentLine=Math.min(t,this.currentLine,this.doc.getLength()),this.stop()},this.stop=function(){this.running&amp;&amp;clearTimeout(this.running),this.running=!1},this.getTokens=function(e){return this.lines[e]||this.$tokenizeRow(e)},this.getState=function(e){return this.currentLine==e&amp;&amp;this.$tokenizeRow(e),this.states[e]||&quot;start&quot;},this.$tokenizeRow=function(e){var t=this.doc.getLine(e),n=this.states[e-1],r=this.tokenizer.getLineTokens(t,n,e);return this.states[e]+&quot;&quot;!=r.state+&quot;&quot;?(this.states[e]=r.state,this.lines[e+1]=null,this.currentLine&gt;e+1&amp;&amp;(this.currentLine=e+1)):this.currentLine==e&amp;&amp;(this.currentLine=e+1),this.lines[e]=r.tokens}}).call(s.prototype),t.BackgroundTokenizer=s}),ace.define(&quot;ace/search_highlight&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/oop&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/lang&quot;),i=e(&quot;./lib/oop&quot;),s=e(&quot;./range&quot;).Range,o=function(e,t,n){this.setRegexp(e),this.clazz=t,this.type=n||&quot;text&quot;};(function(){this.MAX_RANGES=500,this.setRegexp=function(e){if(this.regExp+&quot;&quot;==e+&quot;&quot;)return;this.regExp=e,this.cache=[]},this.update=function(e,t,n,i){if(!this.regExp)return;var o=i.firstRow,u=i.lastRow;for(var a=o;a&lt;=u;a++){var f=this.cache[a];f==null&amp;&amp;(f=r.getMatchOffsets(n.getLine(a),this.regExp),f.length&gt;this.MAX_RANGES&amp;&amp;(f=f.slice(0,this.MAX_RANGES)),f=f.map(function(e){return new s(a,e.offset,a,e.offset+e.length)}),this.cache[a]=f.length?f:&quot;&quot;);for(var l=f.length;l--;)t.drawSingleLineMarker(e,f[l].toScreenRange(n),this.clazz,i)}}}).call(o.prototype),t.SearchHighlight=o}),ace.define(&quot;ace/edit_session/fold_line&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function i(e,t){this.foldData=e,Array.isArray(t)?this.folds=t:t=this.folds=[t];var n=t[t.length-1];this.range=new r(t[0].start.row,t[0].start.column,n.end.row,n.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(e){e.setFoldLine(this)},this)}var r=e(&quot;../range&quot;).Range;(function(){this.shiftRow=function(e){this.start.row+=e,this.end.row+=e,this.folds.forEach(function(t){t.start.row+=e,t.end.row+=e})},this.addFold=function(e){if(e.sameRow){if(e.start.row&lt;this.startRow||e.endRow&gt;this.endRow)throw new Error(&quot;Can't add a fold to this FoldLine as it has no connection&quot;);this.folds.push(e),this.folds.sort(function(e,t){return-e.range.compareEnd(t.start.row,t.start.column)}),this.range.compareEnd(e.start.row,e.start.column)&gt;0?(this.end.row=e.end.row,this.end.column=e.end.column):this.range.compareStart(e.end.row,e.end.column)&lt;0&amp;&amp;(this.start.row=e.start.row,this.start.column=e.start.column)}else if(e.start.row==this.end.row)this.folds.push(e),this.end.row=e.end.row,this.end.column=e.end.column;else{if(e.end.row!=this.start.row)throw new Error(&quot;Trying to add fold to FoldRow that doesn't have a matching row&quot;);this.folds.unshift(e),this.start.row=e.start.row,this.start.column=e.start.column}e.foldLine=this},this.containsRow=function(e){return e&gt;=this.start.row&amp;&amp;e&lt;=this.end.row},this.walk=function(e,t,n){var r=0,i=this.folds,s,o,u,a=!0;t==null&amp;&amp;(t=this.end.row,n=this.end.column);for(var f=0;f&lt;i.length;f++){s=i[f],o=s.range.compareStart(t,n);if(o==-1){e(null,t,n,r,a);return}u=e(null,s.start.row,s.start.column,r,a),u=!u&amp;&amp;e(s.placeholder,s.start.row,s.start.column,r);if(u||o===0)return;a=!s.sameRow,r=s.end.column}e(null,t,n,r,a)},this.getNextFoldTo=function(e,t){var n,r;for(var i=0;i&lt;this.folds.length;i++){n=this.folds[i],r=n.range.compareEnd(e,t);if(r==-1)return{fold:n,kind:&quot;after&quot;};if(r===0)return{fold:n,kind:&quot;inside&quot;}}return null},this.addRemoveChars=function(e,t,n){var r=this.getNextFoldTo(e,t),i,s;if(r){i=r.fold;if(r.kind==&quot;inside&quot;&amp;&amp;i.start.column!=t&amp;&amp;i.start.row!=e)window.console&amp;&amp;window.console.log(e,t,i);else if(i.start.row==e){s=this.folds;var o=s.indexOf(i);o===0&amp;&amp;(this.start.column+=n);for(o;o&lt;s.length;o++){i=s[o],i.start.column+=n;if(!i.sameRow)return;i.end.column+=n}this.end.column+=n}}},this.split=function(e,t){var n=this.getNextFoldTo(e,t);if(!n||n.kind==&quot;inside&quot;)return null;var r=n.fold,s=this.folds,o=this.foldData,u=s.indexOf(r),a=s[u-1];this.end.row=a.end.row,this.end.column=a.end.column,s=s.splice(u,s.length-u);var f=new i(o,s);return o.splice(o.indexOf(this)+1,0,f),f},this.merge=function(e){var t=e.folds;for(var n=0;n&lt;t.length;n++)this.addFold(t[n]);var r=this.foldData;r.splice(r.indexOf(e),1)},this.toString=function(){var e=[this.range.toString()+&quot;: [&quot;];return this.folds.forEach(function(t){e.push(&quot;  &quot;+t.toString())}),e.push(&quot;]&quot;),e.join(&quot;\sn&quot;)},this.idxToPosition=function(e){var t=0;for(var n=0;n&lt;this.folds.length;n++){var r=this.folds[n];e-=r.start.column-t;if(e&lt;0)return{row:r.start.row,column:r.start.column+e};e-=r.placeholder.length;if(e&lt;0)return r.start;t=r.end.column}return{row:this.end.row,column:this.end.column+e}}}).call(i.prototype),t.FoldLine=i}),ace.define(&quot;ace/range_list&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./range&quot;).Range,i=r.comparePoints,s=function(){this.ranges=[],this.$bias=1};(function(){this.comparePoints=i,this.pointIndex=function(e,t,n){var r=this.ranges;for(var s=n||0;s&lt;r.length;s++){var o=r[s],u=i(e,o.end);if(u&gt;0)continue;var a=i(e,o.start);return u===0?t&amp;&amp;a!==0?-s-2:s:a&gt;0||a===0&amp;&amp;!t?s:-s-1}return-s-1},this.add=function(e){var t=!e.isEmpty(),n=this.pointIndex(e.start,t);n&lt;0&amp;&amp;(n=-n-1);var r=this.pointIndex(e.end,t,n);return r&lt;0?r=-r-1:r++,this.ranges.splice(n,r-n,e)},this.addList=function(e){var t=[];for(var n=e.length;n--;)t.push.apply(t,this.add(e[n]));return t},this.substractPoint=function(e){var t=this.pointIndex(e);if(t&gt;=0)return this.ranges.splice(t,1)},this.merge=function(){var e=[],t=this.ranges;t=t.sort(function(e,t){return i(e.start,t.start)});var n=t[0],r;for(var s=1;s&lt;t.length;s++){r=n,n=t[s];var o=i(r.end,n.start);if(o&lt;0)continue;if(o==0&amp;&amp;!r.isEmpty()&amp;&amp;!n.isEmpty())continue;i(r.end,n.end)&lt;0&amp;&amp;(r.end.row=n.end.row,r.end.column=n.end.column),t.splice(s,1),e.push(n),n=r,s--}return this.ranges=t,e},this.contains=function(e,t){return this.pointIndex({row:e,column:t})&gt;=0},this.containsPoint=function(e){return this.pointIndex(e)&gt;=0},this.rangeAtPoint=function(e){var t=this.pointIndex(e);if(t&gt;=0)return this.ranges[t]},this.clipRows=function(e,t){var n=this.ranges;if(n[0].start.row&gt;t||n[n.length-1].start.row&lt;e)return[];var r=this.pointIndex({row:e,column:0});r&lt;0&amp;&amp;(r=-r-1);var i=this.pointIndex({row:t,column:0},r);i&lt;0&amp;&amp;(i=-i-1);var s=[];for(var o=r;o&lt;i;o++)s.push(n[o]);return s},this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},this.attach=function(e){this.session&amp;&amp;this.detach(),this.session=e,this.onChange=this.$onChange.bind(this),this.session.on(&quot;change&quot;,this.onChange)},this.detach=function(){if(!this.session)return;this.session.removeListener(&quot;change&quot;,this.onChange),this.session=null},this.$onChange=function(e){var t=e.start,n=e.end,r=t.row,i=n.row,s=this.ranges;for(var o=0,u=s.length;o&lt;u;o++){var a=s[o];if(a.end.row&gt;=r)break}if(e.action==&quot;insert&quot;){var f=i-r,l=-t.column+n.column;for(;o&lt;u;o++){var a=s[o];if(a.start.row&gt;r)break;a.start.row==r&amp;&amp;a.start.column&gt;=t.column&amp;&amp;(a.start.column==t.column&amp;&amp;this.$bias&lt;=0||(a.start.column+=l,a.start.row+=f));if(a.end.row==r&amp;&amp;a.end.column&gt;=t.column){if(a.end.column==t.column&amp;&amp;this.$bias&lt;0)continue;a.end.column==t.column&amp;&amp;l&gt;0&amp;&amp;o&lt;u-1&amp;&amp;a.end.column&gt;a.start.column&amp;&amp;a.end.column==s[o+1].start.column&amp;&amp;(a.end.column-=l),a.end.column+=l,a.end.row+=f}}}else{var f=r-i,l=t.column-n.column;for(;o&lt;u;o++){var a=s[o];if(a.start.row&gt;i)break;if(a.end.row&lt;i&amp;&amp;(r&lt;a.end.row||r==a.end.row&amp;&amp;t.column&lt;a.end.column))a.end.row=r,a.end.column=t.column;else if(a.end.row==i)if(a.end.column&lt;=n.column){if(f||a.end.column&gt;t.column)a.end.column=t.column,a.end.row=t.row}else a.end.column+=l,a.end.row+=f;else a.end.row&gt;i&amp;&amp;(a.end.row+=f);if(a.start.row&lt;i&amp;&amp;(r&lt;a.start.row||r==a.start.row&amp;&amp;t.column&lt;a.start.column))a.start.row=r,a.start.column=t.column;else if(a.start.row==i)if(a.start.column&lt;=n.column){if(f||a.start.column&gt;t.column)a.start.column=t.column,a.start.row=t.row}else a.start.column+=l,a.start.row+=f;else a.start.row&gt;i&amp;&amp;(a.start.row+=f)}}if(f!=0&amp;&amp;o&lt;u)for(;o&lt;u;o++){var a=s[o];a.start.row+=f,a.end.row+=f}}}).call(s.prototype),t.RangeList=s}),ace.define(&quot;ace/edit_session/fold&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range_list&quot;,&quot;ace/lib/oop&quot;],function(e,t,n){&quot;use strict&quot;;function o(e,t){e.row-=t.row,e.row==0&amp;&amp;(e.column-=t.column)}function u(e,t){o(e.start,t),o(e.end,t)}function a(e,t){e.row==0&amp;&amp;(e.column+=t.column),e.row+=t.row}function f(e,t){a(e.start,t),a(e.end,t)}var r=e(&quot;../range_list&quot;).RangeList,i=e(&quot;../lib/oop&quot;),s=t.Fold=function(e,t){this.foldLine=null,this.placeholder=t,this.range=e,this.start=e.start,this.end=e.end,this.sameRow=e.start.row==e.end.row,this.subFolds=this.ranges=[]};i.inherits(s,r),function(){this.toString=function(){return'&quot;'+this.placeholder+'&quot; '+this.range.toString()},this.setFoldLine=function(e){this.foldLine=e,this.subFolds.forEach(function(t){t.setFoldLine(e)})},this.clone=function(){var e=this.range.clone(),t=new s(e,this.placeholder);return this.subFolds.forEach(function(e){t.subFolds.push(e.clone())}),t.collapseChildren=this.collapseChildren,t},this.addSubFold=function(e){if(this.range.isEqual(e))return;u(e,this.start);var t=e.start.row,n=e.start.column;for(var r=0,i=-1;r&lt;this.subFolds.length;r++){i=this.subFolds[r].range.compare(t,n);if(i!=1)break}var s=this.subFolds[r],o=0;if(i==0){if(s.range.containsRange(e))return s.addSubFold(e);o=1}var t=e.range.end.row,n=e.range.end.column;for(var a=r,i=-1;a&lt;this.subFolds.length;a++){i=this.subFolds[a].range.compare(t,n);if(i!=1)break}i==0&amp;&amp;a++;var f=this.subFolds.splice(r,a-r,e),l=i==0?f.length-1:f.length;for(var c=o;c&lt;l;c++)e.addSubFold(f[c]);return e.setFoldLine(this.foldLine),e},this.restoreRange=function(e){return f(e,this.start)}}.call(s.prototype)}),ace.define(&quot;ace/edit_session/folding&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;,&quot;ace/edit_session/fold_line&quot;,&quot;ace/edit_session/fold&quot;,&quot;ace/token_iterator&quot;],function(e,t,n){&quot;use strict&quot;;function u(){this.getFoldAt=function(e,t,n){var r=this.getFoldLine(e);if(!r)return null;var i=r.folds;for(var s=0;s&lt;i.length;s++){var o=i[s].range;if(o.contains(e,t)){if(n==1&amp;&amp;o.isEnd(e,t)&amp;&amp;!o.isEmpty())continue;if(n==-1&amp;&amp;o.isStart(e,t)&amp;&amp;!o.isEmpty())continue;return i[s]}}},this.getFoldsInRange=function(e){var t=e.start,n=e.end,r=this.$foldData,i=[];t.column+=1,n.column-=1;for(var s=0;s&lt;r.length;s++){var o=r[s].range.compareRange(e);if(o==2)continue;if(o==-2)break;var u=r[s].folds;for(var a=0;a&lt;u.length;a++){var f=u[a];o=f.range.compareRange(e);if(o==-2)break;if(o==2)continue;if(o==42)break;i.push(f)}}return t.column-=1,n.column+=1,i},this.getFoldsInRangeList=function(e){if(Array.isArray(e)){var t=[];e.forEach(function(e){t=t.concat(this.getFoldsInRange(e))},this)}else var t=this.getFoldsInRange(e);return t},this.getAllFolds=function(){var e=[],t=this.$foldData;for(var n=0;n&lt;t.length;n++)for(var r=0;r&lt;t[n].folds.length;r++)e.push(t[n].folds[r]);return e},this.getFoldStringAt=function(e,t,n,r){r=r||this.getFoldLine(e);if(!r)return null;var i={end:{column:0}},s,o;for(var u=0;u&lt;r.folds.length;u++){o=r.folds[u];var a=o.range.compareEnd(e,t);if(a==-1){s=this.getLine(o.start.row).substring(i.end.column,o.start.column);break}if(a===0)return null;i=o}return s||(s=this.getLine(o.start.row).substring(i.end.column)),n==-1?s.substring(0,t-i.end.column):n==1?s.substring(t-i.end.column):s},this.getFoldLine=function(e,t){var n=this.$foldData,r=0;t&amp;&amp;(r=n.indexOf(t)),r==-1&amp;&amp;(r=0);for(r;r&lt;n.length;r++){var i=n[r];if(i.start.row&lt;=e&amp;&amp;i.end.row&gt;=e)return i;if(i.end.row&gt;e)return null}return null},this.getNextFoldLine=function(e,t){var n=this.$foldData,r=0;t&amp;&amp;(r=n.indexOf(t)),r==-1&amp;&amp;(r=0);for(r;r&lt;n.length;r++){var i=n[r];if(i.end.row&gt;=e)return i}return null},this.getFoldedRowCount=function(e,t){var n=this.$foldData,r=t-e+1;for(var i=0;i&lt;n.length;i++){var s=n[i],o=s.end.row,u=s.start.row;if(o&gt;=t){u&lt;t&amp;&amp;(u&gt;=e?r-=t-u:r=0);break}o&gt;=e&amp;&amp;(u&gt;=e?r-=o-u:r-=o-e+1)}return r},this.$addFoldLine=function(e){return this.$foldData.push(e),this.$foldData.sort(function(e,t){return e.start.row-t.start.row}),e},this.addFold=function(e,t){var n=this.$foldData,r=!1,o;e instanceof s?o=e:(o=new s(t,e),o.collapseChildren=t.collapseChildren),this.$clipRangeToDocument(o.range);var u=o.start.row,a=o.start.column,f=o.end.row,l=o.end.column,c=this.getFoldAt(u,a,1),h=this.getFoldAt(f,l,-1);if(c&amp;&amp;h==c)return c.addSubFold(o);c&amp;&amp;!c.range.isStart(u,a)&amp;&amp;this.removeFold(c),h&amp;&amp;!h.range.isEnd(f,l)&amp;&amp;this.removeFold(h);var p=this.getFoldsInRange(o.range);p.length&gt;0&amp;&amp;(this.removeFolds(p),p.forEach(function(e){o.addSubFold(e)}));for(var d=0;d&lt;n.length;d++){var v=n[d];if(f==v.start.row){v.addFold(o),r=!0;break}if(u==v.end.row){v.addFold(o),r=!0;if(!o.sameRow){var m=n[d+1];if(m&amp;&amp;m.start.row==f){v.merge(m);break}}break}if(f&lt;=v.start.row)break}return r||(v=this.$addFoldLine(new i(this.$foldData,o))),this.$useWrapMode?this.$updateWrapData(v.start.row,v.start.row):this.$updateRowLengthCache(v.start.row,v.start.row),this.$modified=!0,this._signal(&quot;changeFold&quot;,{data:o,action:&quot;add&quot;}),o},this.addFolds=function(e){e.forEach(function(e){this.addFold(e)},this)},this.removeFold=function(e){var t=e.foldLine,n=t.start.row,r=t.end.row,i=this.$foldData,s=t.folds;if(s.length==1)i.splice(i.indexOf(t),1);else if(t.range.isEnd(e.end.row,e.end.column))s.pop(),t.end.row=s[s.length-1].end.row,t.end.column=s[s.length-1].end.column;else if(t.range.isStart(e.start.row,e.start.column))s.shift(),t.start.row=s[0].start.row,t.start.column=s[0].start.column;else if(e.sameRow)s.splice(s.indexOf(e),1);else{var o=t.split(e.start.row,e.start.column);s=o.folds,s.shift(),o.start.row=s[0].start.row,o.start.column=s[0].start.column}this.$updating||(this.$useWrapMode?this.$updateWrapData(n,r):this.$updateRowLengthCache(n,r)),this.$modified=!0,this._signal(&quot;changeFold&quot;,{data:e,action:&quot;remove&quot;})},this.removeFolds=function(e){var t=[];for(var n=0;n&lt;e.length;n++)t.push(e[n]);t.forEach(function(e){this.removeFold(e)},this),this.$modified=!0},this.expandFold=function(e){this.removeFold(e),e.subFolds.forEach(function(t){e.restoreRange(t),this.addFold(t)},this),e.collapseChildren&gt;0&amp;&amp;this.foldAll(e.start.row+1,e.end.row,e.collapseChildren-1),e.subFolds=[]},this.expandFolds=function(e){e.forEach(function(e){this.expandFold(e)},this)},this.unfold=function(e,t){var n,i;e==null?(n=new r(0,0,this.getLength(),0),t=!0):typeof e==&quot;number&quot;?n=new r(e,0,e,this.getLine(e).length):&quot;row&quot;in e?n=r.fromPoints(e,e):n=e,i=this.getFoldsInRangeList(n);if(t)this.removeFolds(i);else{var s=i;while(s.length)this.expandFolds(s),s=this.getFoldsInRangeList(n)}if(i.length)return i},this.isRowFolded=function(e,t){return!!this.getFoldLine(e,t)},this.getRowFoldEnd=function(e,t){var n=this.getFoldLine(e,t);return n?n.end.row:e},this.getRowFoldStart=function(e,t){var n=this.getFoldLine(e,t);return n?n.start.row:e},this.getFoldDisplayLine=function(e,t,n,r,i){r==null&amp;&amp;(r=e.start.row),i==null&amp;&amp;(i=0),t==null&amp;&amp;(t=e.end.row),n==null&amp;&amp;(n=this.getLine(t).length);var s=this.doc,o=&quot;&quot;;return e.walk(function(e,t,n,u){if(t&lt;r)return;if(t==r){if(n&lt;i)return;u=Math.max(i,u)}e!=null?o+=e:o+=s.getLine(t).substring(u,n)},t,n),o},this.getDisplayLine=function(e,t,n,r){var i=this.getFoldLine(e);if(!i){var s;return s=this.doc.getLine(e),s.substring(r||0,t||s.length)}return this.getFoldDisplayLine(i,e,t,n,r)},this.$cloneFoldData=function(){var e=[];return e=this.$foldData.map(function(t){var n=t.folds.map(function(e){return e.clone()});return new i(e,n)}),e},this.toggleFold=function(e){var t=this.selection,n=t.getRange(),r,i;if(n.isEmpty()){var s=n.start;r=this.getFoldAt(s.row,s.column);if(r){this.expandFold(r);return}(i=this.findMatchingBracket(s))?n.comparePoint(i)==1?n.end=i:(n.start=i,n.start.column++,n.end.column--):(i=this.findMatchingBracket({row:s.row,column:s.column+1}))?(n.comparePoint(i)==1?n.end=i:n.start=i,n.start.column++):n=this.getCommentFoldRange(s.row,s.column)||n}else{var o=this.getFoldsInRange(n);if(e&amp;&amp;o.length){this.expandFolds(o);return}o.length==1&amp;&amp;(r=o[0])}r||(r=this.getFoldAt(n.start.row,n.start.column));if(r&amp;&amp;r.range.toString()==n.toString()){this.expandFold(r);return}var u=&quot;...&quot;;if(!n.isMultiLine()){u=this.getTextRange(n);if(u.length&lt;4)return;u=u.trim().substring(0,2)+&quot;..&quot;}this.addFold(u,n)},this.getCommentFoldRange=function(e,t,n){var i=new o(this,e,t),s=i.getCurrentToken(),u=s.type;if(s&amp;&amp;/^comment|string/.test(u)){u=u.match(/comment|string/)[0],u==&quot;comment&quot;&amp;&amp;(u+=&quot;|doc-start&quot;);var a=new RegExp(u),f=new r;if(n!=1){do s=i.stepBackward();while(s&amp;&amp;a.test(s.type));i.stepForward()}f.start.row=i.getCurrentTokenRow(),f.start.column=i.getCurrentTokenColumn()+2,i=new o(this,e,t);if(n!=-1){var l=-1;do{s=i.stepForward();if(l==-1){var c=this.getState(i.$row);a.test(c)||(l=i.$row)}else if(i.$row&gt;l)break}while(s&amp;&amp;a.test(s.type));s=i.stepBackward()}else s=i.getCurrentToken();return f.end.row=i.getCurrentTokenRow(),f.end.column=i.getCurrentTokenColumn()+s.value.length-2,f}},this.foldAll=function(e,t,n){n==undefined&amp;&amp;(n=1e5);var r=this.foldWidgets;if(!r)return;t=t||this.getLength(),e=e||0;for(var i=e;i&lt;t;i++){r[i]==null&amp;&amp;(r[i]=this.getFoldWidget(i));if(r[i]!=&quot;start&quot;)continue;var s=this.getFoldWidgetRange(i);if(s&amp;&amp;s.isMultiLine()&amp;&amp;s.end.row&lt;=t&amp;&amp;s.start.row&gt;=e){i=s.end.row;try{var o=this.addFold(&quot;...&quot;,s);o&amp;&amp;(o.collapseChildren=n)}catch(u){}}}},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle=&quot;markbegin&quot;,this.setFoldStyle=function(e){if(!this.$foldStyles[e])throw new Error(&quot;invalid fold style: &quot;+e+&quot;[&quot;+Object.keys(this.$foldStyles).join(&quot;, &quot;)+&quot;]&quot;);if(this.$foldStyle==e)return;this.$foldStyle=e,e==&quot;manual&quot;&amp;&amp;this.unfold();var t=this.$foldMode;this.$setFolding(null),this.$setFolding(t)},this.$setFolding=function(e){if(this.$foldMode==e)return;this.$foldMode=e,this.off(&quot;change&quot;,this.$updateFoldWidgets),this.off(&quot;tokenizerUpdate&quot;,this.$tokenizerUpdateFoldWidgets),this._signal(&quot;changeAnnotation&quot;);if(!e||this.$foldStyle==&quot;manual&quot;){this.foldWidgets=null;return}this.foldWidgets=[],this.getFoldWidget=e.getFoldWidget.bind(e,this,this.$foldStyle),this.getFoldWidgetRange=e.getFoldWidgetRange.bind(e,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on(&quot;change&quot;,this.$updateFoldWidgets),this.on(&quot;tokenizerUpdate&quot;,this.$tokenizerUpdateFoldWidgets)},this.getParentFoldRangeData=function(e,t){var n=this.foldWidgets;if(!n||t&amp;&amp;n[e])return{};var r=e-1,i;while(r&gt;=0){var s=n[r];s==null&amp;&amp;(s=n[r]=this.getFoldWidget(r));if(s==&quot;start&quot;){var o=this.getFoldWidgetRange(r);i||(i=o);if(o&amp;&amp;o.end.row&gt;=e)break}r--}return{range:r!==-1&amp;&amp;o,firstRange:i}},this.onFoldWidgetClick=function(e,t){t=t.domEvent;var n={children:t.shiftKey,all:t.ctrlKey||t.metaKey,siblings:t.altKey},r=this.$toggleFoldWidget(e,n);if(!r){var i=t.target||t.srcElement;i&amp;&amp;/ace_fold-widget/.test(i.className)&amp;&amp;(i.className+=&quot; ace_invalid&quot;)}},this.$toggleFoldWidget=function(e,t){if(!this.getFoldWidget)return;var n=this.getFoldWidget(e),r=this.getLine(e),i=n===&quot;end&quot;?-1:1,s=this.getFoldAt(e,i===-1?0:r.length,i);if(s)return t.children||t.all?this.removeFold(s):this.expandFold(s),s;var o=this.getFoldWidgetRange(e,!0);if(o&amp;&amp;!o.isMultiLine()){s=this.getFoldAt(o.start.row,o.start.column,1);if(s&amp;&amp;o.isEqual(s.range))return this.removeFold(s),s}if(t.siblings){var u=this.getParentFoldRangeData(e);if(u.range)var a=u.range.start.row+1,f=u.range.end.row;this.foldAll(a,f,t.all?1e4:0)}else t.children?(f=o?o.end.row:this.getLength(),this.foldAll(e+1,f,t.all?1e4:0)):o&amp;&amp;(t.all&amp;&amp;(o.collapseChildren=1e4),this.addFold(&quot;...&quot;,o));return o},this.toggleFoldWidget=function(e){var t=this.selection.getCursor().row;t=this.getRowFoldStart(t);var n=this.$toggleFoldWidget(t,{});if(n)return;var r=this.getParentFoldRangeData(t,!0);n=r.range||r.firstRange;if(n){t=n.start.row;var i=this.getFoldAt(t,this.getLine(t).length,1);i?this.removeFold(i):this.addFold(&quot;...&quot;,n)}},this.updateFoldWidgets=function(e){var t=e.start.row,n=e.end.row-t;if(n===0)this.foldWidgets[t]=null;else if(e.action==&quot;remove&quot;)this.foldWidgets.splice(t,n+1,null);else{var r=Array(n+1);r.unshift(t,1),this.foldWidgets.splice.apply(this.foldWidgets,r)}},this.tokenizerUpdateFoldWidgets=function(e){var t=e.data;t.first!=t.last&amp;&amp;this.foldWidgets.length&gt;t.first&amp;&amp;this.foldWidgets.splice(t.first,this.foldWidgets.length)}}var r=e(&quot;../range&quot;).Range,i=e(&quot;./fold_line&quot;).FoldLine,s=e(&quot;./fold&quot;).Fold,o=e(&quot;../token_iterator&quot;).TokenIterator;t.Folding=u}),ace.define(&quot;ace/edit_session/bracket_match&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/token_iterator&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function s(){this.findMatchingBracket=function(e,t){if(e.column==0)return null;var n=t||this.getLine(e.row).charAt(e.column-1);if(n==&quot;&quot;)return null;var r=n.match(/([\s(\s[\s{])|([\s)\s]\s}])/);return r?r[1]?this.$findClosingBracket(r[1],e):this.$findOpeningBracket(r[2],e):null},this.getBracketRange=function(e){var t=this.getLine(e.row),n=!0,r,s=t.charAt(e.column-1),o=s&amp;&amp;s.match(/([\s(\s[\s{])|([\s)\s]\s}])/);o||(s=t.charAt(e.column),e={row:e.row,column:e.column+1},o=s&amp;&amp;s.match(/([\s(\s[\s{])|([\s)\s]\s}])/),n=!1);if(!o)return null;if(o[1]){var u=this.$findClosingBracket(o[1],e);if(!u)return null;r=i.fromPoints(e,u),n||(r.end.column++,r.start.column--),r.cursor=r.end}else{var u=this.$findOpeningBracket(o[2],e);if(!u)return null;r=i.fromPoints(u,e),n||(r.start.column++,r.end.column--),r.cursor=r.start}return r},this.getMatchingBracketRanges=function(e){var t=this.getLine(e.row),n=t.charAt(e.column-1),r=n&amp;&amp;n.match(/([\s(\s[\s{])|([\s)\s]\s}])/);r||(n=t.charAt(e.column),e={row:e.row,column:e.column+1},r=n&amp;&amp;n.match(/([\s(\s[\s{])|([\s)\s]\s}])/));if(!r)return null;var s=new i(e.row,e.column-1,e.row,e.column),o=r[1]?this.$findClosingBracket(r[1],e):this.$findOpeningBracket(r[2],e);if(!o)return[s];var u=new i(o.row,o.column,o.row,o.column+1);return[s,u]},this.$brackets={&quot;)&quot;:&quot;(&quot;,&quot;(&quot;:&quot;)&quot;,&quot;]&quot;:&quot;[&quot;,&quot;[&quot;:&quot;]&quot;,&quot;{&quot;:&quot;}&quot;,&quot;}&quot;:&quot;{&quot;,&quot;&lt;&quot;:&quot;&gt;&quot;,&quot;&gt;&quot;:&quot;&lt;&quot;},this.$findOpeningBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp(&quot;(\s\s.?&quot;+u.type.replace(&quot;.&quot;,&quot;\s\s.&quot;).replace(&quot;rparen&quot;,&quot;.paren&quot;).replace(/\sb(?:end)\sb/,&quot;(?:start|begin|end)&quot;)+&quot;)+&quot;));var a=t.column-o.getCurrentTokenColumn()-2,f=u.value;for(;;){while(a&gt;=0){var l=f.charAt(a);if(l==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else l==e&amp;&amp;(s+=1);a-=1}do u=o.stepBackward();while(u&amp;&amp;!n.test(u.type));if(u==null)break;f=u.value,a=f.length-1}return null},this.$findClosingBracket=function(e,t,n){var i=this.$brackets[e],s=1,o=new r(this,t.row,t.column),u=o.getCurrentToken();u||(u=o.stepForward());if(!u)return;n||(n=new RegExp(&quot;(\s\s.?&quot;+u.type.replace(&quot;.&quot;,&quot;\s\s.&quot;).replace(&quot;lparen&quot;,&quot;.paren&quot;).replace(/\sb(?:start|begin)\sb/,&quot;(?:start|begin|end)&quot;)+&quot;)+&quot;));var a=t.column-o.getCurrentTokenColumn();for(;;){var f=u.value,l=f.length;while(a&lt;l){var c=f.charAt(a);if(c==i){s-=1;if(s==0)return{row:o.getCurrentTokenRow(),column:a+o.getCurrentTokenColumn()}}else c==e&amp;&amp;(s+=1);a+=1}do u=o.stepForward();while(u&amp;&amp;!n.test(u.type));if(u==null)break;a=0}return null}}var r=e(&quot;../token_iterator&quot;).TokenIterator,i=e(&quot;../range&quot;).Range;t.BracketMatch=s}),ace.define(&quot;ace/edit_session&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/lang&quot;,&quot;ace/bidihandler&quot;,&quot;ace/config&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/selection&quot;,&quot;ace/mode/text&quot;,&quot;ace/range&quot;,&quot;ace/document&quot;,&quot;ace/background_tokenizer&quot;,&quot;ace/search_highlight&quot;,&quot;ace/edit_session/folding&quot;,&quot;ace/edit_session/bracket_match&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/lang&quot;),s=e(&quot;./bidihandler&quot;).BidiHandler,o=e(&quot;./config&quot;),u=e(&quot;./lib/event_emitter&quot;).EventEmitter,a=e(&quot;./selection&quot;).Selection,f=e(&quot;./mode/text&quot;).Mode,l=e(&quot;./range&quot;).Range,c=e(&quot;./document&quot;).Document,h=e(&quot;./background_tokenizer&quot;).BackgroundTokenizer,p=e(&quot;./search_highlight&quot;).SearchHighlight,d=function(e,t){this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id=&quot;session&quot;+ ++d.$uid,this.$foldData.toString=function(){return this.join(&quot;\sn&quot;)},this.on(&quot;changeFold&quot;,this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this);if(typeof e!=&quot;object&quot;||!e.getLine)e=new c(e);this.setDocument(e),this.selection=new a(this),this.$bidiHandler=new s(this),o.resetOptions(this),this.setMode(t),o._signal(&quot;session&quot;,this)};d.$uid=0,function(){function m(e){return e&lt;4352?!1:e&gt;=4352&amp;&amp;e&lt;=4447||e&gt;=4515&amp;&amp;e&lt;=4519||e&gt;=4602&amp;&amp;e&lt;=4607||e&gt;=9001&amp;&amp;e&lt;=9002||e&gt;=11904&amp;&amp;e&lt;=11929||e&gt;=11931&amp;&amp;e&lt;=12019||e&gt;=12032&amp;&amp;e&lt;=12245||e&gt;=12272&amp;&amp;e&lt;=12283||e&gt;=12288&amp;&amp;e&lt;=12350||e&gt;=12353&amp;&amp;e&lt;=12438||e&gt;=12441&amp;&amp;e&lt;=12543||e&gt;=12549&amp;&amp;e&lt;=12589||e&gt;=12593&amp;&amp;e&lt;=12686||e&gt;=12688&amp;&amp;e&lt;=12730||e&gt;=12736&amp;&amp;e&lt;=12771||e&gt;=12784&amp;&amp;e&lt;=12830||e&gt;=12832&amp;&amp;e&lt;=12871||e&gt;=12880&amp;&amp;e&lt;=13054||e&gt;=13056&amp;&amp;e&lt;=19903||e&gt;=19968&amp;&amp;e&lt;=42124||e&gt;=42128&amp;&amp;e&lt;=42182||e&gt;=43360&amp;&amp;e&lt;=43388||e&gt;=44032&amp;&amp;e&lt;=55203||e&gt;=55216&amp;&amp;e&lt;=55238||e&gt;=55243&amp;&amp;e&lt;=55291||e&gt;=63744&amp;&amp;e&lt;=64255||e&gt;=65040&amp;&amp;e&lt;=65049||e&gt;=65072&amp;&amp;e&lt;=65106||e&gt;=65108&amp;&amp;e&lt;=65126||e&gt;=65128&amp;&amp;e&lt;=65131||e&gt;=65281&amp;&amp;e&lt;=65376||e&gt;=65504&amp;&amp;e&lt;=65510}r.implement(this,u),this.setDocument=function(e){this.doc&amp;&amp;this.doc.removeListener(&quot;change&quot;,this.$onChange),this.doc=e,e.on(&quot;change&quot;,this.$onChange),this.bgTokenizer&amp;&amp;this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},this.getDocument=function(){return this.doc},this.$resetRowCache=function(e){if(!e){this.$docRowCache=[],this.$screenRowCache=[];return}var t=this.$docRowCache.length,n=this.$getRowCacheIndex(this.$docRowCache,e)+1;t&gt;n&amp;&amp;(this.$docRowCache.splice(n,t),this.$screenRowCache.splice(n,t))},this.$getRowCacheIndex=function(e,t){var n=0,r=e.length-1;while(n&lt;=r){var i=n+r&gt;&gt;1,s=e[i];if(t&gt;s)n=i+1;else{if(!(t&lt;s))return i;r=i-1}}return n-1},this.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.bgTokenizer&amp;&amp;this.bgTokenizer.start(0)},this.onChangeFold=function(e){var t=e.data;this.$resetRowCache(t.start.row)},this.onChange=function(e){this.$modified=!0,this.$bidiHandler.onChange(e),this.$resetRowCache(e.start.row);var t=this.$updateInternalDataOnChange(e);!this.$fromUndo&amp;&amp;this.$undoManager&amp;&amp;(t&amp;&amp;t.length&amp;&amp;(this.$undoManager.add({action:&quot;removeFolds&quot;,folds:t},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(e,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer&amp;&amp;this.bgTokenizer.$updateOnChange(e),this._signal(&quot;change&quot;,e)},this.setValue=function(e){this.doc.setValue(e),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.getState=function(e){return this.bgTokenizer.getState(e)},this.getTokens=function(e){return this.bgTokenizer.getTokens(e)},this.getTokenAt=function(e,t){var n=this.bgTokenizer.getTokens(e),r,i=0;if(t==null){var s=n.length-1;i=this.getLine(e).length}else for(var s=0;s&lt;n.length;s++){i+=n[s].value.length;if(i&gt;=t)break}return r=n[s],r?(r.index=s,r.start=i-r.value.length,r):null},this.setUndoManager=function(e){this.$undoManager=e,this.$informUndoManager&amp;&amp;this.$informUndoManager.cancel();if(e){var t=this;e.addSession(this),this.$syncInformUndoManager=function(){t.$informUndoManager.cancel(),t.mergeUndoDeltas=!1},this.$informUndoManager=i.delayedCall(this.$syncInformUndoManager)}else this.$syncInformUndoManager=function(){}},this.markUndoGroup=function(){this.$syncInformUndoManager&amp;&amp;this.$syncInformUndoManager()},this.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?i.stringRepeat(&quot; &quot;,this.getTabSize()):&quot;	&quot;},this.setUseSoftTabs=function(e){this.setOption(&quot;useSoftTabs&quot;,e)},this.getUseSoftTabs=function(){return this.$useSoftTabs&amp;&amp;!this.$mode.$indentWithTabs},this.setTabSize=function(e){this.setOption(&quot;tabSize&quot;,e)},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(e){return this.$useSoftTabs&amp;&amp;e.column%this.$tabSize===0},this.setNavigateWithinSoftTabs=function(e){this.setOption(&quot;navigateWithinSoftTabs&quot;,e)},this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},this.$overwrite=!1,this.setOverwrite=function(e){this.setOption(&quot;overwrite&quot;,e)},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.addGutterDecoration=function(e,t){this.$decorations[e]||(this.$decorations[e]=&quot;&quot;),this.$decorations[e]+=&quot; &quot;+t,this._signal(&quot;changeBreakpoint&quot;,{})},this.removeGutterDecoration=function(e,t){this.$decorations[e]=(this.$decorations[e]||&quot;&quot;).replace(&quot; &quot;+t,&quot;&quot;),this._signal(&quot;changeBreakpoint&quot;,{})},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(e){this.$breakpoints=[];for(var t=0;t&lt;e.length;t++)this.$breakpoints[e[t]]=&quot;ace_breakpoint&quot;;this._signal(&quot;changeBreakpoint&quot;,{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._signal(&quot;changeBreakpoint&quot;,{})},this.setBreakpoint=function(e,t){t===undefined&amp;&amp;(t=&quot;ace_breakpoint&quot;),t?this.$breakpoints[e]=t:delete this.$breakpoints[e],this._signal(&quot;changeBreakpoint&quot;,{})},this.clearBreakpoint=function(e){delete this.$breakpoints[e],this._signal(&quot;changeBreakpoint&quot;,{})},this.addMarker=function(e,t,n,r){var i=this.$markerId++,s={range:e,type:n||&quot;line&quot;,renderer:typeof n==&quot;function&quot;?n:null,clazz:t,inFront:!!r,id:i};return r?(this.$frontMarkers[i]=s,this._signal(&quot;changeFrontMarker&quot;)):(this.$backMarkers[i]=s,this._signal(&quot;changeBackMarker&quot;)),i},this.addDynamicMarker=function(e,t){if(!e.update)return;var n=this.$markerId++;return e.id=n,e.inFront=!!t,t?(this.$frontMarkers[n]=e,this._signal(&quot;changeFrontMarker&quot;)):(this.$backMarkers[n]=e,this._signal(&quot;changeBackMarker&quot;)),e},this.removeMarker=function(e){var t=this.$frontMarkers[e]||this.$backMarkers[e];if(!t)return;var n=t.inFront?this.$frontMarkers:this.$backMarkers;delete n[e],this._signal(t.inFront?&quot;changeFrontMarker&quot;:&quot;changeBackMarker&quot;)},this.getMarkers=function(e){return e?this.$frontMarkers:this.$backMarkers},this.highlight=function(e){if(!this.$searchHighlight){var t=new p(null,&quot;ace_selected-word&quot;,&quot;text&quot;);this.$searchHighlight=this.addDynamicMarker(t)}this.$searchHighlight.setRegexp(e)},this.highlightLines=function(e,t,n,r){typeof t!=&quot;number&quot;&amp;&amp;(n=t,t=e),n||(n=&quot;ace_step&quot;);var i=new l(e,0,t,Infinity);return i.id=this.addMarker(i,n,&quot;fullLine&quot;,r),i},this.setAnnotations=function(e){this.$annotations=e,this._signal(&quot;changeAnnotation&quot;,{})},this.getAnnotations=function(){return this.$annotations||[]},this.clearAnnotations=function(){this.setAnnotations([])},this.$detectNewLine=function(e){var t=e.match(/^.*?(\sr?\sn)/m);t?this.$autoNewLine=t[1]:this.$autoNewLine=&quot;\sn&quot;},this.getWordRange=function(e,t){var n=this.getLine(e),r=!1;t&gt;0&amp;&amp;(r=!!n.charAt(t-1).match(this.tokenRe)),r||(r=!!n.charAt(t).match(this.tokenRe));if(r)var i=this.tokenRe;else if(/^\ss+$/.test(n.slice(t-1,t+1)))var i=/\ss/;else var i=this.nonTokenRe;var s=t;if(s&gt;0){do s--;while(s&gt;=0&amp;&amp;n.charAt(s).match(i));s++}var o=t;while(o&lt;n.length&amp;&amp;n.charAt(o).match(i))o++;return new l(e,s,e,o)},this.getAWordRange=function(e,t){var n=this.getWordRange(e,t),r=this.getLine(n.end.row);while(r.charAt(n.end.column).match(/[ \st]/))n.end.column+=1;return n},this.setNewLineMode=function(e){this.doc.setNewLineMode(e)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.setUseWorker=function(e){this.setOption(&quot;useWorker&quot;,e)},this.getUseWorker=function(){return this.$useWorker},this.onReloadTokenizer=function(e){var t=e.data;this.bgTokenizer.start(t.first),this._signal(&quot;tokenizerUpdate&quot;,e)},this.$modes=o.$modes,this.$mode=null,this.$modeId=null,this.setMode=function(e,t){if(e&amp;&amp;typeof e==&quot;object&quot;){if(e.getTokenizer)return this.$onChangeMode(e);var n=e,r=n.path}else r=e||&quot;ace/mode/text&quot;;this.$modes[&quot;ace/mode/text&quot;]||(this.$modes[&quot;ace/mode/text&quot;]=new f);if(this.$modes[r]&amp;&amp;!n){this.$onChangeMode(this.$modes[r]),t&amp;&amp;t();return}this.$modeId=r,o.loadModule([&quot;mode&quot;,r],function(e){if(this.$modeId!==r)return t&amp;&amp;t();this.$modes[r]&amp;&amp;!n?this.$onChangeMode(this.$modes[r]):e&amp;&amp;e.Mode&amp;&amp;(e=new e.Mode(n),n||(this.$modes[r]=e,e.$id=r),this.$onChangeMode(e)),t&amp;&amp;t()}.bind(this)),this.$mode||this.$onChangeMode(this.$modes[&quot;ace/mode/text&quot;],!0)},this.$onChangeMode=function(e,t){t||(this.$modeId=e.$id);if(this.$mode===e)return;this.$mode=e,this.$stopWorker(),this.$useWorker&amp;&amp;this.$startWorker();var n=e.getTokenizer();if(n.addEventListener!==undefined){var r=this.onReloadTokenizer.bind(this);n.addEventListener(&quot;update&quot;,r)}if(!this.bgTokenizer){this.bgTokenizer=new h(n);var i=this;this.bgTokenizer.addEventListener(&quot;update&quot;,function(e){i._signal(&quot;tokenizerUpdate&quot;,e)})}else this.bgTokenizer.setTokenizer(n);this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=e.tokenRe,this.nonTokenRe=e.nonTokenRe,t||(e.attachToSession&amp;&amp;e.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(e.foldingRules),this.bgTokenizer.start(0),this._emit(&quot;changeMode&quot;))},this.$stopWorker=function(){this.$worker&amp;&amp;(this.$worker.terminate(),this.$worker=null)},this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){o.warn(&quot;Could not load worker&quot;,e),this.$worker=null}},this.getMode=function(){return this.$mode},this.$scrollTop=0,this.setScrollTop=function(e){if(this.$scrollTop===e||isNaN(e))return;this.$scrollTop=e,this._signal(&quot;changeScrollTop&quot;,e)},this.getScrollTop=function(){return this.$scrollTop},this.$scrollLeft=0,this.setScrollLeft=function(e){if(this.$scrollLeft===e||isNaN(e))return;this.$scrollLeft=e,this._signal(&quot;changeScrollLeft&quot;,e)},this.getScrollLeft=function(){return this.$scrollLeft},this.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},this.getLineWidgetMaxWidth=function(){if(this.lineWidgetsWidth!=null)return this.lineWidgetsWidth;var e=0;return this.lineWidgets.forEach(function(t){t&amp;&amp;t.screenWidth&gt;e&amp;&amp;(e=t.screenWidth)}),this.lineWidgetWidth=e},this.$computeWidth=function(e){if(this.$modified||e){this.$modified=!1;if(this.$useWrapMode)return this.screenWidth=this.$wrapLimit;var t=this.doc.getAllLines(),n=this.$rowLengthCache,r=0,i=0,s=this.$foldData[i],o=s?s.start.row:Infinity,u=t.length;for(var a=0;a&lt;u;a++){if(a&gt;o){a=s.end.row+1;if(a&gt;=u)break;s=this.$foldData[i++],o=s?s.start.row:Infinity}n[a]==null&amp;&amp;(n[a]=this.$getStringScreenWidth(t[a])[0]),n[a]&gt;r&amp;&amp;(r=n[a])}this.screenWidth=r}},this.getLine=function(e){return this.doc.getLine(e)},this.getLines=function(e,t){return this.doc.getLines(e,t)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(e){return this.doc.getTextRange(e||this.selection.getRange())},this.insert=function(e,t){return this.doc.insert(e,t)},this.remove=function(e){return this.doc.remove(e)},this.removeFullLines=function(e,t){return this.doc.removeFullLines(e,t)},this.undoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;for(var n=e.length-1;n!=-1;n--){var r=e[n];r.action==&quot;insert&quot;||r.action==&quot;remove&quot;?this.doc.revertDelta(r):r.folds&amp;&amp;this.addFolds(r.folds)}!t&amp;&amp;this.$undoSelect&amp;&amp;(e.selectionBefore?this.selection.fromJSON(e.selectionBefore):this.selection.setRange(this.$getUndoSelection(e,!0))),this.$fromUndo=!1},this.redoChanges=function(e,t){if(!e.length)return;this.$fromUndo=!0;for(var n=0;n&lt;e.length;n++){var r=e[n];(r.action==&quot;insert&quot;||r.action==&quot;remove&quot;)&amp;&amp;this.doc.applyDelta(r)}!t&amp;&amp;this.$undoSelect&amp;&amp;(e.selectionAfter?this.selection.fromJSON(e.selectionAfter):this.selection.setRange(this.$getUndoSelection(e,!1))),this.$fromUndo=!1},this.setUndoSelect=function(e){this.$undoSelect=e},this.$getUndoSelection=function(e,t){function n(e){return t?e.action!==&quot;insert&quot;:e.action===&quot;insert&quot;}var r,i,s;for(var o=0;o&lt;e.length;o++){var u=e[o];if(!u.start)continue;if(!r){n(u)?(r=l.fromPoints(u.start,u.end),s=!0):(r=l.fromPoints(u.start,u.start),s=!1);continue}n(u)?(i=u.start,r.compare(i.row,i.column)==-1&amp;&amp;r.setStart(i),i=u.end,r.compare(i.row,i.column)==1&amp;&amp;r.setEnd(i),s=!0):(i=u.start,r.compare(i.row,i.column)==-1&amp;&amp;(r=l.fromPoints(u.start,u.start)),s=!1)}return r},this.replace=function(e,t){return this.doc.replace(e,t)},this.moveText=function(e,t,n){var r=this.getTextRange(e),i=this.getFoldsInRange(e),s=l.fromPoints(t,t);if(!n){this.remove(e);var o=e.start.row-e.end.row,u=o?-e.end.column:e.start.column-e.end.column;u&amp;&amp;(s.start.row==e.end.row&amp;&amp;s.start.column&gt;e.end.column&amp;&amp;(s.start.column+=u),s.end.row==e.end.row&amp;&amp;s.end.column&gt;e.end.column&amp;&amp;(s.end.column+=u)),o&amp;&amp;s.start.row&gt;=e.end.row&amp;&amp;(s.start.row+=o,s.end.row+=o)}s.end=this.insert(s.start,r);if(i.length){var a=e.start,f=s.start,o=f.row-a.row,u=f.column-a.column;this.addFolds(i.map(function(e){return e=e.clone(),e.start.row==a.row&amp;&amp;(e.start.column+=u),e.end.row==a.row&amp;&amp;(e.end.column+=u),e.start.row+=o,e.end.row+=o,e}))}return s},this.indentRows=function(e,t,n){n=n.replace(/\st/g,this.getTabString());for(var r=e;r&lt;=t;r++)this.doc.insertInLine({row:r,column:0},n)},this.outdentRows=function(e){var t=e.collapseRows(),n=new l(0,0,0,0),r=this.getTabSize();for(var i=t.start.row;i&lt;=t.end.row;++i){var s=this.getLine(i);n.start.row=i,n.end.row=i;for(var o=0;o&lt;r;++o)if(s.charAt(o)!=&quot; &quot;)break;o&lt;r&amp;&amp;s.charAt(o)==&quot;	&quot;?(n.start.column=o,n.end.column=o+1):(n.start.column=0,n.end.column=o),this.remove(n)}},this.$moveLines=function(e,t,n){e=this.getRowFoldStart(e),t=this.getRowFoldEnd(t);if(n&lt;0){var r=this.getRowFoldStart(e+n);if(r&lt;0)return 0;var i=r-e}else if(n&gt;0){var r=this.getRowFoldEnd(t+n);if(r&gt;this.doc.getLength()-1)return 0;var i=r-t}else{e=this.$clipRowToDocument(e),t=this.$clipRowToDocument(t);var i=t-e+1}var s=new l(e,0,t,Number.MAX_VALUE),o=this.getFoldsInRange(s).map(function(e){return e=e.clone(),e.start.row+=i,e.end.row+=i,e}),u=n==0?this.doc.getLines(e,t):this.doc.removeFullLines(e,t);return this.doc.insertFullLines(e+i,u),o.length&amp;&amp;this.addFolds(o),i},this.moveLinesUp=function(e,t){return this.$moveLines(e,t,-1)},this.moveLinesDown=function(e,t){return this.$moveLines(e,t,1)},this.duplicateLines=function(e,t){return this.$moveLines(e,t,0)},this.$clipRowToDocument=function(e){return Math.max(0,Math.min(e,this.doc.getLength()-1))},this.$clipColumnToRow=function(e,t){return t&lt;0?0:Math.min(this.doc.getLine(e).length,t)},this.$clipPositionToDocument=function(e,t){t=Math.max(0,t);if(e&lt;0)e=0,t=0;else{var n=this.doc.getLength();e&gt;=n?(e=n-1,t=this.doc.getLine(n-1).length):t=Math.min(this.doc.getLine(e).length,t)}return{row:e,column:t}},this.$clipRangeToDocument=function(e){e.start.row&lt;0?(e.start.row=0,e.start.column=0):e.start.column=this.$clipColumnToRow(e.start.row,e.start.column);var t=this.doc.getLength()-1;return e.end.row&gt;t?(e.end.row=t,e.end.column=this.doc.getLine(t).length):e.end.column=this.$clipColumnToRow(e.end.row,e.end.column),e},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(e){if(e!=this.$useWrapMode){this.$useWrapMode=e,this.$modified=!0,this.$resetRowCache(0);if(e){var t=this.getLength();this.$wrapData=Array(t),this.$updateWrapData(0,t-1)}this._signal(&quot;changeWrapMode&quot;)}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(e,t){if(this.$wrapLimitRange.min!==e||this.$wrapLimitRange.max!==t)this.$wrapLimitRange={min:e,max:t},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&amp;&amp;this._signal(&quot;changeWrapMode&quot;)},this.adjustWrapLimit=function(e,t){var n=this.$wrapLimitRange;n.max&lt;0&amp;&amp;(n={min:t,max:t});var r=this.$constrainWrapLimit(e,n.min,n.max);return r!=this.$wrapLimit&amp;&amp;r&gt;1?(this.$wrapLimit=r,this.$modified=!0,this.$useWrapMode&amp;&amp;(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal(&quot;changeWrapLimit&quot;)),!0):!1},this.$constrainWrapLimit=function(e,t,n){return t&amp;&amp;(e=Math.max(t,e)),n&amp;&amp;(e=Math.min(n,e)),e},this.getWrapLimit=function(){return this.$wrapLimit},this.setWrapLimit=function(e){this.setWrapLimitRange(e,e)},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateInternalDataOnChange=function(e){var t=this.$useWrapMode,n=e.action,r=e.start,i=e.end,s=r.row,o=i.row,u=o-s,a=null;this.$updating=!0;if(u!=0)if(n===&quot;remove&quot;){this[t?&quot;$wrapData&quot;:&quot;$rowLengthCache&quot;].splice(s,u);var f=this.$foldData;a=this.getFoldsInRange(e),this.removeFolds(a);var l=this.getFoldLine(i.row),c=0;if(l){l.addRemoveChars(i.row,i.column,r.column-i.column),l.shiftRow(-u);var h=this.getFoldLine(s);h&amp;&amp;h!==l&amp;&amp;(h.merge(l),l=h),c=f.indexOf(l)+1}for(c;c&lt;f.length;c++){var l=f[c];l.start.row&gt;=i.row&amp;&amp;l.shiftRow(-u)}o=s}else{var p=Array(u);p.unshift(s,0);var d=t?this.$wrapData:this.$rowLengthCache;d.splice.apply(d,p);var f=this.$foldData,l=this.getFoldLine(s),c=0;if(l){var v=l.range.compareInside(r.row,r.column);v==0?(l=l.split(r.row,r.column),l&amp;&amp;(l.shiftRow(u),l.addRemoveChars(o,0,i.column-r.column))):v==-1&amp;&amp;(l.addRemoveChars(s,0,i.column-r.column),l.shiftRow(u)),c=f.indexOf(l)+1}for(c;c&lt;f.length;c++){var l=f[c];l.start.row&gt;=s&amp;&amp;l.shiftRow(u)}}else{u=Math.abs(e.start.column-e.end.column),n===&quot;remove&quot;&amp;&amp;(a=this.getFoldsInRange(e),this.removeFolds(a),u=-u);var l=this.getFoldLine(s);l&amp;&amp;l.addRemoveChars(s,r.column,u)}return t&amp;&amp;this.$wrapData.length!=this.doc.getLength()&amp;&amp;console.error(&quot;doc.getLength() and $wrapData.length have to be the same!&quot;),this.$updating=!1,t?this.$updateWrapData(s,o):this.$updateRowLengthCache(s,o),a},this.$updateRowLengthCache=function(e,t,n){this.$rowLengthCache[e]=null,this.$rowLengthCache[t]=null},this.$updateWrapData=function(e,t){var r=this.doc.getAllLines(),i=this.getTabSize(),o=this.$wrapData,u=this.$wrapLimit,a,f,l=e;t=Math.min(t,r.length-1);while(l&lt;=t)f=this.getFoldLine(l,f),f?(a=[],f.walk(function(e,t,i,o){var u;if(e!=null){u=this.$getDisplayTokens(e,a.length),u[0]=n;for(var f=1;f&lt;u.length;f++)u[f]=s}else u=this.$getDisplayTokens(r[t].substring(o,i),a.length);a=a.concat(u)}.bind(this),f.end.row,r[f.end.row].length+1),o[f.start.row]=this.$computeWrapSplits(a,u,i),l=f.end.row+1):(a=this.$getDisplayTokens(r[l]),o[l]=this.$computeWrapSplits(a,u,i),l++)};var e=1,t=2,n=3,s=4,a=9,c=10,d=11,v=12;this.$computeWrapSplits=function(e,r,i){function g(){var t=0;if(m===0)return t;if(p)for(var n=0;n&lt;e.length;n++){var r=e[n];if(r==c)t+=1;else{if(r!=d){if(r==v)continue;break}t+=i}}return h&amp;&amp;p!==!1&amp;&amp;(t+=i),Math.min(t,m)}function y(t){var n=t-f;for(var r=f;r&lt;t;r++){var i=e[r];if(i===12||i===2)n-=1}o.length||(b=g(),o.indent=b),l+=n,o.push(l),f=t}if(e.length==0)return[];var o=[],u=e.length,f=0,l=0,h=this.$wrapAsCode,p=this.$indentedSoftWrap,m=r&lt;=Math.max(2*i,8)||p===!1?0:Math.floor(r/2),b=0;while(u-f&gt;r-b){var w=f+r-b;if(e[w-1]&gt;=c&amp;&amp;e[w]&gt;=c){y(w);continue}if(e[w]==n||e[w]==s){for(w;w!=f-1;w--)if(e[w]==n)break;if(w&gt;f){y(w);continue}w=f+r;for(w;w&lt;e.length;w++)if(e[w]!=s)break;if(w==e.length)break;y(w);continue}var E=Math.max(w-(r-(r&gt;&gt;2)),f-1);while(w&gt;E&amp;&amp;e[w]&lt;n)w--;if(h){while(w&gt;E&amp;&amp;e[w]&lt;n)w--;while(w&gt;E&amp;&amp;e[w]==a)w--}else while(w&gt;E&amp;&amp;e[w]&lt;c)w--;if(w&gt;E){y(++w);continue}w=f+r,e[w]==t&amp;&amp;w--,y(w-b)}return o},this.$getDisplayTokens=function(n,r){var i=[],s;r=r||0;for(var o=0;o&lt;n.length;o++){var u=n.charCodeAt(o);if(u==9){s=this.getScreenTabSize(i.length+r),i.push(d);for(var f=1;f&lt;s;f++)i.push(v)}else u==32?i.push(c):u&gt;39&amp;&amp;u&lt;48||u&gt;57&amp;&amp;u&lt;64?i.push(a):u&gt;=4352&amp;&amp;m(u)?i.push(e,t):i.push(e)}return i},this.$getStringScreenWidth=function(e,t,n){if(t==0)return[0,0];t==null&amp;&amp;(t=Infinity),n=n||0;var r,i;for(i=0;i&lt;e.length;i++){r=e.charCodeAt(i),r==9?n+=this.getScreenTabSize(n):r&gt;=4352&amp;&amp;m(r)?n+=2:n+=1;if(n&gt;t)break}return[n,i]},this.lineWidgets=null,this.getRowLength=function(e){var t=1;return this.lineWidgets&amp;&amp;(t+=this.lineWidgets[e]&amp;&amp;this.lineWidgets[e].rowCount||0),!this.$useWrapMode||!this.$wrapData[e]?t:this.$wrapData[e].length+t},this.getRowLineCount=function(e){return!this.$useWrapMode||!this.$wrapData[e]?1:this.$wrapData[e].length+1},this.getRowWrapIndent=function(e){if(this.$useWrapMode){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE),n=this.$wrapData[t.row];return n.length&amp;&amp;n[0]&lt;t.column?n.indent:0}return 0},this.getScreenLastRowColumn=function(e){var t=this.screenToDocumentPosition(e,Number.MAX_VALUE);return this.documentToScreenColumn(t.row,t.column)},this.getDocumentLastRowColumn=function(e,t){var n=this.documentToScreenRow(e,t);return this.getScreenLastRowColumn(n)},this.getDocumentLastRowColumnPosition=function(e,t){var n=this.documentToScreenRow(e,t);return this.screenToDocumentPosition(n,Number.MAX_VALUE/10)},this.getRowSplitData=function(e){return this.$useWrapMode?this.$wrapData[e]:undefined},this.getScreenTabSize=function(e){return this.$tabSize-(e%this.$tabSize|0)},this.screenToDocumentRow=function(e,t){return this.screenToDocumentPosition(e,t).row},this.screenToDocumentColumn=function(e,t){return this.screenToDocumentPosition(e,t).column},this.screenToDocumentPosition=function(e,t,n){if(e&lt;0)return{row:0,column:0};var r,i=0,s=0,o,u=0,a=0,f=this.$screenRowCache,l=this.$getRowCacheIndex(f,e),c=f.length;if(c&amp;&amp;l&gt;=0)var u=f[l],i=this.$docRowCache[l],h=e&gt;f[c-1];else var h=!c;var p=this.getLength()-1,d=this.getNextFoldLine(i),v=d?d.start.row:Infinity;while(u&lt;=e){a=this.getRowLength(i);if(u+a&gt;e||i&gt;=p)break;u+=a,i++,i&gt;v&amp;&amp;(i=d.end.row+1,d=this.getNextFoldLine(i,d),v=d?d.start.row:Infinity),h&amp;&amp;(this.$docRowCache.push(i),this.$screenRowCache.push(u))}if(d&amp;&amp;d.start.row&lt;=i)r=this.getFoldDisplayLine(d),i=d.start.row;else{if(u+a&lt;=e||i&gt;p)return{row:p,column:this.getLine(p).length};r=this.getLine(i),d=null}var m=0,g=Math.floor(e-u);if(this.$useWrapMode){var y=this.$wrapData[i];y&amp;&amp;(o=y[g],g&gt;0&amp;&amp;y.length&amp;&amp;(m=y.indent,s=y[g-1]||y[y.length-1],r=r.substring(s)))}return n!==undefined&amp;&amp;this.$bidiHandler.isBidiRow(u+g,i,g)&amp;&amp;(t=this.$bidiHandler.offsetToCol(n)),s+=this.$getStringScreenWidth(r,t-m)[1],this.$useWrapMode&amp;&amp;s&gt;=o&amp;&amp;(s=o-1),d?d.idxToPosition(s):{row:i,column:s}},this.documentToScreenPosition=function(e,t){if(typeof t==&quot;undefined&quot;)var n=this.$clipPositionToDocument(e.row,e.column);else n=this.$clipPositionToDocument(e,t);e=n.row,t=n.column;var r=0,i=null,s=null;s=this.getFoldAt(e,t,1),s&amp;&amp;(e=s.start.row,t=s.start.column);var o,u=0,a=this.$docRowCache,f=this.$getRowCacheIndex(a,e),l=a.length;if(l&amp;&amp;f&gt;=0)var u=a[f],r=this.$screenRowCache[f],c=e&gt;a[l-1];else var c=!l;var h=this.getNextFoldLine(u),p=h?h.start.row:Infinity;while(u&lt;e){if(u&gt;=p){o=h.end.row+1;if(o&gt;e)break;h=this.getNextFoldLine(o,h),p=h?h.start.row:Infinity}else o=u+1;r+=this.getRowLength(u),u=o,c&amp;&amp;(this.$docRowCache.push(u),this.$screenRowCache.push(r))}var d=&quot;&quot;;h&amp;&amp;u&gt;=p?(d=this.getFoldDisplayLine(h,e,t),i=h.start.row):(d=this.getLine(e).substring(0,t),i=e);var v=0;if(this.$useWrapMode){var m=this.$wrapData[i];if(m){var g=0;while(d.length&gt;=m[g])r++,g++;d=d.substring(m[g-1]||0,d.length),v=g&gt;0?m.indent:0}}return this.lineWidgets&amp;&amp;this.lineWidgets[u]&amp;&amp;this.lineWidgets[u].rowsAbove&amp;&amp;(r+=this.lineWidgets[u].rowsAbove),{row:r,column:v+this.$getStringScreenWidth(d)[0]}},this.documentToScreenColumn=function(e,t){return this.documentToScreenPosition(e,t).column},this.documentToScreenRow=function(e,t){return this.documentToScreenPosition(e,t).row},this.getScreenLength=function(){var e=0,t=null;if(!this.$useWrapMode){e=this.getLength();var n=this.$foldData;for(var r=0;r&lt;n.length;r++)t=n[r],e-=t.end.row-t.start.row}else{var i=this.$wrapData.length,s=0,r=0,t=this.$foldData[r++],o=t?t.start.row:Infinity;while(s&lt;i){var u=this.$wrapData[s];e+=u?u.length+1:1,s++,s&gt;o&amp;&amp;(s=t.end.row+1,t=this.$foldData[r++],o=t?t.start.row:Infinity)}}return this.lineWidgets&amp;&amp;(e+=this.$getWidgetScreenLength()),e},this.$setFontMetrics=function(e){if(!this.$enableVarChar)return;this.$getStringScreenWidth=function(t,n,r){if(n===0)return[0,0];n||(n=Infinity),r=r||0;var i,s;for(s=0;s&lt;t.length;s++){i=t.charAt(s),i===&quot;	&quot;?r+=this.getScreenTabSize(r):r+=e.getCharacterWidth(i);if(r&gt;n)break}return[r,s]}},this.destroy=function(){this.bgTokenizer&amp;&amp;(this.bgTokenizer.setDocument(null),this.bgTokenizer=null),this.$stopWorker()},this.isFullWidth=m}.call(d.prototype),e(&quot;./edit_session/folding&quot;).Folding.call(d.prototype),e(&quot;./edit_session/bracket_match&quot;).BracketMatch.call(d.prototype),o.defineOptions(d.prototype,&quot;session&quot;,{wrap:{set:function(e){!e||e==&quot;off&quot;?e=!1:e==&quot;free&quot;?e=!0:e==&quot;printMargin&quot;?e=-1:typeof e==&quot;string&quot;&amp;&amp;(e=parseInt(e,10)||!1);if(this.$wrap==e)return;this.$wrap=e;if(!e)this.setUseWrapMode(!1);else{var t=typeof e==&quot;number&quot;?e:null;this.setWrapLimitRange(t,t),this.setUseWrapMode(!0)}},get:function(){return this.getUseWrapMode()?this.$wrap==-1?&quot;printMargin&quot;:this.getWrapLimitRange().min?this.$wrap:&quot;free&quot;:&quot;off&quot;},handlesSet:!0},wrapMethod:{set:function(e){e=e==&quot;auto&quot;?this.$mode.type!=&quot;text&quot;:e!=&quot;text&quot;,e!=this.$wrapAsCode&amp;&amp;(this.$wrapAsCode=e,this.$useWrapMode&amp;&amp;(this.$useWrapMode=!1,this.setUseWrapMode(!0)))},initialValue:&quot;auto&quot;},indentedSoftWrap:{set:function(){this.$useWrapMode&amp;&amp;(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal(&quot;changeBreakpoint&quot;)},initialValue:1},useWorker:{set:function(e){this.$useWorker=e,this.$stopWorker(),e&amp;&amp;this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(e){e=parseInt(e),e&gt;0&amp;&amp;this.$tabSize!==e&amp;&amp;(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=e,this._signal(&quot;changeTabSize&quot;))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(e){this.setFoldStyle(e)},handlesSet:!0},overwrite:{set:function(e){this._signal(&quot;changeOverwrite&quot;)},initialValue:!1},newLineMode:{set:function(e){this.doc.setNewLineMode(e)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(e){this.setMode(e)},get:function(){return this.$modeId},handlesSet:!0}}),t.EditSession=d}),ace.define(&quot;ace/search&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/oop&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function u(e,t){function n(e){return/\sw/.test(e)||t.regExp?&quot;\s\sb&quot;:&quot;&quot;}return n(e[0])+e+n(e[e.length-1])}var r=e(&quot;./lib/lang&quot;),i=e(&quot;./lib/oop&quot;),s=e(&quot;./range&quot;).Range,o=function(){this.$options={}};(function(){this.set=function(e){return i.mixin(this.$options,e),this},this.getOptions=function(){return r.copyObject(this.$options)},this.setOptions=function(e){this.$options=e},this.find=function(e){var t=this.$options,n=this.$matchIterator(e,t);if(!n)return!1;var r=null;return n.forEach(function(e,n,i,o){return r=new s(e,n,i,o),n==o&amp;&amp;t.start&amp;&amp;t.start.start&amp;&amp;t.skipCurrent!=0&amp;&amp;r.isEqual(t.start)?(r=null,!1):!0}),r},this.findAll=function(e){var t=this.$options;if(!t.needle)return[];this.$assembleRegExp(t);var n=t.range,i=n?e.getLines(n.start.row,n.end.row):e.doc.getAllLines(),o=[],u=t.re;if(t.$isMultiLine){var a=u.length,f=i.length-a,l;e:for(var c=u.offset||0;c&lt;=f;c++){for(var h=0;h&lt;a;h++)if(i[c+h].search(u[h])==-1)continue e;var p=i[c],d=i[c+a-1],v=p.length-p.match(u[0])[0].length,m=d.match(u[a-1])[0].length;if(l&amp;&amp;l.end.row===c&amp;&amp;l.end.column&gt;v)continue;o.push(l=new s(c,v,c+a-1,m)),a&gt;2&amp;&amp;(c=c+a-2)}}else for(var g=0;g&lt;i.length;g++){var y=r.getMatchOffsets(i[g],u);for(var h=0;h&lt;y.length;h++){var b=y[h];o.push(new s(g,b.offset,g,b.offset+b.length))}}if(n){var w=n.start.column,E=n.start.column,g=0,h=o.length-1;while(g&lt;h&amp;&amp;o[g].start.column&lt;w&amp;&amp;o[g].start.row==n.start.row)g++;while(g&lt;h&amp;&amp;o[h].end.column&gt;E&amp;&amp;o[h].end.row==n.end.row)h--;o=o.slice(g,h+1);for(g=0,h=o.length;g&lt;h;g++)o[g].start.row+=n.start.row,o[g].end.row+=n.start.row}return o},this.replace=function(e,t){var n=this.$options,r=this.$assembleRegExp(n);if(n.$isMultiLine)return t;if(!r)return;var i=r.exec(e);if(!i||i[0].length!=e.length)return null;t=e.replace(r,t);if(n.preserveCase){t=t.split(&quot;&quot;);for(var s=Math.min(e.length,e.length);s--;){var o=e[s];o&amp;&amp;o.toLowerCase()!=o?t[s]=t[s].toUpperCase():t[s]=t[s].toLowerCase()}t=t.join(&quot;&quot;)}return t},this.$assembleRegExp=function(e,t){if(e.needle instanceof RegExp)return e.re=e.needle;var n=e.needle;if(!e.needle)return e.re=!1;e.regExp||(n=r.escapeRegExp(n)),e.wholeWord&amp;&amp;(n=u(n,e));var i=e.caseSensitive?&quot;gm&quot;:&quot;gmi&quot;;e.$isMultiLine=!t&amp;&amp;/[\sn\sr]/.test(n);if(e.$isMultiLine)return e.re=this.$assembleMultilineRegExp(n,i);try{var s=new RegExp(n,i)}catch(o){s=!1}return e.re=s},this.$assembleMultilineRegExp=function(e,t){var n=e.replace(/\sr\sn|\sr|\sn/g,&quot;$\sn^&quot;).split(&quot;\sn&quot;),r=[];for(var i=0;i&lt;n.length;i++)try{r.push(new RegExp(n[i],t))}catch(s){return!1}return r},this.$matchIterator=function(e,t){var n=this.$assembleRegExp(t);if(!n)return!1;var r=t.backwards==1,i=t.skipCurrent!=0,s=t.range,o=t.start;o||(o=s?s[r?&quot;end&quot;:&quot;start&quot;]:e.selection.getRange()),o.start&amp;&amp;(o=o[i!=r?&quot;end&quot;:&quot;start&quot;]);var u=s?s.start.row:0,a=s?s.end.row:e.getLength()-1;if(r)var f=function(e){var n=o.row;if(c(n,o.column,e))return;for(n--;n&gt;=u;n--)if(c(n,Number.MAX_VALUE,e))return;if(t.wrap==0)return;for(n=a,u=o.row;n&gt;=u;n--)if(c(n,Number.MAX_VALUE,e))return};else var f=function(e){var n=o.row;if(c(n,o.column,e))return;for(n+=1;n&lt;=a;n++)if(c(n,0,e))return;if(t.wrap==0)return;for(n=u,a=o.row;n&lt;=a;n++)if(c(n,0,e))return};if(t.$isMultiLine)var l=n.length,c=function(t,i,s){var o=r?t-l+1:t;if(o&lt;0)return;var u=e.getLine(o),a=u.search(n[0]);if(!r&amp;&amp;a&lt;i||a===-1)return;for(var f=1;f&lt;l;f++){u=e.getLine(o+f);if(u.search(n[f])==-1)return}var c=u.match(n[l-1])[0].length;if(r&amp;&amp;c&gt;i)return;if(s(o,a,o+l-1,c))return!0};else if(r)var c=function(t,r,i){var s=e.getLine(t),o=[],u,a=0;n.lastIndex=0;while(u=n.exec(s)){var f=u[0].length;a=u.index;if(!f){if(a&gt;=s.length)break;n.lastIndex=a+=1}if(u.index+f&gt;r)break;o.push(u.index,f)}for(var l=o.length-1;l&gt;=0;l-=2){var c=o[l-1],f=o[l];if(i(t,c,t,c+f))return!0}};else var c=function(t,r,i){var s=e.getLine(t),o,u;n.lastIndex=r;while(u=n.exec(s)){var a=u[0].length;o=u.index;if(i(t,o,t,o+a))return!0;if(!a){n.lastIndex=o+=1;if(o&gt;=s.length)return!1}}};return{forEach:f}}}).call(o.prototype),t.Search=o}),ace.define(&quot;ace/keyboard/hash_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/keys&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;function o(e,t){this.platform=t||(i.isMac?&quot;mac&quot;:&quot;win&quot;),this.commands={},this.commandKeyBinding={},this.addCommands(e),this.$singleCommand=!0}function u(e,t){o.call(this,e,t),this.$singleCommand=!1}var r=e(&quot;../lib/keys&quot;),i=e(&quot;../lib/useragent&quot;),s=r.KEY_MODS;u.prototype=o.prototype,function(){function e(e){return typeof e==&quot;object&quot;&amp;&amp;e.bindKey&amp;&amp;e.bindKey.position||(e.isDefault?-100:0)}this.addCommand=function(e){this.commands[e.name]&amp;&amp;this.removeCommand(e),this.commands[e.name]=e,e.bindKey&amp;&amp;this._buildKeyHash(e)},this.removeCommand=function(e,t){var n=e&amp;&amp;(typeof e==&quot;string&quot;?e:e.name);e=this.commands[n],t||delete this.commands[n];var r=this.commandKeyBinding;for(var i in r){var s=r[i];if(s==e)delete r[i];else if(Array.isArray(s)){var o=s.indexOf(e);o!=-1&amp;&amp;(s.splice(o,1),s.length==1&amp;&amp;(r[i]=s[0]))}}},this.bindKey=function(e,t,n){typeof e==&quot;object&quot;&amp;&amp;e&amp;&amp;(n==undefined&amp;&amp;(n=e.position),e=e[this.platform]);if(!e)return;if(typeof t==&quot;function&quot;)return this.addCommand({exec:t,bindKey:e,name:t.name||e});e.split(&quot;|&quot;).forEach(function(e){var r=&quot;&quot;;if(e.indexOf(&quot; &quot;)!=-1){var i=e.split(/\ss+/);e=i.pop(),i.forEach(function(e){var t=this.parseKeys(e),n=s[t.hashId]+t.key;r+=(r?&quot; &quot;:&quot;&quot;)+n,this._addCommandToBinding(r,&quot;chainKeys&quot;)},this),r+=&quot; &quot;}var o=this.parseKeys(e),u=s[o.hashId]+o.key;this._addCommandToBinding(r+u,t,n)},this)},this._addCommandToBinding=function(t,n,r){var i=this.commandKeyBinding,s;if(!n)delete i[t];else if(!i[t]||this.$singleCommand)i[t]=n;else{Array.isArray(i[t])?(s=i[t].indexOf(n))!=-1&amp;&amp;i[t].splice(s,1):i[t]=[i[t]],typeof r!=&quot;number&quot;&amp;&amp;(r=e(n));var o=i[t];for(s=0;s&lt;o.length;s++){var u=o[s],a=e(u);if(a&gt;r)break}o.splice(s,0,n)}},this.addCommands=function(e){e&amp;&amp;Object.keys(e).forEach(function(t){var n=e[t];if(!n)return;if(typeof n==&quot;string&quot;)return this.bindKey(n,t);typeof n==&quot;function&quot;&amp;&amp;(n={exec:n});if(typeof n!=&quot;object&quot;)return;n.name||(n.name=t),this.addCommand(n)},this)},this.removeCommands=function(e){Object.keys(e).forEach(function(t){this.removeCommand(e[t])},this)},this.bindKeys=function(e){Object.keys(e).forEach(function(t){this.bindKey(t,e[t])},this)},this._buildKeyHash=function(e){this.bindKey(e.bindKey,e)},this.parseKeys=function(e){var t=e.toLowerCase().split(/[\s-\s+]([\s-\s+])?/).filter(function(e){return e}),n=t.pop(),i=r[n];if(r.FUNCTION_KEYS[i])n=r.FUNCTION_KEYS[i].toLowerCase();else{if(!t.length)return{key:n,hashId:-1};if(t.length==1&amp;&amp;t[0]==&quot;shift&quot;)return{key:n.toUpperCase(),hashId:-1}}var s=0;for(var o=t.length;o--;){var u=r.KEY_MODS[t[o]];if(u==null)return typeof console!=&quot;undefined&quot;&amp;&amp;console.error(&quot;invalid modifier &quot;+t[o]+&quot; in &quot;+e),!1;s|=u}return{key:n,hashId:s}},this.findKeyCommand=function(t,n){var r=s[t]+n;return this.commandKeyBinding[r]},this.handleKeyboard=function(e,t,n,r){if(r&lt;0)return;var i=s[t]+n,o=this.commandKeyBinding[i];e.$keyChain&amp;&amp;(e.$keyChain+=&quot; &quot;+i,o=this.commandKeyBinding[e.$keyChain]||o);if(o)if(o==&quot;chainKeys&quot;||o[o.length-1]==&quot;chainKeys&quot;)return e.$keyChain=e.$keyChain||i,{command:&quot;null&quot;};if(e.$keyChain)if(!!t&amp;&amp;t!=4||n.length!=1){if(t==-1||r&gt;0)e.$keyChain=&quot;&quot;}else e.$keyChain=e.$keyChain.slice(0,-i.length-1);return{command:o}},this.getStatusText=function(e,t){return t.$keyChain||&quot;&quot;}}.call(o.prototype),t.HashHandler=o,t.MultiHashHandler=u}),ace.define(&quot;ace/commands/command_manager&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/oop&quot;),i=e(&quot;../keyboard/hash_handler&quot;).MultiHashHandler,s=e(&quot;../lib/event_emitter&quot;).EventEmitter,o=function(e,t){i.call(this,t,e),this.byName=this.commands,this.setDefaultHandler(&quot;exec&quot;,function(e){return e.command.exec(e.editor,e.args||{})})};r.inherits(o,i),function(){r.implement(this,s),this.exec=function(e,t,n){if(Array.isArray(e)){for(var r=e.length;r--;)if(this.exec(e[r],t,n))return!0;return!1}typeof e==&quot;string&quot;&amp;&amp;(e=this.commands[e]);if(!e)return!1;if(t&amp;&amp;t.$readOnly&amp;&amp;!e.readOnly)return!1;if(this.$checkCommandState!=0&amp;&amp;e.isAvailable&amp;&amp;!e.isAvailable(t))return!1;var i={editor:t,command:e,args:n};return i.returnValue=this._emit(&quot;exec&quot;,i),this._signal(&quot;afterExec&quot;,i),i.returnValue===!1?!1:!0},this.toggleRecording=function(e){if(this.$inReplay)return;return e&amp;&amp;e._emit(&quot;changeStatus&quot;),this.recording?(this.macro.pop(),this.removeEventListener(&quot;exec&quot;,this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)),this.oldMacro=this.macro,this.macro=[],this.on(&quot;exec&quot;,this.$addCommandToMacro),this.recording=!0)},this.replay=function(e){if(this.$inReplay||!this.macro)return;if(this.recording)return this.toggleRecording(e);try{this.$inReplay=!0,this.macro.forEach(function(t){typeof t==&quot;string&quot;?this.exec(t,e):this.exec(t[0],e,t[1])},this)}finally{this.$inReplay=!1}},this.trimMacro=function(e){return e.map(function(e){return typeof e[0]!=&quot;string&quot;&amp;&amp;(e[0]=e[0].name),e[1]||(e=e[0]),e})}}.call(o.prototype),t.CommandManager=o}),ace.define(&quot;ace/commands/default_commands&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/lang&quot;,&quot;ace/config&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function o(e,t){return{win:e,mac:t}}var r=e(&quot;../lib/lang&quot;),i=e(&quot;../config&quot;),s=e(&quot;../range&quot;).Range;t.commands=[{name:&quot;showSettingsMenu&quot;,bindKey:o(&quot;Ctrl-,&quot;,&quot;Command-,&quot;),exec:function(e){i.loadModule(&quot;ace/ext/settings_menu&quot;,function(t){t.init(e),e.showSettingsMenu()})},readOnly:!0},{name:&quot;goToNextError&quot;,bindKey:o(&quot;Alt-E&quot;,&quot;F4&quot;),exec:function(e){i.loadModule(&quot;./ext/error_marker&quot;,function(t){t.showErrorMarker(e,1)})},scrollIntoView:&quot;animate&quot;,readOnly:!0},{name:&quot;goToPreviousError&quot;,bindKey:o(&quot;Alt-Shift-E&quot;,&quot;Shift-F4&quot;),exec:function(e){i.loadModule(&quot;./ext/error_marker&quot;,function(t){t.showErrorMarker(e,-1)})},scrollIntoView:&quot;animate&quot;,readOnly:!0},{name:&quot;selectall&quot;,description:&quot;Select all&quot;,bindKey:o(&quot;Ctrl-A&quot;,&quot;Command-A&quot;),exec:function(e){e.selectAll()},readOnly:!0},{name:&quot;centerselection&quot;,description:&quot;Center selection&quot;,bindKey:o(null,&quot;Ctrl-L&quot;),exec:function(e){e.centerSelection()},readOnly:!0},{name:&quot;gotoline&quot;,description:&quot;Go to line...&quot;,bindKey:o(&quot;Ctrl-L&quot;,&quot;Command-L&quot;),exec:function(e,t){typeof t==&quot;number&quot;&amp;&amp;!isNaN(t)&amp;&amp;e.gotoLine(t),e.prompt({$type:&quot;gotoLine&quot;})},readOnly:!0},{name:&quot;fold&quot;,bindKey:o(&quot;Alt-L|Ctrl-F1&quot;,&quot;Command-Alt-L|Command-F1&quot;),exec:function(e){e.session.toggleFold(!1)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;unfold&quot;,bindKey:o(&quot;Alt-Shift-L|Ctrl-Shift-F1&quot;,&quot;Command-Alt-Shift-L|Command-Shift-F1&quot;),exec:function(e){e.session.toggleFold(!0)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;toggleFoldWidget&quot;,bindKey:o(&quot;F2&quot;,&quot;F2&quot;),exec:function(e){e.session.toggleFoldWidget()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;toggleParentFoldWidget&quot;,bindKey:o(&quot;Alt-F2&quot;,&quot;Alt-F2&quot;),exec:function(e){e.session.toggleFoldWidget(!0)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;foldall&quot;,description:&quot;Fold all&quot;,bindKey:o(null,&quot;Ctrl-Command-Option-0&quot;),exec:function(e){e.session.foldAll()},scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;foldOther&quot;,description:&quot;Fold other&quot;,bindKey:o(&quot;Alt-0&quot;,&quot;Command-Option-0&quot;),exec:function(e){e.session.foldAll(),e.session.unfold(e.selection.getAllRanges())},scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;unfoldall&quot;,description:&quot;Unfold all&quot;,bindKey:o(&quot;Alt-Shift-0&quot;,&quot;Command-Option-Shift-0&quot;),exec:function(e){e.session.unfold()},scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;findnext&quot;,description:&quot;Find next&quot;,bindKey:o(&quot;Ctrl-K&quot;,&quot;Command-G&quot;),exec:function(e){e.findNext()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;findprevious&quot;,description:&quot;Find previous&quot;,bindKey:o(&quot;Ctrl-Shift-K&quot;,&quot;Command-Shift-G&quot;),exec:function(e){e.findPrevious()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;center&quot;,readOnly:!0},{name:&quot;selectOrFindNext&quot;,description:&quot;Select or find next&quot;,bindKey:o(&quot;Alt-K&quot;,&quot;Ctrl-G&quot;),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findNext()},readOnly:!0},{name:&quot;selectOrFindPrevious&quot;,description:&quot;Select or find previous&quot;,bindKey:o(&quot;Alt-Shift-K&quot;,&quot;Ctrl-Shift-G&quot;),exec:function(e){e.selection.isEmpty()?e.selection.selectWord():e.findPrevious()},readOnly:!0},{name:&quot;find&quot;,description:&quot;Find&quot;,bindKey:o(&quot;Ctrl-F&quot;,&quot;Command-F&quot;),exec:function(e){i.loadModule(&quot;ace/ext/searchbox&quot;,function(t){t.Search(e)})},readOnly:!0},{name:&quot;overwrite&quot;,description:&quot;Overwrite&quot;,bindKey:&quot;Insert&quot;,exec:function(e){e.toggleOverwrite()},readOnly:!0},{name:&quot;selecttostart&quot;,description:&quot;Select to start&quot;,bindKey:o(&quot;Ctrl-Shift-Home&quot;,&quot;Command-Shift-Home|Command-Shift-Up&quot;),exec:function(e){e.getSelection().selectFileStart()},multiSelectAction:&quot;forEach&quot;,readOnly:!0,scrollIntoView:&quot;animate&quot;,aceCommandGroup:&quot;fileJump&quot;},{name:&quot;gotostart&quot;,description:&quot;Go to start&quot;,bindKey:o(&quot;Ctrl-Home&quot;,&quot;Command-Home|Command-Up&quot;),exec:function(e){e.navigateFileStart()},multiSelectAction:&quot;forEach&quot;,readOnly:!0,scrollIntoView:&quot;animate&quot;,aceCommandGroup:&quot;fileJump&quot;},{name:&quot;selectup&quot;,description:&quot;Select up&quot;,bindKey:o(&quot;Shift-Up&quot;,&quot;Shift-Up|Ctrl-Shift-P&quot;),exec:function(e){e.getSelection().selectUp()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;golineup&quot;,description:&quot;Go line up&quot;,bindKey:o(&quot;Up&quot;,&quot;Up|Ctrl-P&quot;),exec:function(e,t){e.navigateUp(t.times)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selecttoend&quot;,description:&quot;Select to end&quot;,bindKey:o(&quot;Ctrl-Shift-End&quot;,&quot;Command-Shift-End|Command-Shift-Down&quot;),exec:function(e){e.getSelection().selectFileEnd()},multiSelectAction:&quot;forEach&quot;,readOnly:!0,scrollIntoView:&quot;animate&quot;,aceCommandGroup:&quot;fileJump&quot;},{name:&quot;gotoend&quot;,description:&quot;Go to end&quot;,bindKey:o(&quot;Ctrl-End&quot;,&quot;Command-End|Command-Down&quot;),exec:function(e){e.navigateFileEnd()},multiSelectAction:&quot;forEach&quot;,readOnly:!0,scrollIntoView:&quot;animate&quot;,aceCommandGroup:&quot;fileJump&quot;},{name:&quot;selectdown&quot;,description:&quot;Select down&quot;,bindKey:o(&quot;Shift-Down&quot;,&quot;Shift-Down|Ctrl-Shift-N&quot;),exec:function(e){e.getSelection().selectDown()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;golinedown&quot;,description:&quot;Go line down&quot;,bindKey:o(&quot;Down&quot;,&quot;Down|Ctrl-N&quot;),exec:function(e,t){e.navigateDown(t.times)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectwordleft&quot;,description:&quot;Select word left&quot;,bindKey:o(&quot;Ctrl-Shift-Left&quot;,&quot;Option-Shift-Left&quot;),exec:function(e){e.getSelection().selectWordLeft()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotowordleft&quot;,description:&quot;Go to word left&quot;,bindKey:o(&quot;Ctrl-Left&quot;,&quot;Option-Left&quot;),exec:function(e){e.navigateWordLeft()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selecttolinestart&quot;,description:&quot;Select to line start&quot;,bindKey:o(&quot;Alt-Shift-Left&quot;,&quot;Command-Shift-Left|Ctrl-Shift-A&quot;),exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotolinestart&quot;,description:&quot;Go to line start&quot;,bindKey:o(&quot;Alt-Left|Home&quot;,&quot;Command-Left|Home|Ctrl-A&quot;),exec:function(e){e.navigateLineStart()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectleft&quot;,description:&quot;Select left&quot;,bindKey:o(&quot;Shift-Left&quot;,&quot;Shift-Left|Ctrl-Shift-B&quot;),exec:function(e){e.getSelection().selectLeft()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotoleft&quot;,description:&quot;Go to left&quot;,bindKey:o(&quot;Left&quot;,&quot;Left|Ctrl-B&quot;),exec:function(e,t){e.navigateLeft(t.times)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectwordright&quot;,description:&quot;Select word right&quot;,bindKey:o(&quot;Ctrl-Shift-Right&quot;,&quot;Option-Shift-Right&quot;),exec:function(e){e.getSelection().selectWordRight()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotowordright&quot;,description:&quot;Go to word right&quot;,bindKey:o(&quot;Ctrl-Right&quot;,&quot;Option-Right&quot;),exec:function(e){e.navigateWordRight()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selecttolineend&quot;,description:&quot;Select to line end&quot;,bindKey:o(&quot;Alt-Shift-Right&quot;,&quot;Command-Shift-Right|Shift-End|Ctrl-Shift-E&quot;),exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotolineend&quot;,description:&quot;Go to line end&quot;,bindKey:o(&quot;Alt-Right|End&quot;,&quot;Command-Right|End|Ctrl-E&quot;),exec:function(e){e.navigateLineEnd()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectright&quot;,description:&quot;Select right&quot;,bindKey:o(&quot;Shift-Right&quot;,&quot;Shift-Right&quot;),exec:function(e){e.getSelection().selectRight()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;gotoright&quot;,description:&quot;Go to right&quot;,bindKey:o(&quot;Right&quot;,&quot;Right|Ctrl-F&quot;),exec:function(e,t){e.navigateRight(t.times)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectpagedown&quot;,description:&quot;Select page down&quot;,bindKey:&quot;Shift-PageDown&quot;,exec:function(e){e.selectPageDown()},readOnly:!0},{name:&quot;pagedown&quot;,description:&quot;Page down&quot;,bindKey:o(null,&quot;Option-PageDown&quot;),exec:function(e){e.scrollPageDown()},readOnly:!0},{name:&quot;gotopagedown&quot;,description:&quot;Go to page down&quot;,bindKey:o(&quot;PageDown&quot;,&quot;PageDown|Ctrl-V&quot;),exec:function(e){e.gotoPageDown()},readOnly:!0},{name:&quot;selectpageup&quot;,description:&quot;Select page up&quot;,bindKey:&quot;Shift-PageUp&quot;,exec:function(e){e.selectPageUp()},readOnly:!0},{name:&quot;pageup&quot;,description:&quot;Page up&quot;,bindKey:o(null,&quot;Option-PageUp&quot;),exec:function(e){e.scrollPageUp()},readOnly:!0},{name:&quot;gotopageup&quot;,description:&quot;Go to page up&quot;,bindKey:&quot;PageUp&quot;,exec:function(e){e.gotoPageUp()},readOnly:!0},{name:&quot;scrollup&quot;,description:&quot;Scroll up&quot;,bindKey:o(&quot;Ctrl-Up&quot;,null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:&quot;scrolldown&quot;,description:&quot;Scroll down&quot;,bindKey:o(&quot;Ctrl-Down&quot;,null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:!0},{name:&quot;selectlinestart&quot;,description:&quot;Select line start&quot;,bindKey:&quot;Shift-Home&quot;,exec:function(e){e.getSelection().selectLineStart()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectlineend&quot;,description:&quot;Select line end&quot;,bindKey:&quot;Shift-End&quot;,exec:function(e){e.getSelection().selectLineEnd()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;togglerecording&quot;,description:&quot;Toggle recording&quot;,bindKey:o(&quot;Ctrl-Alt-E&quot;,&quot;Command-Option-E&quot;),exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},{name:&quot;replaymacro&quot;,description:&quot;Replay macro&quot;,bindKey:o(&quot;Ctrl-Shift-E&quot;,&quot;Command-Shift-E&quot;),exec:function(e){e.commands.replay(e)},readOnly:!0},{name:&quot;jumptomatching&quot;,description:&quot;Jump to matching&quot;,bindKey:o(&quot;Ctrl-\s\s|Ctrl-P&quot;,&quot;Command-\s\s&quot;),exec:function(e){e.jumpToMatching()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;animate&quot;,readOnly:!0},{name:&quot;selecttomatching&quot;,description:&quot;Select to matching&quot;,bindKey:o(&quot;Ctrl-Shift-\s\s|Ctrl-Shift-P&quot;,&quot;Command-Shift-\s\s&quot;),exec:function(e){e.jumpToMatching(!0)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;animate&quot;,readOnly:!0},{name:&quot;expandToMatching&quot;,description:&quot;Expand to matching&quot;,bindKey:o(&quot;Ctrl-Shift-M&quot;,&quot;Ctrl-Shift-M&quot;),exec:function(e){e.jumpToMatching(!0,!0)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;animate&quot;,readOnly:!0},{name:&quot;passKeysToBrowser&quot;,description:&quot;Pass keys to browser&quot;,bindKey:o(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:&quot;copy&quot;,description:&quot;Copy&quot;,exec:function(e){},readOnly:!0},{name:&quot;cut&quot;,description:&quot;Cut&quot;,exec:function(e){var t=e.$copyWithEmptySelection&amp;&amp;e.selection.isEmpty(),n=t?e.selection.getLineRange():e.selection.getRange();e._emit(&quot;cut&quot;,n),n.isEmpty()||e.session.remove(n),e.clearSelection()},scrollIntoView:&quot;cursor&quot;,multiSelectAction:&quot;forEach&quot;},{name:&quot;paste&quot;,description:&quot;Paste&quot;,exec:function(e,t){e.$handlePaste(t)},scrollIntoView:&quot;cursor&quot;},{name:&quot;removeline&quot;,description:&quot;Remove line&quot;,bindKey:o(&quot;Ctrl-D&quot;,&quot;Command-D&quot;),exec:function(e){e.removeLines()},scrollIntoView:&quot;cursor&quot;,multiSelectAction:&quot;forEachLine&quot;},{name:&quot;duplicateSelection&quot;,description:&quot;Duplicate selection&quot;,bindKey:o(&quot;Ctrl-Shift-D&quot;,&quot;Command-Shift-D&quot;),exec:function(e){e.duplicateSelection()},scrollIntoView:&quot;cursor&quot;,multiSelectAction:&quot;forEach&quot;},{name:&quot;sortlines&quot;,description:&quot;Sort lines&quot;,bindKey:o(&quot;Ctrl-Alt-S&quot;,&quot;Command-Alt-S&quot;),exec:function(e){e.sortLines()},scrollIntoView:&quot;selection&quot;,multiSelectAction:&quot;forEachLine&quot;},{name:&quot;togglecomment&quot;,description:&quot;Toggle comment&quot;,bindKey:o(&quot;Ctrl-/&quot;,&quot;Command-/&quot;),exec:function(e){e.toggleCommentLines()},multiSelectAction:&quot;forEachLine&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;toggleBlockComment&quot;,description:&quot;Toggle block comment&quot;,bindKey:o(&quot;Ctrl-Shift-/&quot;,&quot;Command-Shift-/&quot;),exec:function(e){e.toggleBlockComment()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;modifyNumberUp&quot;,description:&quot;Modify number up&quot;,bindKey:o(&quot;Ctrl-Shift-Up&quot;,&quot;Alt-Shift-Up&quot;),exec:function(e){e.modifyNumber(1)},scrollIntoView:&quot;cursor&quot;,multiSelectAction:&quot;forEach&quot;},{name:&quot;modifyNumberDown&quot;,description:&quot;Modify number down&quot;,bindKey:o(&quot;Ctrl-Shift-Down&quot;,&quot;Alt-Shift-Down&quot;),exec:function(e){e.modifyNumber(-1)},scrollIntoView:&quot;cursor&quot;,multiSelectAction:&quot;forEach&quot;},{name:&quot;replace&quot;,description:&quot;Replace&quot;,bindKey:o(&quot;Ctrl-H&quot;,&quot;Command-Option-F&quot;),exec:function(e){i.loadModule(&quot;ace/ext/searchbox&quot;,function(t){t.Search(e,!0)})}},{name:&quot;undo&quot;,description:&quot;Undo&quot;,bindKey:o(&quot;Ctrl-Z&quot;,&quot;Command-Z&quot;),exec:function(e){e.undo()}},{name:&quot;redo&quot;,description:&quot;Redo&quot;,bindKey:o(&quot;Ctrl-Shift-Z|Ctrl-Y&quot;,&quot;Command-Shift-Z|Command-Y&quot;),exec:function(e){e.redo()}},{name:&quot;copylinesup&quot;,description:&quot;Copy lines up&quot;,bindKey:o(&quot;Alt-Shift-Up&quot;,&quot;Command-Option-Up&quot;),exec:function(e){e.copyLinesUp()},scrollIntoView:&quot;cursor&quot;},{name:&quot;movelinesup&quot;,description:&quot;Move lines up&quot;,bindKey:o(&quot;Alt-Up&quot;,&quot;Option-Up&quot;),exec:function(e){e.moveLinesUp()},scrollIntoView:&quot;cursor&quot;},{name:&quot;copylinesdown&quot;,description:&quot;Copy lines down&quot;,bindKey:o(&quot;Alt-Shift-Down&quot;,&quot;Command-Option-Down&quot;),exec:function(e){e.copyLinesDown()},scrollIntoView:&quot;cursor&quot;},{name:&quot;movelinesdown&quot;,description:&quot;Move lines down&quot;,bindKey:o(&quot;Alt-Down&quot;,&quot;Option-Down&quot;),exec:function(e){e.moveLinesDown()},scrollIntoView:&quot;cursor&quot;},{name:&quot;del&quot;,description:&quot;Delete&quot;,bindKey:o(&quot;Delete&quot;,&quot;Delete|Ctrl-D|Shift-Delete&quot;),exec:function(e){e.remove(&quot;right&quot;)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;backspace&quot;,description:&quot;Backspace&quot;,bindKey:o(&quot;Shift-Backspace|Backspace&quot;,&quot;Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H&quot;),exec:function(e){e.remove(&quot;left&quot;)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;cut_or_delete&quot;,description:&quot;Cut or delete&quot;,bindKey:o(&quot;Shift-Delete&quot;,null),exec:function(e){if(!e.selection.isEmpty())return!1;e.remove(&quot;left&quot;)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removetolinestart&quot;,description:&quot;Remove to line start&quot;,bindKey:o(&quot;Alt-Backspace&quot;,&quot;Command-Backspace&quot;),exec:function(e){e.removeToLineStart()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removetolineend&quot;,description:&quot;Remove to line end&quot;,bindKey:o(&quot;Alt-Delete&quot;,&quot;Ctrl-K|Command-Delete&quot;),exec:function(e){e.removeToLineEnd()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removetolinestarthard&quot;,description:&quot;Remove to line start hard&quot;,bindKey:o(&quot;Ctrl-Shift-Backspace&quot;,null),exec:function(e){var t=e.selection.getRange();t.start.column=0,e.session.remove(t)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removetolineendhard&quot;,description:&quot;Remove to line end hard&quot;,bindKey:o(&quot;Ctrl-Shift-Delete&quot;,null),exec:function(e){var t=e.selection.getRange();t.end.column=Number.MAX_VALUE,e.session.remove(t)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removewordleft&quot;,description:&quot;Remove word left&quot;,bindKey:o(&quot;Ctrl-Backspace&quot;,&quot;Alt-Backspace|Ctrl-Alt-Backspace&quot;),exec:function(e){e.removeWordLeft()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;removewordright&quot;,description:&quot;Remove word right&quot;,bindKey:o(&quot;Ctrl-Delete&quot;,&quot;Alt-Delete&quot;),exec:function(e){e.removeWordRight()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;outdent&quot;,description:&quot;Outdent&quot;,bindKey:o(&quot;Shift-Tab&quot;,&quot;Shift-Tab&quot;),exec:function(e){e.blockOutdent()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;indent&quot;,description:&quot;Indent&quot;,bindKey:o(&quot;Tab&quot;,&quot;Tab&quot;),exec:function(e){e.indent()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;blockoutdent&quot;,description:&quot;Block outdent&quot;,bindKey:o(&quot;Ctrl-[&quot;,&quot;Ctrl-[&quot;),exec:function(e){e.blockOutdent()},multiSelectAction:&quot;forEachLine&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;blockindent&quot;,description:&quot;Block indent&quot;,bindKey:o(&quot;Ctrl-]&quot;,&quot;Ctrl-]&quot;),exec:function(e){e.blockIndent()},multiSelectAction:&quot;forEachLine&quot;,scrollIntoView:&quot;selectionPart&quot;},{name:&quot;insertstring&quot;,description:&quot;Insert string&quot;,exec:function(e,t){e.insert(t)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;inserttext&quot;,description:&quot;Insert text&quot;,exec:function(e,t){e.insert(r.stringRepeat(t.text||&quot;&quot;,t.times||1))},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;splitline&quot;,description:&quot;Split line&quot;,bindKey:o(null,&quot;Ctrl-O&quot;),exec:function(e){e.splitLine()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;transposeletters&quot;,description:&quot;Transpose letters&quot;,bindKey:o(&quot;Alt-Shift-X&quot;,&quot;Ctrl-T&quot;),exec:function(e){e.transposeLetters()},multiSelectAction:function(e){e.transposeSelections(1)},scrollIntoView:&quot;cursor&quot;},{name:&quot;touppercase&quot;,description:&quot;To uppercase&quot;,bindKey:o(&quot;Ctrl-U&quot;,&quot;Ctrl-U&quot;),exec:function(e){e.toUpperCase()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;tolowercase&quot;,description:&quot;To lowercase&quot;,bindKey:o(&quot;Ctrl-Shift-U&quot;,&quot;Ctrl-Shift-U&quot;),exec:function(e){e.toLowerCase()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;expandtoline&quot;,description:&quot;Expand to line&quot;,bindKey:o(&quot;Ctrl-Shift-L&quot;,&quot;Command-Shift-L&quot;),exec:function(e){var t=e.selection.getRange();t.start.column=t.end.column=0,t.end.row++,e.selection.setRange(t,!1)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;joinlines&quot;,description:&quot;Join lines&quot;,bindKey:o(null,null),exec:function(e){var t=e.selection.isBackwards(),n=t?e.selection.getSelectionLead():e.selection.getSelectionAnchor(),i=t?e.selection.getSelectionAnchor():e.selection.getSelectionLead(),o=e.session.doc.getLine(n.row).length,u=e.session.doc.getTextRange(e.selection.getRange()),a=u.replace(/\sn\ss*/,&quot; &quot;).length,f=e.session.doc.getLine(n.row);for(var l=n.row+1;l&lt;=i.row+1;l++){var c=r.stringTrimLeft(r.stringTrimRight(e.session.doc.getLine(l)));c.length!==0&amp;&amp;(c=&quot; &quot;+c),f+=c}i.row+1&lt;e.session.doc.getLength()-1&amp;&amp;(f+=e.session.doc.getNewLineCharacter()),e.clearSelection(),e.session.doc.replace(new s(n.row,0,i.row+2,0),f),a&gt;0?(e.selection.moveCursorTo(n.row,n.column),e.selection.selectTo(n.row,n.column+a)):(o=e.session.doc.getLine(n.row).length&gt;o?o+1:o,e.selection.moveCursorTo(n.row,o))},multiSelectAction:&quot;forEach&quot;,readOnly:!0},{name:&quot;invertSelection&quot;,description:&quot;Invert selection&quot;,bindKey:o(null,null),exec:function(e){var t=e.session.doc.getLength()-1,n=e.session.doc.getLine(t).length,r=e.selection.rangeList.ranges,i=[];r.length&lt;1&amp;&amp;(r=[e.selection.getRange()]);for(var o=0;o&lt;r.length;o++)o==r.length-1&amp;&amp;(r[o].end.row!==t||r[o].end.column!==n)&amp;&amp;i.push(new s(r[o].end.row,r[o].end.column,t,n)),o===0?(r[o].start.row!==0||r[o].start.column!==0)&amp;&amp;i.push(new s(0,0,r[o].start.row,r[o].start.column)):i.push(new s(r[o-1].end.row,r[o-1].end.column,r[o].start.row,r[o].start.column));e.exitMultiSelectMode(),e.clearSelection();for(var o=0;o&lt;i.length;o++)e.selection.addRange(i[o],!1)},readOnly:!0,scrollIntoView:&quot;none&quot;},{name:&quot;addLineAfter&quot;,exec:function(e){e.selection.clearSelection(),e.navigateLineEnd(),e.insert(&quot;\sn&quot;)},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;addLineBefore&quot;,exec:function(e){e.selection.clearSelection();var t=e.getCursorPosition();e.selection.moveTo(t.row-1,Number.MAX_VALUE),e.insert(&quot;\sn&quot;),t.row===0&amp;&amp;e.navigateUp()},multiSelectAction:&quot;forEach&quot;,scrollIntoView:&quot;cursor&quot;},{name:&quot;openCommandPallete&quot;,description:&quot;Open command pallete&quot;,bindKey:o(&quot;F1&quot;,&quot;F1&quot;),exec:function(e){e.prompt({$type:&quot;commands&quot;})},readOnly:!0},{name:&quot;modeSelect&quot;,description:&quot;Change language mode...&quot;,bindKey:o(null,null),exec:function(e){e.prompt({$type:&quot;modes&quot;})},readOnly:!0}]}),ace.define(&quot;ace/editor&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/fixoldbrowsers&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/useragent&quot;,&quot;ace/keyboard/textinput&quot;,&quot;ace/mouse/mouse_handler&quot;,&quot;ace/mouse/fold_handler&quot;,&quot;ace/keyboard/keybinding&quot;,&quot;ace/edit_session&quot;,&quot;ace/search&quot;,&quot;ace/range&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/commands/command_manager&quot;,&quot;ace/commands/default_commands&quot;,&quot;ace/config&quot;,&quot;ace/token_iterator&quot;,&quot;ace/clipboard&quot;],function(e,t,n){&quot;use strict&quot;;e(&quot;./lib/fixoldbrowsers&quot;);var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/dom&quot;),s=e(&quot;./lib/lang&quot;),o=e(&quot;./lib/useragent&quot;),u=e(&quot;./keyboard/textinput&quot;).TextInput,a=e(&quot;./mouse/mouse_handler&quot;).MouseHandler,f=e(&quot;./mouse/fold_handler&quot;).FoldHandler,l=e(&quot;./keyboard/keybinding&quot;).KeyBinding,c=e(&quot;./edit_session&quot;).EditSession,h=e(&quot;./search&quot;).Search,p=e(&quot;./range&quot;).Range,d=e(&quot;./lib/event_emitter&quot;).EventEmitter,v=e(&quot;./commands/command_manager&quot;).CommandManager,m=e(&quot;./commands/default_commands&quot;).commands,g=e(&quot;./config&quot;),y=e(&quot;./token_iterator&quot;).TokenIterator,b=e(&quot;./clipboard&quot;),w=function(e,t,n){var r=e.getContainerElement();this.container=r,this.renderer=e,this.id=&quot;editor&quot;+ ++w.$uid,this.commands=new v(o.isMac?&quot;mac&quot;:&quot;win&quot;,m),typeof document==&quot;object&quot;&amp;&amp;(this.textInput=new u(e.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new a(this),new f(this)),this.keyBinding=new l(this),this.$search=(new h).set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on(&quot;exec&quot;,this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=s.delayedCall(function(){this._signal(&quot;input&quot;,{}),this.session&amp;&amp;this.session.bgTokenizer&amp;&amp;this.session.bgTokenizer.scheduleStart()}.bind(this)),this.on(&quot;change&quot;,function(e,t){t._$emitInputEvent.schedule(31)}),this.setSession(t||n&amp;&amp;n.session||new c(&quot;&quot;)),g.resetOptions(this),n&amp;&amp;this.setOptions(n),g._signal(&quot;editor&quot;,this)};w.$uid=0,function(){r.implement(this,d),this.$initOperationListeners=function(){this.commands.on(&quot;exec&quot;,this.startOperation.bind(this),!0),this.commands.on(&quot;afterExec&quot;,this.endOperation.bind(this),!0),this.$opResetTimer=s.delayedCall(this.endOperation.bind(this,!0)),this.on(&quot;change&quot;,function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}.bind(this),!0),this.on(&quot;changeSelection&quot;,function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}.bind(this),!0)},this.curOp=null,this.prevOp={},this.startOperation=function(e){if(this.curOp){if(!e||this.curOp.command)return;this.prevOp=this.curOp}e||(this.previousCommand=null,e={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:e.command||{},args:e.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},this.endOperation=function(e){if(this.curOp){if(e&amp;&amp;e.returnValue===!1)return this.curOp=null;if(e==1&amp;&amp;this.curOp.command&amp;&amp;this.curOp.command.name==&quot;mouse&quot;)return;this._signal(&quot;beforeEndOperation&quot;);if(!this.curOp)return;var t=this.curOp.command,n=t&amp;&amp;t.scrollIntoView;if(n){switch(n){case&quot;center-animate&quot;:n=&quot;animate&quot;;case&quot;center&quot;:this.renderer.scrollCursorIntoView(null,.5);break;case&quot;animate&quot;:case&quot;cursor&quot;:this.renderer.scrollCursorIntoView();break;case&quot;selectionPart&quot;:var r=this.selection.getRange(),i=this.renderer.layerConfig;(r.start.row&gt;=i.lastRow||r.end.row&lt;=i.firstRow)&amp;&amp;this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead);break;default:}n==&quot;animate&quot;&amp;&amp;this.renderer.animateScrolling(this.curOp.scrollTop)}var s=this.selection.toJSON();this.curOp.selectionAfter=s,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(s),this.prevOp=this.curOp,this.curOp=null}},this.$mergeableCommands=[&quot;backspace&quot;,&quot;del&quot;,&quot;insertstring&quot;],this.$historyTracker=function(e){if(!this.$mergeUndoDeltas)return;var t=this.prevOp,n=this.$mergeableCommands,r=t.command&amp;&amp;e.command.name==t.command.name;if(e.command.name==&quot;insertstring&quot;){var i=e.args;this.mergeNextCommand===undefined&amp;&amp;(this.mergeNextCommand=!0),r=r&amp;&amp;this.mergeNextCommand&amp;&amp;(!/\ss/.test(i)||/\ss/.test(t.args)),this.mergeNextCommand=!0}else r=r&amp;&amp;n.indexOf(e.command.name)!==-1;this.$mergeUndoDeltas!=&quot;always&quot;&amp;&amp;Date.now()-this.sequenceStartTime&gt;2e3&amp;&amp;(r=!1),r?this.session.mergeUndoDeltas=!0:n.indexOf(e.command.name)!==-1&amp;&amp;(this.sequenceStartTime=Date.now())},this.setKeyboardHandler=function(e,t){if(e&amp;&amp;typeof e==&quot;string&quot;&amp;&amp;e!=&quot;ace&quot;){this.$keybindingId=e;var n=this;g.loadModule([&quot;keybinding&quot;,e],function(r){n.$keybindingId==e&amp;&amp;n.keyBinding.setKeyboardHandler(r&amp;&amp;r.handler),t&amp;&amp;t()})}else this.$keybindingId=null,this.keyBinding.setKeyboardHandler(e),t&amp;&amp;t()},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(e){if(this.session==e)return;this.curOp&amp;&amp;this.endOperation(),this.curOp={};var t=this.session;if(t){this.session.off(&quot;change&quot;,this.$onDocumentChange),this.session.off(&quot;changeMode&quot;,this.$onChangeMode),this.session.off(&quot;tokenizerUpdate&quot;,this.$onTokenizerUpdate),this.session.off(&quot;changeTabSize&quot;,this.$onChangeTabSize),this.session.off(&quot;changeWrapLimit&quot;,this.$onChangeWrapLimit),this.session.off(&quot;changeWrapMode&quot;,this.$onChangeWrapMode),this.session.off(&quot;changeFold&quot;,this.$onChangeFold),this.session.off(&quot;changeFrontMarker&quot;,this.$onChangeFrontMarker),this.session.off(&quot;changeBackMarker&quot;,this.$onChangeBackMarker),this.session.off(&quot;changeBreakpoint&quot;,this.$onChangeBreakpoint),this.session.off(&quot;changeAnnotation&quot;,this.$onChangeAnnotation),this.session.off(&quot;changeOverwrite&quot;,this.$onCursorChange),this.session.off(&quot;changeScrollTop&quot;,this.$onScrollTopChange),this.session.off(&quot;changeScrollLeft&quot;,this.$onScrollLeftChange);var n=this.session.getSelection();n.off(&quot;changeCursor&quot;,this.$onCursorChange),n.off(&quot;changeSelection&quot;,this.$onSelectionChange)}this.session=e,e?(this.$onDocumentChange=this.onDocumentChange.bind(this),e.on(&quot;change&quot;,this.$onDocumentChange),this.renderer.setSession(e),this.$onChangeMode=this.onChangeMode.bind(this),e.on(&quot;changeMode&quot;,this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),e.on(&quot;tokenizerUpdate&quot;,this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),e.on(&quot;changeTabSize&quot;,this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),e.on(&quot;changeWrapLimit&quot;,this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),e.on(&quot;changeWrapMode&quot;,this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),e.on(&quot;changeFold&quot;,this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on(&quot;changeFrontMarker&quot;,this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on(&quot;changeBackMarker&quot;,this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on(&quot;changeBreakpoint&quot;,this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on(&quot;changeAnnotation&quot;,this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on(&quot;changeOverwrite&quot;,this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on(&quot;changeScrollTop&quot;,this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on(&quot;changeScrollLeft&quot;,this.$onScrollLeftChange),this.selection=e.getSelection(),this.selection.on(&quot;changeCursor&quot;,this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on(&quot;changeSelection&quot;,this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&amp;&amp;this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(e)),this._signal(&quot;changeSession&quot;,{session:e,oldSession:t}),this.curOp=null,t&amp;&amp;t._signal(&quot;changeEditor&quot;,{oldEditor:this}),e&amp;&amp;e._signal(&quot;changeEditor&quot;,{editor:this}),e&amp;&amp;e.bgTokenizer&amp;&amp;e.bgTokenizer.scheduleStart()},this.getSession=function(){return this.session},this.setValue=function(e,t){return this.session.doc.setValue(e),t?t==1?this.navigateFileEnd():t==-1&amp;&amp;this.navigateFileStart():this.selectAll(),e},this.getValue=function(){return this.session.getValue()},this.getSelection=function(){return this.selection},this.resize=function(e){this.renderer.onResize(e)},this.setTheme=function(e,t){this.renderer.setTheme(e,t)},this.getTheme=function(){return this.renderer.getTheme()},this.setStyle=function(e){this.renderer.setStyle(e)},this.unsetStyle=function(e){this.renderer.unsetStyle(e)},this.getFontSize=function(){return this.getOption(&quot;fontSize&quot;)||i.computedStyle(this.container).fontSize},this.setFontSize=function(e){this.setOption(&quot;fontSize&quot;,e)},this.$highlightBrackets=function(){if(this.$highlightPending)return;var e=this;this.$highlightPending=!0,setTimeout(function(){e.$highlightPending=!1;var t=e.session;if(!t||!t.bgTokenizer)return;t.$bracketHighlight&amp;&amp;(t.$bracketHighlight.markerIds.forEach(function(e){t.removeMarker(e)}),t.$bracketHighlight=null);var n=t.getMatchingBracketRanges(e.getCursorPosition());!n&amp;&amp;t.$mode.getMatching&amp;&amp;(n=t.$mode.getMatching(e.session));if(!n)return;var r=&quot;ace_bracket&quot;;Array.isArray(n)?n.length==1&amp;&amp;(r=&quot;ace_error_bracket&quot;):n=[n],n.length==2&amp;&amp;(p.comparePoints(n[0].end,n[1].start)==0?n=[p.fromPoints(n[0].start,n[1].end)]:p.comparePoints(n[0].start,n[1].end)==0&amp;&amp;(n=[p.fromPoints(n[1].start,n[0].end)])),t.$bracketHighlight={ranges:n,markerIds:n.map(function(e){return t.addMarker(e,r,&quot;text&quot;)})}},50)},this.$highlightTags=function(){if(this.$highlightTagPending)return;var e=this;this.$highlightTagPending=!0,setTimeout(function(){e.$highlightTagPending=!1;var t=e.session;if(!t||!t.bgTokenizer)return;var n=e.getCursorPosition(),r=new y(e.session,n.row,n.column),i=r.getCurrentToken();if(!i||!/\sb(?:tag-open|tag-name)/.test(i.type)){t.removeMarker(t.$tagHighlight),t.$tagHighlight=null;return}if(i.type.indexOf(&quot;tag-open&quot;)!=-1){i=r.stepForward();if(!i)return}var s=i.value,o=0,u=r.stepBackward();if(u.value==&quot;&lt;&quot;){do u=i,i=r.stepForward(),i&amp;&amp;i.value===s&amp;&amp;i.type.indexOf(&quot;tag-name&quot;)!==-1&amp;&amp;(u.value===&quot;&lt;&quot;?o++:u.value===&quot;&lt;/&quot;&amp;&amp;o--);while(i&amp;&amp;o&gt;=0)}else{do i=u,u=r.stepBackward(),i&amp;&amp;i.value===s&amp;&amp;i.type.indexOf(&quot;tag-name&quot;)!==-1&amp;&amp;(u.value===&quot;&lt;&quot;?o++:u.value===&quot;&lt;/&quot;&amp;&amp;o--);while(u&amp;&amp;o&lt;=0);r.stepForward()}if(!i){t.removeMarker(t.$tagHighlight),t.$tagHighlight=null;return}var a=r.getCurrentTokenRow(),f=r.getCurrentTokenColumn(),l=new p(a,f,a,f+i.value.length),c=t.$backMarkers[t.$tagHighlight];t.$tagHighlight&amp;&amp;c!=undefined&amp;&amp;l.compareRange(c.range)!==0&amp;&amp;(t.removeMarker(t.$tagHighlight),t.$tagHighlight=null),t.$tagHighlight||(t.$tagHighlight=t.addMarker(l,&quot;ace_bracket&quot;,&quot;text&quot;))},50)},this.focus=function(){var e=this;setTimeout(function(){e.isFocused()||e.textInput.focus()}),this.textInput.focus()},this.isFocused=function(){return this.textInput.isFocused()},this.blur=function(){this.textInput.blur()},this.onFocus=function(e){if(this.$isFocused)return;this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit(&quot;focus&quot;,e)},this.onBlur=function(e){if(!this.$isFocused)return;this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit(&quot;blur&quot;,e)},this.$cursorChange=function(){this.renderer.updateCursor()},this.onDocumentChange=function(e){var t=this.session.$useWrapMode,n=e.start.row==e.end.row?e.end.row:Infinity;this.renderer.updateLines(e.start.row,n,t),this._signal(&quot;change&quot;,e),this.$cursorChange(),this.$updateHighlightActiveLine()},this.onTokenizerUpdate=function(e){var t=e.data;this.renderer.updateLines(t.first,t.last)},this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},this.onCursorChange=function(){this.$cursorChange(),this.$highlightBrackets(),this.$highlightTags(),this.$updateHighlightActiveLine(),this._signal(&quot;changeSelection&quot;)},this.$updateHighlightActiveLine=function(){var e=this.getSession(),t;if(this.$highlightActiveLine){if(this.$selectionStyle!=&quot;line&quot;||!this.selection.isMultiLine())t=this.getCursorPosition();this.renderer.theme&amp;&amp;this.renderer.theme.$selectionColorConflict&amp;&amp;!this.selection.isEmpty()&amp;&amp;(t=!1),this.renderer.$maxLines&amp;&amp;this.session.getLength()===1&amp;&amp;!(this.renderer.$minLines&gt;1)&amp;&amp;(t=!1)}if(e.$highlightLineMarker&amp;&amp;!t)e.removeMarker(e.$highlightLineMarker.id),e.$highlightLineMarker=null;else if(!e.$highlightLineMarker&amp;&amp;t){var n=new p(t.row,t.column,t.row,Infinity);n.id=e.addMarker(n,&quot;ace_active-line&quot;,&quot;screenLine&quot;),e.$highlightLineMarker=n}else t&amp;&amp;(e.$highlightLineMarker.start.row=t.row,e.$highlightLineMarker.end.row=t.row,e.$highlightLineMarker.start.column=t.column,e._signal(&quot;changeBackMarker&quot;))},this.onSelectionChange=function(e){var t=this.session;t.$selectionMarker&amp;&amp;t.removeMarker(t.$selectionMarker),t.$selectionMarker=null;if(!this.selection.isEmpty()){var n=this.selection.getRange(),r=this.getSelectionStyle();t.$selectionMarker=t.addMarker(n,&quot;ace_selection&quot;,r)}else this.$updateHighlightActiveLine();var i=this.$highlightSelectedWord&amp;&amp;this.$getSelectionHighLightRegexp();this.session.highlight(i),this._signal(&quot;changeSelection&quot;)},this.$getSelectionHighLightRegexp=function(){var e=this.session,t=this.getSelectionRange();if(t.isEmpty()||t.isMultiLine())return;var n=t.start.column,r=t.end.column,i=e.getLine(t.start.row),s=i.substring(n,r);if(s.length&gt;5e3||!/[\sw\sd]/.test(s))return;var o=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:s}),u=i.substring(n-1,r+1);if(!o.test(u))return;return o},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(e){this.renderer.updateText(),this._emit(&quot;changeMode&quot;,e)},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},this.getCopyText=function(){var e=this.getSelectedText(),t=this.session.doc.getNewLineCharacter(),n=!1;if(!e&amp;&amp;this.$copyWithEmptySelection){n=!0;var r=this.selection.getAllRanges();for(var i=0;i&lt;r.length;i++){var s=r[i];if(i&amp;&amp;r[i-1].start.row==s.start.row)continue;e+=this.session.getLine(s.start.row)+t}}var o={text:e};return this._signal(&quot;copy&quot;,o),b.lineMode=n?o.text:&quot;&quot;,o.text},this.onCopy=function(){this.commands.exec(&quot;copy&quot;,this)},this.onCut=function(){this.commands.exec(&quot;cut&quot;,this)},this.onPaste=function(e,t){var n={text:e,event:t};this.commands.exec(&quot;paste&quot;,this,n)},this.$handlePaste=function(e){typeof e==&quot;string&quot;&amp;&amp;(e={text:e}),this._signal(&quot;paste&quot;,e);var t=e.text,n=t==b.lineMode,r=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)n?r.insert({row:this.selection.lead.row,column:0},t):this.insert(t);else if(n)this.selection.rangeList.ranges.forEach(function(e){r.insert({row:e.start.row,column:0},t)});else{var i=t.split(/\sr\sn|\sr|\sn/),s=this.selection.rangeList.ranges,o=i.length==2&amp;&amp;(!i[0]||!i[1]);if(i.length!=s.length||o)return this.commands.exec(&quot;insertstring&quot;,this,t);for(var u=s.length;u--;){var a=s[u];a.isEmpty()||r.remove(a),r.insert(a.start,i[u])}}},this.execCommand=function(e,t){return this.commands.exec(e,this,t)},this.insert=function(e,t){var n=this.session,r=n.getMode(),i=this.getCursorPosition();if(this.getBehavioursEnabled()&amp;&amp;!t){var s=r.transformAction(n.getState(i.row),&quot;insertion&quot;,this,n,e);s&amp;&amp;(e!==s.text&amp;&amp;(this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1)),e=s.text)}e==&quot;	&quot;&amp;&amp;(e=this.session.getTabString());if(!this.selection.isEmpty()){var o=this.getSelectionRange();i=this.session.remove(o),this.clearSelection()}else if(this.session.getOverwrite()&amp;&amp;e.indexOf(&quot;\sn&quot;)==-1){var o=new p.fromPoints(i,i);o.end.column+=e.length,this.session.remove(o)}if(e==&quot;\sn&quot;||e==&quot;\sr\sn&quot;){var u=n.getLine(i.row);if(i.column&gt;u.search(/\sS|$/)){var a=u.substr(i.column).search(/\sS|$/);n.doc.removeInLine(i.row,i.column,i.column+a)}}this.clearSelection();var f=i.column,l=n.getState(i.row),u=n.getLine(i.row),c=r.checkOutdent(l,u,e);n.insert(i,e),s&amp;&amp;s.selection&amp;&amp;(s.selection.length==2?this.selection.setSelectionRange(new p(i.row,f+s.selection[0],i.row,f+s.selection[1])):this.selection.setSelectionRange(new p(i.row+s.selection[0],s.selection[1],i.row+s.selection[2],s.selection[3])));if(n.getDocument().isNewLine(e)){var h=r.getNextLineIndent(l,u.slice(0,i.column),n.getTabString());n.insert({row:i.row+1,column:0},h)}c&amp;&amp;r.autoOutdent(l,n,i.row)},this.onTextInput=function(e,t){if(!t)return this.keyBinding.onTextInput(e);this.startOperation({command:{name:&quot;insertstring&quot;}});var n=this.applyComposition.bind(this,e,t);this.selection.rangeCount?this.forEachSelection(n):n(),this.endOperation()},this.applyComposition=function(e,t){if(t.extendLeft||t.extendRight){var n=this.selection.getRange();n.start.column-=t.extendLeft,n.end.column+=t.extendRight,this.selection.setRange(n),!e&amp;&amp;!n.isEmpty()&amp;&amp;this.remove()}(e||!this.selection.isEmpty())&amp;&amp;this.insert(e,!0);if(t.restoreStart||t.restoreEnd){var n=this.selection.getRange();n.start.column-=t.restoreStart,n.end.column-=t.restoreEnd,this.selection.setRange(n)}},this.onCommandKey=function(e,t,n){return this.keyBinding.onCommandKey(e,t,n)},this.setOverwrite=function(e){this.session.setOverwrite(e)},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(e){this.setOption(&quot;scrollSpeed&quot;,e)},this.getScrollSpeed=function(){return this.getOption(&quot;scrollSpeed&quot;)},this.setDragDelay=function(e){this.setOption(&quot;dragDelay&quot;,e)},this.getDragDelay=function(){return this.getOption(&quot;dragDelay&quot;)},this.setSelectionStyle=function(e){this.setOption(&quot;selectionStyle&quot;,e)},this.getSelectionStyle=function(){return this.getOption(&quot;selectionStyle&quot;)},this.setHighlightActiveLine=function(e){this.setOption(&quot;highlightActiveLine&quot;,e)},this.getHighlightActiveLine=function(){return this.getOption(&quot;highlightActiveLine&quot;)},this.setHighlightGutterLine=function(e){this.setOption(&quot;highlightGutterLine&quot;,e)},this.getHighlightGutterLine=function(){return this.getOption(&quot;highlightGutterLine&quot;)},this.setHighlightSelectedWord=function(e){this.setOption(&quot;highlightSelectedWord&quot;,e)},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setAnimatedScroll=function(e){this.renderer.setAnimatedScroll(e)},this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},this.setShowInvisibles=function(e){this.renderer.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setDisplayIndentGuides=function(e){this.renderer.setDisplayIndentGuides(e)},this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},this.setShowPrintMargin=function(e){this.renderer.setShowPrintMargin(e)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(e){this.renderer.setPrintMarginColumn(e)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.setReadOnly=function(e){this.setOption(&quot;readOnly&quot;,e)},this.getReadOnly=function(){return this.getOption(&quot;readOnly&quot;)},this.setBehavioursEnabled=function(e){this.setOption(&quot;behavioursEnabled&quot;,e)},this.getBehavioursEnabled=function(){return this.getOption(&quot;behavioursEnabled&quot;)},this.setWrapBehavioursEnabled=function(e){this.setOption(&quot;wrapBehavioursEnabled&quot;,e)},this.getWrapBehavioursEnabled=function(){return this.getOption(&quot;wrapBehavioursEnabled&quot;)},this.setShowFoldWidgets=function(e){this.setOption(&quot;showFoldWidgets&quot;,e)},this.getShowFoldWidgets=function(){return this.getOption(&quot;showFoldWidgets&quot;)},this.setFadeFoldWidgets=function(e){this.setOption(&quot;fadeFoldWidgets&quot;,e)},this.getFadeFoldWidgets=function(){return this.getOption(&quot;fadeFoldWidgets&quot;)},this.remove=function(e){this.selection.isEmpty()&amp;&amp;(e==&quot;left&quot;?this.selection.selectLeft():this.selection.selectRight());var t=this.getSelectionRange();if(this.getBehavioursEnabled()){var n=this.session,r=n.getState(t.start.row),i=n.getMode().transformAction(r,&quot;deletion&quot;,this,n,t);if(t.end.column===0){var s=n.getTextRange(t);if(s[s.length-1]==&quot;\sn&quot;){var o=n.getLine(t.end.row);/^\ss+$/.test(o)&amp;&amp;(t.end.column=o.length)}}i&amp;&amp;(t=i)}this.session.remove(t),this.clearSelection()},this.removeWordRight=function(){this.selection.isEmpty()&amp;&amp;this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeWordLeft=function(){this.selection.isEmpty()&amp;&amp;this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineStart=function(){this.selection.isEmpty()&amp;&amp;this.selection.selectLineStart(),this.selection.isEmpty()&amp;&amp;this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},this.removeToLineEnd=function(){this.selection.isEmpty()&amp;&amp;this.selection.selectLineEnd();var e=this.getSelectionRange();e.start.column==e.end.column&amp;&amp;e.start.row==e.end.row&amp;&amp;(e.end.column=0,e.end.row++),this.session.remove(e),this.clearSelection()},this.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var e=this.getCursorPosition();this.insert(&quot;\sn&quot;),this.moveCursorToPosition(e)},this.transposeLetters=function(){if(!this.selection.isEmpty())return;var e=this.getCursorPosition(),t=e.column;if(t===0)return;var n=this.session.getLine(e.row),r,i;t&lt;n.length?(r=n.charAt(t)+n.charAt(t-1),i=new p(e.row,t-1,e.row,t+1)):(r=n.charAt(t-1)+n.charAt(t-2),i=new p(e.row,t-2,e.row,t)),this.session.replace(i,r),this.session.selection.moveToPosition(i.end)},this.toLowerCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&amp;&amp;this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toLowerCase()),this.selection.setSelectionRange(e)},this.toUpperCase=function(){var e=this.getSelectionRange();this.selection.isEmpty()&amp;&amp;this.selection.selectWord();var t=this.getSelectionRange(),n=this.session.getTextRange(t);this.session.replace(t,n.toUpperCase()),this.selection.setSelectionRange(e)},this.indent=function(){var e=this.session,t=this.getSelectionRange();if(t.start.row&lt;t.end.row){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,&quot;	&quot;);return}if(t.start.column&lt;t.end.column){var r=e.getTextRange(t);if(!/^\ss+$/.test(r)){var n=this.$getSelectedRows();e.indentRows(n.first,n.last,&quot;	&quot;);return}}var i=e.getLine(t.start.row),o=t.start,u=e.getTabSize(),a=e.documentToScreenColumn(o.row,o.column);if(this.session.getUseSoftTabs())var f=u-a%u,l=s.stringRepeat(&quot; &quot;,f);else{var f=a%u;while(i[t.start.column-1]==&quot; &quot;&amp;&amp;f)t.start.column--,f--;this.selection.setSelectionRange(t),l=&quot;	&quot;}return this.insert(l)},this.blockIndent=function(){var e=this.$getSelectedRows();this.session.indentRows(e.first,e.last,&quot;	&quot;)},this.blockOutdent=function(){var e=this.session.getSelection();this.session.outdentRows(e.getRange())},this.sortLines=function(){var e=this.$getSelectedRows(),t=this.session,n=[];for(var r=e.first;r&lt;=e.last;r++)n.push(t.getLine(r));n.sort(function(e,t){return e.toLowerCase()&lt;t.toLowerCase()?-1:e.toLowerCase()&gt;t.toLowerCase()?1:0});var i=new p(0,0,0,0);for(var r=e.first;r&lt;=e.last;r++){var s=t.getLine(r);i.start.row=r,i.end.row=r,i.end.column=s.length,t.replace(i,n[r-e.first])}},this.toggleCommentLines=function(){var e=this.session.getState(this.getCursorPosition().row),t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(e,this.session,t.first,t.last)},this.toggleBlockComment=function(){var e=this.getCursorPosition(),t=this.session.getState(e.row),n=this.getSelectionRange();this.session.getMode().toggleBlockComment(t,this.session,n,e)},this.getNumberAt=function(e,t){var n=/[\s-]?[0-9]+(?:\s.[0-9]+)?/g;n.lastIndex=0;var r=this.session.getLine(e);while(n.lastIndex&lt;t){var i=n.exec(r);if(i.index&lt;=t&amp;&amp;i.index+i[0].length&gt;=t){var s={value:i[0],start:i.index,end:i.index+i[0].length};return s}}return null},this.modifyNumber=function(e){var t=this.selection.getCursor().row,n=this.selection.getCursor().column,r=new p(t,n-1,t,n),i=this.session.getTextRange(r);if(!isNaN(parseFloat(i))&amp;&amp;isFinite(i)){var s=this.getNumberAt(t,n);if(s){var o=s.value.indexOf(&quot;.&quot;)&gt;=0?s.start+s.value.indexOf(&quot;.&quot;)+1:s.end,u=s.start+s.value.length-o,a=parseFloat(s.value);a*=Math.pow(10,u),o!==s.end&amp;&amp;n&lt;o?e*=Math.pow(10,s.end-n-1):e*=Math.pow(10,s.end-n),a+=e,a/=Math.pow(10,u);var f=a.toFixed(u),l=new p(t,s.start,t,s.end);this.session.replace(l,f),this.moveCursorTo(t,Math.max(s.start+1,n+f.length-s.value.length))}}else this.toggleWord()},this.$toggleWordPairs=[[&quot;first&quot;,&quot;last&quot;],[&quot;true&quot;,&quot;false&quot;],[&quot;yes&quot;,&quot;no&quot;],[&quot;width&quot;,&quot;height&quot;],[&quot;top&quot;,&quot;bottom&quot;],[&quot;right&quot;,&quot;left&quot;],[&quot;on&quot;,&quot;off&quot;],[&quot;x&quot;,&quot;y&quot;],[&quot;get&quot;,&quot;set&quot;],[&quot;max&quot;,&quot;min&quot;],[&quot;horizontal&quot;,&quot;vertical&quot;],[&quot;show&quot;,&quot;hide&quot;],[&quot;add&quot;,&quot;remove&quot;],[&quot;up&quot;,&quot;down&quot;],[&quot;before&quot;,&quot;after&quot;],[&quot;even&quot;,&quot;odd&quot;],[&quot;in&quot;,&quot;out&quot;],[&quot;inside&quot;,&quot;outside&quot;],[&quot;next&quot;,&quot;previous&quot;],[&quot;increase&quot;,&quot;decrease&quot;],[&quot;attach&quot;,&quot;detach&quot;],[&quot;&amp;&amp;&quot;,&quot;||&quot;],[&quot;==&quot;,&quot;!=&quot;]],this.toggleWord=function(){var e=this.selection.getCursor().row,t=this.selection.getCursor().column;this.selection.selectWord();var n=this.getSelectedText(),r=this.selection.getWordRange().start.column,i=n.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,&quot;$1 &quot;).split(/\ss/),o=t-r-1;o&lt;0&amp;&amp;(o=0);var u=0,a=0,f=this;n.match(/[A-Za-z0-9_]+/)&amp;&amp;i.forEach(function(t,i){a=u+t.length,o&gt;=u&amp;&amp;o&lt;=a&amp;&amp;(n=t,f.selection.clearSelection(),f.moveCursorTo(e,u+r),f.selection.selectTo(e,a+r)),u=a});var l=this.$toggleWordPairs,c;for(var h=0;h&lt;l.length;h++){var p=l[h];for(var d=0;d&lt;=1;d++){var v=+!d,m=n.match(new RegExp(&quot;^\s\ss?_?(&quot;+s.escapeRegExp(p[d])+&quot;)\s\ss?$&quot;,&quot;i&quot;));if(m){var g=n.match(new RegExp(&quot;([_]|^|\s\ss)(&quot;+s.escapeRegExp(m[1])+&quot;)($|\s\ss)&quot;,&quot;g&quot;));g&amp;&amp;(c=n.replace(new RegExp(s.escapeRegExp(p[d]),&quot;i&quot;),function(e){var t=p[v];return e.toUpperCase()==e?t=t.toUpperCase():e.charAt(0).toUpperCase()==e.charAt(0)&amp;&amp;(t=t.substr(0,0)+p[v].charAt(0).toUpperCase()+t.substr(1)),t}),this.insert(c),c=&quot;&quot;)}}}},this.removeLines=function(){var e=this.$getSelectedRows();this.session.removeFullLines(e.first,e.last),this.clearSelection()},this.duplicateSelection=function(){var e=this.selection,t=this.session,n=e.getRange(),r=e.isBackwards();if(n.isEmpty()){var i=n.start.row;t.duplicateLines(i,i)}else{var s=r?n.start:n.end,o=t.insert(s,t.getTextRange(n),!1);n.start=s,n.end=o,e.setSelectionRange(n,r)}},this.moveLinesDown=function(){this.$moveLines(1,!1)},this.moveLinesUp=function(){this.$moveLines(-1,!1)},this.moveText=function(e,t,n){return this.session.moveText(e,t,n)},this.copyLinesUp=function(){this.$moveLines(-1,!0)},this.copyLinesDown=function(){this.$moveLines(1,!0)},this.$moveLines=function(e,t){var n,r,i=this.selection;if(!i.inMultiSelectMode||this.inVirtualSelectionMode){var s=i.toOrientedRange();n=this.$getSelectedRows(s),r=this.session.$moveLines(n.first,n.last,t?0:e),t&amp;&amp;e==-1&amp;&amp;(r=0),s.moveBy(r,0),i.fromOrientedRange(s)}else{var o=i.rangeList.ranges;i.rangeList.detach(this.session),this.inVirtualSelectionMode=!0;var u=0,a=0,f=o.length;for(var l=0;l&lt;f;l++){var c=l;o[l].moveBy(u,0),n=this.$getSelectedRows(o[l]);var h=n.first,p=n.last;while(++l&lt;f){a&amp;&amp;o[l].moveBy(a,0);var d=this.$getSelectedRows(o[l]);if(t&amp;&amp;d.first!=p)break;if(!t&amp;&amp;d.first&gt;p+1)break;p=d.last}l--,u=this.session.$moveLines(h,p,t?0:e),t&amp;&amp;e==-1&amp;&amp;(c=l+1);while(c&lt;=l)o[c].moveBy(u,0),c++;t||(u=0),a+=u}i.fromOrientedRange(i.ranges[0]),i.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},this.$getSelectedRows=function(e){return e=(e||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(e.start.row),last:this.session.getRowFoldEnd(e.end.row)}},this.onCompositionStart=function(e){this.renderer.showComposition(e)},this.onCompositionUpdate=function(e){this.renderer.setCompositionText(e)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(e){return e&gt;=this.getFirstVisibleRow()&amp;&amp;e&lt;=this.getLastVisibleRow()},this.isRowFullyVisible=function(e){return e&gt;=this.renderer.getFirstFullyVisibleRow()&amp;&amp;e&lt;=this.renderer.getLastFullyVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$moveByPage=function(e,t){var n=this.renderer,r=this.renderer.layerConfig,i=e*Math.floor(r.height/r.lineHeight);t===!0?this.selection.$moveSelection(function(){this.moveCursorBy(i,0)}):t===!1&amp;&amp;(this.selection.moveCursorBy(i,0),this.selection.clearSelection());var s=n.scrollTop;n.scrollBy(0,i*r.lineHeight),t!=null&amp;&amp;n.scrollCursorIntoView(null,.5),n.animateScrolling(s)},this.selectPageDown=function(){this.$moveByPage(1,!0)},this.selectPageUp=function(){this.$moveByPage(-1,!0)},this.gotoPageDown=function(){this.$moveByPage(1,!1)},this.gotoPageUp=function(){this.$moveByPage(-1,!1)},this.scrollPageDown=function(){this.$moveByPage(1)},this.scrollPageUp=function(){this.$moveByPage(-1)},this.scrollToRow=function(e){this.renderer.scrollToRow(e)},this.scrollToLine=function(e,t,n,r){this.renderer.scrollToLine(e,t,n,r)},this.centerSelection=function(){var e=this.getSelectionRange(),t={row:Math.floor(e.start.row+(e.end.row-e.start.row)/2),column:Math.floor(e.start.column+(e.end.column-e.start.column)/2)};this.renderer.alignCursor(t,.5)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.selection.selectAll()},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(e,t){this.selection.moveCursorTo(e,t)},this.moveCursorToPosition=function(e){this.selection.moveCursorToPosition(e)},this.jumpToMatching=function(e,t){var n=this.getCursorPosition(),r=new y(this.session,n.row,n.column),i=r.getCurrentToken(),s=i||r.stepForward();if(!s)return;var o,u=!1,a={},f=n.column-s.start,l,c={&quot;)&quot;:&quot;(&quot;,&quot;(&quot;:&quot;(&quot;,&quot;]&quot;:&quot;[&quot;,&quot;[&quot;:&quot;[&quot;,&quot;{&quot;:&quot;{&quot;,&quot;}&quot;:&quot;{&quot;};do{if(s.value.match(/[{}()\s[\s]]/g))for(;f&lt;s.value.length&amp;&amp;!u;f++){if(!c[s.value[f]])continue;l=c[s.value[f]]+&quot;.&quot;+s.type.replace(&quot;rparen&quot;,&quot;lparen&quot;),isNaN(a[l])&amp;&amp;(a[l]=0);switch(s.value[f]){case&quot;(&quot;:case&quot;[&quot;:case&quot;{&quot;:a[l]++;break;case&quot;)&quot;:case&quot;]&quot;:case&quot;}&quot;:a[l]--,a[l]===-1&amp;&amp;(o=&quot;bracket&quot;,u=!0)}}else s.type.indexOf(&quot;tag-name&quot;)!==-1&amp;&amp;(isNaN(a[s.value])&amp;&amp;(a[s.value]=0),i.value===&quot;&lt;&quot;?a[s.value]++:i.value===&quot;&lt;/&quot;&amp;&amp;a[s.value]--,a[s.value]===-1&amp;&amp;(o=&quot;tag&quot;,u=!0));u||(i=s,s=r.stepForward(),f=0)}while(s&amp;&amp;!u);if(!o)return;var h,d;if(o===&quot;bracket&quot;){h=this.session.getBracketRange(n);if(!h){h=new p(r.getCurrentTokenRow(),r.getCurrentTokenColumn()+f-1,r.getCurrentTokenRow(),r.getCurrentTokenColumn()+f-1),d=h.start;if(t||d.row===n.row&amp;&amp;Math.abs(d.column-n.column)&lt;2)h=this.session.getBracketRange(d)}}else if(o===&quot;tag&quot;){if(!s||s.type.indexOf(&quot;tag-name&quot;)===-1)return;var v=s.value;h=new p(r.getCurrentTokenRow(),r.getCurrentTokenColumn()-2,r.getCurrentTokenRow(),r.getCurrentTokenColumn()-2);if(h.compare(n.row,n.column)===0){u=!1;do s=i,i=r.stepBackward(),i&amp;&amp;(i.type.indexOf(&quot;tag-close&quot;)!==-1&amp;&amp;h.setEnd(r.getCurrentTokenRow(),r.getCurrentTokenColumn()+1),s.value===v&amp;&amp;s.type.indexOf(&quot;tag-name&quot;)!==-1&amp;&amp;(i.value===&quot;&lt;&quot;?a[v]++:i.value===&quot;&lt;/&quot;&amp;&amp;a[v]--,a[v]===0&amp;&amp;(u=!0)));while(i&amp;&amp;!u)}s&amp;&amp;s.type.indexOf(&quot;tag-name&quot;)&amp;&amp;(d=h.start,d.row==n.row&amp;&amp;Math.abs(d.column-n.column)&lt;2&amp;&amp;(d=h.end))}d=h&amp;&amp;h.cursor||d,d&amp;&amp;(e?h&amp;&amp;t?this.selection.setRange(h):h&amp;&amp;h.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(d.row,d.column):this.selection.moveTo(d.row,d.column))},this.gotoLine=function(e,t,n){this.selection.clearSelection(),this.session.unfold({row:e-1,column:t||0}),this.exitMultiSelectMode&amp;&amp;this.exitMultiSelectMode(),this.moveCursorTo(e-1,t||0),this.isRowFullyVisible(e-1)||this.scrollToLine(e-1,!0,n)},this.navigateTo=function(e,t){this.selection.moveTo(e,t)},this.navigateUp=function(e){if(this.selection.isMultiLine()&amp;&amp;!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(-e||-1,0)},this.navigateDown=function(e){if(this.selection.isMultiLine()&amp;&amp;this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection(),this.selection.moveCursorBy(e||1,0)},this.navigateLeft=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorLeft()}this.clearSelection()},this.navigateRight=function(e){if(!this.selection.isEmpty()){var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}else{e=e||1;while(e--)this.selection.moveCursorRight()}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(e,t){t&amp;&amp;this.$search.set(t);var n=this.$search.find(this.session),r=0;return n?(this.$tryReplace(n,e)&amp;&amp;(r=1),this.selection.setSelectionRange(n),this.renderer.scrollSelectionIntoView(n.start,n.end),r):r},this.replaceAll=function(e,t){t&amp;&amp;this.$search.set(t);var n=this.$search.findAll(this.session),r=0;if(!n.length)return r;var i=this.getSelectionRange();this.selection.moveTo(0,0);for(var s=n.length-1;s&gt;=0;--s)this.$tryReplace(n[s],e)&amp;&amp;r++;return this.selection.setSelectionRange(i),r},this.$tryReplace=function(e,t){var n=this.session.getTextRange(e);return t=this.$search.replace(n,t),t!==null?(e.end=this.session.replace(e,t),e):null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(e,t,n){t||(t={}),typeof e==&quot;string&quot;||e instanceof RegExp?t.needle=e:typeof e==&quot;object&quot;&amp;&amp;r.mixin(t,e);var i=this.selection.getRange();t.needle==null&amp;&amp;(e=this.session.getTextRange(i)||this.$search.$options.needle,e||(i=this.session.getWordRange(i.start.row,i.start.column),e=this.session.getTextRange(i)),this.$search.set({needle:e})),this.$search.set(t),t.start||this.$search.set({start:i});var s=this.$search.find(this.session);if(t.preventScroll)return s;if(s)return this.revealRange(s,n),s;t.backwards?i.start=i.end:i.end=i.start,this.selection.setRange(i)},this.findNext=function(e,t){this.find({skipCurrent:!0,backwards:!1},e,t)},this.findPrevious=function(e,t){this.find(e,{skipCurrent:!0,backwards:!0},t)},this.revealRange=function(e,t){this.session.unfold(e),this.selection.setSelectionRange(e);var n=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(e.start,e.end,.5),t!==!1&amp;&amp;this.renderer.animateScrolling(n)},this.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},this.destroy=function(){this.renderer.destroy(),this._signal(&quot;destroy&quot;,this),this.session&amp;&amp;this.session.destroy(),this._$emitInputEvent&amp;&amp;this._$emitInputEvent.cancel(),this.session=null},this.setAutoScrollEditorIntoView=function(e){if(!e)return;var t,n=this,r=!1;this.$scrollAnchor||(this.$scrollAnchor=document.createElement(&quot;div&quot;));var i=this.$scrollAnchor;i.style.cssText=&quot;position:absolute&quot;,this.container.insertBefore(i,this.container.firstChild);var s=this.on(&quot;changeSelection&quot;,function(){r=!0}),o=this.renderer.on(&quot;beforeRender&quot;,function(){r&amp;&amp;(t=n.renderer.container.getBoundingClientRect())}),u=this.renderer.on(&quot;afterRender&quot;,function(){if(r&amp;&amp;t&amp;&amp;(n.isFocused()||n.searchBox&amp;&amp;n.searchBox.isFocused())){var e=n.renderer,s=e.$cursorLayer.$pixelPos,o=e.layerConfig,u=s.top-o.offset;s.top&gt;=0&amp;&amp;u+t.top&lt;0?r=!0:s.top&lt;o.height&amp;&amp;s.top+t.top+o.lineHeight&gt;window.innerHeight?r=!1:r=null,r!=null&amp;&amp;(i.style.top=u+&quot;px&quot;,i.style.left=s.left+&quot;px&quot;,i.style.height=o.lineHeight+&quot;px&quot;,i.scrollIntoView(r)),r=t=null}});this.setAutoScrollEditorIntoView=function(e){if(e)return;delete this.setAutoScrollEditorIntoView,this.off(&quot;changeSelection&quot;,s),this.renderer.off(&quot;afterRender&quot;,u),this.renderer.off(&quot;beforeRender&quot;,o)}},this.$resetCursorStyle=function(){var e=this.$cursorStyle||&quot;ace&quot;,t=this.renderer.$cursorLayer;if(!t)return;t.setSmoothBlinking(/smooth/.test(e)),t.isBlinking=!this.$readOnly&amp;&amp;e!=&quot;wide&quot;,i.setCssClass(t.element,&quot;ace_slim-cursors&quot;,/slim/.test(e))},this.prompt=function(e,t,n){var r=this;g.loadModule(&quot;./ext/prompt&quot;,function(i){i.prompt(r,e,t,n)})}}.call(w.prototype),g.defineOptions(w.prototype,&quot;editor&quot;,{selectionStyle:{set:function(e){this.onSelectionChange(),this._signal(&quot;changeSelectionStyle&quot;,{data:e})},initialValue:&quot;line&quot;},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(e){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(e){this.textInput.setReadOnly(e),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(e){this.textInput.setCopyWithEmptySelection(e)},initialValue:!1},cursorStyle:{set:function(e){this.$resetCursorStyle()},values:[&quot;ace&quot;,&quot;slim&quot;,&quot;smooth&quot;,&quot;wide&quot;],initialValue:&quot;ace&quot;},mergeUndoDeltas:{values:[!1,!0,&quot;always&quot;],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},autoScrollEditorIntoView:{set:function(e){this.setAutoScrollEditorIntoView(e)}},keyboardHandler:{set:function(e){this.setKeyboardHandler(e)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(e){this.session.setValue(e)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(e){this.setSession(e)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(e){this.renderer.$gutterLayer.setShowLineNumbers(e),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),e&amp;&amp;this.$relativeLineNumbers?E.attach(this):E.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(e){this.$showLineNumbers&amp;&amp;e?E.attach(this):E.detach(this)}},placeholder:{set:function(e){this.$updatePlaceholder||(this.$updatePlaceholder=function(){var e=this.renderer.$composition||this.getValue();if(e&amp;&amp;this.renderer.placeholderNode)this.renderer.off(&quot;afterRender&quot;,this.$updatePlaceholder),i.removeCssClass(this.container,&quot;ace_hasPlaceholder&quot;),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null;else if(!e&amp;&amp;!this.renderer.placeholderNode){this.renderer.on(&quot;afterRender&quot;,this.$updatePlaceholder),i.addCssClass(this.container,&quot;ace_hasPlaceholder&quot;);var t=i.createElement(&quot;div&quot;);t.className=&quot;ace_placeholder&quot;,t.textContent=this.$placeholder||&quot;&quot;,this.renderer.placeholderNode=t,this.renderer.content.appendChild(this.renderer.placeholderNode)}}.bind(this),this.on(&quot;input&quot;,this.$updatePlaceholder)),this.$updatePlaceholder()}},hScrollBarAlwaysVisible:&quot;renderer&quot;,vScrollBarAlwaysVisible:&quot;renderer&quot;,highlightGutterLine:&quot;renderer&quot;,animatedScroll:&quot;renderer&quot;,showInvisibles:&quot;renderer&quot;,showPrintMargin:&quot;renderer&quot;,printMarginColumn:&quot;renderer&quot;,printMargin:&quot;renderer&quot;,fadeFoldWidgets:&quot;renderer&quot;,showFoldWidgets:&quot;renderer&quot;,displayIndentGuides:&quot;renderer&quot;,showGutter:&quot;renderer&quot;,fontSize:&quot;renderer&quot;,fontFamily:&quot;renderer&quot;,maxLines:&quot;renderer&quot;,minLines:&quot;renderer&quot;,scrollPastEnd:&quot;renderer&quot;,fixedWidthGutter:&quot;renderer&quot;,theme:&quot;renderer&quot;,hasCssTransforms:&quot;renderer&quot;,maxPixelHeight:&quot;renderer&quot;,useTextareaForIME:&quot;renderer&quot;,scrollSpeed:&quot;$mouseHandler&quot;,dragDelay:&quot;$mouseHandler&quot;,dragEnabled:&quot;$mouseHandler&quot;,focusTimeout:&quot;$mouseHandler&quot;,tooltipFollowsMouse:&quot;$mouseHandler&quot;,firstLineNumber:&quot;session&quot;,overwrite:&quot;session&quot;,newLineMode:&quot;session&quot;,useWorker:&quot;session&quot;,useSoftTabs:&quot;session&quot;,navigateWithinSoftTabs:&quot;session&quot;,tabSize:&quot;session&quot;,wrap:&quot;session&quot;,indentedSoftWrap:&quot;session&quot;,foldStyle:&quot;session&quot;,mode:&quot;session&quot;});var E={getText:function(e,t){return(Math.abs(e.selection.lead.row-t)||t+1+(t&lt;9?&quot;\su00b7&quot;:&quot;&quot;))+&quot;&quot;},getWidth:function(e,t,n){return Math.max(t.toString().length,(n.lastRow+1).toString().length,2)*n.characterWidth},update:function(e,t){t.renderer.$loop.schedule(t.renderer.CHANGE_GUTTER)},attach:function(e){e.renderer.$gutterLayer.$renderer=this,e.on(&quot;changeSelection&quot;,this.update),this.update(null,e)},detach:function(e){e.renderer.$gutterLayer.$renderer==this&amp;&amp;(e.renderer.$gutterLayer.$renderer=null),e.off(&quot;changeSelection&quot;,this.update),this.update(null,e)}};t.Editor=w}),ace.define(&quot;ace/undomanager&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function i(e,t){for(var n=t;n--;){var r=e[n];if(r&amp;&amp;!r[0].ignore){while(n&lt;t-1){var i=d(e[n],e[n+1]);e[n]=i[0],e[n+1]=i[1],n++}return!0}}}function a(e){var t=e.action==&quot;insert&quot;,n=e.start,r=e.end,i=(r.row-n.row)*(t?1:-1),s=(r.column-n.column)*(t?1:-1);t&amp;&amp;(r=n);for(var o in this.marks){var a=this.marks[o],f=u(a,n);if(f&lt;0)continue;if(f===0&amp;&amp;t){if(a.bias!=1){a.bias==-1;continue}f=1}var l=t?f:u(a,r);if(l&gt;0){a.row+=i,a.column+=a.row==r.row?s:0;continue}!t&amp;&amp;l&lt;=0&amp;&amp;(a.row=n.row,a.column=n.column,l===0&amp;&amp;(a.bias=1))}}function f(e){return{row:e.row,column:e.column}}function l(e){return{start:f(e.start),end:f(e.end),action:e.action,lines:e.lines.slice()}}function c(e){e=e||this;if(Array.isArray(e))return e.map(c).join(&quot;\sn&quot;);var t=&quot;&quot;;e.action?(t=e.action==&quot;insert&quot;?&quot;+&quot;:&quot;-&quot;,t+=&quot;[&quot;+e.lines+&quot;]&quot;):e.value&amp;&amp;(Array.isArray(e.value)?t=e.value.map(h).join(&quot;\sn&quot;):t=h(e.value)),e.start&amp;&amp;(t+=h(e));if(e.id||e.rev)t+=&quot;	(&quot;+(e.id||e.rev)+&quot;)&quot;;return t}function h(e){return e.start.row+&quot;:&quot;+e.start.column+&quot;=&gt;&quot;+e.end.row+&quot;:&quot;+e.end.column}function p(e,t){var n=e.action==&quot;insert&quot;,r=t.action==&quot;insert&quot;;if(n&amp;&amp;r)if(o(t.start,e.end)&gt;=0)m(t,e,-1);else{if(!(o(t.start,e.start)&lt;=0))return null;m(e,t,1)}else if(n&amp;&amp;!r)if(o(t.start,e.end)&gt;=0)m(t,e,-1);else{if(!(o(t.end,e.start)&lt;=0))return null;m(e,t,-1)}else if(!n&amp;&amp;r)if(o(t.start,e.start)&gt;=0)m(t,e,1);else{if(!(o(t.start,e.start)&lt;=0))return null;m(e,t,1)}else if(!n&amp;&amp;!r)if(o(t.start,e.start)&gt;=0)m(t,e,1);else{if(!(o(t.end,e.start)&lt;=0))return null;m(e,t,-1)}return[t,e]}function d(e,t){for(var n=e.length;n--;)for(var r=0;r&lt;t.length;r++)if(!p(e[n],t[r])){while(n&lt;e.length){while(r--)p(t[r],e[n]);r=t.length,n++}return[e,t]}return e.selectionBefore=t.selectionBefore=e.selectionAfter=t.selectionAfter=null,[t,e]}function v(e,t){var n=e.action==&quot;insert&quot;,r=t.action==&quot;insert&quot;;if(n&amp;&amp;r)o(e.start,t.start)&lt;0?m(t,e,1):m(e,t,1);else if(n&amp;&amp;!r)o(e.start,t.end)&gt;=0?m(e,t,-1):o(e.start,t.start)&lt;=0?m(t,e,1):(m(e,s.fromPoints(t.start,e.start),-1),m(t,e,1));else if(!n&amp;&amp;r)o(t.start,e.end)&gt;=0?m(t,e,-1):o(t.start,e.start)&lt;=0?m(e,t,1):(m(t,s.fromPoints(e.start,t.start),-1),m(e,t,1));else if(!n&amp;&amp;!r)if(o(t.start,e.end)&gt;=0)m(t,e,-1);else{if(!(o(t.end,e.start)&lt;=0)){var i,u;return o(e.start,t.start)&lt;0&amp;&amp;(i=e,e=y(e,t.start)),o(e.end,t.end)&gt;0&amp;&amp;(u=y(e,t.end)),g(t.end,e.start,e.end,-1),u&amp;&amp;!i&amp;&amp;(e.lines=u.lines,e.start=u.start,e.end=u.end,u=e),[t,i,u].filter(Boolean)}m(e,t,-1)}return[t,e]}function m(e,t,n){g(e.start,t.start,t.end,n),g(e.end,t.start,t.end,n)}function g(e,t,n,r){e.row==(r==1?t:n).row&amp;&amp;(e.column+=r*(n.column-t.column)),e.row+=r*(n.row-t.row)}function y(e,t){var n=e.lines,r=e.end;e.end=f(t);var i=e.end.row-e.start.row,s=n.splice(i,n.length),o=i?t.column:t.column-e.start.column;n.push(s[0].substring(0,o)),s[0]=s[0].substr(o);var u={start:f(t),end:r,lines:s,action:e.action};return u}function b(e,t){t=l(t);for(var n=e.length;n--;){var r=e[n];for(var i=0;i&lt;r.length;i++){var s=r[i],o=v(s,t);t=o[0],o.length!=2&amp;&amp;(o[2]?(r.splice(i+1,1,o[1],o[2]),i++):o[1]||(r.splice(i,1),i--))}r.length||e.splice(n,1)}return e}function w(e,t){for(var n=0;n&lt;t.length;n++){var r=t[n];for(var i=0;i&lt;r.length;i++)b(e,r[i])}}var r=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(e){this.$session=e},this.add=function(e,t,n){if(this.$fromUndo)return;if(e==this.$lastDelta)return;this.$keepRedoStack||(this.$redoStack.length=0);if(t===!1||!this.lastDeltas)this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),e.id=this.$rev=++this.$maxRev;if(e.action==&quot;remove&quot;||e.action==&quot;insert&quot;)this.$lastDelta=e;this.lastDeltas.push(e)},this.addSelection=function(e,t){this.selections.push({value:e,rev:t||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(e,t){t==null&amp;&amp;(t=this.$rev+1);var n=this.$undoStack;for(var r=n.length;r--;){var i=n[r][0];if(i.id&lt;=e)break;i.id&lt;t&amp;&amp;(i.ignore=!0)}this.lastDeltas=null},this.getSelection=function(e,t){var n=this.selections;for(var r=n.length;r--;){var i=n[r];if(i.rev&lt;e)return t&amp;&amp;(i=n[r+1]),i}},this.getRevision=function(){return this.$rev},this.getDeltas=function(e,t){t==null&amp;&amp;(t=this.$rev+1);var n=this.$undoStack,r=null,i=0;for(var s=n.length;s--;){var o=n[s][0];o.id&lt;t&amp;&amp;!r&amp;&amp;(r=s+1);if(o.id&lt;=e){i=s+1;break}}return n.slice(i,r)},this.getChangedRanges=function(e,t){t==null&amp;&amp;(t=this.$rev+1)},this.getChangedLines=function(e,t){t==null&amp;&amp;(t=this.$rev+1)},this.validateDeltaBoundaries=function(e,t,n){return e?e.every(function(e){var r=e.action;n&amp;&amp;e.action===&quot;insert&quot;&amp;&amp;(r=&quot;remove&quot;),n&amp;&amp;e.action===&quot;remove&quot;&amp;&amp;(r=&quot;insert&quot;);switch(r){case&quot;insert&quot;:return e.start.row&lt;=t;case&quot;remove&quot;:return e.start.row&lt;t&amp;&amp;e.end.row&lt;t;default:return!0}}):!1},this.undo=function(e,t){this.lastDeltas=null;var n=this.$undoStack;if(!i(n,n.length))return;e||(e=this.$session),this.$redoStackBaseRev!==this.$rev&amp;&amp;this.$redoStack.length&amp;&amp;(this.$redoStack=[]),this.$fromUndo=!0;var r=n.pop(),s=null;return this.validateDeltaBoundaries(r,e.getLength(),!0)&amp;&amp;(s=e.undoChanges(r,t),this.$redoStack.push(r),this.$syncRev()),this.$fromUndo=!1,s},this.redo=function(e,t){this.lastDeltas=null,e||(e=this.$session),this.$fromUndo=!0;if(this.$redoStackBaseRev!=this.$rev){var n=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);w(this.$redoStack,n),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(e){e[0].id=++this.$maxRev},this)}var r=this.$redoStack.pop(),i=null;return this.validateDeltaBoundaries(r,e.getLength(),!1)&amp;&amp;(i=e.redoChanges(r,t),this.$undoStack.push(r),this.$syncRev()),this.$fromUndo=!1,i},this.$syncRev=function(){var e=this.$undoStack,t=e[e.length-1],n=t&amp;&amp;t[0].id||0;this.$redoStackBaseRev=n,this.$rev=n},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length&gt;0},this.canRedo=function(){return this.$redoStack.length&gt;0},this.bookmark=function(e){e==undefined&amp;&amp;(e=this.$rev),this.mark=e},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(e){return e?c(e):c(this.$undoStack)+&quot;\sn---\sn&quot;+c(this.$redoStack)}}).call(r.prototype);var s=e(&quot;./range&quot;).Range,o=s.comparePoints,u=s.comparePoints;t.UndoManager=r}),ace.define(&quot;ace/layer/lines&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/dom&quot;),i=function(e,t){this.element=e,this.canvasHeight=t||5e5,this.element.style.height=this.canvasHeight*2+&quot;px&quot;,this.cells=[],this.cellCache=[],this.$offsetCoefficient=0};(function(){this.moveContainer=function(e){r.translate(this.element,0,-(e.firstRowScreen*e.lineHeight%this.canvasHeight)-e.offset*this.$offsetCoefficient)},this.pageChanged=function(e,t){return Math.floor(e.firstRowScreen*e.lineHeight/this.canvasHeight)!==Math.floor(t.firstRowScreen*t.lineHeight/this.canvasHeight)},this.computeLineTop=function(e,t,n){var r=t.firstRowScreen*t.lineHeight,i=Math.floor(r/this.canvasHeight),s=n.documentToScreenRow(e,0)*t.lineHeight;return s-i*this.canvasHeight},this.computeLineHeight=function(e,t,n){return t.lineHeight*n.getRowLineCount(e)},this.getLength=function(){return this.cells.length},this.get=function(e){return this.cells[e]},this.shift=function(){this.$cacheCell(this.cells.shift())},this.pop=function(){this.$cacheCell(this.cells.pop())},this.push=function(e){if(Array.isArray(e)){this.cells.push.apply(this.cells,e);var t=r.createFragment(this.element);for(var n=0;n&lt;e.length;n++)t.appendChild(e[n].element);this.element.appendChild(t)}else this.cells.push(e),this.element.appendChild(e.element)},this.unshift=function(e){if(Array.isArray(e)){this.cells.unshift.apply(this.cells,e);var t=r.createFragment(this.element);for(var n=0;n&lt;e.length;n++)t.appendChild(e[n].element);this.element.firstChild?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}else this.cells.unshift(e),this.element.insertAdjacentElement(&quot;afterbegin&quot;,e.element)},this.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},this.$cacheCell=function(e){if(!e)return;e.element.remove(),this.cellCache.push(e)},this.createCell=function(e,t,n,i){var s=this.cellCache.pop();if(!s){var o=r.createElement(&quot;div&quot;);i&amp;&amp;i(o),this.element.appendChild(o),s={element:o,text:&quot;&quot;,row:e}}return s.row=e,s}}).call(i.prototype),t.Lines=i}),ace.define(&quot;ace/layer/gutter&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/layer/lines&quot;],function(e,t,n){&quot;use strict&quot;;function f(e){var t=document.createTextNode(&quot;&quot;);e.appendChild(t);var n=r.createElement(&quot;span&quot;);return e.appendChild(n),e}var r=e(&quot;../lib/dom&quot;),i=e(&quot;../lib/oop&quot;),s=e(&quot;../lib/lang&quot;),o=e(&quot;../lib/event_emitter&quot;).EventEmitter,u=e(&quot;./lines&quot;).Lines,a=function(e){this.element=r.createElement(&quot;div&quot;),this.element.className=&quot;ace_layer ace_gutter-layer&quot;,e.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new u(this.element),this.$lines.$offsetCoefficient=1};(function(){i.implement(this,o),this.setSession=function(e){this.session&amp;&amp;this.session.removeEventListener(&quot;change&quot;,this.$updateAnnotations),this.session=e,e&amp;&amp;e.on(&quot;change&quot;,this.$updateAnnotations)},this.addGutterDecoration=function(e,t){window.console&amp;&amp;console.warn&amp;&amp;console.warn(&quot;deprecated use session.addGutterDecoration&quot;),this.session.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){window.console&amp;&amp;console.warn&amp;&amp;console.warn(&quot;deprecated use session.removeGutterDecoration&quot;),this.session.removeGutterDecoration(e,t)},this.setAnnotations=function(e){this.$annotations=[];for(var t=0;t&lt;e.length;t++){var n=e[t],r=n.row,i=this.$annotations[r];i||(i=this.$annotations[r]={text:[]});var o=n.text;o=o?s.escapeHTML(o):n.html||&quot;&quot;,i.text.indexOf(o)===-1&amp;&amp;i.text.push(o);var u=n.type;u==&quot;error&quot;?i.className=&quot; ace_error&quot;:u==&quot;warning&quot;&amp;&amp;i.className!=&quot; ace_error&quot;?i.className=&quot; ace_warning&quot;:u==&quot;info&quot;&amp;&amp;!i.className&amp;&amp;(i.className=&quot; ace_info&quot;)}},this.$updateAnnotations=function(e){if(!this.$annotations.length)return;var t=e.start.row,n=e.end.row-t;if(n!==0)if(e.action==&quot;remove&quot;)this.$annotations.splice(t,n+1,null);else{var r=new Array(n+1);r.unshift(t,1),this.$annotations.splice.apply(this.$annotations,r)}},this.update=function(e){this.config=e;var t=this.session,n=e.firstRow,r=Math.min(e.lastRow+e.gutterOffset,t.getLength()-1);this.oldLastRow=r,this.config=e,this.$lines.moveContainer(e),this.$updateCursorRow();var i=t.getNextFoldLine(n),s=i?i.start.row:Infinity,o=null,u=-1,a=n;for(;;){a&gt;s&amp;&amp;(a=i.end.row+1,i=t.getNextFoldLine(a,i),s=i?i.start.row:Infinity);if(a&gt;r){while(this.$lines.getLength()&gt;u+1)this.$lines.pop();break}o=this.$lines.get(++u),o?o.row=a:(o=this.$lines.createCell(a,e,this.session,f),this.$lines.push(o)),this.$renderCell(o,e,i,a),a++}this._signal(&quot;afterRender&quot;),this.$updateGutterWidth(e)},this.$updateGutterWidth=function(e){var t=this.session,n=t.gutterRenderer||this.$renderer,r=t.$firstLineNumber,i=this.$lines.last()?this.$lines.last().text:&quot;&quot;;if(this.$fixedWidth||t.$useWrapMode)i=t.getLength()+r-1;var s=n?n.getWidth(t,i,e):i.toString().length*e.characterWidth,o=this.$padding||this.$computePadding();s+=o.left+o.right,s!==this.gutterWidth&amp;&amp;!isNaN(s)&amp;&amp;(this.gutterWidth=s,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+&quot;px&quot;,this._signal(&quot;changeGutterWidth&quot;,s))},this.$updateCursorRow=function(){if(!this.$highlightGutterLine)return;var e=this.session.selection.getCursor();if(this.$cursorRow===e.row)return;this.$cursorRow=e.row},this.updateLineHighlight=function(){if(!this.$highlightGutterLine)return;var e=this.session.selection.cursor.row;this.$cursorRow=e;if(this.$cursorCell&amp;&amp;this.$cursorCell.row==e)return;this.$cursorCell&amp;&amp;(this.$cursorCell.element.className=this.$cursorCell.element.className.replace(&quot;ace_gutter-active-line &quot;,&quot;&quot;));var t=this.$lines.cells;this.$cursorCell=null;for(var n=0;n&lt;t.length;n++){var r=t[n];if(r.row&gt;=this.$cursorRow){if(r.row&gt;this.$cursorRow){var i=this.session.getFoldLine(this.$cursorRow);if(!(n&gt;0&amp;&amp;i&amp;&amp;i.start.row==t[n-1].row))break;r=t[n-1]}r.element.className=&quot;ace_gutter-active-line &quot;+r.element.className,this.$cursorCell=r;break}}},this.scrollLines=function(e){var t=this.config;this.config=e,this.$updateCursorRow();if(this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=Math.min(e.lastRow+e.gutterOffset,this.session.getLength()-1),r=this.oldLastRow;this.oldLastRow=n;if(!t||r&lt;e.firstRow)return this.update(e);if(n&lt;t.firstRow)return this.update(e);if(t.firstRow&lt;e.firstRow)for(var i=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);i&gt;0;i--)this.$lines.shift();if(r&gt;n)for(var i=this.session.getFoldedRowCount(n+1,r);i&gt;0;i--)this.$lines.pop();e.firstRow&lt;t.firstRow&amp;&amp;this.$lines.unshift(this.$renderLines(e,e.firstRow,t.firstRow-1)),n&gt;r&amp;&amp;this.$lines.push(this.$renderLines(e,r+1,n)),this.updateLineHighlight(),this._signal(&quot;afterRender&quot;),this.$updateGutterWidth(e)},this.$renderLines=function(e,t,n){var r=[],i=t,s=this.session.getNextFoldLine(i),o=s?s.start.row:Infinity;for(;;){i&gt;o&amp;&amp;(i=s.end.row+1,s=this.session.getNextFoldLine(i,s),o=s?s.start.row:Infinity);if(i&gt;n)break;var u=this.$lines.createCell(i,e,this.session,f);this.$renderCell(u,e,s,i),r.push(u),i++}return r},this.$renderCell=function(e,t,n,i){var s=e.element,o=this.session,u=s.childNodes[0],a=s.childNodes[1],f=o.$firstLineNumber,l=o.$breakpoints,c=o.$decorations,h=o.gutterRenderer||this.$renderer,p=this.$showFoldWidgets&amp;&amp;o.foldWidgets,d=n?n.start.row:Number.MAX_VALUE,v=&quot;ace_gutter-cell &quot;;this.$highlightGutterLine&amp;&amp;(i==this.$cursorRow||n&amp;&amp;i&lt;this.$cursorRow&amp;&amp;i&gt;=d&amp;&amp;this.$cursorRow&lt;=n.end.row)&amp;&amp;(v+=&quot;ace_gutter-active-line &quot;,this.$cursorCell!=e&amp;&amp;(this.$cursorCell&amp;&amp;(this.$cursorCell.element.className=this.$cursorCell.element.className.replace(&quot;ace_gutter-active-line &quot;,&quot;&quot;)),this.$cursorCell=e)),l[i]&amp;&amp;(v+=l[i]),c[i]&amp;&amp;(v+=c[i]),this.$annotations[i]&amp;&amp;(v+=this.$annotations[i].className),s.className!=v&amp;&amp;(s.className=v);if(p){var m=p[i];m==null&amp;&amp;(m=p[i]=o.getFoldWidget(i))}if(m){var v=&quot;ace_fold-widget ace_&quot;+m;m==&quot;start&quot;&amp;&amp;i==d&amp;&amp;i&lt;n.end.row?v+=&quot; ace_closed&quot;:v+=&quot; ace_open&quot;,a.className!=v&amp;&amp;(a.className=v);var g=t.lineHeight+&quot;px&quot;;r.setStyle(a.style,&quot;height&quot;,g),r.setStyle(a.style,&quot;display&quot;,&quot;inline-block&quot;)}else a&amp;&amp;r.setStyle(a.style,&quot;display&quot;,&quot;none&quot;);var y=(h?h.getText(o,i):i+f).toString();return y!==u.data&amp;&amp;(u.data=y),r.setStyle(e.element.style,&quot;height&quot;,this.$lines.computeLineHeight(i,t,o)+&quot;px&quot;),r.setStyle(e.element.style,&quot;top&quot;,this.$lines.computeLineTop(i,t,o)+&quot;px&quot;),e.text=y,e},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer=&quot;&quot;,this.setHighlightGutterLine=function(e){this.$highlightGutterLine=e},this.$showLineNumbers=!0,this.$renderer=&quot;&quot;,this.setShowLineNumbers=function(e){this.$renderer=!e&amp;&amp;{getWidth:function(){return 0},getText:function(){return&quot;&quot;}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(e){e?r.addCssClass(this.element,&quot;ace_folding-enabled&quot;):r.removeCssClass(this.element,&quot;ace_folding-enabled&quot;),this.$showFoldWidgets=e,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var e=r.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(e.borderLeftWidth)||0)+(parseInt(e.paddingLeft)||0)+1,this.$padding.right=(parseInt(e.borderRightWidth)||0)+(parseInt(e.paddingRight)||0),this.$padding},this.getRegion=function(e){var t=this.$padding||this.$computePadding(),n=this.element.getBoundingClientRect();if(e.x&lt;t.left+n.left)return&quot;markers&quot;;if(this.$showFoldWidgets&amp;&amp;e.x&gt;n.right-t.right)return&quot;foldWidgets&quot;}}).call(a.prototype),t.Gutter=a}),ace.define(&quot;ace/layer/marker&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../range&quot;).Range,i=e(&quot;../lib/dom&quot;),s=function(e){this.element=i.createElement(&quot;div&quot;),this.element.className=&quot;ace_layer ace_marker-layer&quot;,e.appendChild(this.element)};(function(){function e(e,t,n,r){return(e?1:0)|(t?2:0)|(n?4:0)|(r?8:0)}this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setMarkers=function(e){this.markers=e},this.elt=function(e,t){var n=this.i!=-1&amp;&amp;this.element.childNodes[this.i];n?this.i++:(n=document.createElement(&quot;div&quot;),this.element.appendChild(n),this.i=-1),n.style.cssText=t,n.className=e},this.update=function(e){if(!e)return;this.config=e,this.i=0;var t;for(var n in this.markers){var r=this.markers[n];if(!r.range){r.update(t,this,this.session,e);continue}var i=r.range.clipRows(e.firstRow,e.lastRow);if(i.isEmpty())continue;i=i.toScreenRange(this.session);if(r.renderer){var s=this.$getTop(i.start.row,e),o=this.$padding+i.start.column*e.characterWidth;r.renderer(t,i,o,s,e)}else r.type==&quot;fullLine&quot;?this.drawFullLineMarker(t,i,r.clazz,e):r.type==&quot;screenLine&quot;?this.drawScreenLineMarker(t,i,r.clazz,e):i.isMultiLine()?r.type==&quot;text&quot;?this.drawTextMarker(t,i,r.clazz,e):this.drawMultiLineMarker(t,i,r.clazz,e):this.drawSingleLineMarker(t,i,r.clazz+&quot; ace_start&quot;+&quot; ace_br15&quot;,e)}if(this.i!=-1)while(this.i&lt;this.element.childElementCount)this.element.removeChild(this.element.lastChild)},this.$getTop=function(e,t){return(e-t.firstRowScreen)*t.lineHeight},this.drawTextMarker=function(t,n,i,s,o){var u=this.session,a=n.start.row,f=n.end.row,l=a,c=0,h=0,p=u.getScreenLastRowColumn(l),d=new r(l,n.start.column,l,h);for(;l&lt;=f;l++)d.start.row=d.end.row=l,d.start.column=l==a?n.start.column:u.getRowWrapIndent(l),d.end.column=p,c=h,h=p,p=l+1&lt;f?u.getScreenLastRowColumn(l+1):l==f?0:n.end.column,this.drawSingleLineMarker(t,d,i+(l==a?&quot; ace_start&quot;:&quot;&quot;)+&quot; ace_br&quot;+e(l==a||l==a+1&amp;&amp;n.start.column,c&lt;h,h&gt;p,l==f),s,l==f?0:1,o)},this.drawMultiLineMarker=function(e,t,n,r,i){var s=this.$padding,o=r.lineHeight,u=this.$getTop(t.start.row,r),a=s+t.start.column*r.characterWidth;i=i||&quot;&quot;;if(this.session.$bidiHandler.isBidiRow(t.start.row)){var f=t.clone();f.end.row=f.start.row,f.end.column=this.session.getLine(f.start.row).length,this.drawBidiSingleLineMarker(e,f,n+&quot; ace_br1 ace_start&quot;,r,null,i)}else this.elt(n+&quot; ace_br1 ace_start&quot;,&quot;height:&quot;+o+&quot;px;&quot;+&quot;right:0;&quot;+&quot;top:&quot;+u+&quot;px;left:&quot;+a+&quot;px;&quot;+(i||&quot;&quot;));if(this.session.$bidiHandler.isBidiRow(t.end.row)){var f=t.clone();f.start.row=f.end.row,f.start.column=0,this.drawBidiSingleLineMarker(e,f,n+&quot; ace_br12&quot;,r,null,i)}else{u=this.$getTop(t.end.row,r);var l=t.end.column*r.characterWidth;this.elt(n+&quot; ace_br12&quot;,&quot;height:&quot;+o+&quot;px;&quot;+&quot;width:&quot;+l+&quot;px;&quot;+&quot;top:&quot;+u+&quot;px;&quot;+&quot;left:&quot;+s+&quot;px;&quot;+(i||&quot;&quot;))}o=(t.end.row-t.start.row-1)*r.lineHeight;if(o&lt;=0)return;u=this.$getTop(t.start.row+1,r);var c=(t.start.column?1:0)|(t.end.column?0:8);this.elt(n+(c?&quot; ace_br&quot;+c:&quot;&quot;),&quot;height:&quot;+o+&quot;px;&quot;+&quot;right:0;&quot;+&quot;top:&quot;+u+&quot;px;&quot;+&quot;left:&quot;+s+&quot;px;&quot;+(i||&quot;&quot;))},this.drawSingleLineMarker=function(e,t,n,r,i,s){if(this.session.$bidiHandler.isBidiRow(t.start.row))return this.drawBidiSingleLineMarker(e,t,n,r,i,s);var o=r.lineHeight,u=(t.end.column+(i||0)-t.start.column)*r.characterWidth,a=this.$getTop(t.start.row,r),f=this.$padding+t.start.column*r.characterWidth;this.elt(n,&quot;height:&quot;+o+&quot;px;&quot;+&quot;width:&quot;+u+&quot;px;&quot;+&quot;top:&quot;+a+&quot;px;&quot;+&quot;left:&quot;+f+&quot;px;&quot;+(s||&quot;&quot;))},this.drawBidiSingleLineMarker=function(e,t,n,r,i,s){var o=r.lineHeight,u=this.$getTop(t.start.row,r),a=this.$padding,f=this.session.$bidiHandler.getSelections(t.start.column,t.end.column);f.forEach(function(e){this.elt(n,&quot;height:&quot;+o+&quot;px;&quot;+&quot;width:&quot;+e.width+(i||0)+&quot;px;&quot;+&quot;top:&quot;+u+&quot;px;&quot;+&quot;left:&quot;+(a+e.left)+&quot;px;&quot;+(s||&quot;&quot;))},this)},this.drawFullLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;t.start.row!=t.end.row&amp;&amp;(o+=this.$getTop(t.end.row,r)-s),this.elt(n,&quot;height:&quot;+o+&quot;px;&quot;+&quot;top:&quot;+s+&quot;px;&quot;+&quot;left:0;right:0;&quot;+(i||&quot;&quot;))},this.drawScreenLineMarker=function(e,t,n,r,i){var s=this.$getTop(t.start.row,r),o=r.lineHeight;this.elt(n,&quot;height:&quot;+o+&quot;px;&quot;+&quot;top:&quot;+s+&quot;px;&quot;+&quot;left:0;right:0;&quot;+(i||&quot;&quot;))}}).call(s.prototype),t.Marker=s}),ace.define(&quot;ace/layer/text&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/lang&quot;,&quot;ace/layer/lines&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/oop&quot;),i=e(&quot;../lib/dom&quot;),s=e(&quot;../lib/lang&quot;),o=e(&quot;./lines&quot;).Lines,u=e(&quot;../lib/event_emitter&quot;).EventEmitter,a=function(e){this.dom=i,this.element=this.dom.createElement(&quot;div&quot;),this.element.className=&quot;ace_layer ace_text-layer&quot;,e.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new o(this.element)};(function(){r.implement(this,u),this.EOF_CHAR=&quot;\su00b6&quot;,this.EOL_CHAR_LF=&quot;\su00ac&quot;,this.EOL_CHAR_CRLF=&quot;\su00a4&quot;,this.EOL_CHAR=this.EOL_CHAR_LF,this.TAB_CHAR=&quot;\su2014&quot;,this.SPACE_CHAR=&quot;\su00b7&quot;,this.$padding=0,this.MAX_LINE_LENGTH=1e4,this.$updateEolChar=function(){var e=this.session.doc,t=e.getNewLineCharacter()==&quot;\sn&quot;&amp;&amp;e.getNewLineMode()!=&quot;windows&quot;,n=t?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=n)return this.EOL_CHAR=n,!0},this.setPadding=function(e){this.$padding=e,this.element.style.margin=&quot;0 &quot;+e+&quot;px&quot;},this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},this.$setFontMetrics=function(e){this.$fontMetrics=e,this.$fontMetrics.on(&quot;changeCharacterSize&quot;,function(e){this._signal(&quot;changeCharacterSize&quot;,e)}.bind(this)),this.$pollSizeChanges()},this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},this.setSession=function(e){this.session=e,e&amp;&amp;this.$computeTabString()},this.showInvisibles=!1,this.setShowInvisibles=function(e){return this.showInvisibles==e?!1:(this.showInvisibles=e,this.$computeTabString(),!0)},this.displayIndentGuides=!0,this.setDisplayIndentGuides=function(e){return this.displayIndentGuides==e?!1:(this.displayIndentGuides=e,this.$computeTabString(),!0)},this.$tabStrings=[],this.onChangeTabSize=this.$computeTabString=function(){var e=this.session.getTabSize();this.tabSize=e;var t=this.$tabStrings=[0];for(var n=1;n&lt;e+1;n++)if(this.showInvisibles){var r=this.dom.createElement(&quot;span&quot;);r.className=&quot;ace_invisible ace_invisible_tab&quot;,r.textContent=s.stringRepeat(this.TAB_CHAR,n),t.push(r)}else t.push(this.dom.createTextNode(s.stringRepeat(&quot; &quot;,n),this.element));if(this.displayIndentGuides){this.$indentGuideRe=/\ss\sS| \st|\st |\ss$/;var i=&quot;ace_indent-guide&quot;,o=&quot;&quot;,u=&quot;&quot;;if(this.showInvisibles){i+=&quot; ace_invisible&quot;,o=&quot; ace_invisible_space&quot;,u=&quot; ace_invisible_tab&quot;;var a=s.stringRepeat(this.SPACE_CHAR,this.tabSize),f=s.stringRepeat(this.TAB_CHAR,this.tabSize)}else var a=s.stringRepeat(&quot; &quot;,this.tabSize),f=a;var r=this.dom.createElement(&quot;span&quot;);r.className=i+o,r.textContent=a,this.$tabStrings[&quot; &quot;]=r;var r=this.dom.createElement(&quot;span&quot;);r.className=i+u,r.textContent=f,this.$tabStrings[&quot;	&quot;]=r}},this.updateLines=function(e,t,n){if(this.config.lastRow!=e.lastRow||this.config.firstRow!=e.firstRow)return this.update(e);this.config=e;var r=Math.max(t,e.firstRow),i=Math.min(n,e.lastRow),s=this.element.childNodes,o=0;for(var u=e.firstRow;u&lt;r;u++){var a=this.session.getFoldLine(u);if(a){if(a.containsRow(r)){r=a.start.row;break}u=a.end.row}o++}var f=!1,u=r,a=this.session.getNextFoldLine(u),l=a?a.start.row:Infinity;for(;;){u&gt;l&amp;&amp;(u=a.end.row+1,a=this.session.getNextFoldLine(u,a),l=a?a.start.row:Infinity);if(u&gt;i)break;var c=s[o++];if(c){this.dom.removeChildren(c),this.$renderLine(c,u,u==l?a:!1),f&amp;&amp;(c.style.top=this.$lines.computeLineTop(u,e,this.session)+&quot;px&quot;);var h=e.lineHeight*this.session.getRowLength(u)+&quot;px&quot;;c.style.height!=h&amp;&amp;(f=!0,c.style.height=h)}u++}if(f)while(o&lt;this.$lines.cells.length){var p=this.$lines.cells[o++];p.element.style.top=this.$lines.computeLineTop(p.row,e,this.session)+&quot;px&quot;}},this.scrollLines=function(e){var t=this.config;this.config=e;if(this.$lines.pageChanged(t,e))return this.update(e);this.$lines.moveContainer(e);var n=e.lastRow,r=t?t.lastRow:-1;if(!t||r&lt;e.firstRow)return this.update(e);if(n&lt;t.firstRow)return this.update(e);if(!t||t.lastRow&lt;e.firstRow)return this.update(e);if(e.lastRow&lt;t.firstRow)return this.update(e);if(t.firstRow&lt;e.firstRow)for(var i=this.session.getFoldedRowCount(t.firstRow,e.firstRow-1);i&gt;0;i--)this.$lines.shift();if(t.lastRow&gt;e.lastRow)for(var i=this.session.getFoldedRowCount(e.lastRow+1,t.lastRow);i&gt;0;i--)this.$lines.pop();e.firstRow&lt;t.firstRow&amp;&amp;this.$lines.unshift(this.$renderLinesFragment(e,e.firstRow,t.firstRow-1)),e.lastRow&gt;t.lastRow&amp;&amp;this.$lines.push(this.$renderLinesFragment(e,t.lastRow+1,e.lastRow))},this.$renderLinesFragment=function(e,t,n){var r=[],s=t,o=this.session.getNextFoldLine(s),u=o?o.start.row:Infinity;for(;;){s&gt;u&amp;&amp;(s=o.end.row+1,o=this.session.getNextFoldLine(s,o),u=o?o.start.row:Infinity);if(s&gt;n)break;var a=this.$lines.createCell(s,e,this.session),f=a.element;this.dom.removeChildren(f),i.setStyle(f.style,&quot;height&quot;,this.$lines.computeLineHeight(s,e,this.session)+&quot;px&quot;),i.setStyle(f.style,&quot;top&quot;,this.$lines.computeLineTop(s,e,this.session)+&quot;px&quot;),this.$renderLine(f,s,s==u?o:!1),this.$useLineGroups()?f.className=&quot;ace_line_group&quot;:f.className=&quot;ace_line&quot;,r.push(a),s++}return r},this.update=function(e){this.$lines.moveContainer(e),this.config=e;var t=e.firstRow,n=e.lastRow,r=this.$lines;while(r.getLength())r.pop();r.push(this.$renderLinesFragment(e,t,n))},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderToken=function(e,t,n,r){var i=this,o=/(\st)|( +)|([\sx00-\sx1f\sx80-\sxa0\sxad\su1680\su180E\su2000-\su200f\su2028\su2029\su202F\su205F\suFEFF\suFFF9-\suFFFC]+)|(\su3000)|([\su1100-\su115F\su11A3-\su11A7\su11FA-\su11FF\su2329-\su232A\su2E80-\su2E99\su2E9B-\su2EF3\su2F00-\su2FD5\su2FF0-\su2FFB\su3001-\su303E\su3041-\su3096\su3099-\su30FF\su3105-\su312D\su3131-\su318E\su3190-\su31BA\su31C0-\su31E3\su31F0-\su321E\su3220-\su3247\su3250-\su32FE\su3300-\su4DBF\su4E00-\suA48C\suA490-\suA4C6\suA960-\suA97C\suAC00-\suD7A3\suD7B0-\suD7C6\suD7CB-\suD7FB\suF900-\suFAFF\suFE10-\suFE19\suFE30-\suFE52\suFE54-\suFE66\suFE68-\suFE6B\suFF01-\suFF60\suFFE0-\suFFE6]|[\suD800-\suDBFF][\suDC00-\suDFFF])/g,u=this.dom.createFragment(this.element),a,f=0;while(a=o.exec(r)){var l=a[1],c=a[2],h=a[3],p=a[4],d=a[5];if(!i.showInvisibles&amp;&amp;c)continue;var v=f!=a.index?r.slice(f,a.index):&quot;&quot;;f=a.index+a[0].length,v&amp;&amp;u.appendChild(this.dom.createTextNode(v,this.element));if(l){var m=i.session.getScreenTabSize(t+a.index);u.appendChild(i.$tabStrings[m].cloneNode(!0)),t+=m-1}else if(c)if(i.showInvisibles){var g=this.dom.createElement(&quot;span&quot;);g.className=&quot;ace_invisible ace_invisible_space&quot;,g.textContent=s.stringRepeat(i.SPACE_CHAR,c.length),u.appendChild(g)}else u.appendChild(this.com.createTextNode(c,this.element));else if(h){var g=this.dom.createElement(&quot;span&quot;);g.className=&quot;ace_invisible ace_invisible_space ace_invalid&quot;,g.textContent=s.stringRepeat(i.SPACE_CHAR,h.length),u.appendChild(g)}else if(p){t+=1;var g=this.dom.createElement(&quot;span&quot;);g.style.width=i.config.characterWidth*2+&quot;px&quot;,g.className=i.showInvisibles?&quot;ace_cjk ace_invisible ace_invisible_space&quot;:&quot;ace_cjk&quot;,g.textContent=i.showInvisibles?i.SPACE_CHAR:p,u.appendChild(g)}else if(d){t+=1;var g=this.dom.createElement(&quot;span&quot;);g.style.width=i.config.characterWidth*2+&quot;px&quot;,g.className=&quot;ace_cjk&quot;,g.textContent=d,u.appendChild(g)}}u.appendChild(this.dom.createTextNode(f?r.slice(f):r,this.element));if(!this.$textToken[n.type]){var y=&quot;ace_&quot;+n.type.replace(/\s./g,&quot; ace_&quot;),g=this.dom.createElement(&quot;span&quot;);n.type==&quot;fold&quot;&amp;&amp;(g.style.width=n.value.length*this.config.characterWidth+&quot;px&quot;),g.className=y,g.appendChild(u),e.appendChild(g)}else e.appendChild(u);return t+r.length},this.renderIndentGuide=function(e,t,n){var r=t.search(this.$indentGuideRe);if(r&lt;=0||r&gt;=n)return t;if(t[0]==&quot; &quot;){r-=r%this.tabSize;var i=r/this.tabSize;for(var s=0;s&lt;i;s++)e.appendChild(this.$tabStrings[&quot; &quot;].cloneNode(!0));return t.substr(r)}if(t[0]==&quot;	&quot;){for(var s=0;s&lt;r;s++)e.appendChild(this.$tabStrings[&quot;	&quot;].cloneNode(!0));return t.substr(r)}return t},this.$createLineElement=function(e){var t=this.dom.createElement(&quot;div&quot;);return t.className=&quot;ace_line&quot;,t.style.height=this.config.lineHeight+&quot;px&quot;,t},this.$renderWrappedLine=function(e,t,n){var r=0,i=0,o=n[0],u=0,a=this.$createLineElement();e.appendChild(a);for(var f=0;f&lt;t.length;f++){var l=t[f],c=l.value;if(f==0&amp;&amp;this.displayIndentGuides){r=c.length,c=this.renderIndentGuide(a,c,o);if(!c)continue;r-=c.length}if(r+c.length&lt;o)u=this.$renderToken(a,u,l,c),r+=c.length;else{while(r+c.length&gt;=o)u=this.$renderToken(a,u,l,c.substring(0,o-r)),c=c.substring(o-r),r=o,a=this.$createLineElement(),e.appendChild(a),a.appendChild(this.dom.createTextNode(s.stringRepeat(&quot;\su00a0&quot;,n.indent),this.element)),i++,u=0,o=n[i]||Number.MAX_VALUE;c.length!=0&amp;&amp;(r+=c.length,u=this.$renderToken(a,u,l,c))}}n[n.length-1]&gt;this.MAX_LINE_LENGTH&amp;&amp;this.$renderOverflowMessage(a,u,null,&quot;&quot;,!0)},this.$renderSimpleLine=function(e,t){var n=0,r=t[0],i=r.value;this.displayIndentGuides&amp;&amp;(i=this.renderIndentGuide(e,i)),i&amp;&amp;(n=this.$renderToken(e,n,r,i));for(var s=1;s&lt;t.length;s++){r=t[s],i=r.value;if(n+i.length&gt;this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(e,n,r,i);n=this.$renderToken(e,n,r,i)}},this.$renderOverflowMessage=function(e,t,n,r,i){n&amp;&amp;this.$renderToken(e,t,n,r.slice(0,this.MAX_LINE_LENGTH-t));var s=this.dom.createElement(&quot;span&quot;);s.className=&quot;ace_inline_button ace_keyword ace_toggle_wrap&quot;,s.textContent=i?&quot;&lt;hide&gt;&quot;:&quot;&lt;click to see more...&gt;&quot;,e.appendChild(s)},this.$renderLine=function(e,t,n){!n&amp;&amp;n!=0&amp;&amp;(n=this.session.getFoldLine(t));if(n)var r=this.$getFoldLineTokens(t,n);else var r=this.session.getTokens(t);var i=e;if(r.length){var s=this.session.getRowSplitData(t);if(s&amp;&amp;s.length){this.$renderWrappedLine(e,r,s);var i=e.lastChild}else{var i=e;this.$useLineGroups()&amp;&amp;(i=this.$createLineElement(),e.appendChild(i)),this.$renderSimpleLine(i,r)}}else this.$useLineGroups()&amp;&amp;(i=this.$createLineElement(),e.appendChild(i));if(this.showInvisibles&amp;&amp;i){n&amp;&amp;(t=n.end.row);var o=this.dom.createElement(&quot;span&quot;);o.className=&quot;ace_invisible ace_invisible_eol&quot;,o.textContent=t==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,i.appendChild(o)}},this.$getFoldLineTokens=function(e,t){function i(e,t,n){var i=0,s=0;while(s+e[i].value.length&lt;t){s+=e[i].value.length,i++;if(i==e.length)return}if(s!=t){var o=e[i].value.substring(t-s);o.length&gt;n-t&amp;&amp;(o=o.substring(0,n-t)),r.push({type:e[i].type,value:o}),s=t+o.length,i+=1}while(s&lt;n&amp;&amp;i&lt;e.length){var o=e[i].value;o.length+s&gt;n?r.push({type:e[i].type,value:o.substring(0,n-s)}):r.push(e[i]),s+=o.length,i+=1}}var n=this.session,r=[],s=n.getTokens(e);return t.walk(function(e,t,o,u,a){e!=null?r.push({type:&quot;fold&quot;,value:e}):(a&amp;&amp;(s=n.getTokens(t)),s.length&amp;&amp;i(s,u,o))},t.end.row,this.session.getLine(t.end.row).length),r},this.$useLineGroups=function(){return this.session.getUseWrapMode()},this.destroy=function(){}}).call(a.prototype),t.Text=a}),ace.define(&quot;ace/layer/cursor&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/dom&quot;),i=function(e){this.element=r.createElement(&quot;div&quot;),this.element.className=&quot;ace_layer ace_cursor-layer&quot;,e.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),r.addCssClass(this.element,&quot;ace_hidden-cursors&quot;),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(e){var t=this.cursors;for(var n=t.length;n--;)r.setStyle(t[n].style,&quot;opacity&quot;,e?&quot;&quot;:&quot;0&quot;)},this.$startCssAnimation=function(){var e=this.cursors;for(var t=e.length;t--;)e[t].style.animationDuration=this.blinkInterval+&quot;ms&quot;;setTimeout(function(){r.addCssClass(this.element,&quot;ace_animate-blinking&quot;)}.bind(this))},this.$stopCssAnimation=function(){r.removeCssClass(this.element,&quot;ace_animate-blinking&quot;)},this.$padding=0,this.setPadding=function(e){this.$padding=e},this.setSession=function(e){this.session=e},this.setBlinking=function(e){e!=this.isBlinking&amp;&amp;(this.isBlinking=e,this.restartTimer())},this.setBlinkInterval=function(e){e!=this.blinkInterval&amp;&amp;(this.blinkInterval=e,this.restartTimer())},this.setSmoothBlinking=function(e){e!=this.smoothBlinking&amp;&amp;(this.smoothBlinking=e,r.setCssClass(this.element,&quot;ace_smooth-blinking&quot;,e),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var e=r.createElement(&quot;div&quot;);return e.className=&quot;ace_cursor&quot;,this.element.appendChild(e),this.cursors.push(e),e},this.removeCursor=function(){if(this.cursors.length&gt;1){var e=this.cursors.pop();return e.parentNode.removeChild(e),e}},this.hideCursor=function(){this.isVisible=!1,r.addCssClass(this.element,&quot;ace_hidden-cursors&quot;),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,r.removeCssClass(this.element,&quot;ace_hidden-cursors&quot;),this.restartTimer()},this.restartTimer=function(){var e=this.$updateCursors;clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&amp;&amp;r.removeCssClass(this.element,&quot;ace_smooth-blinking&quot;),e(!0);if(!this.isBlinking||!this.blinkInterval||!this.isVisible){this.$stopCssAnimation();return}this.smoothBlinking&amp;&amp;setTimeout(function(){r.addCssClass(this.element,&quot;ace_smooth-blinking&quot;)}.bind(this));if(r.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var t=function(){this.timeoutId=setTimeout(function(){e(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){e(!0),t()},this.blinkInterval),t()}},this.getPixelPosition=function(e,t){if(!this.config||!this.session)return{left:0,top:0};e||(e=this.session.selection.getCursor());var n=this.session.documentToScreenPosition(e),r=this.$padding+(this.session.$bidiHandler.isBidiRow(n.row,e.row)?this.session.$bidiHandler.getPosLeft(n.column):n.column*this.config.characterWidth),i=(n.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:r,top:i}},this.isCursorInView=function(e,t){return e.top&gt;=0&amp;&amp;e.top&lt;t.maxHeight},this.update=function(e){this.config=e;var t=this.session.$selectionMarkers,n=0,i=0;if(t===undefined||t.length===0)t=[{cursor:null}];for(var n=0,s=t.length;n&lt;s;n++){var o=this.getPixelPosition(t[n].cursor,!0);if((o.top&gt;e.height+e.offset||o.top&lt;0)&amp;&amp;n&gt;1)continue;var u=this.cursors[i++]||this.addCursor(),a=u.style;this.drawCursor?this.drawCursor(u,o,e,t[n],this.session):this.isCursorInView(o,e)?(r.setStyle(a,&quot;display&quot;,&quot;block&quot;),r.translate(u,o.left,o.top),r.setStyle(a,&quot;width&quot;,Math.round(e.characterWidth)+&quot;px&quot;),r.setStyle(a,&quot;height&quot;,e.lineHeight+&quot;px&quot;)):r.setStyle(a,&quot;display&quot;,&quot;none&quot;)}while(this.cursors.length&gt;i)this.removeCursor();var f=this.session.getOverwrite();this.$setOverwrite(f),this.$pixelPos=o,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(e){e!=this.overwrite&amp;&amp;(this.overwrite=e,e?r.addCssClass(this.element,&quot;ace_overwrite-cursors&quot;):r.removeCssClass(this.element,&quot;ace_overwrite-cursors&quot;))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(i.prototype),t.Cursor=i}),ace.define(&quot;ace/scrollbar&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/dom&quot;),s=e(&quot;./lib/event&quot;),o=e(&quot;./lib/event_emitter&quot;).EventEmitter,u=32768,a=function(e){this.element=i.createElement(&quot;div&quot;),this.element.className=&quot;ace_scrollbar ace_scrollbar&quot;+this.classSuffix,this.inner=i.createElement(&quot;div&quot;),this.inner.className=&quot;ace_scrollbar-inner&quot;,this.inner.textContent=&quot;\su00a0&quot;,this.element.appendChild(this.inner),e.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,s.addListener(this.element,&quot;scroll&quot;,this.onScroll.bind(this)),s.addListener(this.element,&quot;mousedown&quot;,s.preventDefault)};(function(){r.implement(this,o),this.setVisible=function(e){this.element.style.display=e?&quot;&quot;:&quot;none&quot;,this.isVisible=e,this.coeff=1}}).call(a.prototype);var f=function(e,t){a.call(this,e),this.scrollTop=0,this.scrollHeight=0,t.$scrollbarWidth=this.width=i.scrollbarWidth(e.ownerDocument),this.inner.style.width=this.element.style.width=(this.width||15)+5+&quot;px&quot;,this.$minWidth=0};r.inherits(f,a),function(){this.classSuffix=&quot;-v&quot;,this.onScroll=function(){if(!this.skipEvent){this.scrollTop=this.element.scrollTop;if(this.coeff!=1){var e=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-e)/(this.coeff-e)}this._emit(&quot;scroll&quot;,{data:this.scrollTop})}this.skipEvent=!1},this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},this.setHeight=function(e){this.element.style.height=e+&quot;px&quot;},this.setInnerHeight=this.setScrollHeight=function(e){this.scrollHeight=e,e&gt;u?(this.coeff=u/e,e=u):this.coeff!=1&amp;&amp;(this.coeff=1),this.inner.style.height=e+&quot;px&quot;},this.setScrollTop=function(e){this.scrollTop!=e&amp;&amp;(this.skipEvent=!0,this.scrollTop=e,this.element.scrollTop=e*this.coeff)}}.call(f.prototype);var l=function(e,t){a.call(this,e),this.scrollLeft=0,this.height=t.$scrollbarWidth,this.inner.style.height=this.element.style.height=(this.height||15)+5+&quot;px&quot;};r.inherits(l,a),function(){this.classSuffix=&quot;-h&quot;,this.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit(&quot;scroll&quot;,{data:this.scrollLeft})),this.skipEvent=!1},this.getHeight=function(){return this.isVisible?this.height:0},this.setWidth=function(e){this.element.style.width=e+&quot;px&quot;},this.setInnerWidth=function(e){this.inner.style.width=e+&quot;px&quot;},this.setScrollWidth=function(e){this.inner.style.width=e+&quot;px&quot;},this.setScrollLeft=function(e){this.scrollLeft!=e&amp;&amp;(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=e)}}.call(l.prototype),t.ScrollBar=f,t.ScrollBarV=f,t.ScrollBarH=l,t.VScrollBar=f,t.HScrollBar=l}),ace.define(&quot;ace/renderloop&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/event&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/event&quot;),i=function(e,t){this.onRender=e,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=t||window;var n=this;this._flush=function(e){n.pending=!1;var t=n.changes;t&amp;&amp;(r.blockIdle(100),n.changes=0,n.onRender(t));if(n.changes){if(n.$recursionLimit--&lt;0)return;n.schedule()}else n.$recursionLimit=2}};(function(){this.schedule=function(e){this.changes=this.changes|e,this.changes&amp;&amp;!this.pending&amp;&amp;(r.nextFrame(this._flush),this.pending=!0)},this.clear=function(e){var t=this.changes;return this.changes=0,t}}).call(i.prototype),t.RenderLoop=i}),ace.define(&quot;ace/layer/font_metrics&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;,&quot;ace/lib/event_emitter&quot;],function(e,t,n){var r=e(&quot;../lib/oop&quot;),i=e(&quot;../lib/dom&quot;),s=e(&quot;../lib/lang&quot;),o=e(&quot;../lib/event&quot;),u=e(&quot;../lib/useragent&quot;),a=e(&quot;../lib/event_emitter&quot;).EventEmitter,f=256,l=typeof ResizeObserver==&quot;function&quot;,c=200,h=t.FontMetrics=function(e){this.el=i.createElement(&quot;div&quot;),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=i.createElement(&quot;div&quot;),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=i.createElement(&quot;div&quot;),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),e.appendChild(this.el),this.$measureNode.innerHTML=s.stringRepeat(&quot;X&quot;,f),this.$characterSize={width:0,height:0},l?this.$addObserver():this.checkForSizeChanges()};(function(){r.implement(this,a),this.$characterSize={width:0,height:0},this.$setMeasureNodeStyles=function(e,t){e.width=e.height=&quot;auto&quot;,e.left=e.top=&quot;0px&quot;,e.visibility=&quot;hidden&quot;,e.position=&quot;absolute&quot;,e.whiteSpace=&quot;pre&quot;,u.isIE&lt;8?e[&quot;font-family&quot;]=&quot;inherit&quot;:e.font=&quot;inherit&quot;,e.overflow=t?&quot;hidden&quot;:&quot;visible&quot;},this.checkForSizeChanges=function(e){e===undefined&amp;&amp;(e=this.$measureSizes());if(e&amp;&amp;(this.$characterSize.width!==e.width||this.$characterSize.height!==e.height)){this.$measureNode.style.fontWeight=&quot;bold&quot;;var t=this.$measureSizes();this.$measureNode.style.fontWeight=&quot;&quot;,this.$characterSize=e,this.charSizes=Object.create(null),this.allowBoldFonts=t&amp;&amp;t.width===e.width&amp;&amp;t.height===e.height,this._emit(&quot;changeCharacterSize&quot;,{data:e})}},this.$addObserver=function(){var e=this;this.$observer=new window.ResizeObserver(function(t){var n=t[0].contentRect;e.checkForSizeChanges({height:n.height,width:n.width/f})}),this.$observer.observe(this.$measureNode)},this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer||this.$observer)return this.$pollSizeChangesTimer;var e=this;return this.$pollSizeChangesTimer=o.onIdle(function t(){e.checkForSizeChanges(),o.onIdle(t,500)},500)},this.setPolling=function(e){e?this.$pollSizeChanges():this.$pollSizeChangesTimer&amp;&amp;(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},this.$measureSizes=function(e){var t={height:(e||this.$measureNode).clientHeight,width:(e||this.$measureNode).clientWidth/f};return t.width===0||t.height===0?null:t},this.$measureCharWidth=function(e){this.$main.innerHTML=s.stringRepeat(e,f);var t=this.$main.getBoundingClientRect();return t.width/f},this.getCharacterWidth=function(e){var t=this.charSizes[e];return t===undefined&amp;&amp;(t=this.charSizes[e]=this.$measureCharWidth(e)/this.$characterSize.width),t},this.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&amp;&amp;this.$observer.disconnect(),this.el&amp;&amp;this.el.parentNode&amp;&amp;this.el.parentNode.removeChild(this.el)},this.$getZoom=function e(t){return t?(window.getComputedStyle(t).zoom||1)*e(t.parentElement):1},this.$initTransformMeasureNodes=function(){var e=function(e,t){return[&quot;div&quot;,{style:&quot;position: absolute;top:&quot;+e+&quot;px;left:&quot;+t+&quot;px;&quot;}]};this.els=i.buildDom([e(0,0),e(c,0),e(0,c),e(c,c)],this.el)},this.transformCoordinates=function(e,t){function r(e,t,n){var r=e[1]*t[0]-e[0]*t[1];return[(-t[1]*n[0]+t[0]*n[1])/r,(+e[1]*n[0]-e[0]*n[1])/r]}function i(e,t){return[e[0]-t[0],e[1]-t[1]]}function s(e,t){return[e[0]+t[0],e[1]+t[1]]}function o(e,t){return[e*t[0],e*t[1]]}function u(e){var t=e.getBoundingClientRect();return[t.left,t.top]}if(e){var n=this.$getZoom(this.el);e=o(1/n,e)}this.els||this.$initTransformMeasureNodes();var a=u(this.els[0]),f=u(this.els[1]),l=u(this.els[2]),h=u(this.els[3]),p=r(i(h,f),i(h,l),i(s(f,l),s(h,a))),d=o(1+p[0],i(f,a)),v=o(1+p[1],i(l,a));if(t){var m=t,g=p[0]*m[0]/c+p[1]*m[1]/c+1,y=s(o(m[0],d),o(m[1],v));return s(o(1/g/c,y),a)}var b=i(e,a),w=r(i(d,o(p[0],b)),i(v,o(p[1],b)),b);return o(c,w)}}).call(h.prototype)}),ace.define(&quot;ace/virtual_renderer&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/dom&quot;,&quot;ace/config&quot;,&quot;ace/layer/gutter&quot;,&quot;ace/layer/marker&quot;,&quot;ace/layer/text&quot;,&quot;ace/layer/cursor&quot;,&quot;ace/scrollbar&quot;,&quot;ace/scrollbar&quot;,&quot;ace/renderloop&quot;,&quot;ace/layer/font_metrics&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/dom&quot;),s=e(&quot;./config&quot;),o=e(&quot;./layer/gutter&quot;).Gutter,u=e(&quot;./layer/marker&quot;).Marker,a=e(&quot;./layer/text&quot;).Text,f=e(&quot;./layer/cursor&quot;).Cursor,l=e(&quot;./scrollbar&quot;).HScrollBar,c=e(&quot;./scrollbar&quot;).VScrollBar,h=e(&quot;./renderloop&quot;).RenderLoop,p=e(&quot;./layer/font_metrics&quot;).FontMetrics,d=e(&quot;./lib/event_emitter&quot;).EventEmitter,v='.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;font: 12px/normal \s'Monaco\s', \s'Menlo\s', \s'Ubuntu Mono\s', \s'Consolas\s', \s'source-code-pro\s', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \s'\s';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==&quot;);background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==&quot;);background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=&quot;);background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC&quot;);}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer &gt; .ace_line, .ace_text-layer &gt; .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer &gt; .ace_line, .ace_hidpi .ace_text-layer &gt; .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=&quot;),url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=&quot;);background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII=&quot;),url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC&quot;);}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled &gt; .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==&quot;);background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==&quot;);}.ace_fold-widget.ace_closed {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==&quot;);}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC&quot;);}.ace_dark .ace_fold-widget.ace_end {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==&quot;);}.ace_dark .ace_fold-widget.ace_closed {background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==&quot;);}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark &gt; .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}',m=e(&quot;./lib/useragent&quot;),g=m.isIE;i.importCssString(v,&quot;ace_editor.css&quot;);var y=function(e,t){var n=this;this.container=e||i.createElement(&quot;div&quot;),i.addCssClass(this.container,&quot;ace_editor&quot;),i.HI_DPI&amp;&amp;i.addCssClass(this.container,&quot;ace_hidpi&quot;),this.setTheme(t),this.$gutter=i.createElement(&quot;div&quot;),this.$gutter.className=&quot;ace_gutter&quot;,this.container.appendChild(this.$gutter),this.$gutter.setAttribute(&quot;aria-hidden&quot;,!0),this.scroller=i.createElement(&quot;div&quot;),this.scroller.className=&quot;ace_scroller&quot;,this.container.appendChild(this.scroller),this.content=i.createElement(&quot;div&quot;),this.content.className=&quot;ace_content&quot;,this.scroller.appendChild(this.content),this.$gutterLayer=new o(this.$gutter),this.$gutterLayer.on(&quot;changeGutterWidth&quot;,this.onGutterResize.bind(this)),this.$markerBack=new u(this.content);var r=this.$textLayer=new a(this.content);this.canvas=r.element,this.$markerFront=new u(this.content),this.$cursorLayer=new f(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new c(this.container,this),this.scrollBarH=new l(this.container,this),this.scrollBarV.addEventListener(&quot;scroll&quot;,function(e){n.$scrollAnimation||n.session.setScrollTop(e.data-n.scrollMargin.top)}),this.scrollBarH.addEventListener(&quot;scroll&quot;,function(e){n.$scrollAnimation||n.session.setScrollLeft(e.data-n.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new p(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.addEventListener(&quot;changeCharacterSize&quot;,function(e){n.updateCharacterSize(),n.onResize(!0,n.gutterWidth,n.$size.width,n.$size.height),n._signal(&quot;changeCharacterSize&quot;,e)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!m.isIOS,this.$loop=new h(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),s.resetOptions(this),s._signal(&quot;renderer&quot;,this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,r.implement(this,d),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&amp;&amp;(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle(&quot;ace_nobold&quot;,!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),i.setStyle(this.scroller.style,&quot;line-height&quot;,this.lineHeight+&quot;px&quot;)},this.setSession=function(e){this.session&amp;&amp;this.session.doc.off(&quot;changeNewLineMode&quot;,this.onChangeNewLineMode),this.session=e,e&amp;&amp;this.scrollMargin.top&amp;&amp;e.getScrollTop()&lt;=0&amp;&amp;e.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(e),this.$markerBack.setSession(e),this.$markerFront.setSession(e),this.$gutterLayer.setSession(e),this.$textLayer.setSession(e);if(!e)return;this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on(&quot;changeNewLineMode&quot;,this.onChangeNewLineMode)},this.updateLines=function(e,t,n){t===undefined&amp;&amp;(t=Infinity),this.$changedLines?(this.$changedLines.firstRow&gt;e&amp;&amp;(this.$changedLines.firstRow=e),this.$changedLines.lastRow&lt;t&amp;&amp;(this.$changedLines.lastRow=t)):this.$changedLines={firstRow:e,lastRow:t};if(this.$changedLines.lastRow&lt;this.layerConfig.firstRow){if(!n)return;this.$changedLines.lastRow=this.layerConfig.lastRow}if(this.$changedLines.firstRow&gt;this.layerConfig.lastRow)return;this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(e){e?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(e,t,n,r){if(this.resizing&gt;2)return;this.resizing&gt;0?this.resizing++:this.resizing=e?1:0;var i=this.container;r||(r=i.clientHeight||i.scrollHeight),n||(n=i.clientWidth||i.scrollWidth);var s=this.$updateCachedSize(e,t,n,r);if(!this.$size.scrollerHeight||!n&amp;&amp;!r)return this.resizing=0;e&amp;&amp;(this.$gutterLayer.$padding=null),e?this.$renderChanges(s|this.$changes,!0):this.$loop.schedule(s|this.$changes),this.resizing&amp;&amp;(this.resizing=0),this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null},this.$updateCachedSize=function(e,t,n,r){r-=this.$extraHeight||0;var s=0,o=this.$size,u={width:o.width,height:o.height,scrollerHeight:o.scrollerHeight,scrollerWidth:o.scrollerWidth};r&amp;&amp;(e||o.height!=r)&amp;&amp;(o.height=r,s|=this.CHANGE_SIZE,o.scrollerHeight=o.height,this.$horizScroll&amp;&amp;(o.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+&quot;px&quot;,s|=this.CHANGE_SCROLL);if(n&amp;&amp;(e||o.width!=n)){s|=this.CHANGE_SIZE,o.width=n,t==null&amp;&amp;(t=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=t,i.setStyle(this.scrollBarH.element.style,&quot;left&quot;,t+&quot;px&quot;),i.setStyle(this.scroller.style,&quot;left&quot;,t+this.margin.left+&quot;px&quot;),o.scrollerWidth=Math.max(0,n-t-this.scrollBarV.getWidth()-this.margin.h),i.setStyle(this.$gutter.style,&quot;left&quot;,this.margin.left+&quot;px&quot;);var a=this.scrollBarV.getWidth()+&quot;px&quot;;i.setStyle(this.scrollBarH.element.style,&quot;right&quot;,a),i.setStyle(this.scroller.style,&quot;right&quot;,a),i.setStyle(this.scroller.style,&quot;bottom&quot;,this.scrollBarH.getHeight());if(this.session&amp;&amp;this.session.getUseWrapMode()&amp;&amp;this.adjustWrapLimit()||e)s|=this.CHANGE_FULL}return o.$dirty=!n||!r,s&amp;&amp;this._signal(&quot;resize&quot;,u),s},this.onGutterResize=function(e){var t=this.$showGutter?e:0;t!=this.gutterWidth&amp;&amp;(this.$changes|=this.$updateCachedSize(!0,t,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&amp;&amp;this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var e=this.$size.scrollerWidth-this.$padding*2,t=Math.floor(e/this.characterWidth);return this.session.adjustWrapLimit(t,this.$showPrintMargin&amp;&amp;this.$printMarginColumn)},this.setAnimatedScroll=function(e){this.setOption(&quot;animatedScroll&quot;,e)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(e){this.setOption(&quot;showInvisibles&quot;,e),this.session.$bidiHandler.setShowInvisibles(e)},this.getShowInvisibles=function(){return this.getOption(&quot;showInvisibles&quot;)},this.getDisplayIndentGuides=function(){return this.getOption(&quot;displayIndentGuides&quot;)},this.setDisplayIndentGuides=function(e){this.setOption(&quot;displayIndentGuides&quot;,e)},this.setShowPrintMargin=function(e){this.setOption(&quot;showPrintMargin&quot;,e)},this.getShowPrintMargin=function(){return this.getOption(&quot;showPrintMargin&quot;)},this.setPrintMarginColumn=function(e){this.setOption(&quot;printMarginColumn&quot;,e)},this.getPrintMarginColumn=function(){return this.getOption(&quot;printMarginColumn&quot;)},this.getShowGutter=function(){return this.getOption(&quot;showGutter&quot;)},this.setShowGutter=function(e){return this.setOption(&quot;showGutter&quot;,e)},this.getFadeFoldWidgets=function(){return this.getOption(&quot;fadeFoldWidgets&quot;)},this.setFadeFoldWidgets=function(e){this.setOption(&quot;fadeFoldWidgets&quot;,e)},this.setHighlightGutterLine=function(e){this.setOption(&quot;highlightGutterLine&quot;,e)},this.getHighlightGutterLine=function(){return this.getOption(&quot;highlightGutterLine&quot;)},this.$updatePrintMargin=function(){if(!this.$showPrintMargin&amp;&amp;!this.$printMarginEl)return;if(!this.$printMarginEl){var e=i.createElement(&quot;div&quot;);e.className=&quot;ace_layer ace_print-margin-layer&quot;,this.$printMarginEl=i.createElement(&quot;div&quot;),this.$printMarginEl.className=&quot;ace_print-margin&quot;,e.appendChild(this.$printMarginEl),this.content.insertBefore(e,this.content.firstChild)}var t=this.$printMarginEl.style;t.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+&quot;px&quot;,t.visibility=this.$showPrintMargin?&quot;visible&quot;:&quot;hidden&quot;,this.session&amp;&amp;this.session.$wrap==-1&amp;&amp;this.adjustWrapLimit()},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){if(this.$isMousePressed)return;var e=this.textarea.style,t=this.$composition;if(!this.$keepTextAreaAtCursor&amp;&amp;!t){i.translate(this.textarea,-100,0);return}var n=this.$cursorLayer.$pixelPos;if(!n)return;t&amp;&amp;t.markerRange&amp;&amp;(n=this.$cursorLayer.getPixelPosition(t.markerRange.start,!0));var r=this.layerConfig,s=n.top,o=n.left;s-=r.offset;var u=t&amp;&amp;t.useTextareaForIME?this.lineHeight:g?0:1;if(s&lt;0||s&gt;r.height-u){i.translate(this.textarea,0,0);return}var a=1,f=this.$size.height-u;if(!t)s+=this.lineHeight;else if(t.useTextareaForIME){var l=this.textarea.value;a=this.characterWidth*this.session.$getStringScreenWidth(l)[0]}else s+=this.lineHeight+2;o-=this.scrollLeft,o&gt;this.$size.scrollerWidth-a&amp;&amp;(o=this.$size.scrollerWidth-a),o+=this.gutterWidth+this.margin.left,i.setStyle(e,&quot;height&quot;,u+&quot;px&quot;),i.setStyle(e,&quot;width&quot;,a+&quot;px&quot;),i.translate(this.textarea,Math.min(o,this.$size.scrollerWidth-a),Math.min(s,f))},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)},this.getLastFullyVisibleRow=function(){var e=this.layerConfig,t=e.lastRow,n=this.session.documentToScreenRow(t,0)*e.lineHeight;return n-this.session.getScrollTop()&gt;e.height-e.lineHeight?t-1:t},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(e){this.$padding=e,this.$textLayer.setPadding(e),this.$cursorLayer.setPadding(e),this.$markerFront.setPadding(e),this.$markerBack.setPadding(e),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(e,t,n,r){var i=this.scrollMargin;i.top=e|0,i.bottom=t|0,i.right=r|0,i.left=n|0,i.v=i.top+i.bottom,i.h=i.left+i.right,i.top&amp;&amp;this.scrollTop&lt;=0&amp;&amp;this.session&amp;&amp;this.session.setScrollTop(-i.top),this.updateFull()},this.setMargin=function(e,t,n,r){var i=this.margin;i.top=e|0,i.bottom=t|0,i.right=r|0,i.left=n|0,i.v=i.top+i.bottom,i.h=i.left+i.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(e){this.setOption(&quot;hScrollBarAlwaysVisible&quot;,e)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(e){this.setOption(&quot;vScrollBarAlwaysVisible&quot;,e)},this.$updateScrollBarV=function(){var e=this.layerConfig.maxHeight,t=this.$size.scrollerHeight;!this.$maxLines&amp;&amp;this.$scrollPastEnd&amp;&amp;(e-=(t-this.lineHeight)*this.$scrollPastEnd,this.scrollTop&gt;e-t&amp;&amp;(e=this.scrollTop+t,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(e+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(e,t){this.$changes&amp;&amp;(e|=this.$changes,this.$changes=0);if(!this.session||!this.container.offsetWidth||this.$frozen||!e&amp;&amp;!t){this.$changes|=e;return}if(this.$size.$dirty)return this.$changes|=e,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal(&quot;beforeRender&quot;,e),this.session&amp;&amp;this.session.$bidiHandler&amp;&amp;this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var n=this.layerConfig;if(e&amp;this.CHANGE_FULL||e&amp;this.CHANGE_SIZE||e&amp;this.CHANGE_TEXT||e&amp;this.CHANGE_LINES||e&amp;this.CHANGE_SCROLL||e&amp;this.CHANGE_H_SCROLL){e|=this.$computeLayerConfig()|this.$loop.clear();if(n.firstRow!=this.layerConfig.firstRow&amp;&amp;n.firstRowScreen==this.layerConfig.firstRowScreen){var r=this.scrollTop+(n.firstRow-this.layerConfig.firstRow)*this.lineHeight;r&gt;0&amp;&amp;(this.scrollTop=r,e|=this.CHANGE_SCROLL,e|=this.$computeLayerConfig()|this.$loop.clear())}n=this.layerConfig,this.$updateScrollBarV(),e&amp;this.CHANGE_H_SCROLL&amp;&amp;this.$updateScrollBarH(),i.translate(this.content,-this.scrollLeft,-n.offset);var s=n.width+2*this.$padding+&quot;px&quot;,o=n.minHeight+&quot;px&quot;;i.setStyle(this.content.style,&quot;width&quot;,s),i.setStyle(this.content.style,&quot;height&quot;,o)}e&amp;this.CHANGE_H_SCROLL&amp;&amp;(i.translate(this.content,-this.scrollLeft,-n.offset),this.scroller.className=this.scrollLeft&lt;=0?&quot;ace_scroller&quot;:&quot;ace_scroller ace_scroll-left&quot;);if(e&amp;this.CHANGE_FULL){this.$changedLines=null,this.$textLayer.update(n),this.$showGutter&amp;&amp;this.$gutterLayer.update(n),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this._signal(&quot;afterRender&quot;,e);return}if(e&amp;this.CHANGE_SCROLL){this.$changedLines=null,e&amp;this.CHANGE_TEXT||e&amp;this.CHANGE_LINES?this.$textLayer.update(n):this.$textLayer.scrollLines(n),this.$showGutter&amp;&amp;(e&amp;this.CHANGE_GUTTER||e&amp;this.CHANGE_LINES?this.$gutterLayer.update(n):this.$gutterLayer.scrollLines(n)),this.$markerBack.update(n),this.$markerFront.update(n),this.$cursorLayer.update(n),this.$moveTextAreaToCursor(),this._signal(&quot;afterRender&quot;,e);return}e&amp;this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(n),this.$showGutter&amp;&amp;this.$gutterLayer.update(n)):e&amp;this.CHANGE_LINES?(this.$updateLines()||e&amp;this.CHANGE_GUTTER&amp;&amp;this.$showGutter)&amp;&amp;this.$gutterLayer.update(n):e&amp;this.CHANGE_TEXT||e&amp;this.CHANGE_GUTTER?this.$showGutter&amp;&amp;this.$gutterLayer.update(n):e&amp;this.CHANGE_CURSOR&amp;&amp;this.$highlightGutterLine&amp;&amp;this.$gutterLayer.updateLineHighlight(n),e&amp;this.CHANGE_CURSOR&amp;&amp;(this.$cursorLayer.update(n),this.$moveTextAreaToCursor()),e&amp;(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&amp;&amp;this.$markerFront.update(n),e&amp;(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&amp;&amp;this.$markerBack.update(n),this._signal(&quot;afterRender&quot;,e)},this.$autosize=function(){var e=this.session.getScreenLength()*this.lineHeight,t=this.$maxLines*this.lineHeight,n=Math.min(t,Math.max((this.$minLines||1)*this.lineHeight,e))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&amp;&amp;(n+=this.scrollBarH.getHeight()),this.$maxPixelHeight&amp;&amp;n&gt;this.$maxPixelHeight&amp;&amp;(n=this.$maxPixelHeight);var r=n&lt;=2*this.lineHeight,i=!r&amp;&amp;e&gt;t;if(n!=this.desiredHeight||this.$size.height!=this.desiredHeight||i!=this.$vScroll){i!=this.$vScroll&amp;&amp;(this.$vScroll=i,this.scrollBarV.setVisible(i));var s=this.container.clientWidth;this.container.style.height=n+&quot;px&quot;,this.$updateCachedSize(!0,this.$gutterWidth,s,n),this.desiredHeight=n,this._signal(&quot;autosize&quot;)}},this.$computeLayerConfig=function(){var e=this.session,t=this.$size,n=t.height&lt;=2*this.lineHeight,r=this.session.getScreenLength(),i=r*this.lineHeight,s=this.$getLongestLine(),o=!n&amp;&amp;(this.$hScrollBarAlwaysVisible||t.scrollerWidth-s-2*this.$padding&lt;0),u=this.$horizScroll!==o;u&amp;&amp;(this.$horizScroll=o,this.scrollBarH.setVisible(o));var a=this.$vScroll;this.$maxLines&amp;&amp;this.lineHeight&gt;1&amp;&amp;this.$autosize();var f=t.scrollerHeight+this.lineHeight,l=!this.$maxLines&amp;&amp;this.$scrollPastEnd?(t.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;i+=l;var c=this.scrollMargin;this.session.setScrollTop(Math.max(-c.top,Math.min(this.scrollTop,i-t.scrollerHeight+c.bottom))),this.session.setScrollLeft(Math.max(-c.left,Math.min(this.scrollLeft,s+2*this.$padding-t.scrollerWidth+c.right)));var h=!n&amp;&amp;(this.$vScrollBarAlwaysVisible||t.scrollerHeight-i+l&lt;0||this.scrollTop&gt;c.top),p=a!==h;p&amp;&amp;(this.$vScroll=h,this.scrollBarV.setVisible(h));var d=this.scrollTop%this.lineHeight,v=Math.ceil(f/this.lineHeight)-1,m=Math.max(0,Math.round((this.scrollTop-d)/this.lineHeight)),g=m+v,y,b,w=this.lineHeight;m=e.screenToDocumentRow(m,0);var E=e.getFoldLine(m);E&amp;&amp;(m=E.start.row),y=e.documentToScreenRow(m,0),b=e.getRowLength(m)*w,g=Math.min(e.screenToDocumentRow(g,0),e.getLength()-1),f=t.scrollerHeight+e.getRowLength(g)*w+b,d=this.scrollTop-y*w;var S=0;if(this.layerConfig.width!=s||u)S=this.CHANGE_H_SCROLL;if(u||p)S|=this.$updateCachedSize(!0,this.gutterWidth,t.width,t.height),this._signal(&quot;scrollbarVisibilityChanged&quot;),p&amp;&amp;(s=this.$getLongestLine());return this.layerConfig={width:s,padding:this.$padding,firstRow:m,firstRowScreen:y,lastRow:g,lineHeight:w,characterWidth:this.characterWidth,minHeight:f,maxHeight:i,offset:d,gutterOffset:w?Math.max(0,Math.ceil((d+t.height-t.scrollerHeight)/w)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&amp;&amp;this.session.$bidiHandler.setContentWidth(s-this.$padding),S},this.$updateLines=function(){if(!this.$changedLines)return;var e=this.$changedLines.firstRow,t=this.$changedLines.lastRow;this.$changedLines=null;var n=this.layerConfig;if(e&gt;n.lastRow+1)return;if(t&lt;n.firstRow)return;if(t===Infinity){this.$showGutter&amp;&amp;this.$gutterLayer.update(n),this.$textLayer.update(n);return}return this.$textLayer.updateLines(n,e,t),!0},this.$getLongestLine=function(){var e=this.session.getScreenWidth();return this.showInvisibles&amp;&amp;!this.session.$useWrapMode&amp;&amp;(e+=1),this.$textLayer&amp;&amp;e&gt;this.$textLayer.MAX_LINE_LENGTH&amp;&amp;(e=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(e*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(e,t){this.$gutterLayer.addGutterDecoration(e,t)},this.removeGutterDecoration=function(e,t){this.$gutterLayer.removeGutterDecoration(e,t)},this.updateBreakpoints=function(e){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(e){this.$gutterLayer.setAnnotations(e),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(e,t,n){this.scrollCursorIntoView(e,n),this.scrollCursorIntoView(t,n)},this.scrollCursorIntoView=function(e,t,n){if(this.$size.scrollerHeight===0)return;var r=this.$cursorLayer.getPixelPosition(e),i=r.left,s=r.top,o=n&amp;&amp;n.top||0,u=n&amp;&amp;n.bottom||0,a=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;a+o&gt;s?(t&amp;&amp;a+o&gt;s+this.lineHeight&amp;&amp;(s-=t*this.$size.scrollerHeight),s===0&amp;&amp;(s=-this.scrollMargin.top),this.session.setScrollTop(s)):a+this.$size.scrollerHeight-u&lt;s+this.lineHeight&amp;&amp;(t&amp;&amp;a+this.$size.scrollerHeight-u&lt;s-this.lineHeight&amp;&amp;(s+=t*this.$size.scrollerHeight),this.session.setScrollTop(s+this.lineHeight+u-this.$size.scrollerHeight));var f=this.scrollLeft;f&gt;i?(i&lt;this.$padding+2*this.layerConfig.characterWidth&amp;&amp;(i=-this.scrollMargin.left),this.session.setScrollLeft(i)):f+this.$size.scrollerWidth&lt;i+this.characterWidth?this.session.setScrollLeft(Math.round(i+this.characterWidth-this.$size.scrollerWidth)):f&lt;=this.$padding&amp;&amp;i-f&lt;this.characterWidth&amp;&amp;this.session.setScrollLeft(0)},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(e){this.session.setScrollTop(e*this.lineHeight)},this.alignCursor=function(e,t){typeof e==&quot;number&quot;&amp;&amp;(e={row:e,column:0});var n=this.$cursorLayer.getPixelPosition(e),r=this.$size.scrollerHeight-this.lineHeight,i=n.top-r*(t||0);return this.session.setScrollTop(i),i},this.STEPS=8,this.$calcSteps=function(e,t){var n=0,r=this.STEPS,i=[],s=function(e,t,n){return n*(Math.pow(e-1,3)+1)+t};for(n=0;n&lt;r;++n)i.push(s(n/this.STEPS,e,t-e));return i},this.scrollToLine=function(e,t,n,r){var i=this.$cursorLayer.getPixelPosition({row:e,column:0}),s=i.top;t&amp;&amp;(s-=this.$size.scrollerHeight/2);var o=this.scrollTop;this.session.setScrollTop(s),n!==!1&amp;&amp;this.animateScrolling(o,r)},this.animateScrolling=function(e,t){var n=this.scrollTop;if(!this.$animatedScroll)return;var r=this;if(e==n)return;if(this.$scrollAnimation){var i=this.$scrollAnimation.steps;if(i.length){e=i[0];if(e==n)return}}var s=r.$calcSteps(e,n);this.$scrollAnimation={from:e,to:n,steps:s},clearInterval(this.$timer),r.session.setScrollTop(s.shift()),r.session.$scrollTop=n,this.$timer=setInterval(function(){s.length?(r.session.setScrollTop(s.shift()),r.session.$scrollTop=n):n!=null?(r.session.$scrollTop=-1,r.session.setScrollTop(n),n=null):(r.$timer=clearInterval(r.$timer),r.$scrollAnimation=null,t&amp;&amp;t())},10)},this.scrollToY=function(e){this.scrollTop!==e&amp;&amp;(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=e)},this.scrollToX=function(e){this.scrollLeft!==e&amp;&amp;(this.scrollLeft=e),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(e,t){this.session.setScrollTop(t),this.session.setScrollLeft(t)},this.scrollBy=function(e,t){t&amp;&amp;this.session.setScrollTop(this.session.getScrollTop()+t),e&amp;&amp;this.session.setScrollLeft(this.session.getScrollLeft()+e)},this.isScrollableBy=function(e,t){if(t&lt;0&amp;&amp;this.session.getScrollTop()&gt;=1-this.scrollMargin.top)return!0;if(t&gt;0&amp;&amp;this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight&lt;-1+this.scrollMargin.bottom)return!0;if(e&lt;0&amp;&amp;this.session.getScrollLeft()&gt;=1-this.scrollMargin.left)return!0;if(e&gt;0&amp;&amp;this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width&lt;-1+this.scrollMargin.right)return!0},this.pixelToScreenCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var r=this.$fontMetrics.transformCoordinates([e,t]);e=r[1]-this.gutterWidth-this.margin.left,t=r[0]}else n=this.scroller.getBoundingClientRect();var i=e+this.scrollLeft-n.left-this.$padding,s=i/this.characterWidth,o=Math.floor((t+this.scrollTop-n.top)/this.lineHeight),u=this.$blockCursor?Math.floor(s):Math.round(s);return{row:o,column:u,side:s-u&gt;0?1:-1,offsetX:i}},this.screenToTextCoordinates=function(e,t){var n;if(this.$hasCssTransforms){n={top:0,left:0};var r=this.$fontMetrics.transformCoordinates([e,t]);e=r[1]-this.gutterWidth-this.margin.left,t=r[0]}else n=this.scroller.getBoundingClientRect();var i=e+this.scrollLeft-n.left-this.$padding,s=i/this.characterWidth,o=this.$blockCursor?Math.floor(s):Math.round(s),u=Math.floor((t+this.scrollTop-n.top)/this.lineHeight);return this.session.screenToDocumentPosition(u,Math.max(o,0),i)},this.textToScreenCoordinates=function(e,t){var n=this.scroller.getBoundingClientRect(),r=this.session.documentToScreenPosition(e,t),i=this.$padding+(this.session.$bidiHandler.isBidiRow(r.row,e)?this.session.$bidiHandler.getPosLeft(r.column):Math.round(r.column*this.characterWidth)),s=r.row*this.lineHeight;return{pageX:n.left+i-this.scrollLeft,pageY:n.top+s-this.scrollTop}},this.visualizeFocus=function(){i.addCssClass(this.container,&quot;ace_focus&quot;)},this.visualizeBlur=function(){i.removeCssClass(this.container,&quot;ace_focus&quot;)},this.showComposition=function(e){this.$composition=e,e.cssText||(e.cssText=this.textarea.style.cssText),e.useTextareaForIME=this.$useTextareaForIME,this.$useTextareaForIME?(i.addCssClass(this.textarea,&quot;ace_composition&quot;),this.textarea.style.cssText=&quot;&quot;,this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display=&quot;none&quot;):e.markerId=this.session.addMarker(e.markerRange,&quot;ace_composition_marker&quot;,&quot;text&quot;)},this.setCompositionText=function(e){var t=this.session.selection.cursor;this.addToken(e,&quot;composition_placeholder&quot;,t.row,t.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){if(!this.$composition)return;this.$composition.markerId&amp;&amp;this.session.removeMarker(this.$composition.markerId),i.removeCssClass(this.textarea,&quot;ace_composition&quot;),this.textarea.style.cssText=this.$composition.cssText,this.$composition=null,this.$cursorLayer.element.style.display=&quot;&quot;},this.addToken=function(e,t,n,r){var i=this.session;i.bgTokenizer.lines[n]=null;var s={type:t,value:e},o=i.getTokens(n);if(r==null)o.push(s);else{var u=0;for(var a=0;a&lt;o.length;a++){var f=o[a];u+=f.value.length;if(r&lt;=u){var l=f.value.length-(u-r),c=f.value.slice(0,l),h=f.value.slice(l);o.splice(a,1,{type:f.type,value:c},s,{type:f.type,value:h});break}}}this.updateLines(n,n)},this.setTheme=function(e,t){function o(r){if(n.$themeId!=e)return t&amp;&amp;t();if(!r||!r.cssClass)throw new Error(&quot;couldn't load module &quot;+e+&quot; or it didn't call define&quot;);r.$id&amp;&amp;(n.$themeId=r.$id),i.importCssString(r.cssText,r.cssClass,n.container),n.theme&amp;&amp;i.removeCssClass(n.container,n.theme.cssClass);var s=&quot;padding&quot;in r?r.padding:&quot;padding&quot;in(n.theme||{})?4:n.$padding;n.$padding&amp;&amp;s!=n.$padding&amp;&amp;n.setPadding(s),n.$theme=r.cssClass,n.theme=r,i.addCssClass(n.container,r.cssClass),i.setCssClass(n.container,&quot;ace_dark&quot;,r.isDark),n.$size&amp;&amp;(n.$size.width=0,n.$updateSizeAsync()),n._dispatchEvent(&quot;themeLoaded&quot;,{theme:r}),t&amp;&amp;t()}var n=this;this.$themeId=e,n._dispatchEvent(&quot;themeChange&quot;,{theme:e});if(!e||typeof e==&quot;string&quot;){var r=e||this.$options.theme.initialValue;s.loadModule([&quot;theme&quot;,r],o)}else o(e)},this.getTheme=function(){return this.$themeId},this.setStyle=function(e,t){i.setCssClass(this.container,e,t!==!1)},this.unsetStyle=function(e){i.removeCssClass(this.container,e)},this.setCursorStyle=function(e){i.setStyle(this.scroller.style,&quot;cursor&quot;,e)},this.setMouseCursor=function(e){i.setStyle(this.scroller.style,&quot;cursor&quot;,e)},this.attachToShadowRoot=function(){i.importCssString(v,&quot;ace_editor.css&quot;,this.container)},this.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy()}}).call(y.prototype),s.defineOptions(y.prototype,&quot;renderer&quot;,{animatedScroll:{initialValue:!1},showInvisibles:{set:function(e){this.$textLayer.setShowInvisibles(e)&amp;&amp;this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(e){typeof e==&quot;number&quot;&amp;&amp;(this.$printMarginColumn=e),this.$showPrintMargin=!!e,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&amp;&amp;this.$printMarginColumn}},showGutter:{set:function(e){this.$gutter.style.display=e?&quot;block&quot;:&quot;none&quot;,this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(e){i.setCssClass(this.$gutter,&quot;ace_fade-fold-widgets&quot;,e)},initialValue:!1},showFoldWidgets:{set:function(e){this.$gutterLayer.setShowFoldWidgets(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(e){this.$textLayer.setDisplayIndentGuides(e)&amp;&amp;this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(e){this.$gutterLayer.setHighlightGutterLine(e),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(e){(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)&amp;&amp;this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(e){(!this.$vScrollBarAlwaysVisible||!this.$vScroll)&amp;&amp;this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(e){typeof e==&quot;number&quot;&amp;&amp;(e+=&quot;px&quot;),this.container.style.fontSize=e,this.updateFontSize()},initialValue:12},fontFamily:{set:function(e){this.container.style.fontFamily=e,this.updateFontSize()}},maxLines:{set:function(e){this.updateFull()}},minLines:{set:function(e){this.$minLines&lt;562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(e){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(e){e=+e||0;if(this.$scrollPastEnd==e)return;this.$scrollPastEnd=e,this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(e){this.$gutterLayer.$fixedWidth=!!e,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(e){this.setTheme(e)},get:function(){return this.$themeId||this.theme},initialValue:&quot;./theme/textmate&quot;,handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!m.isMobile&amp;&amp;!m.isIE}}),t.VirtualRenderer=y}),ace.define(&quot;ace/worker/worker_client&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/net&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;function u(e){var t=&quot;importScripts('&quot;+i.qualifyURL(e)+&quot;');&quot;;try{return new Blob([t],{type:&quot;application/javascript&quot;})}catch(n){var r=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,s=new r;return s.append(t),s.getBlob(&quot;application/javascript&quot;)}}function a(e){if(typeof Worker==&quot;undefined&quot;)return{postMessage:function(){},terminate:function(){}};if(o.get(&quot;loadWorkerFromBlob&quot;)){var t=u(e),n=window.URL||window.webkitURL,r=n.createObjectURL(t);return new Worker(r)}return new Worker(e)}var r=e(&quot;../lib/oop&quot;),i=e(&quot;../lib/net&quot;),s=e(&quot;../lib/event_emitter&quot;).EventEmitter,o=e(&quot;../config&quot;),f=function(e){e.postMessage||(e=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=e,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage};(function(){r.implement(this,s),this.$createWorkerFromOldConfig=function(t,n,r,i,s){e.nameToUrl&amp;&amp;!e.toUrl&amp;&amp;(e.toUrl=e.nameToUrl);if(o.get(&quot;packaged&quot;)||!e.toUrl)i=i||o.moduleUrl(n,&quot;worker&quot;);else{var u=this.$normalizePath;i=i||u(e.toUrl(&quot;ace/worker/worker.js&quot;,null,&quot;_&quot;));var f={};t.forEach(function(t){f[t]=u(e.toUrl(t,null,&quot;_&quot;).replace(/(\s.js)?(\s?.*)?$/,&quot;&quot;))})}return this.$worker=a(i),s&amp;&amp;this.send(&quot;importScripts&quot;,s),this.$worker.postMessage({init:!0,tlns:f,module:n,classname:r}),this.$worker},this.onMessage=function(e){var t=e.data;switch(t.type){case&quot;event&quot;:this._signal(t.name,{data:t.data});break;case&quot;call&quot;:var n=this.callbacks[t.id];n&amp;&amp;(n(t.data),delete this.callbacks[t.id]);break;case&quot;error&quot;:this.reportError(t.data);break;case&quot;log&quot;:window.console&amp;&amp;console.log&amp;&amp;console.log.apply(console,t.data)}},this.reportError=function(e){window.console&amp;&amp;console.error&amp;&amp;console.error(e)},this.$normalizePath=function(e){return i.qualifyURL(e)},this.terminate=function(){this._signal(&quot;terminate&quot;,{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker=null,this.$doc&amp;&amp;this.$doc.off(&quot;change&quot;,this.changeListener),this.$doc=null},this.send=function(e,t){this.$worker.postMessage({command:e,args:t})},this.call=function(e,t,n){if(n){var r=this.callbackId++;this.callbacks[r]=n,t.push(r)}this.send(e,t)},this.emit=function(e,t){try{t.data&amp;&amp;t.data.err&amp;&amp;(t.data.err={message:t.data.err.message,stack:t.data.err.stack,code:t.data.err.code}),this.$worker.postMessage({event:e,data:{data:t.data}})}catch(n){console.error(n.stack)}},this.attachToDocument=function(e){this.$doc&amp;&amp;this.terminate(),this.$doc=e,this.call(&quot;setValue&quot;,[e.getValue()]),e.on(&quot;change&quot;,this.changeListener)},this.changeListener=function(e){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),e.action==&quot;insert&quot;?this.deltaQueue.push(e.start,e.lines):this.deltaQueue.push(e.start,e.end)},this.$sendDeltaQueue=function(){var e=this.deltaQueue;if(!e)return;this.deltaQueue=null,e.length&gt;50&amp;&amp;e.length&gt;this.$doc.getLength()&gt;&gt;1?this.call(&quot;setValue&quot;,[this.$doc.getValue()]):this.emit(&quot;change&quot;,{data:e})}}).call(f.prototype);var l=function(e,t,n){var r=null,i=!1,u=Object.create(s),a=[],l=new f({messageBuffer:a,terminate:function(){},postMessage:function(e){a.push(e);if(!r)return;i?setTimeout(c):c()}});l.setEmitSync=function(e){i=e};var c=function(){var e=a.shift();e.command?r[e.command].apply(r,e.args):e.event&amp;&amp;u._signal(e.event,e.data)};return u.postMessage=function(e){l.onMessage({data:e})},u.callback=function(e,t){this.postMessage({type:&quot;call&quot;,id:t,data:e})},u.emit=function(e,t){this.postMessage({type:&quot;event&quot;,name:e,data:t})},o.loadModule([&quot;worker&quot;,t],function(e){r=new e[n](u);while(a.length)c()}),l};t.UIWorkerClient=l,t.WorkerClient=f,t.createWorker=a}),ace.define(&quot;ace/placeholder&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/lib/oop&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./range&quot;).Range,i=e(&quot;./lib/event_emitter&quot;).EventEmitter,s=e(&quot;./lib/oop&quot;),o=function(e,t,n,r,i,s){var o=this;this.length=t,this.session=e,this.doc=e.getDocument(),this.mainClass=i,this.othersClass=s,this.$onUpdate=this.onUpdate.bind(this),this.doc.on(&quot;change&quot;,this.$onUpdate),this.$others=r,this.$onCursorChange=function(){setTimeout(function(){o.onCursorChange()})},this.$pos=n;var u=e.getUndoManager().$undoStack||e.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=u.length,this.setup(),e.selection.on(&quot;changeCursor&quot;,this.$onCursorChange)};(function(){s.implement(this,i),this.setup=function(){var e=this,t=this.doc,n=this.session;this.selectionBefore=n.selection.toJSON(),n.selection.inMultiSelectMode&amp;&amp;n.selection.toSingleRange(),this.pos=t.createAnchor(this.$pos.row,this.$pos.column);var i=this.pos;i.$insertRight=!0,i.detach(),i.markerId=n.addMarker(new r(i.row,i.column,i.row,i.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(n){var r=t.createAnchor(n.row,n.column);r.$insertRight=!0,r.detach(),e.others.push(r)}),n.setUndoSelect(!1)},this.showOtherMarkers=function(){if(this.othersActive)return;var e=this.session,t=this;this.othersActive=!0,this.others.forEach(function(n){n.markerId=e.addMarker(new r(n.row,n.column,n.row,n.column+t.length),t.othersClass,null,!1)})},this.hideOtherMarkers=function(){if(!this.othersActive)return;this.othersActive=!1;for(var e=0;e&lt;this.others.length;e++)this.session.removeMarker(this.others[e].markerId)},this.onUpdate=function(e){if(this.$updating)return this.updateAnchors(e);var t=e;if(t.start.row!==t.end.row)return;if(t.start.row!==this.pos.row)return;this.$updating=!0;var n=e.action===&quot;insert&quot;?t.end.column-t.start.column:t.start.column-t.end.column,i=t.start.column&gt;=this.pos.column&amp;&amp;t.start.column&lt;=this.pos.column+this.length+1,s=t.start.column-this.pos.column;this.updateAnchors(e),i&amp;&amp;(this.length+=n);if(i&amp;&amp;!this.session.$fromUndo)if(e.action===&quot;insert&quot;)for(var o=this.others.length-1;o&gt;=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};this.doc.insertMergedLines(a,e.lines)}else if(e.action===&quot;remove&quot;)for(var o=this.others.length-1;o&gt;=0;o--){var u=this.others[o],a={row:u.row,column:u.column+s};this.doc.remove(new r(a.row,a.column,a.row,a.column-n))}this.$updating=!1,this.updateMarkers()},this.updateAnchors=function(e){this.pos.onChange(e);for(var t=this.others.length;t--;)this.others[t].onChange(e);this.updateMarkers()},this.updateMarkers=function(){if(this.$updating)return;var e=this,t=this.session,n=function(n,i){t.removeMarker(n.markerId),n.markerId=t.addMarker(new r(n.row,n.column,n.row,n.column+e.length),i,null,!1)};n(this.pos,this.mainClass);for(var i=this.others.length;i--;)n(this.others[i],this.othersClass)},this.onCursorChange=function(e){if(this.$updating||!this.session)return;var t=this.session.selection.getCursor();t.row===this.pos.row&amp;&amp;t.column&gt;=this.pos.column&amp;&amp;t.column&lt;=this.pos.column+this.length?(this.showOtherMarkers(),this._emit(&quot;cursorEnter&quot;,e)):(this.hideOtherMarkers(),this._emit(&quot;cursorLeave&quot;,e))},this.detach=function(){this.session.removeMarker(this.pos&amp;&amp;this.pos.markerId),this.hideOtherMarkers(),this.doc.removeEventListener(&quot;change&quot;,this.$onUpdate),this.session.selection.removeEventListener(&quot;changeCursor&quot;,this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(this.$undoStackDepth===-1)return;var e=this.session.getUndoManager(),t=(e.$undoStack||e.$undostack).length-this.$undoStackDepth;for(var n=0;n&lt;t;n++)e.undo(this.session,!0);this.selectionBefore&amp;&amp;this.session.selection.fromJSON(this.selectionBefore)}}).call(o.prototype),t.PlaceHolder=o}),ace.define(&quot;ace/mouse/multi_select_handler&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/useragent&quot;],function(e,t,n){function s(e,t){return e.row==t.row&amp;&amp;e.column==t.column}function o(e){var t=e.domEvent,n=t.altKey,o=t.shiftKey,u=t.ctrlKey,a=e.getAccelKey(),f=e.getButton();u&amp;&amp;i.isMac&amp;&amp;(f=t.button);if(e.editor.inMultiSelectMode&amp;&amp;f==2){e.editor.textInput.onContextMenu(e.domEvent);return}if(!u&amp;&amp;!n&amp;&amp;!a){f===0&amp;&amp;e.editor.inMultiSelectMode&amp;&amp;e.editor.exitMultiSelectMode();return}if(f!==0)return;var l=e.editor,c=l.selection,h=l.inMultiSelectMode,p=e.getDocumentPosition(),d=c.getCursor(),v=e.inSelection()||c.isEmpty()&amp;&amp;s(p,d),m=e.x,g=e.y,y=function(e){m=e.clientX,g=e.clientY},b=l.session,w=l.renderer.pixelToScreenCoordinates(m,g),E=w,S;if(l.$mouseHandler.$enableJumpToDef)u&amp;&amp;n||a&amp;&amp;n?S=o?&quot;block&quot;:&quot;add&quot;:n&amp;&amp;l.$blockSelectEnabled&amp;&amp;(S=&quot;block&quot;);else if(a&amp;&amp;!n){S=&quot;add&quot;;if(!h&amp;&amp;o)return}else n&amp;&amp;l.$blockSelectEnabled&amp;&amp;(S=&quot;block&quot;);S&amp;&amp;i.isMac&amp;&amp;t.ctrlKey&amp;&amp;l.$mouseHandler.cancelContextMenu();if(S==&quot;add&quot;){if(!h&amp;&amp;v)return;if(!h){var x=c.toOrientedRange();l.addSelectionMarker(x)}var T=c.rangeList.rangeAtPoint(p);l.inVirtualSelectionMode=!0,o&amp;&amp;(T=null,x=c.ranges[0]||x,l.removeSelectionMarker(x)),l.once(&quot;mouseup&quot;,function(){var e=c.toOrientedRange();T&amp;&amp;e.isEmpty()&amp;&amp;s(T.cursor,e.cursor)?c.substractPoint(e.cursor):(o?c.substractPoint(x.cursor):x&amp;&amp;(l.removeSelectionMarker(x),c.addRange(x)),c.addRange(e)),l.inVirtualSelectionMode=!1})}else if(S==&quot;block&quot;){e.stop(),l.inVirtualSelectionMode=!0;var N,C=[],k=function(){var e=l.renderer.pixelToScreenCoordinates(m,g),t=b.screenToDocumentPosition(e.row,e.column,e.offsetX);if(s(E,e)&amp;&amp;s(t,c.lead))return;E=e,l.selection.moveToPosition(t),l.renderer.scrollCursorIntoView(),l.removeSelectionMarkers(C),C=c.rectangularRangeBlock(E,w),l.$mouseHandler.$clickSelection&amp;&amp;C.length==1&amp;&amp;C[0].isEmpty()&amp;&amp;(C[0]=l.$mouseHandler.$clickSelection.clone()),C.forEach(l.addSelectionMarker,l),l.updateSelectionMarkers()};h&amp;&amp;!a?c.toSingleRange():!h&amp;&amp;a&amp;&amp;(N=c.toOrientedRange(),l.addSelectionMarker(N)),o?w=b.documentToScreenPosition(c.lead):c.moveToPosition(p),E={row:-1,column:-1};var L=function(e){k(),clearInterval(O),l.removeSelectionMarkers(C),C.length||(C=[c.toOrientedRange()]),N&amp;&amp;(l.removeSelectionMarker(N),c.toSingleRange(N));for(var t=0;t&lt;C.length;t++)c.addRange(C[t]);l.inVirtualSelectionMode=!1,l.$mouseHandler.$clickSelection=null},A=k;r.capture(l.container,y,L);var O=setInterval(function(){A()},20);return e.preventDefault()}}var r=e(&quot;../lib/event&quot;),i=e(&quot;../lib/useragent&quot;);t.onMouseDown=o}),ace.define(&quot;ace/commands/multi_select_commands&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/keyboard/hash_handler&quot;],function(e,t,n){t.defaultCommands=[{name:&quot;addCursorAbove&quot;,description:&quot;Add cursor above&quot;,exec:function(e){e.selectMoreLines(-1)},bindKey:{win:&quot;Ctrl-Alt-Up&quot;,mac:&quot;Ctrl-Alt-Up&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;addCursorBelow&quot;,description:&quot;Add cursor below&quot;,exec:function(e){e.selectMoreLines(1)},bindKey:{win:&quot;Ctrl-Alt-Down&quot;,mac:&quot;Ctrl-Alt-Down&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;addCursorAboveSkipCurrent&quot;,description:&quot;Add cursor above (skip current)&quot;,exec:function(e){e.selectMoreLines(-1,!0)},bindKey:{win:&quot;Ctrl-Alt-Shift-Up&quot;,mac:&quot;Ctrl-Alt-Shift-Up&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;addCursorBelowSkipCurrent&quot;,description:&quot;Add cursor below (skip current)&quot;,exec:function(e){e.selectMoreLines(1,!0)},bindKey:{win:&quot;Ctrl-Alt-Shift-Down&quot;,mac:&quot;Ctrl-Alt-Shift-Down&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectMoreBefore&quot;,description:&quot;Select more before&quot;,exec:function(e){e.selectMore(-1)},bindKey:{win:&quot;Ctrl-Alt-Left&quot;,mac:&quot;Ctrl-Alt-Left&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectMoreAfter&quot;,description:&quot;Select more after&quot;,exec:function(e){e.selectMore(1)},bindKey:{win:&quot;Ctrl-Alt-Right&quot;,mac:&quot;Ctrl-Alt-Right&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectNextBefore&quot;,description:&quot;Select next before&quot;,exec:function(e){e.selectMore(-1,!0)},bindKey:{win:&quot;Ctrl-Alt-Shift-Left&quot;,mac:&quot;Ctrl-Alt-Shift-Left&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;selectNextAfter&quot;,description:&quot;Select next after&quot;,exec:function(e){e.selectMore(1,!0)},bindKey:{win:&quot;Ctrl-Alt-Shift-Right&quot;,mac:&quot;Ctrl-Alt-Shift-Right&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0},{name:&quot;toggleSplitSelectionIntoLines&quot;,description:&quot;Split into lines&quot;,exec:function(e){e.multiSelect.rangeCount&gt;1?e.multiSelect.joinSelections():e.multiSelect.splitIntoLines()},bindKey:{win:&quot;Ctrl-Alt-L&quot;,mac:&quot;Ctrl-Alt-L&quot;},readOnly:!0},{name:&quot;splitSelectionIntoLines&quot;,description:&quot;Split into lines&quot;,exec:function(e){e.multiSelect.splitIntoLines()},readOnly:!0},{name:&quot;alignCursors&quot;,description:&quot;Align cursors&quot;,exec:function(e){e.alignCursors()},bindKey:{win:&quot;Ctrl-Alt-A&quot;,mac:&quot;Ctrl-Alt-A&quot;},scrollIntoView:&quot;cursor&quot;},{name:&quot;findAll&quot;,description:&quot;Find all&quot;,exec:function(e){e.findAll()},bindKey:{win:&quot;Ctrl-Alt-K&quot;,mac:&quot;Ctrl-Alt-G&quot;},scrollIntoView:&quot;cursor&quot;,readOnly:!0}],t.multiSelectCommands=[{name:&quot;singleSelection&quot;,description:&quot;Single selection&quot;,bindKey:&quot;esc&quot;,exec:function(e){e.exitMultiSelectMode()},scrollIntoView:&quot;cursor&quot;,readOnly:!0,isAvailable:function(e){return e&amp;&amp;e.inMultiSelectMode}}];var r=e(&quot;../keyboard/hash_handler&quot;).HashHandler;t.keyboardHandler=new r(t.multiSelectCommands)}),ace.define(&quot;ace/multi_select&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range_list&quot;,&quot;ace/range&quot;,&quot;ace/selection&quot;,&quot;ace/mouse/multi_select_handler&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/lang&quot;,&quot;ace/commands/multi_select_commands&quot;,&quot;ace/search&quot;,&quot;ace/edit_session&quot;,&quot;ace/editor&quot;,&quot;ace/config&quot;],function(e,t,n){function h(e,t,n){return c.$options.wrap=!0,c.$options.needle=t,c.$options.backwards=n==-1,c.find(e)}function v(e,t){return e.row==t.row&amp;&amp;e.column==t.column}function m(e){if(e.$multiselectOnSessionChange)return;e.$onAddRange=e.$onAddRange.bind(e),e.$onRemoveRange=e.$onRemoveRange.bind(e),e.$onMultiSelect=e.$onMultiSelect.bind(e),e.$onSingleSelect=e.$onSingleSelect.bind(e),e.$multiselectOnSessionChange=t.onSessionChange.bind(e),e.$checkMultiselectChange=e.$checkMultiselectChange.bind(e),e.$multiselectOnSessionChange(e),e.on(&quot;changeSession&quot;,e.$multiselectOnSessionChange),e.on(&quot;mousedown&quot;,o),e.commands.addCommands(f.defaultCommands),g(e)}function g(e){function r(t){n&amp;&amp;(e.renderer.setMouseCursor(&quot;&quot;),n=!1)}if(!e.textInput)return;var t=e.textInput.getElement(),n=!1;u.addListener(t,&quot;keydown&quot;,function(t){var i=t.keyCode==18&amp;&amp;!(t.ctrlKey||t.shiftKey||t.metaKey);e.$blockSelectEnabled&amp;&amp;i?n||(e.renderer.setMouseCursor(&quot;crosshair&quot;),n=!0):n&amp;&amp;r()}),u.addListener(t,&quot;keyup&quot;,r),u.addListener(t,&quot;blur&quot;,r)}var r=e(&quot;./range_list&quot;).RangeList,i=e(&quot;./range&quot;).Range,s=e(&quot;./selection&quot;).Selection,o=e(&quot;./mouse/multi_select_handler&quot;).onMouseDown,u=e(&quot;./lib/event&quot;),a=e(&quot;./lib/lang&quot;),f=e(&quot;./commands/multi_select_commands&quot;);t.commands=f.defaultCommands.concat(f.multiSelectCommands);var l=e(&quot;./search&quot;).Search,c=new l,p=e(&quot;./edit_session&quot;).EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(p.prototype),function(){this.ranges=null,this.rangeList=null,this.addRange=function(e,t){if(!e)return;if(!this.inMultiSelectMode&amp;&amp;this.rangeCount===0){var n=this.toOrientedRange();this.rangeList.add(n),this.rangeList.add(e);if(this.rangeList.ranges.length!=2)return this.rangeList.removeAll(),t||this.fromOrientedRange(e);this.rangeList.removeAll(),this.rangeList.add(n),this.$onAddRange(n)}e.cursor||(e.cursor=e.end);var r=this.rangeList.add(e);return this.$onAddRange(e),r.length&amp;&amp;this.$onRemoveRange(r),this.rangeCount&gt;1&amp;&amp;!this.inMultiSelectMode&amp;&amp;(this._signal(&quot;multiSelect&quot;),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),t||this.fromOrientedRange(e)},this.toSingleRange=function(e){e=e||this.ranges[0];var t=this.rangeList.removeAll();t.length&amp;&amp;this.$onRemoveRange(t),e&amp;&amp;this.fromOrientedRange(e)},this.substractPoint=function(e){var t=this.rangeList.substractPoint(e);if(t)return this.$onRemoveRange(t),t[0]},this.mergeOverlappingRanges=function(){var e=this.rangeList.merge();e.length&amp;&amp;this.$onRemoveRange(e)},this.$onAddRange=function(e){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(e),this._signal(&quot;addRange&quot;,{range:e})},this.$onRemoveRange=function(e){this.rangeCount=this.rangeList.ranges.length;if(this.rangeCount==1&amp;&amp;this.inMultiSelectMode){var t=this.rangeList.ranges.pop();e.push(t),this.rangeCount=0}for(var n=e.length;n--;){var r=this.ranges.indexOf(e[n]);this.ranges.splice(r,1)}this._signal(&quot;removeRange&quot;,{ranges:e}),this.rangeCount===0&amp;&amp;this.inMultiSelectMode&amp;&amp;(this.inMultiSelectMode=!1,this._signal(&quot;singleSelect&quot;),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),t=t||this.ranges[0],t&amp;&amp;!t.isEqual(this.getRange())&amp;&amp;this.fromOrientedRange(t)},this.$initRangeList=function(){if(this.rangeList)return;this.rangeList=new r,this.ranges=[],this.rangeCount=0},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){var e=this.ranges.length?this.ranges:[this.getRange()],t=[];for(var n=0;n&lt;e.length;n++){var r=e[n],s=r.start.row,o=r.end.row;if(s===o)t.push(r.clone());else{t.push(new i(s,r.start.column,s,this.session.getLine(s).length));while(++s&lt;o)t.push(this.getLineRange(s,!0));t.push(new i(o,0,o,r.end.column))}n==0&amp;&amp;!this.isBackwards()&amp;&amp;(t=t.reverse())}this.toSingleRange();for(var n=t.length;n--;)this.addRange(t[n])},this.joinSelections=function(){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)},this.toggleBlockSelection=function(){if(this.rangeCount&gt;1){var e=this.rangeList.ranges,t=e[e.length-1],n=i.fromPoints(e[0].start,t.end);this.toSingleRange(),this.setSelectionRange(n,t.cursor==t.start)}else{var r=this.session.documentToScreenPosition(this.cursor),s=this.session.documentToScreenPosition(this.anchor),o=this.rectangularRangeBlock(r,s);o.forEach(this.addRange,this)}},this.rectangularRangeBlock=function(e,t,n){var r=[],s=e.column&lt;t.column;if(s)var o=e.column,u=t.column,a=e.offsetX,f=t.offsetX;else var o=t.column,u=e.column,a=t.offsetX,f=e.offsetX;var l=e.row&lt;t.row;if(l)var c=e.row,h=t.row;else var c=t.row,h=e.row;o&lt;0&amp;&amp;(o=0),c&lt;0&amp;&amp;(c=0),c==h&amp;&amp;(n=!0);var p;for(var d=c;d&lt;=h;d++){var m=i.fromPoints(this.session.screenToDocumentPosition(d,o,a),this.session.screenToDocumentPosition(d,u,f));if(m.isEmpty()){if(p&amp;&amp;v(m.end,p))break;p=m.end}m.cursor=s?m.start:m.end,r.push(m)}l&amp;&amp;r.reverse();if(!n){var g=r.length-1;while(r[g].isEmpty()&amp;&amp;g&gt;0)g--;if(g&gt;0){var y=0;while(r[y].isEmpty())y++}for(var b=g;b&gt;=y;b--)r[b].isEmpty()&amp;&amp;r.splice(b,1)}return r}}.call(s.prototype);var d=e(&quot;./editor&quot;).Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(e){e.cursor||(e.cursor=e.end);var t=this.getSelectionStyle();return e.marker=this.session.addMarker(e,&quot;ace_selection&quot;,t),this.session.$selectionMarkers.push(e),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,e},this.removeSelectionMarker=function(e){if(!e.marker)return;this.session.removeMarker(e.marker);var t=this.session.$selectionMarkers.indexOf(e);t!=-1&amp;&amp;this.session.$selectionMarkers.splice(t,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length},this.removeSelectionMarkers=function(e){var t=this.session.$selectionMarkers;for(var n=e.length;n--;){var r=e[n];if(!r.marker)continue;this.session.removeMarker(r.marker);var i=t.indexOf(r);i!=-1&amp;&amp;t.splice(i,1)}this.session.selectionMarkerCount=t.length},this.$onAddRange=function(e){this.addSelectionMarker(e.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(e){if(this.inMultiSelectMode)return;this.inMultiSelectMode=!0,this.setStyle(&quot;ace_multiselect&quot;),this.keyBinding.addKeyboardHandler(f.keyboardHandler),this.commands.setDefaultHandler(&quot;exec&quot;,this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onSingleSelect=function(e){if(this.session.multiSelect.inVirtualMode)return;this.inMultiSelectMode=!1,this.unsetStyle(&quot;ace_multiselect&quot;),this.keyBinding.removeKeyboardHandler(f.keyboardHandler),this.commands.removeDefaultHandler(&quot;exec&quot;,this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit(&quot;changeSelection&quot;)},this.$onMultiSelectExec=function(e){var t=e.command,n=e.editor;if(!n.multiSelect)return;if(!t.multiSelectAction){var r=t.exec(n,e.args||{});n.multiSelect.addRange(n.multiSelect.toOrientedRange()),n.multiSelect.mergeOverlappingRanges()}else t.multiSelectAction==&quot;forEach&quot;?r=n.forEachSelection(t,e.args):t.multiSelectAction==&quot;forEachLine&quot;?r=n.forEachSelection(t,e.args,!0):t.multiSelectAction==&quot;single&quot;?(n.exitMultiSelectMode(),r=t.exec(n,e.args||{})):r=t.multiSelectAction(n,e.args||{});return r},this.forEachSelection=function(e,t,n){if(this.inVirtualSelectionMode)return;var r=n&amp;&amp;n.keepOrder,i=n==1||n&amp;&amp;n.$byLines,o=this.session,u=this.selection,a=u.rangeList,f=(r?u:a).ranges,l;if(!f.length)return e.exec?e.exec(this,t||{}):e(this,t||{});var c=u._eventRegistry;u._eventRegistry={};var h=new s(o);this.inVirtualSelectionMode=!0;for(var p=f.length;p--;){if(i)while(p&gt;0&amp;&amp;f[p].start.row==f[p-1].end.row)p--;h.fromOrientedRange(f[p]),h.index=p,this.selection=o.selection=h;var d=e.exec?e.exec(this,t||{}):e(this,t||{});!l&amp;&amp;d!==undefined&amp;&amp;(l=d),h.toOrientedRange(f[p])}h.detach(),this.selection=o.selection=u,this.inVirtualSelectionMode=!1,u._eventRegistry=c,u.mergeOverlappingRanges(),u.ranges[0]&amp;&amp;u.fromOrientedRange(u.ranges[0]);var v=this.renderer.$scrollAnimation;return this.onCursorChange(),this.onSelectionChange(),v&amp;&amp;v.from==v.to&amp;&amp;this.renderer.animateScrolling(v.from),l},this.exitMultiSelectMode=function(){if(!this.inMultiSelectMode||this.inVirtualSelectionMode)return;this.multiSelect.toSingleRange()},this.getSelectedText=function(){var e=&quot;&quot;;if(this.inMultiSelectMode&amp;&amp;!this.inVirtualSelectionMode){var t=this.multiSelect.rangeList.ranges,n=[];for(var r=0;r&lt;t.length;r++)n.push(this.session.getTextRange(t[r]));var i=this.session.getDocument().getNewLineCharacter();e=n.join(i),e.length==(n.length-1)*i.length&amp;&amp;(e=&quot;&quot;)}else this.selection.isEmpty()||(e=this.session.getTextRange(this.getSelectionRange()));return e},this.$checkMultiselectChange=function(e,t){if(this.inMultiSelectMode&amp;&amp;!this.inVirtualSelectionMode){var n=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&amp;&amp;t==this.multiSelect.anchor)return;var r=t==this.multiSelect.anchor?n.cursor==n.start?n.end:n.start:n.cursor;r.row!=t.row||this.session.$clipPositionToDocument(r.row,r.column).column!=t.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()}},this.findAll=function(e,t,n){t=t||{},t.needle=e||t.needle;if(t.needle==undefined){var r=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();t.needle=this.session.getTextRange(r)}this.$search.set(t);var i=this.$search.findAll(this.session);if(!i.length)return 0;var s=this.multiSelect;n||s.toSingleRange(i[0]);for(var o=i.length;o--;)s.addRange(i[o],!0);return r&amp;&amp;s.rangeList.rangeAtPoint(r.start)&amp;&amp;s.addRange(r,!0),i.length},this.selectMoreLines=function(e,t){var n=this.selection.toOrientedRange(),r=n.cursor==n.end,s=this.session.documentToScreenPosition(n.cursor);this.selection.$desiredColumn&amp;&amp;(s.column=this.selection.$desiredColumn);var o=this.session.screenToDocumentPosition(s.row+e,s.column);if(!n.isEmpty())var u=this.session.documentToScreenPosition(r?n.end:n.start),a=this.session.screenToDocumentPosition(u.row+e,u.column);else var a=o;if(r){var f=i.fromPoints(o,a);f.cursor=f.start}else{var f=i.fromPoints(a,o);f.cursor=f.end}f.desiredColumn=s.column;if(!this.selection.inMultiSelectMode)this.selection.addRange(n);else if(t)var l=n.cursor;this.selection.addRange(f),l&amp;&amp;this.selection.substractPoint(l)},this.transposeSelections=function(e){var t=this.session,n=t.multiSelect,r=n.ranges;for(var i=r.length;i--;){var s=r[i];if(s.isEmpty()){var o=t.getWordRange(s.start.row,s.start.column);s.start.row=o.start.row,s.start.column=o.start.column,s.end.row=o.end.row,s.end.column=o.end.column}}n.mergeOverlappingRanges();var u=[];for(var i=r.length;i--;){var s=r[i];u.unshift(t.getTextRange(s))}e&lt;0?u.unshift(u.pop()):u.push(u.shift());for(var i=r.length;i--;){var s=r[i],o=s.clone();t.replace(s,u[i]),s.start.row=o.start.row,s.start.column=o.start.column}n.fromOrientedRange(n.ranges[0])},this.selectMore=function(e,t,n){var r=this.session,i=r.multiSelect,s=i.toOrientedRange();if(s.isEmpty()){s=r.getWordRange(s.start.row,s.start.column),s.cursor=e==-1?s.start:s.end,this.multiSelect.addRange(s);if(n)return}var o=r.getTextRange(s),u=h(r,o,e);u&amp;&amp;(u.cursor=e==-1?u.start:u.end,this.session.unfold(u),this.multiSelect.addRange(u),this.renderer.scrollCursorIntoView(null,.5)),t&amp;&amp;this.multiSelect.substractPoint(s.cursor)},this.alignCursors=function(){var e=this.session,t=e.multiSelect,n=t.ranges,r=-1,s=n.filter(function(e){if(e.cursor.row==r)return!0;r=e.cursor.row});if(!n.length||s.length==n.length-1){var o=this.selection.getRange(),u=o.start.row,f=o.end.row,l=u==f;if(l){var c=this.session.getLength(),h;do h=this.session.getLine(f);while(/[=:]/.test(h)&amp;&amp;++f&lt;c);do h=this.session.getLine(u);while(/[=:]/.test(h)&amp;&amp;--u&gt;0);u&lt;0&amp;&amp;(u=0),f&gt;=c&amp;&amp;(f=c-1)}var p=this.session.removeFullLines(u,f);p=this.$reAlignText(p,l),this.session.insert({row:u,column:0},p.join(&quot;\sn&quot;)+&quot;\sn&quot;),l||(o.start.column=0,o.end.column=p[p.length-1].length),this.selection.setRange(o)}else{s.forEach(function(e){t.substractPoint(e.cursor)});var d=0,v=Infinity,m=n.map(function(t){var n=t.cursor,r=e.getLine(n.row),i=r.substr(n.column).search(/\sS/g);return i==-1&amp;&amp;(i=0),n.column&gt;d&amp;&amp;(d=n.column),i&lt;v&amp;&amp;(v=i),i});n.forEach(function(t,n){var r=t.cursor,s=d-r.column,o=m[n]-v;s&gt;o?e.insert(r,a.stringRepeat(&quot; &quot;,s-o)):e.remove(new i(r.row,r.column,r.row,r.column-s+o)),t.start.column=t.end.column=d,t.start.row=t.end.row=r.row,t.cursor=t.end}),t.fromOrientedRange(n[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}},this.$reAlignText=function(e,t){function u(e){return a.stringRepeat(&quot; &quot;,e)}function f(e){return e[2]?u(i)+e[2]+u(s-e[2].length+o)+e[4].replace(/^([=:])\ss+/,&quot;$1 &quot;):e[0]}function l(e){return e[2]?u(i+s-e[2].length)+e[2]+u(o)+e[4].replace(/^([=:])\ss+/,&quot;$1 &quot;):e[0]}function c(e){return e[2]?u(i)+e[2]+u(o)+e[4].replace(/^([=:])\ss+/,&quot;$1 &quot;):e[0]}var n=!0,r=!0,i,s,o;return e.map(function(e){var t=e.match(/(\ss*)(.*?)(\ss*)([=:].*)/);return t?i==null?(i=t[1].length,s=t[2].length,o=t[3].length,t):(i+s+o!=t[1].length+t[2].length+t[3].length&amp;&amp;(r=!1),i!=t[1].length&amp;&amp;(n=!1),i&gt;t[1].length&amp;&amp;(i=t[1].length),s&lt;t[2].length&amp;&amp;(s=t[2].length),o&gt;t[3].length&amp;&amp;(o=t[3].length),t):[e]}).map(t?f:n?r?l:f:c)}}).call(d.prototype),t.onSessionChange=function(e){var t=e.session;t&amp;&amp;!t.multiSelect&amp;&amp;(t.$selectionMarkers=[],t.selection.$initRangeList(),t.multiSelect=t.selection),this.multiSelect=t&amp;&amp;t.multiSelect;var n=e.oldSession;n&amp;&amp;(n.multiSelect.off(&quot;addRange&quot;,this.$onAddRange),n.multiSelect.off(&quot;removeRange&quot;,this.$onRemoveRange),n.multiSelect.off(&quot;multiSelect&quot;,this.$onMultiSelect),n.multiSelect.off(&quot;singleSelect&quot;,this.$onSingleSelect),n.multiSelect.lead.off(&quot;change&quot;,this.$checkMultiselectChange),n.multiSelect.anchor.off(&quot;change&quot;,this.$checkMultiselectChange)),t&amp;&amp;(t.multiSelect.on(&quot;addRange&quot;,this.$onAddRange),t.multiSelect.on(&quot;removeRange&quot;,this.$onRemoveRange),t.multiSelect.on(&quot;multiSelect&quot;,this.$onMultiSelect),t.multiSelect.on(&quot;singleSelect&quot;,this.$onSingleSelect),t.multiSelect.lead.on(&quot;change&quot;,this.$checkMultiselectChange),t.multiSelect.anchor.on(&quot;change&quot;,this.$checkMultiselectChange)),t&amp;&amp;this.inMultiSelectMode!=t.selection.inMultiSelectMode&amp;&amp;(t.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},t.MultiSelect=m,e(&quot;./config&quot;).defineOptions(d.prototype,&quot;editor&quot;,{enableMultiselect:{set:function(e){m(this),e?(this.on(&quot;changeSession&quot;,this.$multiselectOnSessionChange),this.on(&quot;mousedown&quot;,o)):(this.off(&quot;changeSession&quot;,this.$multiselectOnSessionChange),this.off(&quot;mousedown&quot;,o))},value:!0},enableBlockSelect:{set:function(e){this.$blockSelectEnabled=e},value:!0}})}),ace.define(&quot;ace/mode/folding/fold_mode&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../range&quot;).Range,i=t.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);return this.foldingStartMarker.test(r)?&quot;start&quot;:t==&quot;markbeginend&quot;&amp;&amp;this.foldingStopMarker&amp;&amp;this.foldingStopMarker.test(r)?&quot;end&quot;:&quot;&quot;},this.getFoldWidgetRange=function(e,t,n){return null},this.indentationBlock=function(e,t,n){var i=/\sS/,s=e.getLine(t),o=s.search(i);if(o==-1)return;var u=n||s.length,a=e.getLength(),f=t,l=t;while(++t&lt;a){var c=e.getLine(t).search(i);if(c==-1)continue;if(c&lt;=o){var h=e.getTokenAt(t,0);if(!h||h.type!==&quot;string&quot;)break}l=t}if(l&gt;f){var p=e.getLine(l).length;return new r(f,u,l,p)}},this.openingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i+1},u=e.$findClosingBracket(t,o,s);if(!u)return;var a=e.foldWidgets[u.row];return a==null&amp;&amp;(a=e.getFoldWidget(u.row)),a==&quot;start&quot;&amp;&amp;u.row&gt;o.row&amp;&amp;(u.row--,u.column=e.getLine(u.row).length),r.fromPoints(o,u)},this.closingBracketBlock=function(e,t,n,i,s){var o={row:n,column:i},u=e.$findOpeningBracket(t,o);if(!u)return;return u.column++,o.column--,r.fromPoints(u,o)}}).call(i.prototype)}),ace.define(&quot;ace/theme/textmate&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;t.isDark=!1,t.cssClass=&quot;ace-tm&quot;,t.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==&quot;) right repeat-y;}',t.$id=&quot;ace/theme/textmate&quot;;var r=e(&quot;../lib/dom&quot;);r.importCssString(t.cssText,t.cssClass)}),ace.define(&quot;ace/line_widgets&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;function i(e){this.session=e,this.session.widgetManager=this,this.session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on(&quot;change&quot;,this.updateOnChange),this.session.on(&quot;changeFold&quot;,this.updateOnFold),this.session.on(&quot;changeEditor&quot;,this.$onChangeEditor)}var r=e(&quot;./lib/dom&quot;);(function(){this.getRowLength=function(e){var t;return this.lineWidgets?t=this.lineWidgets[e]&amp;&amp;this.lineWidgets[e].rowCount||0:t=0,!this.$useWrapMode||!this.$wrapData[e]?1+t:this.$wrapData[e].length+1+t},this.$getWidgetScreenLength=function(){var e=0;return this.lineWidgets.forEach(function(t){t&amp;&amp;t.rowCount&amp;&amp;!t.hidden&amp;&amp;(e+=t.rowCount)}),e},this.$onChangeEditor=function(e){this.attach(e.editor)},this.attach=function(e){e&amp;&amp;e.widgetManager&amp;&amp;e.widgetManager!=this&amp;&amp;e.widgetManager.detach();if(this.editor==e)return;this.detach(),this.editor=e,e&amp;&amp;(e.widgetManager=this,e.renderer.on(&quot;beforeRender&quot;,this.measureWidgets),e.renderer.on(&quot;afterRender&quot;,this.renderWidgets))},this.detach=function(e){var t=this.editor;if(!t)return;this.editor=null,t.widgetManager=null,t.renderer.off(&quot;beforeRender&quot;,this.measureWidgets),t.renderer.off(&quot;afterRender&quot;,this.renderWidgets);var n=this.session.lineWidgets;n&amp;&amp;n.forEach(function(e){e&amp;&amp;e.el&amp;&amp;e.el.parentNode&amp;&amp;(e._inDocument=!1,e.el.parentNode.removeChild(e.el))})},this.updateOnFold=function(e,t){var n=t.lineWidgets;if(!n||!e.action)return;var r=e.data,i=r.start.row,s=r.end.row,o=e.action==&quot;add&quot;;for(var u=i+1;u&lt;s;u++)n[u]&amp;&amp;(n[u].hidden=o);n[s]&amp;&amp;(o?n[i]?n[s].hidden=o:n[i]=n[s]:(n[i]==n[s]&amp;&amp;(n[i]=undefined),n[s].hidden=o))},this.updateOnChange=function(e){var t=this.session.lineWidgets;if(!t)return;var n=e.start.row,r=e.end.row-n;if(r!==0)if(e.action==&quot;remove&quot;){var i=t.splice(n+1,r);!t[n]&amp;&amp;i[i.length-1]&amp;&amp;(t[n]=i.pop()),i.forEach(function(e){e&amp;&amp;this.removeLineWidget(e)},this),this.$updateRows()}else{var s=new Array(r);t[n]&amp;&amp;t[n].column!=null&amp;&amp;e.start.column&gt;t[n].column&amp;&amp;n++,s.unshift(n,0),t.splice.apply(t,s),this.$updateRows()}},this.$updateRows=function(){var e=this.session.lineWidgets;if(!e)return;var t=!0;e.forEach(function(e,n){if(e){t=!1,e.row=n;while(e.$oldWidget)e.$oldWidget.row=n,e=e.$oldWidget}}),t&amp;&amp;(this.session.lineWidgets=null)},this.$registerLineWidget=function(e){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var t=this.session.lineWidgets[e.row];return t&amp;&amp;(e.$oldWidget=t,t.el&amp;&amp;t.el.parentNode&amp;&amp;(t.el.parentNode.removeChild(t.el),t._inDocument=!1)),this.session.lineWidgets[e.row]=e,e},this.addLineWidget=function(e){this.$registerLineWidget(e),e.session=this.session;if(!this.editor)return e;var t=this.editor.renderer;e.html&amp;&amp;!e.el&amp;&amp;(e.el=r.createElement(&quot;div&quot;),e.el.innerHTML=e.html),e.el&amp;&amp;(r.addCssClass(e.el,&quot;ace_lineWidgetContainer&quot;),e.el.style.position=&quot;absolute&quot;,e.el.style.zIndex=5,t.container.appendChild(e.el),e._inDocument=!0,e.coverGutter||(e.el.style.zIndex=3),e.pixelHeight==null&amp;&amp;(e.pixelHeight=e.el.offsetHeight)),e.rowCount==null&amp;&amp;(e.rowCount=e.pixelHeight/t.layerConfig.lineHeight);var n=this.session.getFoldAt(e.row,0);e.$fold=n;if(n){var i=this.session.lineWidgets;e.row==n.end.row&amp;&amp;!i[n.start.row]?i[n.start.row]=e:e.hidden=!0}return this.session._emit(&quot;changeFold&quot;,{data:{start:{row:e.row}}}),this.$updateRows(),this.renderWidgets(null,t),this.onWidgetChanged(e),e},this.removeLineWidget=function(e){e._inDocument=!1,e.session=null,e.el&amp;&amp;e.el.parentNode&amp;&amp;e.el.parentNode.removeChild(e.el);if(e.editor&amp;&amp;e.editor.destroy)try{e.editor.destroy()}catch(t){}if(this.session.lineWidgets){var n=this.session.lineWidgets[e.row];if(n==e)this.session.lineWidgets[e.row]=e.$oldWidget,e.$oldWidget&amp;&amp;this.onWidgetChanged(e.$oldWidget);else while(n){if(n.$oldWidget==e){n.$oldWidget=e.$oldWidget;break}n=n.$oldWidget}}this.session._emit(&quot;changeFold&quot;,{data:{start:{row:e.row}}}),this.$updateRows()},this.getWidgetsAtRow=function(e){var t=this.session.lineWidgets,n=t&amp;&amp;t[e],r=[];while(n)r.push(n),n=n.$oldWidget;return r},this.onWidgetChanged=function(e){this.session._changedWidgets.push(e),this.editor&amp;&amp;this.editor.renderer.updateFull()},this.measureWidgets=function(e,t){var n=this.session._changedWidgets,r=t.layerConfig;if(!n||!n.length)return;var i=Infinity;for(var s=0;s&lt;n.length;s++){var o=n[s];if(!o||!o.el)continue;if(o.session!=this.session)continue;if(!o._inDocument){if(this.session.lineWidgets[o.row]!=o)continue;o._inDocument=!0,t.container.appendChild(o.el)}o.h=o.el.offsetHeight,o.fixedWidth||(o.w=o.el.offsetWidth,o.screenWidth=Math.ceil(o.w/r.characterWidth));var u=o.h/r.lineHeight;o.coverLine&amp;&amp;(u-=this.session.getRowLineCount(o.row),u&lt;0&amp;&amp;(u=0)),o.rowCount!=u&amp;&amp;(o.rowCount=u,o.row&lt;i&amp;&amp;(i=o.row))}i!=Infinity&amp;&amp;(this.session._emit(&quot;changeFold&quot;,{data:{start:{row:i}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]},this.renderWidgets=function(e,t){var n=t.layerConfig,r=this.session.lineWidgets;if(!r)return;var i=Math.min(this.firstRow,n.firstRow),s=Math.max(this.lastRow,n.lastRow,r.length);while(i&gt;0&amp;&amp;!r[i])i--;this.firstRow=n.firstRow,this.lastRow=n.lastRow,t.$cursorLayer.config=n;for(var o=i;o&lt;=s;o++){var u=r[o];if(!u||!u.el)continue;if(u.hidden){u.el.style.top=-100-(u.pixelHeight||0)+&quot;px&quot;;continue}u._inDocument||(u._inDocument=!0,t.container.appendChild(u.el));var a=t.$cursorLayer.getPixelPosition({row:o,column:0},!0).top;u.coverLine||(a+=n.lineHeight*this.session.getRowLineCount(u.row)),u.el.style.top=a-n.offset+&quot;px&quot;;var f=u.coverGutter?0:t.gutterWidth;u.fixedWidth||(f-=t.scrollLeft),u.el.style.left=f+&quot;px&quot;,u.fullWidth&amp;&amp;u.screenWidth&amp;&amp;(u.el.style.minWidth=n.width+2*n.padding+&quot;px&quot;),u.fixedWidth?u.el.style.right=t.scrollBar.getWidth()+&quot;px&quot;:u.el.style.right=&quot;&quot;}}}).call(i.prototype),t.LineWidgets=i}),ace.define(&quot;ace/ext/error_marker&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/line_widgets&quot;,&quot;ace/lib/dom&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;function o(e,t,n){var r=0,i=e.length-1;while(r&lt;=i){var s=r+i&gt;&gt;1,o=n(t,e[s]);if(o&gt;0)r=s+1;else{if(!(o&lt;0))return s;i=s-1}}return-(r+1)}function u(e,t,n){var r=e.getAnnotations().sort(s.comparePoints);if(!r.length)return;var i=o(r,{row:t,column:-1},s.comparePoints);i&lt;0&amp;&amp;(i=-i-1),i&gt;=r.length?i=n&gt;0?0:r.length-1:i===0&amp;&amp;n&lt;0&amp;&amp;(i=r.length-1);var u=r[i];if(!u||!n)return;if(u.row===t){do u=r[i+=n];while(u&amp;&amp;u.row===t);if(!u)return r.slice()}var a=[];t=u.row;do a[n&lt;0?&quot;unshift&quot;:&quot;push&quot;](u),u=r[i+=n];while(u&amp;&amp;u.row==t);return a.length&amp;&amp;a}var r=e(&quot;../line_widgets&quot;).LineWidgets,i=e(&quot;../lib/dom&quot;),s=e(&quot;../range&quot;).Range;t.showErrorMarker=function(e,t){var n=e.session;n.widgetManager||(n.widgetManager=new r(n),n.widgetManager.attach(e));var s=e.getCursorPosition(),o=s.row,a=n.widgetManager.getWidgetsAtRow(o).filter(function(e){return e.type==&quot;errorMarker&quot;})[0];a?a.destroy():o-=t;var f=u(n,o,t),l;if(f){var c=f[0];s.column=(c.pos&amp;&amp;typeof c.column!=&quot;number&quot;?c.pos.sc:c.column)||0,s.row=c.row,l=e.renderer.$gutterLayer.$annotations[s.row]}else{if(a)return;l={text:[&quot;Looks good!&quot;],className:&quot;ace_ok&quot;}}e.session.unfold(s.row),e.selection.moveToPosition(s);var h={row:s.row,fixedWidth:!0,coverGutter:!0,el:i.createElement(&quot;div&quot;),type:&quot;errorMarker&quot;},p=h.el.appendChild(i.createElement(&quot;div&quot;)),d=h.el.appendChild(i.createElement(&quot;div&quot;));d.className=&quot;error_widget_arrow &quot;+l.className;var v=e.renderer.$cursorLayer.getPixelPosition(s).left;d.style.left=v+e.renderer.gutterWidth-5+&quot;px&quot;,h.el.className=&quot;error_widget_wrapper&quot;,p.className=&quot;error_widget &quot;+l.className,p.innerHTML=l.text.join(&quot;&lt;br&gt;&quot;),p.appendChild(i.createElement(&quot;div&quot;));var m=function(e,t,n){if(t===0&amp;&amp;(n===&quot;esc&quot;||n===&quot;return&quot;))return h.destroy(),{command:&quot;null&quot;}};h.destroy=function(){if(e.$mouseHandler.isMousePressed)return;e.keyBinding.removeKeyboardHandler(m),n.widgetManager.removeLineWidget(h),e.off(&quot;changeSelection&quot;,h.destroy),e.off(&quot;changeSession&quot;,h.destroy),e.off(&quot;mouseup&quot;,h.destroy),e.off(&quot;change&quot;,h.destroy)},e.keyBinding.addKeyboardHandler(m),e.on(&quot;changeSelection&quot;,h.destroy),e.on(&quot;changeSession&quot;,h.destroy),e.on(&quot;mouseup&quot;,h.destroy),e.on(&quot;change&quot;,h.destroy),e.session.widgetManager.addLineWidget(h),h.el.onmousedown=e.focus.bind(e),e.renderer.scrollCursorIntoView(null,.5,{bottom:h.el.offsetHeight})},i.importCssString(&quot;    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }&quot;,&quot;&quot;)}),ace.define(&quot;ace/ace&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/fixoldbrowsers&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/event&quot;,&quot;ace/range&quot;,&quot;ace/editor&quot;,&quot;ace/edit_session&quot;,&quot;ace/undomanager&quot;,&quot;ace/virtual_renderer&quot;,&quot;ace/worker/worker_client&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/placeholder&quot;,&quot;ace/multi_select&quot;,&quot;ace/mode/folding/fold_mode&quot;,&quot;ace/theme/textmate&quot;,&quot;ace/ext/error_marker&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;e(&quot;./lib/fixoldbrowsers&quot;);var r=e(&quot;./lib/dom&quot;),i=e(&quot;./lib/event&quot;),s=e(&quot;./range&quot;).Range,o=e(&quot;./editor&quot;).Editor,u=e(&quot;./edit_session&quot;).EditSession,a=e(&quot;./undomanager&quot;).UndoManager,f=e(&quot;./virtual_renderer&quot;).VirtualRenderer;e(&quot;./worker/worker_client&quot;),e(&quot;./keyboard/hash_handler&quot;),e(&quot;./placeholder&quot;),e(&quot;./multi_select&quot;),e(&quot;./mode/folding/fold_mode&quot;),e(&quot;./theme/textmate&quot;),e(&quot;./ext/error_marker&quot;),t.config=e(&quot;./config&quot;),t.require=e,typeof define==&quot;function&quot;&amp;&amp;(t.define=define),t.edit=function(e,n){if(typeof e==&quot;string&quot;){var s=e;e=document.getElementById(s);if(!e)throw new Error(&quot;ace.edit can't find div #&quot;+s)}if(e&amp;&amp;e.env&amp;&amp;e.env.editor instanceof o)return e.env.editor;var u=&quot;&quot;;if(e&amp;&amp;/input|textarea/i.test(e.tagName)){var a=e;u=a.value,e=r.createElement(&quot;pre&quot;),a.parentNode.replaceChild(e,a)}else e&amp;&amp;(u=e.textContent,e.innerHTML=&quot;&quot;);var l=t.createEditSession(u),c=new o(new f(e),l,n),h={document:l,editor:c,onResize:c.resize.bind(c,null)};return a&amp;&amp;(h.textarea=a),i.addListener(window,&quot;resize&quot;,h.onResize),c.on(&quot;destroy&quot;,function(){i.removeListener(window,&quot;resize&quot;,h.onResize),h.editor.container.env=null}),c.container.env=c.env=h,c},t.createEditSession=function(e,t){var n=new u(e,t);return n.setUndoManager(new a),n},t.Range=s,t.Editor=o,t.EditSession=u,t.UndoManager=a,t.VirtualRenderer=f,t.version=t.config.version});            (function() {\n                ace.require([&quot;ace/ace&quot;], function(a) {\n                    if (a) {\n                        a.config.init(true);\n                        a.define = ace.define;\n                    }\n                    if (!window.ace)\n                        window.ace = a;\n                    for (var key in a) if (a.hasOwnProperty(key))\n                        window.ace[key] = a[key];\n                    window.ace[&quot;default&quot;] = window.ace;\n                    if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                        module.exports = window.ace;\n                    }\n                });\n            })();\n        \n//}}}\n//{{{\n\n/* Code filename: ext-language_tools.js */\nace.define(&quot;ace/snippets&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/lib/lang&quot;,&quot;ace/range&quot;,&quot;ace/range_list&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/tokenizer&quot;,&quot;ace/clipboard&quot;,&quot;ace/lib/dom&quot;,&quot;ace/editor&quot;],function(e,t,n){&quot;use strict&quot;;function h(e){var t=(new Date).toLocaleString(&quot;en-us&quot;,e);return t.length==1?&quot;0&quot;+t:t}var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/event_emitter&quot;).EventEmitter,s=e(&quot;./lib/lang&quot;),o=e(&quot;./range&quot;).Range,u=e(&quot;./range_list&quot;).RangeList,a=e(&quot;./keyboard/hash_handler&quot;).HashHandler,f=e(&quot;./tokenizer&quot;).Tokenizer,l=e(&quot;./clipboard&quot;),c={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,n){var r=e.session.getTextRange();return n?r.replace(/\sn\sr?([ \st]*\sS)/g,&quot;\sn&quot;+n+&quot;$1&quot;):r},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?&quot;YES&quot;:&quot;NO&quot;},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return l.getText&amp;&amp;l.getText()},FILENAME:function(e){return/[^/\s\s]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\s\s]*$/.exec(this.FILEPATH(e))[0].replace(/\s.[^.]*$/,&quot;&quot;)},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\s\s]*$/,&quot;&quot;)},FILEPATH:function(e){return&quot;/not implemented.txt&quot;},WORKSPACE_NAME:function(){return&quot;Unknown&quot;},FULLNAME:function(){return&quot;Unknown&quot;},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&amp;&amp;t.blockComment.start||&quot;&quot;},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&amp;&amp;t.blockComment.end||&quot;&quot;},LINE_COMMENT:function(e){var t=e.session.$mode||{};return t.lineCommentStart||&quot;&quot;},CURRENT_YEAR:h.bind(null,{year:&quot;numeric&quot;}),CURRENT_YEAR_SHORT:h.bind(null,{year:&quot;2-digit&quot;}),CURRENT_MONTH:h.bind(null,{month:&quot;numeric&quot;}),CURRENT_MONTH_NAME:h.bind(null,{month:&quot;long&quot;}),CURRENT_MONTH_NAME_SHORT:h.bind(null,{month:&quot;short&quot;}),CURRENT_DATE:h.bind(null,{day:&quot;2-digit&quot;}),CURRENT_DAY_NAME:h.bind(null,{weekday:&quot;long&quot;}),CURRENT_DAY_NAME_SHORT:h.bind(null,{weekday:&quot;short&quot;}),CURRENT_HOUR:h.bind(null,{hour:&quot;2-digit&quot;,hour12:!1}),CURRENT_MINUTE:h.bind(null,{minute:&quot;2-digit&quot;}),CURRENT_SECOND:h.bind(null,{second:&quot;2-digit&quot;})};c.SELECTED_TEXT=c.SELECTION;var p=function(){this.snippetMap={},this.snippetNameMap={}};(function(){r.implement(this,i),this.getTokenizer=function(){return p.$tokenizer||this.createTokenizer()},this.createTokenizer=function(){function e(e){return e=e.substr(1),/^\sd+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return&quot;(?:[^\s\s\s\s&quot;+e+&quot;]|\s\s\s\s.)&quot;}var n={regex:&quot;/(&quot;+t(&quot;/&quot;)+&quot;+)/&quot;,onMatch:function(e,t,n){var r=n[0];return r.fmtString=!0,r.guard=e.slice(1,-1),r.flag=&quot;&quot;,&quot;&quot;},next:&quot;formatString&quot;};return p.$tokenizer=new f({start:[{regex:/\s\s./,onMatch:function(e,t,n){var r=e[1];return r==&quot;}&quot;&amp;&amp;n.length?e=r:&quot;`$\s\s&quot;.indexOf(r)!=-1&amp;&amp;(e=r),[e]}},{regex:/}/,onMatch:function(e,t,n){return[n.length?n.shift():e]}},{regex:/\s$(?:\sd+|\sw+)/,onMatch:e},{regex:/\s$\s{[\sdA-Z_a-z]+/,onMatch:function(t,n,r){var i=e(t.substr(1));return r.unshift(i[0]),i},next:&quot;snippetVar&quot;},{regex:/\sn/,token:&quot;newline&quot;,merge:!1}],snippetVar:[{regex:&quot;\s\s|&quot;+t(&quot;\s\s|&quot;)+&quot;*\s\s|&quot;,onMatch:function(e,t,n){var r=e.slice(1,-1).replace(/\s\s[,|\s\s]|,/g,function(e){return e.length==2?e[1]:&quot;\s0&quot;}).split(&quot;\s0&quot;);return n[0].choices=r,[r[0]]},next:&quot;start&quot;},n,{regex:&quot;([^:}\s\s\s\s]|\s\s\s\s.)*:?&quot;,token:&quot;&quot;,next:&quot;start&quot;}],formatString:[{regex:/:/,onMatch:function(e,t,n){return n.length&amp;&amp;n[0].expectElse?(n[0].expectElse=!1,n[0].ifEnd={elseEnd:n[0]},[n[0].ifEnd]):&quot;:&quot;}},{regex:/\s\s./,onMatch:function(e,t,n){var r=e[1];return r==&quot;}&quot;&amp;&amp;n.length?e=r:&quot;`$\s\s&quot;.indexOf(r)!=-1?e=r:r==&quot;n&quot;?e=&quot;\sn&quot;:r==&quot;t&quot;?e=&quot;	&quot;:&quot;ulULE&quot;.indexOf(r)!=-1&amp;&amp;(e={changeCase:r,local:r&gt;&quot;a&quot;}),[e]}},{regex:&quot;/\s\sw*}&quot;,onMatch:function(e,t,n){var r=n.shift();return r&amp;&amp;(r.flag=e.slice(1,-1)),this.next=r&amp;&amp;r.tabstopId?&quot;start&quot;:&quot;&quot;,[r||e]},next:&quot;start&quot;},{regex:/\s$(?:\sd+|\sw+)/,onMatch:function(e,t,n){return[{text:e.slice(1)}]}},{regex:/\s${\sw+/,onMatch:function(e,t,n){var r={text:e.slice(2)};return n.unshift(r),[r]},next:&quot;formatStringVar&quot;},{regex:/\sn/,token:&quot;newline&quot;,merge:!1},{regex:/}/,onMatch:function(e,t,n){var r=n.shift();return this.next=r&amp;&amp;r.tabstopId?&quot;start&quot;:&quot;&quot;,[r||e]},next:&quot;start&quot;}],formatStringVar:[{regex:/:\s/\sw+}/,onMatch:function(e,t,n){var r=n[0];return r.formatFunction=e.slice(2,-1),[n.shift()]},next:&quot;formatString&quot;},n,{regex:/:[\s?\s-+]?/,onMatch:function(e,t,n){e[1]==&quot;+&quot;&amp;&amp;(n[0].ifEnd=n[0]),e[1]==&quot;?&quot;&amp;&amp;(n[0].expectElse=!0)},next:&quot;formatString&quot;},{regex:&quot;([^:}\s\s\s\s]|\s\s\s\s.)*:?&quot;,token:&quot;&quot;,next:&quot;formatString&quot;}]}),p.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.getVariableValue=function(e,t,n){if(/^\sd+$/.test(t))return(this.variables.__||{})[t]||&quot;&quot;;if(/^[A-Z]\sd+$/.test(t))return(this.variables[t[0]+&quot;__&quot;]||{})[t.substr(1)]||&quot;&quot;;t=t.replace(/^TM_/,&quot;&quot;);if(!this.variables.hasOwnProperty(t))return&quot;&quot;;var r=this.variables[t];return typeof r==&quot;function&quot;&amp;&amp;(r=this.variables[t](e,t,n)),r==null?&quot;&quot;:r},this.variables=c,this.tmStrFormat=function(e,t,n){if(!t.fmt)return e;var r=t.flag||&quot;&quot;,i=t.guard;i=new RegExp(i,r.replace(/[^gim]/g,&quot;&quot;));var s=typeof t.fmt==&quot;string&quot;?this.tokenizeTmSnippet(t.fmt,&quot;formatString&quot;):t.fmt,o=this,u=e.replace(i,function(){var e=o.variables.__;o.variables.__=[].slice.call(arguments);var t=o.resolveVariables(s,n),r=&quot;E&quot;;for(var i=0;i&lt;t.length;i++){var u=t[i];if(typeof u==&quot;object&quot;){t[i]=&quot;&quot;;if(u.changeCase&amp;&amp;u.local){var a=t[i+1];a&amp;&amp;typeof a==&quot;string&quot;&amp;&amp;(u.changeCase==&quot;u&quot;?t[i]=a[0].toUpperCase():t[i]=a[0].toLowerCase(),t[i+1]=a.substr(1))}else u.changeCase&amp;&amp;(r=u.changeCase)}else r==&quot;U&quot;?t[i]=u.toUpperCase():r==&quot;L&quot;&amp;&amp;(t[i]=u.toLowerCase())}return o.variables.__=e,t.join(&quot;&quot;)});return u},this.tmFormatFunction=function(e,t,n){return t.formatFunction==&quot;upcase&quot;?e.toUpperCase():t.formatFunction==&quot;downcase&quot;?e.toLowerCase():e},this.resolveVariables=function(e,t){function f(t){var n=e.indexOf(t,s+1);n!=-1&amp;&amp;(s=n)}var n=[],r=&quot;&quot;,i=!0;for(var s=0;s&lt;e.length;s++){var o=e[s];if(typeof o==&quot;string&quot;){n.push(o),o==&quot;\sn&quot;?(i=!0,r=&quot;&quot;):i&amp;&amp;(r=/^\st*/.exec(o)[0],i=/\sS/.test(o));continue}if(!o)continue;i=!1;if(o.fmtString){var u=e.indexOf(o,s+1);u==-1&amp;&amp;(u=e.length),o.fmt=e.slice(s+1,u),s=u}if(o.text){var a=this.getVariableValue(t,o.text,r)+&quot;&quot;;o.fmtString&amp;&amp;(a=this.tmStrFormat(a,o,t)),o.formatFunction&amp;&amp;(a=this.tmFormatFunction(a,o,t)),a&amp;&amp;!o.ifEnd?(n.push(a),f(o)):!a&amp;&amp;o.ifEnd&amp;&amp;f(o.ifEnd)}else o.elseEnd?f(o.elseEnd):o.tabstopId!=null?n.push(o):o.changeCase!=null&amp;&amp;n.push(o)}return n},this.insertSnippetForSelection=function(e,t){function f(e){var t=[];for(var n=0;n&lt;e.length;n++){var r=e[n];if(typeof r==&quot;object&quot;){if(a[r.tabstopId])continue;var i=e.lastIndexOf(r,n-1);r=t[i]||{tabstopId:r.tabstopId}}t[n]=r}return t}var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=e.session.getTabString(),s=r.match(/^\ss*/)[0];n.column&lt;s.length&amp;&amp;(s=s.slice(0,n.column)),t=t.replace(/\sr/g,&quot;&quot;);var o=this.tokenizeTmSnippet(t);o=this.resolveVariables(o,e),o=o.map(function(e){return e==&quot;\sn&quot;?e+s:typeof e==&quot;string&quot;?e.replace(/\st/g,i):e});var u=[];o.forEach(function(e,t){if(typeof e!=&quot;object&quot;)return;var n=e.tabstopId,r=u[n];r||(r=u[n]=[],r.index=n,r.value=&quot;&quot;,r.parents={});if(r.indexOf(e)!==-1)return;e.choices&amp;&amp;!r.choices&amp;&amp;(r.choices=e.choices),r.push(e);var i=o.indexOf(e,t+1);if(i===-1)return;var s=o.slice(t+1,i),a=s.some(function(e){return typeof e==&quot;object&quot;});a&amp;&amp;!r.value?r.value=s:s.length&amp;&amp;(!r.value||typeof r.value!=&quot;string&quot;)&amp;&amp;(r.value=s.join(&quot;&quot;))}),u.forEach(function(e){e.length=0});var a={};for(var l=0;l&lt;o.length;l++){var c=o[l];if(typeof c!=&quot;object&quot;)continue;var h=c.tabstopId,p=u[h],v=o.indexOf(c,l+1);if(a[h]){a[h]===c&amp;&amp;(delete a[h],Object.keys(a).forEach(function(e){p.parents[e]=!0}));continue}a[h]=c;var m=p.value;typeof m!=&quot;string&quot;?m=f(m):c.fmt&amp;&amp;(m=this.tmStrFormat(m,c,e)),o.splice.apply(o,[l+1,Math.max(0,v-l)].concat(m,c)),p.indexOf(c)===-1&amp;&amp;p.push(c)}var g=0,y=0,b=&quot;&quot;;o.forEach(function(e){if(typeof e==&quot;string&quot;){var t=e.split(&quot;\sn&quot;);t.length&gt;1?(y=t[t.length-1].length,g+=t.length-1):y+=e.length,b+=e}else e&amp;&amp;(e.start?e.end={row:g,column:y}:e.start={row:g,column:y})});var w=e.getSelectionRange(),E=e.session.replace(w,b),S=new d(e),x=e.inVirtualSelectionMode&amp;&amp;e.selection.index;S.addTabstops(u,w.start,E,x)},this.insertSnippet=function(e,t){var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t);e.forEachSelection(function(){n.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&amp;&amp;e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||&quot;&quot;;t=t.split(&quot;/&quot;).pop();if(t===&quot;html&quot;||t===&quot;php&quot;){t===&quot;php&quot;&amp;&amp;!e.session.$mode.inlinePhp&amp;&amp;(t=&quot;html&quot;);var n=e.getCursorPosition(),r=e.session.getState(n.row);typeof r==&quot;object&quot;&amp;&amp;(r=r[0]),r.substring&amp;&amp;(r.substring(0,3)==&quot;js-&quot;?t=&quot;javascript&quot;:r.substring(0,4)==&quot;css-&quot;?t=&quot;css&quot;:r.substring(0,4)==&quot;php-&quot;&amp;&amp;(t=&quot;php&quot;))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),n=[t],r=this.snippetMap;return r[t]&amp;&amp;r[t].includeScopes&amp;&amp;n.push.apply(n,r[t].includeScopes),n.push(&quot;_&quot;),n},this.expandWithTab=function(e,t){var n=this,r=e.forEachSelection(function(){return n.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return r&amp;&amp;e.tabstopManager&amp;&amp;e.tabstopManager.tabNext(),r},this.expandSnippetForSelection=function(e,t){var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=r.substring(0,n.column),s=r.substr(n.column),o=this.snippetMap,u;return this.getActiveScopes(e).some(function(e){var t=o[e];return t&amp;&amp;(u=this.findMatchingSnippet(t,i,s)),!!u},this),u?t&amp;&amp;t.dryRun?!0:(e.session.doc.removeInLine(n.row,n.column-u.replaceBefore.length,n.column+u.replaceAfter.length),this.variables.M__=u.matchBefore,this.variables.T__=u.matchAfter,this.insertSnippetForSelection(e,u.content),this.variables.M__=this.variables.T__=null,!0):!1},this.findMatchingSnippet=function(e,t,n){for(var r=e.length;r--;){var i=e[r];if(i.startRe&amp;&amp;!i.startRe.test(t))continue;if(i.endRe&amp;&amp;!i.endRe.test(n))continue;if(!i.startRe&amp;&amp;!i.endRe)continue;return i.matchBefore=i.startRe?i.startRe.exec(t):[&quot;&quot;],i.matchAfter=i.endRe?i.endRe.exec(n):[&quot;&quot;],i.replaceBefore=i.triggerRe?i.triggerRe.exec(t)[0]:&quot;&quot;,i.replaceAfter=i.endTriggerRe?i.endTriggerRe.exec(n)[0]:&quot;&quot;,i}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){function o(e){return e&amp;&amp;!/^\s^?\s(.*\s)\s$?$|^\s\sb$/.test(e)&amp;&amp;(e=&quot;(?:&quot;+e+&quot;)&quot;),e||&quot;&quot;}function u(e,t,n){return e=o(e),t=o(t),n?(e=t+e,e&amp;&amp;e[e.length-1]!=&quot;$&quot;&amp;&amp;(e+=&quot;$&quot;)):(e+=t,e&amp;&amp;e[0]!=&quot;^&quot;&amp;&amp;(e=&quot;^&quot;+e)),new RegExp(e)}function a(e){e.scope||(e.scope=t||&quot;_&quot;),t=e.scope,n[t]||(n[t]=[],r[t]={});var o=r[t];if(e.name){var a=o[e.name];a&amp;&amp;i.unregister(a),o[e.name]=e}n[t].push(e),e.tabTrigger&amp;&amp;!e.trigger&amp;&amp;(!e.guard&amp;&amp;/^\sw/.test(e.tabTrigger)&amp;&amp;(e.guard=&quot;\s\sb&quot;),e.trigger=s.escapeRegExp(e.tabTrigger));if(!e.trigger&amp;&amp;!e.guard&amp;&amp;!e.endTrigger&amp;&amp;!e.endGuard)return;e.startRe=u(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=u(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger)}var n=this.snippetMap,r=this.snippetNameMap,i=this;e||(e=[]),e&amp;&amp;e.content?a(e):Array.isArray(e)&amp;&amp;e.forEach(a),this._signal(&quot;registerSnippets&quot;,{scope:t})},this.unregister=function(e,t){function i(e){var i=r[e.scope||t];if(i&amp;&amp;i[e.name]){delete i[e.name];var s=n[e.scope||t],o=s&amp;&amp;s.indexOf(e);o&gt;=0&amp;&amp;s.splice(o,1)}}var n=this.snippetMap,r=this.snippetNameMap;e.content?i(e):Array.isArray(e)&amp;&amp;e.forEach(i)},this.parseSnippetFile=function(e){e=e.replace(/\sr/g,&quot;&quot;);var t=[],n={},r=/^#.*|^({[\ss\sS]*})\ss*$|^(\sS+) (.*)$|^((?:\sn*\st.*)+)/gm,i;while(i=r.exec(e)){if(i[1])try{n=JSON.parse(i[1]),t.push(n)}catch(s){}if(i[4])n.content=i[4].replace(/^\st/gm,&quot;&quot;),t.push(n),n={};else{var o=i[2],u=i[3];if(o==&quot;regex&quot;){var a=/\s/((?:[^\s/\s\s]|\s\s.)*)|$/g;n.guard=a.exec(u)[1],n.trigger=a.exec(u)[1],n.endTrigger=a.exec(u)[1],n.endGuard=a.exec(u)[1]}else o==&quot;snippet&quot;?(n.tabTrigger=u.match(/^\sS*/)[0],n.name||(n.name=u)):n[o]=u}}return t},this.getSnippetByName=function(e,t){var n=this.snippetNameMap,r;return this.getActiveScopes(t).some(function(t){var i=n[t];return i&amp;&amp;(r=i[e]),!!r},this),r}}).call(p.prototype);var d=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=s.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on(&quot;change&quot;,this.$onChange),this.editor.on(&quot;changeSelection&quot;,this.$onChangeSelection),this.editor.on(&quot;changeSession&quot;,this.$onChangeSession),this.editor.commands.on(&quot;afterExec&quot;,this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener(&quot;change&quot;,this.$onChange),this.editor.removeListener(&quot;changeSelection&quot;,this.$onChangeSelection),this.editor.removeListener(&quot;changeSession&quot;,this.$onChangeSession),this.editor.commands.removeListener(&quot;afterExec&quot;,this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){var t=e.action[0]==&quot;r&quot;,n=this.selectedTabstop||{},r=n.parents||{},i=(this.tabstops||[]).slice();for(var s=0;s&lt;i.length;s++){var o=i[s],u=o==n||r[o.index];o.rangeList.$bias=u?0:1;if(e.action==&quot;remove&quot;&amp;&amp;o!==n){var a=o.parents&amp;&amp;o.parents[n.index],f=o.rangeList.pointIndex(e.start,a);f=f&lt;0?-f-1:f+1;var l=o.rangeList.pointIndex(e.end,a);l=l&lt;0?-l-1:l-1;var c=o.rangeList.ranges.slice(f,l);for(var h=0;h&lt;c.length;h++)this.removeRange(c[h])}o.rangeList.$onChange(e)}var p=this.editor.session;!this.$inChange&amp;&amp;t&amp;&amp;p.getLength()==1&amp;&amp;!p.getValue()&amp;&amp;this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(!e||!e.hasLinkedRanges||!e.firstNonLinked)return;this.$inChange=!0;var n=this.editor.session,r=n.getTextRange(e.firstNonLinked);for(var i=0;i&lt;e.length;i++){var s=e[i];if(!s.linked)continue;var o=s.original,u=t.snippetManager.tmStrFormat(r,o,this.editor);n.replace(s,u)}this.$inChange=!1},this.onAfterExec=function(e){e.command&amp;&amp;!e.command.readOnly&amp;&amp;this.updateLinkedFields()},this.onChangeSelection=function(){if(!this.editor)return;var e=this.editor.selection.lead,t=this.editor.selection.anchor,n=this.editor.selection.isEmpty();for(var r=0;r&lt;this.ranges.length;r++){if(this.ranges[r].linked)continue;var i=this.ranges[r].contains(e.row,e.column),s=n||this.ranges[r].contains(t.row,t.column);if(i&amp;&amp;s)return}this.detach()},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,n=this.index+(e||1);n=Math.min(Math.max(n,1),t),n==t&amp;&amp;(n=0),this.selectTabstop(n),n===0&amp;&amp;this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];t&amp;&amp;this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index];if(!t||!t.length)return;this.selectedTabstop=t;var n=t.firstNonLinked||t;if(!this.editor.inVirtualSelectionMode){var r=this.editor.multiSelect;r.toSingleRange(n.clone());for(var i=0;i&lt;t.length;i++){if(t.hasLinkedRanges&amp;&amp;t[i].linked)continue;r.addRange(t[i].clone(),!0)}r.ranges[0]&amp;&amp;r.addRange(r.ranges[0].clone())}else this.editor.selection.setRange(n);this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&amp;&amp;this.selectedTabstop.choices&amp;&amp;this.editor.execCommand(&quot;startAutocomplete&quot;,{matches:this.selectedTabstop.choices})},this.addTabstops=function(e,t,n){var r=this.useLink||!this.editor.getOption(&quot;enableMultiselect&quot;);this.$openTabstops||(this.$openTabstops=[]);if(!e[0]){var i=o.fromPoints(n,n);m(i.start,t),m(i.end,t),e[0]=[i],e[0].index=0}var s=this.index,a=[s+1,0],f=this.ranges;e.forEach(function(e,n){var i=this.$openTabstops[n]||e;for(var s=0;s&lt;e.length;s++){var l=e[s],c=o.fromPoints(l.start,l.end||l.start);v(c.start,t),v(c.end,t),c.original=l,c.tabstop=i,f.push(c),i!=e?i.unshift(c):i[s]=c,l.fmtString||i.firstNonLinked&amp;&amp;r?(c.linked=!0,i.hasLinkedRanges=!0):i.firstNonLinked||(i.firstNonLinked=c)}i.firstNonLinked||(i.hasLinkedRanges=!1),i===e&amp;&amp;(a.push(i),this.$openTabstops[n]=i),this.addTabstopMarkers(i),i.rangeList=i.rangeList||new u,i.rangeList.$bias=0,i.rangeList.addList(i)},this),a.length&gt;2&amp;&amp;(this.tabstops.length&amp;&amp;a.push(a.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,a))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,&quot;ace_snippet-marker&quot;,&quot;text&quot;))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);t!=-1&amp;&amp;e.tabstop.splice(t,1),t=this.ranges.indexOf(e),t!=-1&amp;&amp;this.ranges.splice(t,1),t=e.tabstop.rangeList.ranges.indexOf(e),t!=-1&amp;&amp;e.tabstop.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),t!=-1&amp;&amp;this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new a,this.keyboardHandler.bindKeys({Tab:function(e){if(t.snippetManager&amp;&amp;t.snippetManager.expandWithTab(e))return;e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView()},&quot;Shift-Tab&quot;:function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}})}).call(d.prototype);var v=function(e,t){e.row==0&amp;&amp;(e.column+=t.column),e.row+=t.row},m=function(e,t){e.row==t.row&amp;&amp;(e.column-=t.column),e.row-=t.row};e(&quot;./lib/dom&quot;).importCssString(&quot;.ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}&quot;),t.snippetManager=new p;var g=e(&quot;./editor&quot;).Editor;(function(){this.insertSnippet=function(e,n){return t.snippetManager.insertSnippet(this,e,n)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(g.prototype)}),ace.define(&quot;ace/autocomplete/popup&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/virtual_renderer&quot;,&quot;ace/editor&quot;,&quot;ace/range&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../virtual_renderer&quot;).VirtualRenderer,i=e(&quot;../editor&quot;).Editor,s=e(&quot;../range&quot;).Range,o=e(&quot;../lib/event&quot;),u=e(&quot;../lib/lang&quot;),a=e(&quot;../lib/dom&quot;),f=function(e){var t=new r(e);t.$maxLines=4;var n=new i(t);return n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),n.renderer.setHighlightGutterLine(!1),n.$mouseHandler.$focusTimeout=0,n.$highlightTagPending=!0,n},l=function(e){var t=a.createElement(&quot;div&quot;),n=new f(t);e&amp;&amp;e.appendChild(t),t.style.display=&quot;none&quot;,n.renderer.content.style.cursor=&quot;default&quot;,n.renderer.setStyle(&quot;ace_autocomplete&quot;),n.setOption(&quot;displayIndentGuides&quot;,!1),n.setOption(&quot;dragDelay&quot;,150);var r=function(){};n.focus=r,n.$isFocused=!0,n.renderer.$cursorLayer.restartTimer=r,n.renderer.$cursorLayer.element.style.opacity=0,n.renderer.$maxLines=8,n.renderer.$keepTextAreaAtCursor=!1,n.setHighlightActiveLine(!1),n.session.highlight(&quot;&quot;),n.session.$searchHighlight.clazz=&quot;ace_highlight-marker&quot;,n.on(&quot;mousedown&quot;,function(e){var t=e.getDocumentPosition();n.selection.moveToPosition(t),c.start.row=c.end.row=t.row,e.stop()});var i,l=new s(-1,0,-1,Infinity),c=new s(-1,0,-1,Infinity);c.id=n.session.addMarker(c,&quot;ace_active-line&quot;,&quot;fullLine&quot;),n.setSelectOnHover=function(e){e?l.id&amp;&amp;(n.session.removeMarker(l.id),l.id=null):l.id=n.session.addMarker(l,&quot;ace_line-hover&quot;,&quot;fullLine&quot;)},n.setSelectOnHover(!1),n.on(&quot;mousemove&quot;,function(e){if(!i){i=e;return}if(i.x==e.x&amp;&amp;i.y==e.y)return;i=e,i.scrollTop=n.renderer.scrollTop;var t=i.getDocumentPosition().row;l.start.row!=t&amp;&amp;(l.id||n.setRow(t),p(t))}),n.renderer.on(&quot;beforeRender&quot;,function(){if(i&amp;&amp;l.start.row!=-1){i.$pos=null;var e=i.getDocumentPosition().row;l.id||n.setRow(e),p(e,!0)}}),n.renderer.on(&quot;afterRender&quot;,function(){var e=n.getRow(),t=n.renderer.$textLayer,r=t.element.childNodes[e-t.config.firstRow];r!==t.selectedNode&amp;&amp;t.selectedNode&amp;&amp;a.removeCssClass(t.selectedNode,&quot;ace_selected&quot;),t.selectedNode=r,r&amp;&amp;a.addCssClass(r,&quot;ace_selected&quot;)});var h=function(){p(-1)},p=function(e,t){e!==l.start.row&amp;&amp;(l.start.row=l.end.row=e,t||n.session._emit(&quot;changeBackMarker&quot;),n._emit(&quot;changeHoverMarker&quot;))};n.getHoveredRow=function(){return l.start.row},o.addListener(n.container,&quot;mouseout&quot;,h),n.on(&quot;hide&quot;,h),n.on(&quot;changeSelection&quot;,h),n.session.doc.getLength=function(){return n.data.length},n.session.doc.getLine=function(e){var t=n.data[e];return typeof t==&quot;string&quot;?t:t&amp;&amp;t.value||&quot;&quot;};var d=n.session.bgTokenizer;return d.$tokenizeRow=function(e){function s(e,n){e&amp;&amp;r.push({type:(t.className||&quot;&quot;)+(n||&quot;&quot;),value:e})}var t=n.data[e],r=[];if(!t)return r;typeof t==&quot;string&quot;&amp;&amp;(t={value:t});var i=t.caption||t.value||t.name,o=i.toLowerCase(),u=(n.filterText||&quot;&quot;).toLowerCase(),a=0,f=0;for(var l=0;l&lt;=u.length;l++)if(l!=f&amp;&amp;(t.matchMask&amp;1&lt;&lt;l||l==u.length)){var c=u.slice(f,l);f=l;var h=o.indexOf(c,a);if(h==-1)continue;s(i.slice(a,h),&quot;&quot;),a=h+c.length,s(i.slice(h,a),&quot;completion-highlight&quot;)}return s(i.slice(a,i.length),&quot;&quot;),t.meta&amp;&amp;r.push({type:&quot;completion-meta&quot;,value:t.meta}),t.message&amp;&amp;r.push({type:&quot;completion-message&quot;,value:t.message}),r},d.$updateOnChange=r,d.start=r,n.session.$computeWidth=function(){return this.screenWidth=0},n.isOpen=!1,n.isTopdown=!1,n.autoSelect=!0,n.filterText=&quot;&quot;,n.data=[],n.setData=function(e,t){n.filterText=t||&quot;&quot;,n.setValue(u.stringRepeat(&quot;\sn&quot;,e.length),-1),n.data=e||[],n.setRow(0)},n.getData=function(e){return n.data[e]},n.getRow=function(){return c.start.row},n.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),c.start.row!=e&amp;&amp;(n.selection.clearSelection(),c.start.row=c.end.row=e||0,n.session._emit(&quot;changeBackMarker&quot;),n.moveCursorTo(e||0,0),n.isOpen&amp;&amp;n._signal(&quot;select&quot;))},n.on(&quot;changeSelection&quot;,function(){n.isOpen&amp;&amp;n.setRow(n.selection.lead.row),n.renderer.scrollCursorIntoView()}),n.hide=function(){this.container.style.display=&quot;none&quot;,this._signal(&quot;hide&quot;),n.isOpen=!1},n.show=function(e,t,r){var s=this.container,o=window.innerHeight,u=window.innerWidth,a=this.renderer,f=a.$maxLines*t*1.4,l=e.top+this.$borderSize,c=l&gt;o/2&amp;&amp;!r;c&amp;&amp;l+t+f&gt;o?(a.$maxPixelHeight=l-2*this.$borderSize,s.style.top=&quot;&quot;,s.style.bottom=o-l+&quot;px&quot;,n.isTopdown=!1):(l+=t,a.$maxPixelHeight=o-l-.2*t,s.style.top=l+&quot;px&quot;,s.style.bottom=&quot;&quot;,n.isTopdown=!0),s.style.display=&quot;&quot;;var h=e.left;h+s.offsetWidth&gt;u&amp;&amp;(h=u-s.offsetWidth),s.style.left=h+&quot;px&quot;,this._signal(&quot;show&quot;),i=null,n.isOpen=!0},n.goTo=function(e){var t=this.getRow(),n=this.session.getLength()-1;switch(e){case&quot;up&quot;:t=t&lt;=0?n:t-1;break;case&quot;down&quot;:t=t&gt;=n?-1:t+1;break;case&quot;start&quot;:t=0;break;case&quot;end&quot;:t=n}this.setRow(t)},n.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},n.$imageSize=0,n.$borderSize=1,n};a.importCssString(&quot;.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}&quot;,&quot;autocompletion.css&quot;),t.AcePopup=l,t.$singleLineEditor=f}),ace.define(&quot;ace/autocomplete/util&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.parForEach=function(e,t,n){var r=0,i=e.length;i===0&amp;&amp;n();for(var s=0;s&lt;i;s++)t(e[s],function(e,t){r++,r===i&amp;&amp;n(e,t)})};var r=/[a-zA-Z_0-9\s$\s-\su00A2-\su2000\su2070-\suFFFF]/;t.retrievePrecedingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t-1;s&gt;=0;s--){if(!n.test(e[s]))break;i.push(e[s])}return i.reverse().join(&quot;&quot;)},t.retrieveFollowingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t;s&lt;e.length;s++){if(!n.test(e[s]))break;i.push(e[s])}return i},t.getCompletionPrefix=function(e){var t=e.getCursorPosition(),n=e.session.getLine(t.row),r;return e.completers.forEach(function(e){e.identifierRegexps&amp;&amp;e.identifierRegexps.forEach(function(e){!r&amp;&amp;e&amp;&amp;(r=this.retrievePrecedingIdentifier(n,t.column,e))}.bind(this))}.bind(this)),r||this.retrievePrecedingIdentifier(n,t.column)}}),ace.define(&quot;ace/autocomplete&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/autocomplete/popup&quot;,&quot;ace/autocomplete/util&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/dom&quot;,&quot;ace/snippets&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./keyboard/hash_handler&quot;).HashHandler,i=e(&quot;./autocomplete/popup&quot;).AcePopup,s=e(&quot;./autocomplete/util&quot;),o=e(&quot;./lib/lang&quot;),u=e(&quot;./lib/dom&quot;),a=e(&quot;./snippets&quot;).snippetManager,f=e(&quot;./config&quot;),l=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new r,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=o.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=o.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new i(document.body||document.documentElement),this.popup.on(&quot;click&quot;,function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on(&quot;show&quot;,this.tooltipTimer.bind(null,null)),this.popup.on(&quot;select&quot;,this.tooltipTimer.bind(null,null)),this.popup.on(&quot;changeHoverMarker&quot;,this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,n){this.popup||this.$init(),this.popup.autoSelect=this.autoSelect,this.popup.setData(this.completions.filtered,this.completions.filterText),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var r=e.renderer;this.popup.setRow(this.autoSelect?0:-1);if(!n){this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var i=r.layerConfig.lineHeight,s=r.$cursorLayer.getPixelPosition(this.base,!0);s.left-=this.popup.getTextLeftOffset();var o=e.container.getBoundingClientRect();s.top+=o.top-r.layerConfig.offset,s.left+=o.left-e.renderer.scrollLeft,s.left+=r.gutterWidth,this.popup.show(s,i)}else n&amp;&amp;!t&amp;&amp;this.detach()},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off(&quot;changeSelection&quot;,this.changeListener),this.editor.off(&quot;blur&quot;,this.blurListener),this.editor.off(&quot;mousedown&quot;,this.mousedownListener),this.editor.off(&quot;mousewheel&quot;,this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&amp;&amp;this.popup.isOpen&amp;&amp;this.popup.hide(),this.base&amp;&amp;this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column&lt;this.base.column)&amp;&amp;this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,n=this.editor.textInput.getElement(),r=e.relatedTarget&amp;&amp;this.tooltipNode&amp;&amp;this.tooltipNode.contains(e.relatedTarget),i=this.popup&amp;&amp;this.popup.container;t!=n&amp;&amp;t.parentNode!=i&amp;&amp;!r&amp;&amp;t!=this.tooltipNode&amp;&amp;e.relatedTarget!=n&amp;&amp;this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){this.popup.goTo(e)},this.insertMatch=function(e,t){e||(e=this.popup.getData(this.popup.getRow()));if(!e)return!1;if(e.completer&amp;&amp;e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(this.completions.filterText){var n=this.editor.selection.getAllRanges();for(var r=0,i;i=n[r];r++)i.start.column-=this.completions.filterText.length,this.editor.session.remove(i)}e.snippet?a.insertSnippet(this.editor,e.snippet):this.editor.execCommand(&quot;insertstring&quot;,e.value||e)}this.detach()},this.commands={Up:function(e){e.completer.goTo(&quot;up&quot;)},Down:function(e){e.completer.goTo(&quot;down&quot;)},&quot;Ctrl-Up|Ctrl-Home&quot;:function(e){e.completer.goTo(&quot;start&quot;)},&quot;Ctrl-Down|Ctrl-End&quot;:function(e){e.completer.goTo(&quot;end&quot;)},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},&quot;Shift-Return&quot;:function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(!!t||!!e.tabstopManager)return t;e.completer.goTo(&quot;down&quot;)},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var n=e.getSession(),r=e.getCursorPosition(),i=s.getCompletionPrefix(e);this.base=n.doc.createAnchor(r.row,r.column-i.length),this.base.$insertRight=!0;var o=[],u=e.completers.length;return e.completers.forEach(function(a,f){a.getCompletions(e,n,r,i,function(n,r){!n&amp;&amp;r&amp;&amp;(o=o.concat(r)),t(null,{prefix:s.getCompletionPrefix(e),matches:o,finished:--u===0})})}),!0},this.showPopup=function(e,t){this.editor&amp;&amp;this.detach(),this.activated=!0,this.editor=e,e.completer!=this&amp;&amp;(e.completer&amp;&amp;e.completer.detach(),e.completer=this),e.on(&quot;changeSelection&quot;,this.changeListener),e.on(&quot;blur&quot;,this.blurListener),e.on(&quot;mousedown&quot;,this.mousedownListener),e.on(&quot;mousewheel&quot;,this.mousewheelListener),this.updateCompletions(!1,t)},this.updateCompletions=function(e,t){if(e&amp;&amp;this.base&amp;&amp;this.completions){var n=this.editor.getCursorPosition(),r=this.editor.session.getTextRange({start:this.base,end:n});if(r==this.completions.filterText)return;this.completions.setFilter(r);if(!this.completions.filtered.length)return this.detach();if(this.completions.filtered.length==1&amp;&amp;this.completions.filtered[0].value==r&amp;&amp;!this.completions.filtered[0].snippet)return this.detach();this.openPopup(this.editor,r,e);return}if(t&amp;&amp;t.matches){var n=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(n.row,n.column),this.base.$insertRight=!0,this.completions=new c(t.matches),this.openPopup(this.editor,&quot;&quot;,e)}var i=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(t,n){var r=function(){if(!n.finished)return;return this.detach()}.bind(this),s=n.prefix,o=n&amp;&amp;n.matches;if(!o||!o.length)return r();if(s.indexOf(n.prefix)!==0||i!=this.gatherCompletionsId)return;this.completions=new c(o),this.exactMatch&amp;&amp;(this.completions.exactMatch=!0),this.completions.setFilter(s);var u=this.completions.filtered;if(!u.length)return r();if(u.length==1&amp;&amp;u[0].value==s&amp;&amp;!u[0].snippet)return r();if(this.autoInsert&amp;&amp;u.length==1&amp;&amp;n.finished)return this.insertMatch(u[0]);this.openPopup(this.editor,s,e)}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,n=t&amp;&amp;(t[e.getHoveredRow()]||t[e.getRow()]),r=null;if(!n||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();this.editor.completers.some(function(e){return e.getDocTooltip&amp;&amp;(r=e.getDocTooltip(n)),r}),!r&amp;&amp;typeof n!=&quot;string&quot;&amp;&amp;(r=n),typeof r==&quot;string&quot;&amp;&amp;(r={docText:r});if(!r||!r.docHTML&amp;&amp;!r.docText)return this.hideDocTooltip();this.showDocTooltip(r)},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=u.createElement(&quot;div&quot;),this.tooltipNode.className=&quot;ace_tooltip ace_doc-tooltip&quot;,this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents=&quot;auto&quot;,this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&amp;&amp;(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var n=this.popup,r=n.container.getBoundingClientRect();t.style.top=n.container.style.top,t.style.bottom=n.container.style.bottom,t.style.display=&quot;block&quot;,window.innerWidth-r.right&lt;320?r.left&lt;320?n.isTopdown?(t.style.top=r.bottom+&quot;px&quot;,t.style.left=r.left+&quot;px&quot;,t.style.right=&quot;&quot;,t.style.bottom=&quot;&quot;):(t.style.top=n.container.offsetTop-t.offsetHeight+&quot;px&quot;,t.style.left=r.left+&quot;px&quot;,t.style.right=&quot;&quot;,t.style.bottom=&quot;&quot;):(t.style.right=window.innerWidth-r.left+&quot;px&quot;,t.style.left=&quot;&quot;):(t.style.left=r.right+1+&quot;px&quot;,t.style.right=&quot;&quot;)},this.hideDocTooltip=function(){this.tooltipTimer.cancel();if(!this.tooltipNode)return;var e=this.tooltipNode;!this.editor.isFocused()&amp;&amp;document.activeElement==e&amp;&amp;this.editor.focus(),this.tooltipNode=null,e.parentNode&amp;&amp;e.parentNode.removeChild(e)},this.onTooltipClick=function(e){var t=e.target;while(t&amp;&amp;t!=this.tooltipNode){if(t.nodeName==&quot;A&quot;&amp;&amp;t.href){t.rel=&quot;noreferrer&quot;,t.target=&quot;_blank&quot;;break}t=t.parentNode}},this.destroy=function(){this.detach();if(this.popup){this.popup.destroy();var e=this.popup.container;e&amp;&amp;e.parentNode&amp;&amp;e.parentNode.removeChild(e)}this.editor&amp;&amp;this.editor.completer==this&amp;&amp;this.editor.completer==null,this.popup=null}}).call(l.prototype),l.for=function(e){return e.completer?e.completer:(f.get(&quot;sharedPopups&quot;)?(l.$shared||(l.$sharedInstance=new l),e.completer=l.$sharedInstance):(e.completer=new l,e.once(&quot;destroy&quot;,function(e,t){t.completer.destroy()})),e.completer)},l.startCommand={name:&quot;startAutocomplete&quot;,exec:function(e,t){var n=l.for(e);n.autoInsert=!1,n.autoSelect=!0,n.showPopup(e,t),n.cancelContextMenu()},bindKey:&quot;Ctrl-Space|Ctrl-Shift-Space|Alt-Space&quot;};var c=function(e,t){this.all=e,this.filtered=e,this.filterText=t||&quot;&quot;,this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length&gt;this.filterText&amp;&amp;e.lastIndexOf(this.filterText,0)===0)var t=this.filtered;else var t=this.all;this.filterText=e,t=this.filterCompletions(t,this.filterText),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)});var n=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t===n?!1:(n=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var n=[],r=t.toUpperCase(),i=t.toLowerCase();e:for(var s=0,o;o=e[s];s++){var u=o.caption||o.value||o.snippet;if(!u)continue;var a=-1,f=0,l=0,c,h;if(this.exactMatch){if(t!==u.substr(0,t.length))continue e}else{var p=u.toLowerCase().indexOf(i);if(p&gt;-1)l=p;else for(var d=0;d&lt;t.length;d++){var v=u.indexOf(i[d],a+1),m=u.indexOf(r[d],a+1);c=v&gt;=0?m&lt;0||v&lt;m?v:m:m;if(c&lt;0)continue e;h=c-a-1,h&gt;0&amp;&amp;(a===-1&amp;&amp;(l+=10),l+=h,f|=1&lt;&lt;d),a=c}}o.matchMask=f,o.exactMatch=l?0:1,o.$score=(o.score||0)-l,n.push(o)}return n}}).call(c.prototype),t.Autocomplete=l,t.FilteredList=c}),ace.define(&quot;ace/autocomplete/text_completer&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){function s(e,t){var n=e.getTextRange(r.fromPoints({row:0,column:0},t));return n.split(i).length-1}function o(e,t){var n=s(e,t),r=e.getValue().split(i),o=Object.create(null),u=r[n];return r.forEach(function(e,t){if(!e||e===u)return;var i=Math.abs(n-t),s=r.length-i;o[e]?o[e]=Math.max(s,o[e]):o[e]=s}),o}var r=e(&quot;../range&quot;).Range,i=/[^a-zA-Z_0-9\s$\s-\su00C0-\su1FFF\su2C00-\suD7FF\sw]+/;t.getCompletions=function(e,t,n,r,i){var s=o(t,n),u=Object.keys(s);i(null,u.map(function(e){return{caption:e,value:e,score:s[e],meta:&quot;local&quot;}}))}}),ace.define(&quot;ace/ext/language_tools&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/snippets&quot;,&quot;ace/autocomplete&quot;,&quot;ace/config&quot;,&quot;ace/lib/lang&quot;,&quot;ace/autocomplete/util&quot;,&quot;ace/autocomplete/text_completer&quot;,&quot;ace/editor&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../snippets&quot;).snippetManager,i=e(&quot;../autocomplete&quot;).Autocomplete,s=e(&quot;../config&quot;),o=e(&quot;../lib/lang&quot;),u=e(&quot;../autocomplete/util&quot;),a=e(&quot;../autocomplete/text_completer&quot;),f={getCompletions:function(e,t,n,r,i){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,n,r,i);var s=e.session.getState(n.row),o=t.$mode.getCompletions(s,t,n,r);i(null,o)}},l={getCompletions:function(e,t,n,i,s){var o=[],u=t.getTokenAt(n.row,n.column);u&amp;&amp;u.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\s.xml$/)?o.push(&quot;html-tag&quot;):o=r.getActiveScopes(e);var a=r.snippetMap,f=[];o.forEach(function(e){var t=a[e]||[];for(var n=t.length;n--;){var r=t[n],i=r.name||r.tabTrigger;if(!i)continue;f.push({caption:i,snippet:r.content,meta:r.tabTrigger&amp;&amp;!r.name?r.tabTrigger+&quot;\su21e5 &quot;:&quot;snippet&quot;,type:&quot;snippet&quot;})}},this),s(null,f)},getDocTooltip:function(e){e.type==&quot;snippet&quot;&amp;&amp;!e.docHTML&amp;&amp;(e.docHTML=[&quot;&lt;b&gt;&quot;,o.escapeHTML(e.caption),&quot;&lt;/b&gt;&quot;,&quot;&lt;hr&gt;&lt;/hr&gt;&quot;,o.escapeHTML(e.snippet)].join(&quot;&quot;))}},c=[l,a,f];t.setCompleters=function(e){c.length=0,e&amp;&amp;c.push.apply(c,e)},t.addCompleter=function(e){c.push(e)},t.textCompleter=a,t.keyWordCompleter=f,t.snippetCompleter=l;var h={name:&quot;expandSnippet&quot;,exec:function(e){return r.expandWithTab(e)},bindKey:&quot;Tab&quot;},p=function(e,t){d(t.session.$mode)},d=function(e){var t=e.$id;r.files||(r.files={}),v(t),e.modes&amp;&amp;e.modes.forEach(d)},v=function(e){if(!e||r.files[e])return;var t=e.replace(&quot;mode&quot;,&quot;snippets&quot;);r.files[e]={},s.loadModule(t,function(t){t&amp;&amp;(r.files[e]=t,!t.snippets&amp;&amp;t.snippetText&amp;&amp;(t.snippets=r.parseSnippetFile(t.snippetText)),r.register(t.snippets||[],t.scope),t.includeScopes&amp;&amp;(r.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){v(&quot;ace/mode/&quot;+e)})))})},m=function(e){var t=e.editor,n=t.completer&amp;&amp;t.completer.activated;if(e.command.name===&quot;backspace&quot;)n&amp;&amp;!u.getCompletionPrefix(t)&amp;&amp;t.completer.detach();else if(e.command.name===&quot;insertstring&quot;){var r=u.getCompletionPrefix(t);if(r&amp;&amp;!n){var s=i.for(t);s.autoInsert=!1,s.showPopup(t)}}},g=e(&quot;../editor&quot;).Editor;e(&quot;../config&quot;).defineOptions(g.prototype,&quot;editor&quot;,{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:c),this.commands.addCommand(i.startCommand)):this.commands.removeCommand(i.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:c),this.commands.on(&quot;afterExec&quot;,m)):this.commands.removeListener(&quot;afterExec&quot;,m)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(h),this.on(&quot;changeMode&quot;,p),p(null,this)):(this.commands.removeCommand(h),this.off(&quot;changeMode&quot;,p))},value:!1}})});                (function() {\n                    ace.require([&quot;ace/ext/language_tools&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: theme-monokai.js */\nace.define(&quot;ace/theme/monokai&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){t.isDark=!0,t.cssClass=&quot;ace-monokai&quot;,t.cssText=&quot;.ace-monokai .ace_gutter {background: #2F3129;color: #8F908A}.ace-monokai .ace_print-margin {width: 1px;background: #555651}.ace-monokai {background-color: #272822;color: #F8F8F2}.ace-monokai .ace_cursor {color: #F8F8F0}.ace-monokai .ace_marker-layer .ace_selection {background: #49483E}.ace-monokai.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #272822;}.ace-monokai .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-monokai .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #49483E}.ace-monokai .ace_marker-layer .ace_active-line {background: #202020}.ace-monokai .ace_gutter-active-line {background-color: #272727}.ace-monokai .ace_marker-layer .ace_selected-word {border: 1px solid #49483E}.ace-monokai .ace_invisible {color: #52524d}.ace-monokai .ace_entity.ace_name.ace_tag,.ace-monokai .ace_keyword,.ace-monokai .ace_meta.ace_tag,.ace-monokai .ace_storage {color: #F92672}.ace-monokai .ace_punctuation,.ace-monokai .ace_punctuation.ace_tag {color: #fff}.ace-monokai .ace_constant.ace_character,.ace-monokai .ace_constant.ace_language,.ace-monokai .ace_constant.ace_numeric,.ace-monokai .ace_constant.ace_other {color: #AE81FF}.ace-monokai .ace_invalid {color: #F8F8F0;background-color: #F92672}.ace-monokai .ace_invalid.ace_deprecated {color: #F8F8F0;background-color: #AE81FF}.ace-monokai .ace_support.ace_constant,.ace-monokai .ace_support.ace_function {color: #66D9EF}.ace-monokai .ace_fold {background-color: #A6E22E;border-color: #F8F8F2}.ace-monokai .ace_storage.ace_type,.ace-monokai .ace_support.ace_class,.ace-monokai .ace_support.ace_type {font-style: italic;color: #66D9EF}.ace-monokai .ace_entity.ace_name.ace_function,.ace-monokai .ace_entity.ace_other,.ace-monokai .ace_entity.ace_other.ace_attribute-name,.ace-monokai .ace_variable {color: #A6E22E}.ace-monokai .ace_variable.ace_parameter {font-style: italic;color: #FD971F}.ace-monokai .ace_string {color: #E6DB74}.ace-monokai .ace_comment {color: #75715E}.ace-monokai .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y}&quot;;var r=e(&quot;../lib/dom&quot;);r.importCssString(t.cssText,t.cssClass)});                (function() {\n                    ace.require([&quot;ace/theme/monokai&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: javascript.js */\nace.define(&quot;ace/snippets/javascript&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.snippetText='# Prototype\snsnippet proto\sn	${1:class_name}.prototype.${2:method_name} = function(${3:first_argument}) {\sn		${4:// body...}\sn	};\sn# Function\snsnippet fun\sn	function ${1?:function_name}(${2:argument}) {\sn		${3:// body...}\sn	}\sn# Anonymous Function\snregex /((=)\s\ss*|(:)\s\ss*|(\s\s()|\s\sb)/f/(\s\s))?/\snsnippet f\sn	function${M1?: ${1:functionName}}($2) {\sn		${0:$TM_SELECTED_TEXT}\sn	}${M2?;}${M3?,}${M4?)}\sn# Immediate function\sntrigger \s\s(?f\s\s(\snendTrigger \s\s)?\snsnippet f(\sn	(function(${1}) {\sn		${0:${TM_SELECTED_TEXT:/* code */}}\sn	}(${1}));\sn# if\snsnippet if\sn	if (${1:true}) {\sn		${0}\sn	}\sn# if ... else\snsnippet ife\sn	if (${1:true}) {\sn		${2}\sn	} else {\sn		${0}\sn	}\sn# tertiary conditional\snsnippet ter\sn	${1:/* condition */} ? ${2:a} : ${3:b}\sn# switch\snsnippet switch\sn	switch (${1:expression}) {\sn		case \s'${3:case}\s':\sn			${4:// code}\sn			break;\sn		${5}\sn		default:\sn			${2:// code}\sn	}\sn# case\snsnippet case\sn	case \s'${1:case}\s':\sn		${2:// code}\sn		break;\sn	${3}\sn\sn# while (...) {...}\snsnippet wh\sn	while (${1:/* condition */}) {\sn		${0:/* code */}\sn	}\sn# try\snsnippet try\sn	try {\sn		${0:/* code */}\sn	} catch (e) {}\sn# do...while\snsnippet do\sn	do {\sn		${2:/* code */}\sn	} while (${1:/* condition */});\sn# Object Method\snsnippet :f\snregex /([,{[])|^\s\ss*/:f/\sn	${1:method_name}: function(${2:attribute}) {\sn		${0}\sn	}${3:,}\sn# setTimeout function\snsnippet setTimeout\snregex /\s\sb/st|timeout|setTimeo?u?t?/\sn	setTimeout(function() {${3:$TM_SELECTED_TEXT}}, ${1:10});\sn# Get Elements\snsnippet gett\sn	getElementsBy${1:TagName}(\s'${2}\s')${3}\sn# Get Element\snsnippet get\sn	getElementBy${1:Id}(\s'${2}\s')${3}\sn# console.log (Firebug)\snsnippet cl\sn	console.log(${1});\sn# return\snsnippet ret\sn	return ${1:result}\sn# for (property in object ) { ... }\snsnippet fori\sn	for (var ${1:prop} in ${2:Things}) {\sn		${0:$2[$1]}\sn	}\sn# hasOwnProperty\snsnippet has\sn	hasOwnProperty(${1})\sn# docstring\snsnippet /**\sn	/**\sn	 * ${1:description}\sn	 *\sn	 */\snsnippet @par\snregex /^\s\ss*\s\s*\s\ss*/@(para?m?)?/\sn	@param {${1:type}} ${2:name} ${3:description}\snsnippet @ret\sn	@return {${1:type}} ${2:description}\sn# JSON.parse\snsnippet jsonp\sn	JSON.parse(${1:jstr});\sn# JSON.stringify\snsnippet jsons\sn	JSON.stringify(${1:object});\sn# self-defining function\snsnippet sdf\sn	var ${1:function_name} = function(${2:argument}) {\sn		${3:// initial code ...}\sn\sn		$1 = function($2) {\sn			${4:// main code}\sn		};\sn	}\sn# singleton\snsnippet sing\sn	function ${1:Singleton} (${2:argument}) {\sn		// the cached instance\sn		var instance;\sn\sn		// rewrite the constructor\sn		$1 = function $1($2) {\sn			return instance;\sn		};\sn		\sn		// carry over the prototype properties\sn		$1.prototype = this;\sn\sn		// the instance\sn		instance = new $1();\sn\sn		// reset the constructor pointer\sn		instance.constructor = $1;\sn\sn		${3:// code ...}\sn\sn		return instance;\sn	}\sn# class\snsnippet class\snregex /^\s\ss*/clas{0,2}/\sn	var ${1:class} = function(${20}) {\sn		$40$0\sn	};\sn	\sn	(function() {\sn		${60:this.prop = &quot;&quot;}\sn	}).call(${1:class}.prototype);\sn	\sn	exports.${1:class} = ${1:class};\sn# \snsnippet for-\sn	for (var ${1:i} = ${2:Things}.length; ${1:i}--; ) {\sn		${0:${2:Things}[${1:i}];}\sn	}\sn# for (...) {...}\snsnippet for\sn	for (var ${1:i} = 0; $1 &lt; ${2:Things}.length; $1++) {\sn		${3:$2[$1]}$0\sn	}\sn# for (...) {...} (Improved Native For-Loop)\snsnippet forr\sn	for (var ${1:i} = ${2:Things}.length - 1; $1 &gt;= 0; $1--) {\sn		${3:$2[$1]}$0\sn	}\sn\sn\sn#modules\snsnippet def\sn	define(function(require, exports, module) {\sn	&quot;use strict&quot;;\sn	var ${1/.*\s\s///} = require(&quot;${1}&quot;);\sn	\sn	$TM_SELECTED_TEXT\sn	});\snsnippet req\snguard ^\s\ss*\sn	var ${1/.*\s\s///} = require(&quot;${1}&quot;);\sn	$0\snsnippet requ\snguard ^\s\ss*\sn	var ${1/.*\s\s/(.)/\s\su$1/} = require(&quot;${1}&quot;).${1/.*\s\s/(.)/\s\su$1/};\sn	$0\sn',t.scope=&quot;javascript&quot;});                (function() {\n                    ace.require([&quot;ace/snippets/javascript&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: text.js */\nace.define(&quot;ace/snippets/text&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.snippetText=undefined,t.scope=&quot;text&quot;});                (function() {\n                    ace.require([&quot;ace/snippets/text&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: ext-searchbox.js */\nace.define(&quot;ace/ext/searchbox&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/event&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/lib/keys&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/dom&quot;),i=e(&quot;../lib/lang&quot;),s=e(&quot;../lib/event&quot;),o='.ace_search {background-color: #ddd;color: #666;border: 1px solid #cbcbcb;border-top: 0 none;overflow: hidden;margin: 0;padding: 4px 6px 0 4px;position: absolute;top: 0;z-index: 99;white-space: normal;}.ace_search.left {border-left: 0 none;border-radius: 0px 0px 5px 0px;left: 0;}.ace_search.right {border-radius: 0px 0px 0px 5px;border-right: 0 none;right: 0;}.ace_search_form, .ace_replace_form {margin: 0 20px 4px 0;overflow: hidden;line-height: 1.9;}.ace_replace_form {margin-right: 0;}.ace_search_form.ace_nomatch {outline: 1px solid red;}.ace_search_field {border-radius: 3px 0 0 3px;background-color: white;color: black;border: 1px solid #cbcbcb;border-right: 0 none;outline: 0;padding: 0;font-size: inherit;margin: 0;line-height: inherit;padding: 0 6px;min-width: 17em;vertical-align: top;min-height: 1.8em;box-sizing: content-box;}.ace_searchbtn {border: 1px solid #cbcbcb;line-height: inherit;display: inline-block;padding: 0 6px;background: #fff;border-right: 0 none;border-left: 1px solid #dcdcdc;cursor: pointer;margin: 0;position: relative;color: #666;}.ace_searchbtn:last-child {border-radius: 0 3px 3px 0;border-right: 1px solid #cbcbcb;}.ace_searchbtn:disabled {background: none;cursor: default;}.ace_searchbtn:hover {background-color: #eef1f6;}.ace_searchbtn.prev, .ace_searchbtn.next {padding: 0px 0.7em}.ace_searchbtn.prev:after, .ace_searchbtn.next:after {content: &quot;&quot;;border: solid 2px #888;width: 0.5em;height: 0.5em;border-width:  2px 0 0 2px;display:inline-block;transform: rotate(-45deg);}.ace_searchbtn.next:after {border-width: 0 2px 2px 0 ;}.ace_searchbtn_close {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;border-radius: 50%;border: 0 none;color: #656565;cursor: pointer;font: 16px/16px Arial;padding: 0;height: 14px;width: 14px;top: 9px;right: 7px;position: absolute;}.ace_searchbtn_close:hover {background-color: #656565;background-position: 50% 100%;color: white;}.ace_button {margin-left: 2px;cursor: pointer;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;overflow: hidden;opacity: 0.7;border: 1px solid rgba(100,100,100,0.23);padding: 1px;box-sizing:    border-box!important;color: black;}.ace_button:hover {background-color: #eee;opacity:1;}.ace_button:active {background-color: #ddd;}.ace_button.checked {border-color: #3399ff;opacity:1;}.ace_search_options{margin-bottom: 3px;text-align: right;-webkit-user-select: none;-moz-user-select: none;-o-user-select: none;-ms-user-select: none;user-select: none;clear: both;}.ace_search_counter {float: left;font-family: arial;padding: 0 8px;}',u=e(&quot;../keyboard/hash_handler&quot;).HashHandler,a=e(&quot;../lib/keys&quot;),f=999;r.importCssString(o,&quot;ace_searchbox&quot;);var l=function(e,t,n){var i=r.createElement(&quot;div&quot;);r.buildDom([&quot;div&quot;,{&quot;class&quot;:&quot;ace_search right&quot;},[&quot;span&quot;,{action:&quot;hide&quot;,&quot;class&quot;:&quot;ace_searchbtn_close&quot;}],[&quot;div&quot;,{&quot;class&quot;:&quot;ace_search_form&quot;},[&quot;input&quot;,{&quot;class&quot;:&quot;ace_search_field&quot;,placeholder:&quot;Search for&quot;,spellcheck:&quot;false&quot;}],[&quot;span&quot;,{action:&quot;findPrev&quot;,&quot;class&quot;:&quot;ace_searchbtn prev&quot;},&quot;\su200b&quot;],[&quot;span&quot;,{action:&quot;findNext&quot;,&quot;class&quot;:&quot;ace_searchbtn next&quot;},&quot;\su200b&quot;],[&quot;span&quot;,{action:&quot;findAll&quot;,&quot;class&quot;:&quot;ace_searchbtn&quot;,title:&quot;Alt-Enter&quot;},&quot;All&quot;]],[&quot;div&quot;,{&quot;class&quot;:&quot;ace_replace_form&quot;},[&quot;input&quot;,{&quot;class&quot;:&quot;ace_search_field&quot;,placeholder:&quot;Replace with&quot;,spellcheck:&quot;false&quot;}],[&quot;span&quot;,{action:&quot;replaceAndFindNext&quot;,&quot;class&quot;:&quot;ace_searchbtn&quot;},&quot;Replace&quot;],[&quot;span&quot;,{action:&quot;replaceAll&quot;,&quot;class&quot;:&quot;ace_searchbtn&quot;},&quot;All&quot;]],[&quot;div&quot;,{&quot;class&quot;:&quot;ace_search_options&quot;},[&quot;span&quot;,{action:&quot;toggleReplace&quot;,&quot;class&quot;:&quot;ace_button&quot;,title:&quot;Toggle Replace mode&quot;,style:&quot;float:left;margin-top:-2px;padding:0 5px;&quot;},&quot;+&quot;],[&quot;span&quot;,{&quot;class&quot;:&quot;ace_search_counter&quot;}],[&quot;span&quot;,{action:&quot;toggleRegexpMode&quot;,&quot;class&quot;:&quot;ace_button&quot;,title:&quot;RegExp Search&quot;},&quot;.*&quot;],[&quot;span&quot;,{action:&quot;toggleCaseSensitive&quot;,&quot;class&quot;:&quot;ace_button&quot;,title:&quot;CaseSensitive Search&quot;},&quot;Aa&quot;],[&quot;span&quot;,{action:&quot;toggleWholeWords&quot;,&quot;class&quot;:&quot;ace_button&quot;,title:&quot;Whole Word Search&quot;},&quot;\s\sb&quot;],[&quot;span&quot;,{action:&quot;searchInSelection&quot;,&quot;class&quot;:&quot;ace_button&quot;,title:&quot;Search In Selection&quot;},&quot;S&quot;]]],i),this.element=i.firstChild,this.setSession=this.setSession.bind(this),this.$init(),this.setEditor(e),r.importCssString(o,&quot;ace_searchbox&quot;,e.container)};(function(){this.setEditor=function(e){e.searchBox=this,e.renderer.scroller.appendChild(this.element),this.editor=e},this.setSession=function(e){this.searchRange=null,this.$syncOptions(!0)},this.$initElements=function(e){this.searchBox=e.querySelector(&quot;.ace_search_form&quot;),this.replaceBox=e.querySelector(&quot;.ace_replace_form&quot;),this.searchOption=e.querySelector(&quot;[action=searchInSelection]&quot;),this.replaceOption=e.querySelector(&quot;[action=toggleReplace]&quot;),this.regExpOption=e.querySelector(&quot;[action=toggleRegexpMode]&quot;),this.caseSensitiveOption=e.querySelector(&quot;[action=toggleCaseSensitive]&quot;),this.wholeWordOption=e.querySelector(&quot;[action=toggleWholeWords]&quot;),this.searchInput=this.searchBox.querySelector(&quot;.ace_search_field&quot;),this.replaceInput=this.replaceBox.querySelector(&quot;.ace_search_field&quot;),this.searchCounter=e.querySelector(&quot;.ace_search_counter&quot;)},this.$init=function(){var e=this.element;this.$initElements(e);var t=this;s.addListener(e,&quot;mousedown&quot;,function(e){setTimeout(function(){t.activeInput.focus()},0),s.stopPropagation(e)}),s.addListener(e,&quot;click&quot;,function(e){var n=e.target||e.srcElement,r=n.getAttribute(&quot;action&quot;);r&amp;&amp;t[r]?t[r]():t.$searchBarKb.commands[r]&amp;&amp;t.$searchBarKb.commands[r].exec(t),s.stopPropagation(e)}),s.addCommandKeyListener(e,function(e,n,r){var i=a.keyCodeToString(r),o=t.$searchBarKb.findKeyCommand(n,i);o&amp;&amp;o.exec&amp;&amp;(o.exec(t),s.stopEvent(e))}),this.$onChange=i.delayedCall(function(){t.find(!1,!1)}),s.addListener(this.searchInput,&quot;input&quot;,function(){t.$onChange.schedule(20)}),s.addListener(this.searchInput,&quot;focus&quot;,function(){t.activeInput=t.searchInput,t.searchInput.value&amp;&amp;t.highlight()}),s.addListener(this.replaceInput,&quot;focus&quot;,function(){t.activeInput=t.replaceInput,t.searchInput.value&amp;&amp;t.highlight()})},this.$closeSearchBarKb=new u([{bindKey:&quot;Esc&quot;,name:&quot;closeSearchBar&quot;,exec:function(e){e.searchBox.hide()}}]),this.$searchBarKb=new u,this.$searchBarKb.bindKeys({&quot;Ctrl-f|Command-f&quot;:function(e){var t=e.isReplace=!e.isReplace;e.replaceBox.style.display=t?&quot;&quot;:&quot;none&quot;,e.replaceOption.checked=!1,e.$syncOptions(),e.searchInput.focus()},&quot;Ctrl-H|Command-Option-F&quot;:function(e){if(e.editor.getReadOnly())return;e.replaceOption.checked=!0,e.$syncOptions(),e.replaceInput.focus()},&quot;Ctrl-G|Command-G&quot;:function(e){e.findNext()},&quot;Ctrl-Shift-G|Command-Shift-G&quot;:function(e){e.findPrev()},esc:function(e){setTimeout(function(){e.hide()})},Return:function(e){e.activeInput==e.replaceInput&amp;&amp;e.replace(),e.findNext()},&quot;Shift-Return&quot;:function(e){e.activeInput==e.replaceInput&amp;&amp;e.replace(),e.findPrev()},&quot;Alt-Return&quot;:function(e){e.activeInput==e.replaceInput&amp;&amp;e.replaceAll(),e.findAll()},Tab:function(e){(e.activeInput==e.replaceInput?e.searchInput:e.replaceInput).focus()}}),this.$searchBarKb.addCommands([{name:&quot;toggleRegexpMode&quot;,bindKey:{win:&quot;Alt-R|Alt-/&quot;,mac:&quot;Ctrl-Alt-R|Ctrl-Alt-/&quot;},exec:function(e){e.regExpOption.checked=!e.regExpOption.checked,e.$syncOptions()}},{name:&quot;toggleCaseSensitive&quot;,bindKey:{win:&quot;Alt-C|Alt-I&quot;,mac:&quot;Ctrl-Alt-R|Ctrl-Alt-I&quot;},exec:function(e){e.caseSensitiveOption.checked=!e.caseSensitiveOption.checked,e.$syncOptions()}},{name:&quot;toggleWholeWords&quot;,bindKey:{win:&quot;Alt-B|Alt-W&quot;,mac:&quot;Ctrl-Alt-B|Ctrl-Alt-W&quot;},exec:function(e){e.wholeWordOption.checked=!e.wholeWordOption.checked,e.$syncOptions()}},{name:&quot;toggleReplace&quot;,exec:function(e){e.replaceOption.checked=!e.replaceOption.checked,e.$syncOptions()}},{name:&quot;searchInSelection&quot;,exec:function(e){e.searchOption.checked=!e.searchRange,e.setSearchRange(e.searchOption.checked&amp;&amp;e.editor.getSelectionRange()),e.$syncOptions()}}]),this.setSearchRange=function(e){this.searchRange=e,e?this.searchRangeMarker=this.editor.session.addMarker(e,&quot;ace_active-line&quot;):this.searchRangeMarker&amp;&amp;(this.editor.session.removeMarker(this.searchRangeMarker),this.searchRangeMarker=null)},this.$syncOptions=function(e){r.setCssClass(this.replaceOption,&quot;checked&quot;,this.searchRange),r.setCssClass(this.searchOption,&quot;checked&quot;,this.searchOption.checked),this.replaceOption.textContent=this.replaceOption.checked?&quot;-&quot;:&quot;+&quot;,r.setCssClass(this.regExpOption,&quot;checked&quot;,this.regExpOption.checked),r.setCssClass(this.wholeWordOption,&quot;checked&quot;,this.wholeWordOption.checked),r.setCssClass(this.caseSensitiveOption,&quot;checked&quot;,this.caseSensitiveOption.checked);var t=this.editor.getReadOnly();this.replaceOption.style.display=t?&quot;none&quot;:&quot;&quot;,this.replaceBox.style.display=this.replaceOption.checked&amp;&amp;!t?&quot;&quot;:&quot;none&quot;,this.find(!1,!1,e)},this.highlight=function(e){this.editor.session.highlight(e||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},this.find=function(e,t,n){var i=this.editor.find(this.searchInput.value,{skipCurrent:e,backwards:t,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked,preventScroll:n,range:this.searchRange}),s=!i&amp;&amp;this.searchInput.value;r.setCssClass(this.searchBox,&quot;ace_nomatch&quot;,s),this.editor._emit(&quot;findSearchBox&quot;,{match:!s}),this.highlight(),this.updateCounter()},this.updateCounter=function(){var e=this.editor,t=e.$search.$options.re,n=0,r=0;if(t){var i=this.searchRange?e.session.getTextRange(this.searchRange):e.getValue(),s=e.session.doc.positionToIndex(e.selection.anchor);this.searchRange&amp;&amp;(s-=e.session.doc.positionToIndex(this.searchRange.start));var o=t.lastIndex=0,u;while(u=t.exec(i)){n++,o=u.index,o&lt;=s&amp;&amp;r++;if(n&gt;f)break;if(!u[0]){t.lastIndex=o+=1;if(o&gt;=i.length)break}}}this.searchCounter.textContent=r+&quot; of &quot;+(n&gt;f?f+&quot;+&quot;:n)},this.findNext=function(){this.find(!0,!1)},this.findPrev=function(){this.find(!0,!0)},this.findAll=function(){var e=this.editor.findAll(this.searchInput.value,{regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked}),t=!e&amp;&amp;this.searchInput.value;r.setCssClass(this.searchBox,&quot;ace_nomatch&quot;,t),this.editor._emit(&quot;findSearchBox&quot;,{match:!t}),this.highlight(),this.hide()},this.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},this.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},this.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},this.hide=function(){this.active=!1,this.setSearchRange(null),this.editor.off(&quot;changeSession&quot;,this.setSession),this.element.style.display=&quot;none&quot;,this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},this.show=function(e,t){this.active=!0,this.editor.on(&quot;changeSession&quot;,this.setSession),this.element.style.display=&quot;&quot;,this.replaceOption.checked=t,e&amp;&amp;(this.searchInput.value=e),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb),this.$syncOptions(!0)},this.isFocused=function(){var e=document.activeElement;return e==this.searchInput||e==this.replaceInput}}).call(l.prototype),t.SearchBox=l,t.Search=function(e,t){var n=e.searchBox||new l(e);n.show(e.session.getTextRange(),t)}});                (function() {\n                    ace.require([&quot;ace/ext/searchbox&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: ext-prompt.js */\nace.define(&quot;ace/ext/menu_tools/get_editor_keyboard_shortcuts&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/keys&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../lib/keys&quot;);n.exports.getEditorKeybordShortcuts=function(e){var t=r.KEY_MODS,n=[],i={};return e.keyBinding.$handlers.forEach(function(e){var t=e.commandKeyBinding;for(var r in t){var s=r.replace(/(^|-)\sw/g,function(e){return e.toUpperCase()}),o=t[r];Array.isArray(o)||(o=[o]),o.forEach(function(e){typeof e!=&quot;string&quot;&amp;&amp;(e=e.name),i[e]?i[e].key+=&quot;|&quot;+s:(i[e]={key:s,command:e},n.push(i[e]))})}}),n}}),ace.define(&quot;ace/autocomplete/popup&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/virtual_renderer&quot;,&quot;ace/editor&quot;,&quot;ace/range&quot;,&quot;ace/lib/event&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../virtual_renderer&quot;).VirtualRenderer,i=e(&quot;../editor&quot;).Editor,s=e(&quot;../range&quot;).Range,o=e(&quot;../lib/event&quot;),u=e(&quot;../lib/lang&quot;),a=e(&quot;../lib/dom&quot;),f=function(e){var t=new r(e);t.$maxLines=4;var n=new i(t);return n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),n.renderer.setHighlightGutterLine(!1),n.$mouseHandler.$focusTimeout=0,n.$highlightTagPending=!0,n},l=function(e){var t=a.createElement(&quot;div&quot;),n=new f(t);e&amp;&amp;e.appendChild(t),t.style.display=&quot;none&quot;,n.renderer.content.style.cursor=&quot;default&quot;,n.renderer.setStyle(&quot;ace_autocomplete&quot;),n.setOption(&quot;displayIndentGuides&quot;,!1),n.setOption(&quot;dragDelay&quot;,150);var r=function(){};n.focus=r,n.$isFocused=!0,n.renderer.$cursorLayer.restartTimer=r,n.renderer.$cursorLayer.element.style.opacity=0,n.renderer.$maxLines=8,n.renderer.$keepTextAreaAtCursor=!1,n.setHighlightActiveLine(!1),n.session.highlight(&quot;&quot;),n.session.$searchHighlight.clazz=&quot;ace_highlight-marker&quot;,n.on(&quot;mousedown&quot;,function(e){var t=e.getDocumentPosition();n.selection.moveToPosition(t),c.start.row=c.end.row=t.row,e.stop()});var i,l=new s(-1,0,-1,Infinity),c=new s(-1,0,-1,Infinity);c.id=n.session.addMarker(c,&quot;ace_active-line&quot;,&quot;fullLine&quot;),n.setSelectOnHover=function(e){e?l.id&amp;&amp;(n.session.removeMarker(l.id),l.id=null):l.id=n.session.addMarker(l,&quot;ace_line-hover&quot;,&quot;fullLine&quot;)},n.setSelectOnHover(!1),n.on(&quot;mousemove&quot;,function(e){if(!i){i=e;return}if(i.x==e.x&amp;&amp;i.y==e.y)return;i=e,i.scrollTop=n.renderer.scrollTop;var t=i.getDocumentPosition().row;l.start.row!=t&amp;&amp;(l.id||n.setRow(t),p(t))}),n.renderer.on(&quot;beforeRender&quot;,function(){if(i&amp;&amp;l.start.row!=-1){i.$pos=null;var e=i.getDocumentPosition().row;l.id||n.setRow(e),p(e,!0)}}),n.renderer.on(&quot;afterRender&quot;,function(){var e=n.getRow(),t=n.renderer.$textLayer,r=t.element.childNodes[e-t.config.firstRow];r!==t.selectedNode&amp;&amp;t.selectedNode&amp;&amp;a.removeCssClass(t.selectedNode,&quot;ace_selected&quot;),t.selectedNode=r,r&amp;&amp;a.addCssClass(r,&quot;ace_selected&quot;)});var h=function(){p(-1)},p=function(e,t){e!==l.start.row&amp;&amp;(l.start.row=l.end.row=e,t||n.session._emit(&quot;changeBackMarker&quot;),n._emit(&quot;changeHoverMarker&quot;))};n.getHoveredRow=function(){return l.start.row},o.addListener(n.container,&quot;mouseout&quot;,h),n.on(&quot;hide&quot;,h),n.on(&quot;changeSelection&quot;,h),n.session.doc.getLength=function(){return n.data.length},n.session.doc.getLine=function(e){var t=n.data[e];return typeof t==&quot;string&quot;?t:t&amp;&amp;t.value||&quot;&quot;};var d=n.session.bgTokenizer;return d.$tokenizeRow=function(e){function s(e,n){e&amp;&amp;r.push({type:(t.className||&quot;&quot;)+(n||&quot;&quot;),value:e})}var t=n.data[e],r=[];if(!t)return r;typeof t==&quot;string&quot;&amp;&amp;(t={value:t});var i=t.caption||t.value||t.name,o=i.toLowerCase(),u=(n.filterText||&quot;&quot;).toLowerCase(),a=0,f=0;for(var l=0;l&lt;=u.length;l++)if(l!=f&amp;&amp;(t.matchMask&amp;1&lt;&lt;l||l==u.length)){var c=u.slice(f,l);f=l;var h=o.indexOf(c,a);if(h==-1)continue;s(i.slice(a,h),&quot;&quot;),a=h+c.length,s(i.slice(h,a),&quot;completion-highlight&quot;)}return s(i.slice(a,i.length),&quot;&quot;),t.meta&amp;&amp;r.push({type:&quot;completion-meta&quot;,value:t.meta}),t.message&amp;&amp;r.push({type:&quot;completion-message&quot;,value:t.message}),r},d.$updateOnChange=r,d.start=r,n.session.$computeWidth=function(){return this.screenWidth=0},n.isOpen=!1,n.isTopdown=!1,n.autoSelect=!0,n.filterText=&quot;&quot;,n.data=[],n.setData=function(e,t){n.filterText=t||&quot;&quot;,n.setValue(u.stringRepeat(&quot;\sn&quot;,e.length),-1),n.data=e||[],n.setRow(0)},n.getData=function(e){return n.data[e]},n.getRow=function(){return c.start.row},n.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),c.start.row!=e&amp;&amp;(n.selection.clearSelection(),c.start.row=c.end.row=e||0,n.session._emit(&quot;changeBackMarker&quot;),n.moveCursorTo(e||0,0),n.isOpen&amp;&amp;n._signal(&quot;select&quot;))},n.on(&quot;changeSelection&quot;,function(){n.isOpen&amp;&amp;n.setRow(n.selection.lead.row),n.renderer.scrollCursorIntoView()}),n.hide=function(){this.container.style.display=&quot;none&quot;,this._signal(&quot;hide&quot;),n.isOpen=!1},n.show=function(e,t,r){var s=this.container,o=window.innerHeight,u=window.innerWidth,a=this.renderer,f=a.$maxLines*t*1.4,l=e.top+this.$borderSize,c=l&gt;o/2&amp;&amp;!r;c&amp;&amp;l+t+f&gt;o?(a.$maxPixelHeight=l-2*this.$borderSize,s.style.top=&quot;&quot;,s.style.bottom=o-l+&quot;px&quot;,n.isTopdown=!1):(l+=t,a.$maxPixelHeight=o-l-.2*t,s.style.top=l+&quot;px&quot;,s.style.bottom=&quot;&quot;,n.isTopdown=!0),s.style.display=&quot;&quot;;var h=e.left;h+s.offsetWidth&gt;u&amp;&amp;(h=u-s.offsetWidth),s.style.left=h+&quot;px&quot;,this._signal(&quot;show&quot;),i=null,n.isOpen=!0},n.goTo=function(e){var t=this.getRow(),n=this.session.getLength()-1;switch(e){case&quot;up&quot;:t=t&lt;=0?n:t-1;break;case&quot;down&quot;:t=t&gt;=n?-1:t+1;break;case&quot;start&quot;:t=0;break;case&quot;end&quot;:t=n}this.setRow(t)},n.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},n.$imageSize=0,n.$borderSize=1,n};a.importCssString(&quot;.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}&quot;,&quot;autocompletion.css&quot;),t.AcePopup=l,t.$singleLineEditor=f}),ace.define(&quot;ace/autocomplete/util&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;t.parForEach=function(e,t,n){var r=0,i=e.length;i===0&amp;&amp;n();for(var s=0;s&lt;i;s++)t(e[s],function(e,t){r++,r===i&amp;&amp;n(e,t)})};var r=/[a-zA-Z_0-9\s$\s-\su00A2-\su2000\su2070-\suFFFF]/;t.retrievePrecedingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t-1;s&gt;=0;s--){if(!n.test(e[s]))break;i.push(e[s])}return i.reverse().join(&quot;&quot;)},t.retrieveFollowingIdentifier=function(e,t,n){n=n||r;var i=[];for(var s=t;s&lt;e.length;s++){if(!n.test(e[s]))break;i.push(e[s])}return i},t.getCompletionPrefix=function(e){var t=e.getCursorPosition(),n=e.session.getLine(t.row),r;return e.completers.forEach(function(e){e.identifierRegexps&amp;&amp;e.identifierRegexps.forEach(function(e){!r&amp;&amp;e&amp;&amp;(r=this.retrievePrecedingIdentifier(n,t.column,e))}.bind(this))}.bind(this)),r||this.retrievePrecedingIdentifier(n,t.column)}}),ace.define(&quot;ace/snippets&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/lib/lang&quot;,&quot;ace/range&quot;,&quot;ace/range_list&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/tokenizer&quot;,&quot;ace/clipboard&quot;,&quot;ace/lib/dom&quot;,&quot;ace/editor&quot;],function(e,t,n){&quot;use strict&quot;;function h(e){var t=(new Date).toLocaleString(&quot;en-us&quot;,e);return t.length==1?&quot;0&quot;+t:t}var r=e(&quot;./lib/oop&quot;),i=e(&quot;./lib/event_emitter&quot;).EventEmitter,s=e(&quot;./lib/lang&quot;),o=e(&quot;./range&quot;).Range,u=e(&quot;./range_list&quot;).RangeList,a=e(&quot;./keyboard/hash_handler&quot;).HashHandler,f=e(&quot;./tokenizer&quot;).Tokenizer,l=e(&quot;./clipboard&quot;),c={CURRENT_WORD:function(e){return e.session.getTextRange(e.session.getWordRange())},SELECTION:function(e,t,n){var r=e.session.getTextRange();return n?r.replace(/\sn\sr?([ \st]*\sS)/g,&quot;\sn&quot;+n+&quot;$1&quot;):r},CURRENT_LINE:function(e){return e.session.getLine(e.getCursorPosition().row)},PREV_LINE:function(e){return e.session.getLine(e.getCursorPosition().row-1)},LINE_INDEX:function(e){return e.getCursorPosition().row},LINE_NUMBER:function(e){return e.getCursorPosition().row+1},SOFT_TABS:function(e){return e.session.getUseSoftTabs()?&quot;YES&quot;:&quot;NO&quot;},TAB_SIZE:function(e){return e.session.getTabSize()},CLIPBOARD:function(e){return l.getText&amp;&amp;l.getText()},FILENAME:function(e){return/[^/\s\s]*$/.exec(this.FILEPATH(e))[0]},FILENAME_BASE:function(e){return/[^/\s\s]*$/.exec(this.FILEPATH(e))[0].replace(/\s.[^.]*$/,&quot;&quot;)},DIRECTORY:function(e){return this.FILEPATH(e).replace(/[^/\s\s]*$/,&quot;&quot;)},FILEPATH:function(e){return&quot;/not implemented.txt&quot;},WORKSPACE_NAME:function(){return&quot;Unknown&quot;},FULLNAME:function(){return&quot;Unknown&quot;},BLOCK_COMMENT_START:function(e){var t=e.session.$mode||{};return t.blockComment&amp;&amp;t.blockComment.start||&quot;&quot;},BLOCK_COMMENT_END:function(e){var t=e.session.$mode||{};return t.blockComment&amp;&amp;t.blockComment.end||&quot;&quot;},LINE_COMMENT:function(e){var t=e.session.$mode||{};return t.lineCommentStart||&quot;&quot;},CURRENT_YEAR:h.bind(null,{year:&quot;numeric&quot;}),CURRENT_YEAR_SHORT:h.bind(null,{year:&quot;2-digit&quot;}),CURRENT_MONTH:h.bind(null,{month:&quot;numeric&quot;}),CURRENT_MONTH_NAME:h.bind(null,{month:&quot;long&quot;}),CURRENT_MONTH_NAME_SHORT:h.bind(null,{month:&quot;short&quot;}),CURRENT_DATE:h.bind(null,{day:&quot;2-digit&quot;}),CURRENT_DAY_NAME:h.bind(null,{weekday:&quot;long&quot;}),CURRENT_DAY_NAME_SHORT:h.bind(null,{weekday:&quot;short&quot;}),CURRENT_HOUR:h.bind(null,{hour:&quot;2-digit&quot;,hour12:!1}),CURRENT_MINUTE:h.bind(null,{minute:&quot;2-digit&quot;}),CURRENT_SECOND:h.bind(null,{second:&quot;2-digit&quot;})};c.SELECTED_TEXT=c.SELECTION;var p=function(){this.snippetMap={},this.snippetNameMap={}};(function(){r.implement(this,i),this.getTokenizer=function(){return p.$tokenizer||this.createTokenizer()},this.createTokenizer=function(){function e(e){return e=e.substr(1),/^\sd+$/.test(e)?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return&quot;(?:[^\s\s\s\s&quot;+e+&quot;]|\s\s\s\s.)&quot;}var n={regex:&quot;/(&quot;+t(&quot;/&quot;)+&quot;+)/&quot;,onMatch:function(e,t,n){var r=n[0];return r.fmtString=!0,r.guard=e.slice(1,-1),r.flag=&quot;&quot;,&quot;&quot;},next:&quot;formatString&quot;};return p.$tokenizer=new f({start:[{regex:/\s\s./,onMatch:function(e,t,n){var r=e[1];return r==&quot;}&quot;&amp;&amp;n.length?e=r:&quot;`$\s\s&quot;.indexOf(r)!=-1&amp;&amp;(e=r),[e]}},{regex:/}/,onMatch:function(e,t,n){return[n.length?n.shift():e]}},{regex:/\s$(?:\sd+|\sw+)/,onMatch:e},{regex:/\s$\s{[\sdA-Z_a-z]+/,onMatch:function(t,n,r){var i=e(t.substr(1));return r.unshift(i[0]),i},next:&quot;snippetVar&quot;},{regex:/\sn/,token:&quot;newline&quot;,merge:!1}],snippetVar:[{regex:&quot;\s\s|&quot;+t(&quot;\s\s|&quot;)+&quot;*\s\s|&quot;,onMatch:function(e,t,n){var r=e.slice(1,-1).replace(/\s\s[,|\s\s]|,/g,function(e){return e.length==2?e[1]:&quot;\s0&quot;}).split(&quot;\s0&quot;);return n[0].choices=r,[r[0]]},next:&quot;start&quot;},n,{regex:&quot;([^:}\s\s\s\s]|\s\s\s\s.)*:?&quot;,token:&quot;&quot;,next:&quot;start&quot;}],formatString:[{regex:/:/,onMatch:function(e,t,n){return n.length&amp;&amp;n[0].expectElse?(n[0].expectElse=!1,n[0].ifEnd={elseEnd:n[0]},[n[0].ifEnd]):&quot;:&quot;}},{regex:/\s\s./,onMatch:function(e,t,n){var r=e[1];return r==&quot;}&quot;&amp;&amp;n.length?e=r:&quot;`$\s\s&quot;.indexOf(r)!=-1?e=r:r==&quot;n&quot;?e=&quot;\sn&quot;:r==&quot;t&quot;?e=&quot;	&quot;:&quot;ulULE&quot;.indexOf(r)!=-1&amp;&amp;(e={changeCase:r,local:r&gt;&quot;a&quot;}),[e]}},{regex:&quot;/\s\sw*}&quot;,onMatch:function(e,t,n){var r=n.shift();return r&amp;&amp;(r.flag=e.slice(1,-1)),this.next=r&amp;&amp;r.tabstopId?&quot;start&quot;:&quot;&quot;,[r||e]},next:&quot;start&quot;},{regex:/\s$(?:\sd+|\sw+)/,onMatch:function(e,t,n){return[{text:e.slice(1)}]}},{regex:/\s${\sw+/,onMatch:function(e,t,n){var r={text:e.slice(2)};return n.unshift(r),[r]},next:&quot;formatStringVar&quot;},{regex:/\sn/,token:&quot;newline&quot;,merge:!1},{regex:/}/,onMatch:function(e,t,n){var r=n.shift();return this.next=r&amp;&amp;r.tabstopId?&quot;start&quot;:&quot;&quot;,[r||e]},next:&quot;start&quot;}],formatStringVar:[{regex:/:\s/\sw+}/,onMatch:function(e,t,n){var r=n[0];return r.formatFunction=e.slice(2,-1),[n.shift()]},next:&quot;formatString&quot;},n,{regex:/:[\s?\s-+]?/,onMatch:function(e,t,n){e[1]==&quot;+&quot;&amp;&amp;(n[0].ifEnd=n[0]),e[1]==&quot;?&quot;&amp;&amp;(n[0].expectElse=!0)},next:&quot;formatString&quot;},{regex:&quot;([^:}\s\s\s\s]|\s\s\s\s.)*:?&quot;,token:&quot;&quot;,next:&quot;formatString&quot;}]}),p.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.getVariableValue=function(e,t,n){if(/^\sd+$/.test(t))return(this.variables.__||{})[t]||&quot;&quot;;if(/^[A-Z]\sd+$/.test(t))return(this.variables[t[0]+&quot;__&quot;]||{})[t.substr(1)]||&quot;&quot;;t=t.replace(/^TM_/,&quot;&quot;);if(!this.variables.hasOwnProperty(t))return&quot;&quot;;var r=this.variables[t];return typeof r==&quot;function&quot;&amp;&amp;(r=this.variables[t](e,t,n)),r==null?&quot;&quot;:r},this.variables=c,this.tmStrFormat=function(e,t,n){if(!t.fmt)return e;var r=t.flag||&quot;&quot;,i=t.guard;i=new RegExp(i,r.replace(/[^gim]/g,&quot;&quot;));var s=typeof t.fmt==&quot;string&quot;?this.tokenizeTmSnippet(t.fmt,&quot;formatString&quot;):t.fmt,o=this,u=e.replace(i,function(){var e=o.variables.__;o.variables.__=[].slice.call(arguments);var t=o.resolveVariables(s,n),r=&quot;E&quot;;for(var i=0;i&lt;t.length;i++){var u=t[i];if(typeof u==&quot;object&quot;){t[i]=&quot;&quot;;if(u.changeCase&amp;&amp;u.local){var a=t[i+1];a&amp;&amp;typeof a==&quot;string&quot;&amp;&amp;(u.changeCase==&quot;u&quot;?t[i]=a[0].toUpperCase():t[i]=a[0].toLowerCase(),t[i+1]=a.substr(1))}else u.changeCase&amp;&amp;(r=u.changeCase)}else r==&quot;U&quot;?t[i]=u.toUpperCase():r==&quot;L&quot;&amp;&amp;(t[i]=u.toLowerCase())}return o.variables.__=e,t.join(&quot;&quot;)});return u},this.tmFormatFunction=function(e,t,n){return t.formatFunction==&quot;upcase&quot;?e.toUpperCase():t.formatFunction==&quot;downcase&quot;?e.toLowerCase():e},this.resolveVariables=function(e,t){function f(t){var n=e.indexOf(t,s+1);n!=-1&amp;&amp;(s=n)}var n=[],r=&quot;&quot;,i=!0;for(var s=0;s&lt;e.length;s++){var o=e[s];if(typeof o==&quot;string&quot;){n.push(o),o==&quot;\sn&quot;?(i=!0,r=&quot;&quot;):i&amp;&amp;(r=/^\st*/.exec(o)[0],i=/\sS/.test(o));continue}if(!o)continue;i=!1;if(o.fmtString){var u=e.indexOf(o,s+1);u==-1&amp;&amp;(u=e.length),o.fmt=e.slice(s+1,u),s=u}if(o.text){var a=this.getVariableValue(t,o.text,r)+&quot;&quot;;o.fmtString&amp;&amp;(a=this.tmStrFormat(a,o,t)),o.formatFunction&amp;&amp;(a=this.tmFormatFunction(a,o,t)),a&amp;&amp;!o.ifEnd?(n.push(a),f(o)):!a&amp;&amp;o.ifEnd&amp;&amp;f(o.ifEnd)}else o.elseEnd?f(o.elseEnd):o.tabstopId!=null?n.push(o):o.changeCase!=null&amp;&amp;n.push(o)}return n},this.insertSnippetForSelection=function(e,t){function f(e){var t=[];for(var n=0;n&lt;e.length;n++){var r=e[n];if(typeof r==&quot;object&quot;){if(a[r.tabstopId])continue;var i=e.lastIndexOf(r,n-1);r=t[i]||{tabstopId:r.tabstopId}}t[n]=r}return t}var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=e.session.getTabString(),s=r.match(/^\ss*/)[0];n.column&lt;s.length&amp;&amp;(s=s.slice(0,n.column)),t=t.replace(/\sr/g,&quot;&quot;);var o=this.tokenizeTmSnippet(t);o=this.resolveVariables(o,e),o=o.map(function(e){return e==&quot;\sn&quot;?e+s:typeof e==&quot;string&quot;?e.replace(/\st/g,i):e});var u=[];o.forEach(function(e,t){if(typeof e!=&quot;object&quot;)return;var n=e.tabstopId,r=u[n];r||(r=u[n]=[],r.index=n,r.value=&quot;&quot;,r.parents={});if(r.indexOf(e)!==-1)return;e.choices&amp;&amp;!r.choices&amp;&amp;(r.choices=e.choices),r.push(e);var i=o.indexOf(e,t+1);if(i===-1)return;var s=o.slice(t+1,i),a=s.some(function(e){return typeof e==&quot;object&quot;});a&amp;&amp;!r.value?r.value=s:s.length&amp;&amp;(!r.value||typeof r.value!=&quot;string&quot;)&amp;&amp;(r.value=s.join(&quot;&quot;))}),u.forEach(function(e){e.length=0});var a={};for(var l=0;l&lt;o.length;l++){var c=o[l];if(typeof c!=&quot;object&quot;)continue;var h=c.tabstopId,p=u[h],v=o.indexOf(c,l+1);if(a[h]){a[h]===c&amp;&amp;(delete a[h],Object.keys(a).forEach(function(e){p.parents[e]=!0}));continue}a[h]=c;var m=p.value;typeof m!=&quot;string&quot;?m=f(m):c.fmt&amp;&amp;(m=this.tmStrFormat(m,c,e)),o.splice.apply(o,[l+1,Math.max(0,v-l)].concat(m,c)),p.indexOf(c)===-1&amp;&amp;p.push(c)}var g=0,y=0,b=&quot;&quot;;o.forEach(function(e){if(typeof e==&quot;string&quot;){var t=e.split(&quot;\sn&quot;);t.length&gt;1?(y=t[t.length-1].length,g+=t.length-1):y+=e.length,b+=e}else e&amp;&amp;(e.start?e.end={row:g,column:y}:e.start={row:g,column:y})});var w=e.getSelectionRange(),E=e.session.replace(w,b),S=new d(e),x=e.inVirtualSelectionMode&amp;&amp;e.selection.index;S.addTabstops(u,w.start,E,x)},this.insertSnippet=function(e,t){var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t);e.forEachSelection(function(){n.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&amp;&amp;e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||&quot;&quot;;t=t.split(&quot;/&quot;).pop();if(t===&quot;html&quot;||t===&quot;php&quot;){t===&quot;php&quot;&amp;&amp;!e.session.$mode.inlinePhp&amp;&amp;(t=&quot;html&quot;);var n=e.getCursorPosition(),r=e.session.getState(n.row);typeof r==&quot;object&quot;&amp;&amp;(r=r[0]),r.substring&amp;&amp;(r.substring(0,3)==&quot;js-&quot;?t=&quot;javascript&quot;:r.substring(0,4)==&quot;css-&quot;?t=&quot;css&quot;:r.substring(0,4)==&quot;php-&quot;&amp;&amp;(t=&quot;php&quot;))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),n=[t],r=this.snippetMap;return r[t]&amp;&amp;r[t].includeScopes&amp;&amp;n.push.apply(n,r[t].includeScopes),n.push(&quot;_&quot;),n},this.expandWithTab=function(e,t){var n=this,r=e.forEachSelection(function(){return n.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return r&amp;&amp;e.tabstopManager&amp;&amp;e.tabstopManager.tabNext(),r},this.expandSnippetForSelection=function(e,t){var n=e.getCursorPosition(),r=e.session.getLine(n.row),i=r.substring(0,n.column),s=r.substr(n.column),o=this.snippetMap,u;return this.getActiveScopes(e).some(function(e){var t=o[e];return t&amp;&amp;(u=this.findMatchingSnippet(t,i,s)),!!u},this),u?t&amp;&amp;t.dryRun?!0:(e.session.doc.removeInLine(n.row,n.column-u.replaceBefore.length,n.column+u.replaceAfter.length),this.variables.M__=u.matchBefore,this.variables.T__=u.matchAfter,this.insertSnippetForSelection(e,u.content),this.variables.M__=this.variables.T__=null,!0):!1},this.findMatchingSnippet=function(e,t,n){for(var r=e.length;r--;){var i=e[r];if(i.startRe&amp;&amp;!i.startRe.test(t))continue;if(i.endRe&amp;&amp;!i.endRe.test(n))continue;if(!i.startRe&amp;&amp;!i.endRe)continue;return i.matchBefore=i.startRe?i.startRe.exec(t):[&quot;&quot;],i.matchAfter=i.endRe?i.endRe.exec(n):[&quot;&quot;],i.replaceBefore=i.triggerRe?i.triggerRe.exec(t)[0]:&quot;&quot;,i.replaceAfter=i.endTriggerRe?i.endTriggerRe.exec(n)[0]:&quot;&quot;,i}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){function o(e){return e&amp;&amp;!/^\s^?\s(.*\s)\s$?$|^\s\sb$/.test(e)&amp;&amp;(e=&quot;(?:&quot;+e+&quot;)&quot;),e||&quot;&quot;}function u(e,t,n){return e=o(e),t=o(t),n?(e=t+e,e&amp;&amp;e[e.length-1]!=&quot;$&quot;&amp;&amp;(e+=&quot;$&quot;)):(e+=t,e&amp;&amp;e[0]!=&quot;^&quot;&amp;&amp;(e=&quot;^&quot;+e)),new RegExp(e)}function a(e){e.scope||(e.scope=t||&quot;_&quot;),t=e.scope,n[t]||(n[t]=[],r[t]={});var o=r[t];if(e.name){var a=o[e.name];a&amp;&amp;i.unregister(a),o[e.name]=e}n[t].push(e),e.tabTrigger&amp;&amp;!e.trigger&amp;&amp;(!e.guard&amp;&amp;/^\sw/.test(e.tabTrigger)&amp;&amp;(e.guard=&quot;\s\sb&quot;),e.trigger=s.escapeRegExp(e.tabTrigger));if(!e.trigger&amp;&amp;!e.guard&amp;&amp;!e.endTrigger&amp;&amp;!e.endGuard)return;e.startRe=u(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger),e.endRe=u(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger)}var n=this.snippetMap,r=this.snippetNameMap,i=this;e||(e=[]),e&amp;&amp;e.content?a(e):Array.isArray(e)&amp;&amp;e.forEach(a),this._signal(&quot;registerSnippets&quot;,{scope:t})},this.unregister=function(e,t){function i(e){var i=r[e.scope||t];if(i&amp;&amp;i[e.name]){delete i[e.name];var s=n[e.scope||t],o=s&amp;&amp;s.indexOf(e);o&gt;=0&amp;&amp;s.splice(o,1)}}var n=this.snippetMap,r=this.snippetNameMap;e.content?i(e):Array.isArray(e)&amp;&amp;e.forEach(i)},this.parseSnippetFile=function(e){e=e.replace(/\sr/g,&quot;&quot;);var t=[],n={},r=/^#.*|^({[\ss\sS]*})\ss*$|^(\sS+) (.*)$|^((?:\sn*\st.*)+)/gm,i;while(i=r.exec(e)){if(i[1])try{n=JSON.parse(i[1]),t.push(n)}catch(s){}if(i[4])n.content=i[4].replace(/^\st/gm,&quot;&quot;),t.push(n),n={};else{var o=i[2],u=i[3];if(o==&quot;regex&quot;){var a=/\s/((?:[^\s/\s\s]|\s\s.)*)|$/g;n.guard=a.exec(u)[1],n.trigger=a.exec(u)[1],n.endTrigger=a.exec(u)[1],n.endGuard=a.exec(u)[1]}else o==&quot;snippet&quot;?(n.tabTrigger=u.match(/^\sS*/)[0],n.name||(n.name=u)):n[o]=u}}return t},this.getSnippetByName=function(e,t){var n=this.snippetNameMap,r;return this.getActiveScopes(t).some(function(t){var i=n[t];return i&amp;&amp;(r=i[e]),!!r},this),r}}).call(p.prototype);var d=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=s.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on(&quot;change&quot;,this.$onChange),this.editor.on(&quot;changeSelection&quot;,this.$onChangeSelection),this.editor.on(&quot;changeSession&quot;,this.$onChangeSession),this.editor.commands.on(&quot;afterExec&quot;,this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener(&quot;change&quot;,this.$onChange),this.editor.removeListener(&quot;changeSelection&quot;,this.$onChangeSelection),this.editor.removeListener(&quot;changeSession&quot;,this.$onChangeSession),this.editor.commands.removeListener(&quot;afterExec&quot;,this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){var t=e.action[0]==&quot;r&quot;,n=this.selectedTabstop||{},r=n.parents||{},i=(this.tabstops||[]).slice();for(var s=0;s&lt;i.length;s++){var o=i[s],u=o==n||r[o.index];o.rangeList.$bias=u?0:1;if(e.action==&quot;remove&quot;&amp;&amp;o!==n){var a=o.parents&amp;&amp;o.parents[n.index],f=o.rangeList.pointIndex(e.start,a);f=f&lt;0?-f-1:f+1;var l=o.rangeList.pointIndex(e.end,a);l=l&lt;0?-l-1:l-1;var c=o.rangeList.ranges.slice(f,l);for(var h=0;h&lt;c.length;h++)this.removeRange(c[h])}o.rangeList.$onChange(e)}var p=this.editor.session;!this.$inChange&amp;&amp;t&amp;&amp;p.getLength()==1&amp;&amp;!p.getValue()&amp;&amp;this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(!e||!e.hasLinkedRanges||!e.firstNonLinked)return;this.$inChange=!0;var n=this.editor.session,r=n.getTextRange(e.firstNonLinked);for(var i=0;i&lt;e.length;i++){var s=e[i];if(!s.linked)continue;var o=s.original,u=t.snippetManager.tmStrFormat(r,o,this.editor);n.replace(s,u)}this.$inChange=!1},this.onAfterExec=function(e){e.command&amp;&amp;!e.command.readOnly&amp;&amp;this.updateLinkedFields()},this.onChangeSelection=function(){if(!this.editor)return;var e=this.editor.selection.lead,t=this.editor.selection.anchor,n=this.editor.selection.isEmpty();for(var r=0;r&lt;this.ranges.length;r++){if(this.ranges[r].linked)continue;var i=this.ranges[r].contains(e.row,e.column),s=n||this.ranges[r].contains(t.row,t.column);if(i&amp;&amp;s)return}this.detach()},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,n=this.index+(e||1);n=Math.min(Math.max(n,1),t),n==t&amp;&amp;(n=0),this.selectTabstop(n),n===0&amp;&amp;this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];t&amp;&amp;this.addTabstopMarkers(t),this.index=e,t=this.tabstops[this.index];if(!t||!t.length)return;this.selectedTabstop=t;var n=t.firstNonLinked||t;if(!this.editor.inVirtualSelectionMode){var r=this.editor.multiSelect;r.toSingleRange(n.clone());for(var i=0;i&lt;t.length;i++){if(t.hasLinkedRanges&amp;&amp;t[i].linked)continue;r.addRange(t[i].clone(),!0)}r.ranges[0]&amp;&amp;r.addRange(r.ranges[0].clone())}else this.editor.selection.setRange(n);this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&amp;&amp;this.selectedTabstop.choices&amp;&amp;this.editor.execCommand(&quot;startAutocomplete&quot;,{matches:this.selectedTabstop.choices})},this.addTabstops=function(e,t,n){var r=this.useLink||!this.editor.getOption(&quot;enableMultiselect&quot;);this.$openTabstops||(this.$openTabstops=[]);if(!e[0]){var i=o.fromPoints(n,n);m(i.start,t),m(i.end,t),e[0]=[i],e[0].index=0}var s=this.index,a=[s+1,0],f=this.ranges;e.forEach(function(e,n){var i=this.$openTabstops[n]||e;for(var s=0;s&lt;e.length;s++){var l=e[s],c=o.fromPoints(l.start,l.end||l.start);v(c.start,t),v(c.end,t),c.original=l,c.tabstop=i,f.push(c),i!=e?i.unshift(c):i[s]=c,l.fmtString||i.firstNonLinked&amp;&amp;r?(c.linked=!0,i.hasLinkedRanges=!0):i.firstNonLinked||(i.firstNonLinked=c)}i.firstNonLinked||(i.hasLinkedRanges=!1),i===e&amp;&amp;(a.push(i),this.$openTabstops[n]=i),this.addTabstopMarkers(i),i.rangeList=i.rangeList||new u,i.rangeList.$bias=0,i.rangeList.addList(i)},this),a.length&gt;2&amp;&amp;(this.tabstops.length&amp;&amp;a.push(a.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,a))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,&quot;ace_snippet-marker&quot;,&quot;text&quot;))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);t!=-1&amp;&amp;e.tabstop.splice(t,1),t=this.ranges.indexOf(e),t!=-1&amp;&amp;this.ranges.splice(t,1),t=e.tabstop.rangeList.ranges.indexOf(e),t!=-1&amp;&amp;e.tabstop.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(t=this.tabstops.indexOf(e.tabstop),t!=-1&amp;&amp;this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new a,this.keyboardHandler.bindKeys({Tab:function(e){if(t.snippetManager&amp;&amp;t.snippetManager.expandWithTab(e))return;e.tabstopManager.tabNext(1),e.renderer.scrollCursorIntoView()},&quot;Shift-Tab&quot;:function(e){e.tabstopManager.tabNext(-1),e.renderer.scrollCursorIntoView()},Esc:function(e){e.tabstopManager.detach()}})}).call(d.prototype);var v=function(e,t){e.row==0&amp;&amp;(e.column+=t.column),e.row+=t.row},m=function(e,t){e.row==t.row&amp;&amp;(e.column-=t.column),e.row-=t.row};e(&quot;./lib/dom&quot;).importCssString(&quot;.ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}&quot;),t.snippetManager=new p;var g=e(&quot;./editor&quot;).Editor;(function(){this.insertSnippet=function(e,n){return t.snippetManager.insertSnippet(this,e,n)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(g.prototype)}),ace.define(&quot;ace/autocomplete&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/keyboard/hash_handler&quot;,&quot;ace/autocomplete/popup&quot;,&quot;ace/autocomplete/util&quot;,&quot;ace/lib/lang&quot;,&quot;ace/lib/dom&quot;,&quot;ace/snippets&quot;,&quot;ace/config&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;./keyboard/hash_handler&quot;).HashHandler,i=e(&quot;./autocomplete/popup&quot;).AcePopup,s=e(&quot;./autocomplete/util&quot;),o=e(&quot;./lib/lang&quot;),u=e(&quot;./lib/dom&quot;),a=e(&quot;./snippets&quot;).snippetManager,f=e(&quot;./config&quot;),l=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new r,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=o.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=o.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new i(document.body||document.documentElement),this.popup.on(&quot;click&quot;,function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on(&quot;show&quot;,this.tooltipTimer.bind(null,null)),this.popup.on(&quot;select&quot;,this.tooltipTimer.bind(null,null)),this.popup.on(&quot;changeHoverMarker&quot;,this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,n){this.popup||this.$init(),this.popup.autoSelect=this.autoSelect,this.popup.setData(this.completions.filtered,this.completions.filterText),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var r=e.renderer;this.popup.setRow(this.autoSelect?0:-1);if(!n){this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var i=r.layerConfig.lineHeight,s=r.$cursorLayer.getPixelPosition(this.base,!0);s.left-=this.popup.getTextLeftOffset();var o=e.container.getBoundingClientRect();s.top+=o.top-r.layerConfig.offset,s.left+=o.left-e.renderer.scrollLeft,s.left+=r.gutterWidth,this.popup.show(s,i)}else n&amp;&amp;!t&amp;&amp;this.detach()},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off(&quot;changeSelection&quot;,this.changeListener),this.editor.off(&quot;blur&quot;,this.blurListener),this.editor.off(&quot;mousedown&quot;,this.mousedownListener),this.editor.off(&quot;mousewheel&quot;,this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&amp;&amp;this.popup.isOpen&amp;&amp;this.popup.hide(),this.base&amp;&amp;this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column&lt;this.base.column)&amp;&amp;this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,n=this.editor.textInput.getElement(),r=e.relatedTarget&amp;&amp;this.tooltipNode&amp;&amp;this.tooltipNode.contains(e.relatedTarget),i=this.popup&amp;&amp;this.popup.container;t!=n&amp;&amp;t.parentNode!=i&amp;&amp;!r&amp;&amp;t!=this.tooltipNode&amp;&amp;e.relatedTarget!=n&amp;&amp;this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){this.popup.goTo(e)},this.insertMatch=function(e,t){e||(e=this.popup.getData(this.popup.getRow()));if(!e)return!1;if(e.completer&amp;&amp;e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(this.completions.filterText){var n=this.editor.selection.getAllRanges();for(var r=0,i;i=n[r];r++)i.start.column-=this.completions.filterText.length,this.editor.session.remove(i)}e.snippet?a.insertSnippet(this.editor,e.snippet):this.editor.execCommand(&quot;insertstring&quot;,e.value||e)}this.detach()},this.commands={Up:function(e){e.completer.goTo(&quot;up&quot;)},Down:function(e){e.completer.goTo(&quot;down&quot;)},&quot;Ctrl-Up|Ctrl-Home&quot;:function(e){e.completer.goTo(&quot;start&quot;)},&quot;Ctrl-Down|Ctrl-End&quot;:function(e){e.completer.goTo(&quot;end&quot;)},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},&quot;Shift-Return&quot;:function(e){e.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(e){var t=e.completer.insertMatch();if(!!t||!!e.tabstopManager)return t;e.completer.goTo(&quot;down&quot;)},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var n=e.getSession(),r=e.getCursorPosition(),i=s.getCompletionPrefix(e);this.base=n.doc.createAnchor(r.row,r.column-i.length),this.base.$insertRight=!0;var o=[],u=e.completers.length;return e.completers.forEach(function(a,f){a.getCompletions(e,n,r,i,function(n,r){!n&amp;&amp;r&amp;&amp;(o=o.concat(r)),t(null,{prefix:s.getCompletionPrefix(e),matches:o,finished:--u===0})})}),!0},this.showPopup=function(e,t){this.editor&amp;&amp;this.detach(),this.activated=!0,this.editor=e,e.completer!=this&amp;&amp;(e.completer&amp;&amp;e.completer.detach(),e.completer=this),e.on(&quot;changeSelection&quot;,this.changeListener),e.on(&quot;blur&quot;,this.blurListener),e.on(&quot;mousedown&quot;,this.mousedownListener),e.on(&quot;mousewheel&quot;,this.mousewheelListener),this.updateCompletions(!1,t)},this.updateCompletions=function(e,t){if(e&amp;&amp;this.base&amp;&amp;this.completions){var n=this.editor.getCursorPosition(),r=this.editor.session.getTextRange({start:this.base,end:n});if(r==this.completions.filterText)return;this.completions.setFilter(r);if(!this.completions.filtered.length)return this.detach();if(this.completions.filtered.length==1&amp;&amp;this.completions.filtered[0].value==r&amp;&amp;!this.completions.filtered[0].snippet)return this.detach();this.openPopup(this.editor,r,e);return}if(t&amp;&amp;t.matches){var n=this.editor.getSelectionRange().start;return this.base=this.editor.session.doc.createAnchor(n.row,n.column),this.base.$insertRight=!0,this.completions=new c(t.matches),this.openPopup(this.editor,&quot;&quot;,e)}var i=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(t,n){var r=function(){if(!n.finished)return;return this.detach()}.bind(this),s=n.prefix,o=n&amp;&amp;n.matches;if(!o||!o.length)return r();if(s.indexOf(n.prefix)!==0||i!=this.gatherCompletionsId)return;this.completions=new c(o),this.exactMatch&amp;&amp;(this.completions.exactMatch=!0),this.completions.setFilter(s);var u=this.completions.filtered;if(!u.length)return r();if(u.length==1&amp;&amp;u[0].value==s&amp;&amp;!u[0].snippet)return r();if(this.autoInsert&amp;&amp;u.length==1&amp;&amp;n.finished)return this.insertMatch(u[0]);this.openPopup(this.editor,s,e)}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,n=t&amp;&amp;(t[e.getHoveredRow()]||t[e.getRow()]),r=null;if(!n||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();this.editor.completers.some(function(e){return e.getDocTooltip&amp;&amp;(r=e.getDocTooltip(n)),r}),!r&amp;&amp;typeof n!=&quot;string&quot;&amp;&amp;(r=n),typeof r==&quot;string&quot;&amp;&amp;(r={docText:r});if(!r||!r.docHTML&amp;&amp;!r.docText)return this.hideDocTooltip();this.showDocTooltip(r)},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=u.createElement(&quot;div&quot;),this.tooltipNode.className=&quot;ace_tooltip ace_doc-tooltip&quot;,this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents=&quot;auto&quot;,this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&amp;&amp;(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var n=this.popup,r=n.container.getBoundingClientRect();t.style.top=n.container.style.top,t.style.bottom=n.container.style.bottom,t.style.display=&quot;block&quot;,window.innerWidth-r.right&lt;320?r.left&lt;320?n.isTopdown?(t.style.top=r.bottom+&quot;px&quot;,t.style.left=r.left+&quot;px&quot;,t.style.right=&quot;&quot;,t.style.bottom=&quot;&quot;):(t.style.top=n.container.offsetTop-t.offsetHeight+&quot;px&quot;,t.style.left=r.left+&quot;px&quot;,t.style.right=&quot;&quot;,t.style.bottom=&quot;&quot;):(t.style.right=window.innerWidth-r.left+&quot;px&quot;,t.style.left=&quot;&quot;):(t.style.left=r.right+1+&quot;px&quot;,t.style.right=&quot;&quot;)},this.hideDocTooltip=function(){this.tooltipTimer.cancel();if(!this.tooltipNode)return;var e=this.tooltipNode;!this.editor.isFocused()&amp;&amp;document.activeElement==e&amp;&amp;this.editor.focus(),this.tooltipNode=null,e.parentNode&amp;&amp;e.parentNode.removeChild(e)},this.onTooltipClick=function(e){var t=e.target;while(t&amp;&amp;t!=this.tooltipNode){if(t.nodeName==&quot;A&quot;&amp;&amp;t.href){t.rel=&quot;noreferrer&quot;,t.target=&quot;_blank&quot;;break}t=t.parentNode}},this.destroy=function(){this.detach();if(this.popup){this.popup.destroy();var e=this.popup.container;e&amp;&amp;e.parentNode&amp;&amp;e.parentNode.removeChild(e)}this.editor&amp;&amp;this.editor.completer==this&amp;&amp;this.editor.completer==null,this.popup=null}}).call(l.prototype),l.for=function(e){return e.completer?e.completer:(f.get(&quot;sharedPopups&quot;)?(l.$shared||(l.$sharedInstance=new l),e.completer=l.$sharedInstance):(e.completer=new l,e.once(&quot;destroy&quot;,function(e,t){t.completer.destroy()})),e.completer)},l.startCommand={name:&quot;startAutocomplete&quot;,exec:function(e,t){var n=l.for(e);n.autoInsert=!1,n.autoSelect=!0,n.showPopup(e,t),n.cancelContextMenu()},bindKey:&quot;Ctrl-Space|Ctrl-Shift-Space|Alt-Space&quot;};var c=function(e,t){this.all=e,this.filtered=e,this.filterText=t||&quot;&quot;,this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length&gt;this.filterText&amp;&amp;e.lastIndexOf(this.filterText,0)===0)var t=this.filtered;else var t=this.all;this.filterText=e,t=this.filterCompletions(t,this.filterText),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.$score-e.$score||(e.caption||e.value).localeCompare(t.caption||t.value)});var n=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t===n?!1:(n=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var n=[],r=t.toUpperCase(),i=t.toLowerCase();e:for(var s=0,o;o=e[s];s++){var u=o.caption||o.value||o.snippet;if(!u)continue;var a=-1,f=0,l=0,c,h;if(this.exactMatch){if(t!==u.substr(0,t.length))continue e}else{var p=u.toLowerCase().indexOf(i);if(p&gt;-1)l=p;else for(var d=0;d&lt;t.length;d++){var v=u.indexOf(i[d],a+1),m=u.indexOf(r[d],a+1);c=v&gt;=0?m&lt;0||v&lt;m?v:m:m;if(c&lt;0)continue e;h=c-a-1,h&gt;0&amp;&amp;(a===-1&amp;&amp;(l+=10),l+=h,f|=1&lt;&lt;d),a=c}}o.matchMask=f,o.exactMatch=l?0:1,o.$score=(o.score||0)-l,n.push(o)}return n}}).call(c.prototype),t.Autocomplete=l,t.FilteredList=c}),ace.define(&quot;ace/ext/menu_tools/overlay_page&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../lib/dom&quot;),i=&quot;#ace_settingsmenu, #kbshortcutmenu {background-color: #F7F7F7;color: black;box-shadow: -5px 4px 5px rgba(126, 126, 126, 0.55);padding: 1em 0.5em 2em 1em;overflow: auto;position: absolute;margin: 0;bottom: 0;right: 0;top: 0;z-index: 9991;cursor: default;}.ace_dark #ace_settingsmenu, .ace_dark #kbshortcutmenu {box-shadow: -20px 10px 25px rgba(126, 126, 126, 0.25);background-color: rgba(255, 255, 255, 0.6);color: black;}.ace_optionsMenuEntry:hover {background-color: rgba(100, 100, 100, 0.1);transition: all 0.3s}.ace_closeButton {background: rgba(245, 146, 146, 0.5);border: 1px solid #F48A8A;border-radius: 50%;padding: 7px;position: absolute;right: -8px;top: -8px;z-index: 100000;}.ace_closeButton{background: rgba(245, 146, 146, 0.9);}.ace_optionsMenuKey {color: darkslateblue;font-weight: bold;}.ace_optionsMenuCommand {color: darkcyan;font-weight: normal;}.ace_optionsMenuEntry input, .ace_optionsMenuEntry button {vertical-align: middle;}.ace_optionsMenuEntry button[ace_selected_button=true] {background: #e7e7e7;box-shadow: 1px 0px 2px 0px #adadad inset;border-color: #adadad;}.ace_optionsMenuEntry button {background: white;border: 1px solid lightgray;margin: 0px;}.ace_optionsMenuEntry button:hover{background: #f0f0f0;}&quot;;r.importCssString(i),n.exports.overlayPage=function(t,n,r){function o(e){e.keyCode===27&amp;&amp;u()}function u(){if(!i)return;document.removeEventListener(&quot;keydown&quot;,o),i.parentNode.removeChild(i),t&amp;&amp;t.focus(),i=null,r&amp;&amp;r()}function a(e){s=e,e&amp;&amp;(i.style.pointerEvents=&quot;none&quot;,n.style.pointerEvents=&quot;auto&quot;)}var i=document.createElement(&quot;div&quot;),s=!1;return i.style.cssText=&quot;margin: 0; padding: 0; position: fixed; top:0; bottom:0; left:0; right:0;z-index: 9990; &quot;+(t?&quot;background-color: rgba(0, 0, 0, 0.3);&quot;:&quot;&quot;),i.addEventListener(&quot;click&quot;,function(e){s||u()}),document.addEventListener(&quot;keydown&quot;,o),n.addEventListener(&quot;click&quot;,function(e){e.stopPropagation()}),i.appendChild(n),document.body.appendChild(i),t&amp;&amp;t.blur(),{close:u,setIgnoreFocusOut:a}}}),ace.define(&quot;ace/ext/modelist&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;function i(e){var t=a.text,n=e.split(/[\s/\s\s]/).pop();for(var i=0;i&lt;r.length;i++)if(r[i].supportsFile(n)){t=r[i];break}return t}var r=[],s=function(e,t,n){this.name=e,this.caption=t,this.mode=&quot;ace/mode/&quot;+e,this.extensions=n;var r;/\s^/.test(n)?r=n.replace(/\s|(\s^)?/g,function(e,t){return&quot;$|&quot;+(t?&quot;^&quot;:&quot;^.*\s\s.&quot;)})+&quot;$&quot;:r=&quot;^.*\s\s.(&quot;+n+&quot;)$&quot;,this.extRe=new RegExp(r,&quot;gi&quot;)};s.prototype.supportsFile=function(e){return e.match(this.extRe)};var o={ABAP:[&quot;abap&quot;],ABC:[&quot;abc&quot;],ActionScript:[&quot;as&quot;],ADA:[&quot;ada|adb&quot;],Apache_Conf:[&quot;^htaccess|^htgroups|^htpasswd|^conf|htaccess|htgroups|htpasswd&quot;],AsciiDoc:[&quot;asciidoc|adoc&quot;],ASL:[&quot;dsl|asl&quot;],Assembly_x86:[&quot;asm|a&quot;],AutoHotKey:[&quot;ahk&quot;],Apex:[&quot;apex|cls|trigger|tgr&quot;],AQL:[&quot;aql&quot;],BatchFile:[&quot;bat|cmd&quot;],C_Cpp:[&quot;cpp|c|cc|cxx|h|hh|hpp|ino&quot;],C9Search:[&quot;c9search_results&quot;],Crystal:[&quot;cr&quot;],Cirru:[&quot;cirru|cr&quot;],Clojure:[&quot;clj|cljs&quot;],Cobol:[&quot;CBL|COB&quot;],coffee:[&quot;coffee|cf|cson|^Cakefile&quot;],ColdFusion:[&quot;cfm&quot;],CSharp:[&quot;cs&quot;],Csound_Document:[&quot;csd&quot;],Csound_Orchestra:[&quot;orc&quot;],Csound_Score:[&quot;sco&quot;],CSS:[&quot;css&quot;],Curly:[&quot;curly&quot;],D:[&quot;d|di&quot;],Dart:[&quot;dart&quot;],Diff:[&quot;diff|patch&quot;],Dockerfile:[&quot;^Dockerfile&quot;],Dot:[&quot;dot&quot;],Drools:[&quot;drl&quot;],Edifact:[&quot;edi&quot;],Eiffel:[&quot;e|ge&quot;],EJS:[&quot;ejs&quot;],Elixir:[&quot;ex|exs&quot;],Elm:[&quot;elm&quot;],Erlang:[&quot;erl|hrl&quot;],Forth:[&quot;frt|fs|ldr|fth|4th&quot;],Fortran:[&quot;f|f90&quot;],FSharp:[&quot;fsi|fs|ml|mli|fsx|fsscript&quot;],FSL:[&quot;fsl&quot;],FTL:[&quot;ftl&quot;],Gcode:[&quot;gcode&quot;],Gherkin:[&quot;feature&quot;],Gitignore:[&quot;^.gitignore&quot;],Glsl:[&quot;glsl|frag|vert&quot;],Gobstones:[&quot;gbs&quot;],golang:[&quot;go&quot;],GraphQLSchema:[&quot;gql&quot;],Groovy:[&quot;groovy&quot;],HAML:[&quot;haml&quot;],Handlebars:[&quot;hbs|handlebars|tpl|mustache&quot;],Haskell:[&quot;hs&quot;],Haskell_Cabal:[&quot;cabal&quot;],haXe:[&quot;hx&quot;],Hjson:[&quot;hjson&quot;],HTML:[&quot;html|htm|xhtml|vue|we|wpy&quot;],HTML_Elixir:[&quot;eex|html.eex&quot;],HTML_Ruby:[&quot;erb|rhtml|html.erb&quot;],INI:[&quot;ini|conf|cfg|prefs&quot;],Io:[&quot;io&quot;],Jack:[&quot;jack&quot;],Jade:[&quot;jade|pug&quot;],Java:[&quot;java&quot;],JavaScript:[&quot;js|jsm|jsx&quot;],JSON5:[&quot;json5&quot;],JSON:[&quot;json&quot;],JSONiq:[&quot;jq&quot;],JSP:[&quot;jsp&quot;],JSSM:[&quot;jssm|jssm_state&quot;],JSX:[&quot;jsx&quot;],Julia:[&quot;jl&quot;],Kotlin:[&quot;kt|kts&quot;],LaTeX:[&quot;tex|latex|ltx|bib&quot;],LESS:[&quot;less&quot;],Liquid:[&quot;liquid&quot;],Lisp:[&quot;lisp&quot;],LiveScript:[&quot;ls&quot;],LogiQL:[&quot;logic|lql&quot;],LSL:[&quot;lsl&quot;],Lua:[&quot;lua&quot;],LuaPage:[&quot;lp&quot;],Lucene:[&quot;lucene&quot;],Makefile:[&quot;^Makefile|^GNUmakefile|^makefile|^OCamlMakefile|make&quot;],Markdown:[&quot;md|markdown&quot;],Mask:[&quot;mask&quot;],MATLAB:[&quot;matlab&quot;],Maze:[&quot;mz&quot;],MEL:[&quot;mel&quot;],MIXAL:[&quot;mixal&quot;],MUSHCode:[&quot;mc|mush&quot;],MySQL:[&quot;mysql&quot;],Nginx:[&quot;nginx|conf&quot;],Nix:[&quot;nix&quot;],Nim:[&quot;nim&quot;],NSIS:[&quot;nsi|nsh&quot;],Nunjucks:[&quot;nunjucks|nunjs|nj|njk&quot;],ObjectiveC:[&quot;m|mm&quot;],OCaml:[&quot;ml|mli&quot;],Pascal:[&quot;pas|p&quot;],Perl:[&quot;pl|pm&quot;],Perl6:[&quot;p6|pl6|pm6&quot;],pgSQL:[&quot;pgsql&quot;],PHP_Laravel_blade:[&quot;blade.php&quot;],PHP:[&quot;php|inc|phtml|shtml|php3|php4|php5|phps|phpt|aw|ctp|module&quot;],Puppet:[&quot;epp|pp&quot;],Pig:[&quot;pig&quot;],Powershell:[&quot;ps1&quot;],Praat:[&quot;praat|praatscript|psc|proc&quot;],Prolog:[&quot;plg|prolog&quot;],Properties:[&quot;properties&quot;],Protobuf:[&quot;proto&quot;],Python:[&quot;py&quot;],R:[&quot;r&quot;],Razor:[&quot;cshtml|asp&quot;],RDoc:[&quot;Rd&quot;],Red:[&quot;red|reds&quot;],RHTML:[&quot;Rhtml&quot;],RST:[&quot;rst&quot;],Ruby:[&quot;rb|ru|gemspec|rake|^Guardfile|^Rakefile|^Gemfile&quot;],Rust:[&quot;rs&quot;],SASS:[&quot;sass&quot;],SCAD:[&quot;scad&quot;],Scala:[&quot;scala|sbt&quot;],Scheme:[&quot;scm|sm|rkt|oak|scheme&quot;],SCSS:[&quot;scss&quot;],SH:[&quot;sh|bash|^.bashrc&quot;],SJS:[&quot;sjs&quot;],Slim:[&quot;slim|skim&quot;],Smarty:[&quot;smarty|tpl&quot;],snippets:[&quot;snippets&quot;],Soy_Template:[&quot;soy&quot;],Space:[&quot;space&quot;],SQL:[&quot;sql&quot;],SQLServer:[&quot;sqlserver&quot;],Stylus:[&quot;styl|stylus&quot;],SVG:[&quot;svg&quot;],Swift:[&quot;swift&quot;],Tcl:[&quot;tcl&quot;],Terraform:[&quot;tf&quot;,&quot;tfvars&quot;,&quot;terragrunt&quot;],Tex:[&quot;tex&quot;],Text:[&quot;txt&quot;],Textile:[&quot;textile&quot;],Toml:[&quot;toml&quot;],TSX:[&quot;tsx&quot;],Twig:[&quot;latte|twig|swig&quot;],Typescript:[&quot;ts|typescript|str&quot;],Vala:[&quot;vala&quot;],VBScript:[&quot;vbs|vb&quot;],Velocity:[&quot;vm&quot;],Verilog:[&quot;v|vh|sv|svh&quot;],VHDL:[&quot;vhd|vhdl&quot;],Visualforce:[&quot;vfp|component|page&quot;],Wollok:[&quot;wlk|wpgm|wtest&quot;],XML:[&quot;xml|rdf|rss|wsdl|xslt|atom|mathml|mml|xul|xbl|xaml&quot;],XQuery:[&quot;xq&quot;],YAML:[&quot;yaml|yml&quot;],Zeek:[&quot;zeek|bro&quot;],Django:[&quot;html&quot;]},u={ObjectiveC:&quot;Objective-C&quot;,CSharp:&quot;C#&quot;,golang:&quot;Go&quot;,C_Cpp:&quot;C and C++&quot;,Csound_Document:&quot;Csound Document&quot;,Csound_Orchestra:&quot;Csound&quot;,Csound_Score:&quot;Csound Score&quot;,coffee:&quot;CoffeeScript&quot;,HTML_Ruby:&quot;HTML (Ruby)&quot;,HTML_Elixir:&quot;HTML (Elixir)&quot;,FTL:&quot;FreeMarker&quot;,PHP_Laravel_blade:&quot;PHP (Blade Template)&quot;,Perl6:&quot;Perl 6&quot;,AutoHotKey:&quot;AutoHotkey / AutoIt&quot;},a={};for(var f in o){var l=o[f],c=(u[f]||f).replace(/_/g,&quot; &quot;),h=f.toLowerCase(),p=new s(h,c,l[0]);a[h]=p,r.push(p)}n.exports={getModeForPath:i,modes:r,modesByName:a}}),ace.define(&quot;ace/ext/prompt&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;,&quot;ace/lib/dom&quot;,&quot;ace/ext/menu_tools/get_editor_keyboard_shortcuts&quot;,&quot;ace/autocomplete&quot;,&quot;ace/autocomplete/popup&quot;,&quot;ace/autocomplete/popup&quot;,&quot;ace/undomanager&quot;,&quot;ace/tokenizer&quot;,&quot;ace/ext/menu_tools/overlay_page&quot;,&quot;ace/ext/modelist&quot;],function(e,t,n){&quot;use strict&quot;;function d(e,t,n,r){function b(){var e;m&amp;&amp;m.getCursorPosition().row&gt;0?e=x():e=o.getValue();var t=m?m.getData(m.getRow()):e;t&amp;&amp;!t.error&amp;&amp;(E(),n.onAccept&amp;&amp;n.onAccept({value:e,item:t},o))}function E(){v.close(),r&amp;&amp;r(),p=null}function S(){if(n.getCompletions){var e;n.getPrefix&amp;&amp;(e=n.getPrefix(o));var t=n.getCompletions(o);m.setData(t,e),m.resize(!0)}}function x(){var e=m.getData(m.getRow());if(e&amp;&amp;!e.error)return e.value||e.caption||e}if(typeof t==&quot;object&quot;)return d(e,&quot;&quot;,t,n);if(p){var s=p;e=s.editor,s.close();if(s.name&amp;&amp;s.name==n.name)return}if(n.$type)return d[n.$type](e,r);var o=a();o.session.setUndoManager(new f);var h=i.buildDom([&quot;div&quot;,{&quot;class&quot;:&quot;ace_prompt_container&quot;+(n.hasDescription?&quot; input-box-with-description&quot;:&quot;&quot;)}]),v=c(e,h,E);h.appendChild(o.container),e&amp;&amp;(e.cmdLine=o,o.setOption(&quot;fontSize&quot;,e.getOption(&quot;fontSize&quot;))),t&amp;&amp;o.setValue(t,1),n.selection&amp;&amp;o.selection.setRange({start:o.session.doc.indexToPosition(n.selection[0]),end:o.session.doc.indexToPosition(n.selection[1])});if(n.getCompletions){var m=new u;m.renderer.setStyle(&quot;ace_autocomplete_inline&quot;),m.container.style.display=&quot;block&quot;,m.container.style.maxWidth=&quot;600px&quot;,m.container.style.width=&quot;100%&quot;,m.container.style.marginTop=&quot;3px&quot;,m.renderer.setScrollMargin(2,2,0,0),m.autoSelect=!1,m.renderer.$maxLines=15,m.setRow(-1),m.on(&quot;click&quot;,function(e){var t=m.getData(m.getRow());t.error||(o.setValue(t.value||t.name||t),b(),e.stop())}),h.appendChild(m.container),S()}if(n.$rules){var g=new l(n.$rules);o.session.bgTokenizer.setTokenizer(g)}n.placeholder&amp;&amp;o.setOption(&quot;placeholder&quot;,n.placeholder);if(n.hasDescription){var y=i.buildDom([&quot;div&quot;,{&quot;class&quot;:&quot;ace_prompt_text_container&quot;}]);i.buildDom(n.prompt||&quot;Press 'Enter' to confirm or 'Escape' to cancel&quot;,y),h.appendChild(y)}v.setIgnoreFocusOut(n.ignoreFocusOut);var w={Enter:b,&quot;Esc|Shift-Esc&quot;:function(){n.onCancel&amp;&amp;n.onCancel(o.getValue(),o),E()}};m&amp;&amp;Object.assign(w,{Up:function(e){m.goTo(&quot;up&quot;),x()},Down:function(e){m.goTo(&quot;down&quot;),x()},&quot;Ctrl-Up|Ctrl-Home&quot;:function(e){m.goTo(&quot;start&quot;),x()},&quot;Ctrl-Down|Ctrl-End&quot;:function(e){m.goTo(&quot;end&quot;),x()},Tab:function(e){m.goTo(&quot;down&quot;),x()},PageUp:function(e){m.gotoPageUp(),x()},PageDown:function(e){m.gotoPageDown(),x()}}),o.commands.bindKeys(w),o.on(&quot;input&quot;,function(){n.onInput&amp;&amp;n.onInput(),S()}),o.resize(!0),m&amp;&amp;m.resize(!0),o.focus(),p={close:E,name:n.name,editor:e}}var r=e(&quot;../range&quot;).Range,i=e(&quot;../lib/dom&quot;),s=e(&quot;../ext/menu_tools/get_editor_keyboard_shortcuts&quot;),o=e(&quot;../autocomplete&quot;).FilteredList,u=e(&quot;../autocomplete/popup&quot;).AcePopup,a=e(&quot;../autocomplete/popup&quot;).$singleLineEditor,f=e(&quot;../undomanager&quot;).UndoManager,l=e(&quot;../tokenizer&quot;).Tokenizer,c=e(&quot;./menu_tools/overlay_page&quot;).overlayPage,h=e(&quot;./modelist&quot;),p;d.gotoLine=function(e,t){function n(e){return Array.isArray(e)||(e=[e]),e.map(function(e){var t=e.isBackwards?e.start:e.end,n=e.isBackwards?e.end:e.start,r=n.row,i=r+1+&quot;:&quot;+n.column;return n.row==t.row?n.column!=t.column&amp;&amp;(i+=&quot;&gt;:&quot;+t.column):i+=&quot;&gt;&quot;+(t.row+1)+&quot;:&quot;+t.column,i}).reverse().join(&quot;, &quot;)}d(e,&quot;:&quot;+n(e.selection.toJSON()),{name:&quot;gotoLine&quot;,selection:[1,Number.MAX_VALUE],onAccept:function(t){var n=t.value,i=d.gotoLine._history;i||(d.gotoLine._history=i=[]),i.indexOf(n)!=-1&amp;&amp;i.splice(i.indexOf(n),1),i.unshift(n),i.length&gt;20&amp;&amp;(i.length=20);var s=e.getCursorPosition(),o=[];n.replace(/^:/,&quot;&quot;).split(/,/).map(function(t){function u(){var t=n[i++];if(!t)return;if(t[0]==&quot;c&quot;){var r=parseInt(t.slice(1))||0;return e.session.doc.indexToPosition(r)}var o=s.row,u=0;return/\sd/.test(t)&amp;&amp;(o=parseInt(t)-1,t=n[i++]),t==&quot;:&quot;&amp;&amp;(t=n[i++],/\sd/.test(t)&amp;&amp;(u=parseInt(t)||0)),{row:o,column:u}}var n=t.split(/([&lt;&gt;:+-]|c?\sd+)|[^c\sd&lt;&gt;:+-]+/).filter(Boolean),i=0;s=u();var a=r.fromPoints(s,s);n[i]==&quot;&gt;&quot;?(i++,a.end=u()):n[i]==&quot;&lt;&quot;&amp;&amp;(i++,a.start=u()),o.unshift(a)}),e.selection.fromJSON(o);var u=e.renderer.scrollTop;e.renderer.scrollSelectionIntoView(e.selection.anchor,e.selection.cursor,.5),e.renderer.animateScrolling(u)},history:function(){var t=e.session.getUndoManager();return d.gotoLine._history?d.gotoLine._history:[]},getCompletions:function(t){var n=t.getValue(),r=n.replace(/^:/,&quot;&quot;).split(&quot;:&quot;),i=Math.min(parseInt(r[0])||1,e.session.getLength())-1,s=e.session.getLine(i),o=n+&quot;  &quot;+s;return[o].concat(this.history())},$rules:{start:[{regex:/\sd+/,token:&quot;string&quot;},{regex:/[:,&gt;&lt;+\s-c]/,token:&quot;keyword&quot;}]}})},d.commands=function(e,t){function n(e){return(e||&quot;&quot;).replace(/^./,function(e){return e.toUpperCase(e)}).replace(/[a-z][A-Z]/g,function(e){return e[0]+&quot; &quot;+e[1].toLowerCase(e)})}function r(t){var r=[],i={};return e.keyBinding.$handlers.forEach(function(e){var s=e.platform,o=e.byName;for(var u in o){var a;o[u].bindKey&amp;&amp;o[u].bindKey[s]!==null?a=o[u].bindKey.win:a=&quot;&quot;;var f=o[u],l=f.description||n(f.name);Array.isArray(f)||(f=[f]),f.forEach(function(e){typeof e!=&quot;string&quot;&amp;&amp;(e=e.name);var n=t.find(function(t){return t===e});n||(i[e]?i[e].key+=&quot;|&quot;+a:(i[e]={key:a,command:e,description:l},r.push(i[e])))})}}),r}var i=[&quot;insertstring&quot;,&quot;inserttext&quot;,&quot;setIndentation&quot;,&quot;paste&quot;],s=r(i);s=s.map(function(e){return{value:e.description,meta:e.key,command:e.command}}),d(e,&quot;&quot;,{name:&quot;commands&quot;,selection:[0,Number.MAX_VALUE],maxHistoryCount:5,onAccept:function(t){if(t.item){var n=t.item.command;this.addToHistory(t.item),e.execCommand(n)}},addToHistory:function(e){var t=this.history();t.unshift(e),delete e.message;for(var n=1;n&lt;t.length;n++)if(t[n][&quot;command&quot;]==e.command){t.splice(n,1);break}this.maxHistoryCount&gt;0&amp;&amp;t.length&gt;this.maxHistoryCount&amp;&amp;t.splice(t.length-1,1),d.commands.history=t},history:function(){return d.commands.history||[]},getPrefix:function(e){var t=e.getCursorPosition(),n=e.getValue();return n.substring(0,t.column)},getCompletions:function(e){function t(e,t){var n=JSON.parse(JSON.stringify(e)),r=new o(n);return r.filterCompletions(n,t)}function n(e,t){if(!t||!t.length)return e;var n=[];t.forEach(function(e){n.push(e.command)});var r=[];return e.forEach(function(e){n.indexOf(e.command)===-1&amp;&amp;r.push(e)}),r}var r=this.getPrefix(e),i=t(this.history(),r),u=n(s,i);u=t(u,r),i.length&amp;&amp;u.length&amp;&amp;(i[0].message=&quot; Recently used&quot;,u[0].message=&quot; Other commands&quot;);var a=i.concat(u);return a.length&gt;0?a:[{value:&quot;No matching commands&quot;,error:1}]}})},d.modes=function(e,t){var n=h.modes;n=n.map(function(e){return{value:e.caption,mode:e.name}}),d(e,&quot;&quot;,{name:&quot;modes&quot;,selection:[0,Number.MAX_VALUE],onAccept:function(t){if(t.item){var n=&quot;ace/mode/&quot;+t.item.mode;e.session.setMode(n)}},getPrefix:function(e){var t=e.getCursorPosition(),n=e.getValue();return n.substring(0,t.column)},getCompletions:function(e){function t(e,t){var n=JSON.parse(JSON.stringify(e)),r=new o(n);return r.filterCompletions(n,t)}var r=this.getPrefix(e),i=t(n,r);return i.length&gt;0?i:[{caption:&quot;No mode matching&quot;,value:&quot;No mode matching&quot;,error:1}]}})},i.importCssString(&quot;.ace_prompt_container {    max-width: 600px;    width: 100%;    margin: 20px auto;    padding: 3px;    background: white;    border-radius: 2px;    box-shadow: 0px 2px 3px 0px #555;}&quot;),t.prompt=d});                (function() {\n                    ace.require([&quot;ace/ext/prompt&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: ext-settings_menu.js */\nace.define(&quot;ace/ext/menu_tools/overlay_page&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/dom&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../lib/dom&quot;),i=&quot;#ace_settingsmenu, #kbshortcutmenu {background-color: #F7F7F7;color: black;box-shadow: -5px 4px 5px rgba(126, 126, 126, 0.55);padding: 1em 0.5em 2em 1em;overflow: auto;position: absolute;margin: 0;bottom: 0;right: 0;top: 0;z-index: 9991;cursor: default;}.ace_dark #ace_settingsmenu, .ace_dark #kbshortcutmenu {box-shadow: -20px 10px 25px rgba(126, 126, 126, 0.25);background-color: rgba(255, 255, 255, 0.6);color: black;}.ace_optionsMenuEntry:hover {background-color: rgba(100, 100, 100, 0.1);transition: all 0.3s}.ace_closeButton {background: rgba(245, 146, 146, 0.5);border: 1px solid #F48A8A;border-radius: 50%;padding: 7px;position: absolute;right: -8px;top: -8px;z-index: 100000;}.ace_closeButton{background: rgba(245, 146, 146, 0.9);}.ace_optionsMenuKey {color: darkslateblue;font-weight: bold;}.ace_optionsMenuCommand {color: darkcyan;font-weight: normal;}.ace_optionsMenuEntry input, .ace_optionsMenuEntry button {vertical-align: middle;}.ace_optionsMenuEntry button[ace_selected_button=true] {background: #e7e7e7;box-shadow: 1px 0px 2px 0px #adadad inset;border-color: #adadad;}.ace_optionsMenuEntry button {background: white;border: 1px solid lightgray;margin: 0px;}.ace_optionsMenuEntry button:hover{background: #f0f0f0;}&quot;;r.importCssString(i),n.exports.overlayPage=function(t,n,r){function o(e){e.keyCode===27&amp;&amp;u()}function u(){if(!i)return;document.removeEventListener(&quot;keydown&quot;,o),i.parentNode.removeChild(i),t&amp;&amp;t.focus(),i=null,r&amp;&amp;r()}function a(e){s=e,e&amp;&amp;(i.style.pointerEvents=&quot;none&quot;,n.style.pointerEvents=&quot;auto&quot;)}var i=document.createElement(&quot;div&quot;),s=!1;return i.style.cssText=&quot;margin: 0; padding: 0; position: fixed; top:0; bottom:0; left:0; right:0;z-index: 9990; &quot;+(t?&quot;background-color: rgba(0, 0, 0, 0.3);&quot;:&quot;&quot;),i.addEventListener(&quot;click&quot;,function(e){s||u()}),document.addEventListener(&quot;keydown&quot;,o),n.addEventListener(&quot;click&quot;,function(e){e.stopPropagation()}),i.appendChild(n),document.body.appendChild(i),t&amp;&amp;t.blur(),{close:u,setIgnoreFocusOut:a}}}),ace.define(&quot;ace/ext/modelist&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;function i(e){var t=a.text,n=e.split(/[\s/\s\s]/).pop();for(var i=0;i&lt;r.length;i++)if(r[i].supportsFile(n)){t=r[i];break}return t}var r=[],s=function(e,t,n){this.name=e,this.caption=t,this.mode=&quot;ace/mode/&quot;+e,this.extensions=n;var r;/\s^/.test(n)?r=n.replace(/\s|(\s^)?/g,function(e,t){return&quot;$|&quot;+(t?&quot;^&quot;:&quot;^.*\s\s.&quot;)})+&quot;$&quot;:r=&quot;^.*\s\s.(&quot;+n+&quot;)$&quot;,this.extRe=new RegExp(r,&quot;gi&quot;)};s.prototype.supportsFile=function(e){return e.match(this.extRe)};var o={ABAP:[&quot;abap&quot;],ABC:[&quot;abc&quot;],ActionScript:[&quot;as&quot;],ADA:[&quot;ada|adb&quot;],Apache_Conf:[&quot;^htaccess|^htgroups|^htpasswd|^conf|htaccess|htgroups|htpasswd&quot;],AsciiDoc:[&quot;asciidoc|adoc&quot;],ASL:[&quot;dsl|asl&quot;],Assembly_x86:[&quot;asm|a&quot;],AutoHotKey:[&quot;ahk&quot;],Apex:[&quot;apex|cls|trigger|tgr&quot;],AQL:[&quot;aql&quot;],BatchFile:[&quot;bat|cmd&quot;],C_Cpp:[&quot;cpp|c|cc|cxx|h|hh|hpp|ino&quot;],C9Search:[&quot;c9search_results&quot;],Crystal:[&quot;cr&quot;],Cirru:[&quot;cirru|cr&quot;],Clojure:[&quot;clj|cljs&quot;],Cobol:[&quot;CBL|COB&quot;],coffee:[&quot;coffee|cf|cson|^Cakefile&quot;],ColdFusion:[&quot;cfm&quot;],CSharp:[&quot;cs&quot;],Csound_Document:[&quot;csd&quot;],Csound_Orchestra:[&quot;orc&quot;],Csound_Score:[&quot;sco&quot;],CSS:[&quot;css&quot;],Curly:[&quot;curly&quot;],D:[&quot;d|di&quot;],Dart:[&quot;dart&quot;],Diff:[&quot;diff|patch&quot;],Dockerfile:[&quot;^Dockerfile&quot;],Dot:[&quot;dot&quot;],Drools:[&quot;drl&quot;],Edifact:[&quot;edi&quot;],Eiffel:[&quot;e|ge&quot;],EJS:[&quot;ejs&quot;],Elixir:[&quot;ex|exs&quot;],Elm:[&quot;elm&quot;],Erlang:[&quot;erl|hrl&quot;],Forth:[&quot;frt|fs|ldr|fth|4th&quot;],Fortran:[&quot;f|f90&quot;],FSharp:[&quot;fsi|fs|ml|mli|fsx|fsscript&quot;],FSL:[&quot;fsl&quot;],FTL:[&quot;ftl&quot;],Gcode:[&quot;gcode&quot;],Gherkin:[&quot;feature&quot;],Gitignore:[&quot;^.gitignore&quot;],Glsl:[&quot;glsl|frag|vert&quot;],Gobstones:[&quot;gbs&quot;],golang:[&quot;go&quot;],GraphQLSchema:[&quot;gql&quot;],Groovy:[&quot;groovy&quot;],HAML:[&quot;haml&quot;],Handlebars:[&quot;hbs|handlebars|tpl|mustache&quot;],Haskell:[&quot;hs&quot;],Haskell_Cabal:[&quot;cabal&quot;],haXe:[&quot;hx&quot;],Hjson:[&quot;hjson&quot;],HTML:[&quot;html|htm|xhtml|vue|we|wpy&quot;],HTML_Elixir:[&quot;eex|html.eex&quot;],HTML_Ruby:[&quot;erb|rhtml|html.erb&quot;],INI:[&quot;ini|conf|cfg|prefs&quot;],Io:[&quot;io&quot;],Jack:[&quot;jack&quot;],Jade:[&quot;jade|pug&quot;],Java:[&quot;java&quot;],JavaScript:[&quot;js|jsm|jsx&quot;],JSON5:[&quot;json5&quot;],JSON:[&quot;json&quot;],JSONiq:[&quot;jq&quot;],JSP:[&quot;jsp&quot;],JSSM:[&quot;jssm|jssm_state&quot;],JSX:[&quot;jsx&quot;],Julia:[&quot;jl&quot;],Kotlin:[&quot;kt|kts&quot;],LaTeX:[&quot;tex|latex|ltx|bib&quot;],LESS:[&quot;less&quot;],Liquid:[&quot;liquid&quot;],Lisp:[&quot;lisp&quot;],LiveScript:[&quot;ls&quot;],LogiQL:[&quot;logic|lql&quot;],LSL:[&quot;lsl&quot;],Lua:[&quot;lua&quot;],LuaPage:[&quot;lp&quot;],Lucene:[&quot;lucene&quot;],Makefile:[&quot;^Makefile|^GNUmakefile|^makefile|^OCamlMakefile|make&quot;],Markdown:[&quot;md|markdown&quot;],Mask:[&quot;mask&quot;],MATLAB:[&quot;matlab&quot;],Maze:[&quot;mz&quot;],MEL:[&quot;mel&quot;],MIXAL:[&quot;mixal&quot;],MUSHCode:[&quot;mc|mush&quot;],MySQL:[&quot;mysql&quot;],Nginx:[&quot;nginx|conf&quot;],Nix:[&quot;nix&quot;],Nim:[&quot;nim&quot;],NSIS:[&quot;nsi|nsh&quot;],Nunjucks:[&quot;nunjucks|nunjs|nj|njk&quot;],ObjectiveC:[&quot;m|mm&quot;],OCaml:[&quot;ml|mli&quot;],Pascal:[&quot;pas|p&quot;],Perl:[&quot;pl|pm&quot;],Perl6:[&quot;p6|pl6|pm6&quot;],pgSQL:[&quot;pgsql&quot;],PHP_Laravel_blade:[&quot;blade.php&quot;],PHP:[&quot;php|inc|phtml|shtml|php3|php4|php5|phps|phpt|aw|ctp|module&quot;],Puppet:[&quot;epp|pp&quot;],Pig:[&quot;pig&quot;],Powershell:[&quot;ps1&quot;],Praat:[&quot;praat|praatscript|psc|proc&quot;],Prolog:[&quot;plg|prolog&quot;],Properties:[&quot;properties&quot;],Protobuf:[&quot;proto&quot;],Python:[&quot;py&quot;],R:[&quot;r&quot;],Razor:[&quot;cshtml|asp&quot;],RDoc:[&quot;Rd&quot;],Red:[&quot;red|reds&quot;],RHTML:[&quot;Rhtml&quot;],RST:[&quot;rst&quot;],Ruby:[&quot;rb|ru|gemspec|rake|^Guardfile|^Rakefile|^Gemfile&quot;],Rust:[&quot;rs&quot;],SASS:[&quot;sass&quot;],SCAD:[&quot;scad&quot;],Scala:[&quot;scala|sbt&quot;],Scheme:[&quot;scm|sm|rkt|oak|scheme&quot;],SCSS:[&quot;scss&quot;],SH:[&quot;sh|bash|^.bashrc&quot;],SJS:[&quot;sjs&quot;],Slim:[&quot;slim|skim&quot;],Smarty:[&quot;smarty|tpl&quot;],snippets:[&quot;snippets&quot;],Soy_Template:[&quot;soy&quot;],Space:[&quot;space&quot;],SQL:[&quot;sql&quot;],SQLServer:[&quot;sqlserver&quot;],Stylus:[&quot;styl|stylus&quot;],SVG:[&quot;svg&quot;],Swift:[&quot;swift&quot;],Tcl:[&quot;tcl&quot;],Terraform:[&quot;tf&quot;,&quot;tfvars&quot;,&quot;terragrunt&quot;],Tex:[&quot;tex&quot;],Text:[&quot;txt&quot;],Textile:[&quot;textile&quot;],Toml:[&quot;toml&quot;],TSX:[&quot;tsx&quot;],Twig:[&quot;latte|twig|swig&quot;],Typescript:[&quot;ts|typescript|str&quot;],Vala:[&quot;vala&quot;],VBScript:[&quot;vbs|vb&quot;],Velocity:[&quot;vm&quot;],Verilog:[&quot;v|vh|sv|svh&quot;],VHDL:[&quot;vhd|vhdl&quot;],Visualforce:[&quot;vfp|component|page&quot;],Wollok:[&quot;wlk|wpgm|wtest&quot;],XML:[&quot;xml|rdf|rss|wsdl|xslt|atom|mathml|mml|xul|xbl|xaml&quot;],XQuery:[&quot;xq&quot;],YAML:[&quot;yaml|yml&quot;],Zeek:[&quot;zeek|bro&quot;],Django:[&quot;html&quot;]},u={ObjectiveC:&quot;Objective-C&quot;,CSharp:&quot;C#&quot;,golang:&quot;Go&quot;,C_Cpp:&quot;C and C++&quot;,Csound_Document:&quot;Csound Document&quot;,Csound_Orchestra:&quot;Csound&quot;,Csound_Score:&quot;Csound Score&quot;,coffee:&quot;CoffeeScript&quot;,HTML_Ruby:&quot;HTML (Ruby)&quot;,HTML_Elixir:&quot;HTML (Elixir)&quot;,FTL:&quot;FreeMarker&quot;,PHP_Laravel_blade:&quot;PHP (Blade Template)&quot;,Perl6:&quot;Perl 6&quot;,AutoHotKey:&quot;AutoHotkey / AutoIt&quot;},a={};for(var f in o){var l=o[f],c=(u[f]||f).replace(/_/g,&quot; &quot;),h=f.toLowerCase(),p=new s(h,c,l[0]);a[h]=p,r.push(p)}n.exports={getModeForPath:i,modes:r,modesByName:a}}),ace.define(&quot;ace/ext/themelist&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;],function(e,t,n){&quot;use strict&quot;;var r=[[&quot;Chrome&quot;],[&quot;Clouds&quot;],[&quot;Crimson Editor&quot;],[&quot;Dawn&quot;],[&quot;Dreamweaver&quot;],[&quot;Eclipse&quot;],[&quot;GitHub&quot;],[&quot;IPlastic&quot;],[&quot;Solarized Light&quot;],[&quot;TextMate&quot;],[&quot;Tomorrow&quot;],[&quot;XCode&quot;],[&quot;Kuroir&quot;],[&quot;KatzenMilch&quot;],[&quot;SQL Server&quot;,&quot;sqlserver&quot;,&quot;light&quot;],[&quot;Ambiance&quot;,&quot;ambiance&quot;,&quot;dark&quot;],[&quot;Chaos&quot;,&quot;chaos&quot;,&quot;dark&quot;],[&quot;Clouds Midnight&quot;,&quot;clouds_midnight&quot;,&quot;dark&quot;],[&quot;Dracula&quot;,&quot;&quot;,&quot;dark&quot;],[&quot;Cobalt&quot;,&quot;cobalt&quot;,&quot;dark&quot;],[&quot;Gruvbox&quot;,&quot;gruvbox&quot;,&quot;dark&quot;],[&quot;Green on Black&quot;,&quot;gob&quot;,&quot;dark&quot;],[&quot;idle Fingers&quot;,&quot;idle_fingers&quot;,&quot;dark&quot;],[&quot;krTheme&quot;,&quot;kr_theme&quot;,&quot;dark&quot;],[&quot;Merbivore&quot;,&quot;merbivore&quot;,&quot;dark&quot;],[&quot;Merbivore Soft&quot;,&quot;merbivore_soft&quot;,&quot;dark&quot;],[&quot;Mono Industrial&quot;,&quot;mono_industrial&quot;,&quot;dark&quot;],[&quot;Monokai&quot;,&quot;monokai&quot;,&quot;dark&quot;],[&quot;Pastel on dark&quot;,&quot;pastel_on_dark&quot;,&quot;dark&quot;],[&quot;Solarized Dark&quot;,&quot;solarized_dark&quot;,&quot;dark&quot;],[&quot;Terminal&quot;,&quot;terminal&quot;,&quot;dark&quot;],[&quot;Tomorrow Night&quot;,&quot;tomorrow_night&quot;,&quot;dark&quot;],[&quot;Tomorrow Night Blue&quot;,&quot;tomorrow_night_blue&quot;,&quot;dark&quot;],[&quot;Tomorrow Night Bright&quot;,&quot;tomorrow_night_bright&quot;,&quot;dark&quot;],[&quot;Tomorrow Night 80s&quot;,&quot;tomorrow_night_eighties&quot;,&quot;dark&quot;],[&quot;Twilight&quot;,&quot;twilight&quot;,&quot;dark&quot;],[&quot;Vibrant Ink&quot;,&quot;vibrant_ink&quot;,&quot;dark&quot;]];t.themesByName={},t.themes=r.map(function(e){var n=e[1]||e[0].replace(/ /g,&quot;_&quot;).toLowerCase(),r={caption:e[0],theme:&quot;ace/theme/&quot;+n,isDark:e[2]==&quot;dark&quot;,name:n};return t.themesByName[n]=r,r})}),ace.define(&quot;ace/ext/options&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/ext/menu_tools/overlay_page&quot;,&quot;ace/lib/dom&quot;,&quot;ace/lib/oop&quot;,&quot;ace/config&quot;,&quot;ace/lib/event_emitter&quot;,&quot;ace/ext/modelist&quot;,&quot;ace/ext/themelist&quot;],function(e,t,n){&quot;use strict&quot;;e(&quot;./menu_tools/overlay_page&quot;);var r=e(&quot;../lib/dom&quot;),i=e(&quot;../lib/oop&quot;),s=e(&quot;../config&quot;),o=e(&quot;../lib/event_emitter&quot;).EventEmitter,u=r.buildDom,a=e(&quot;./modelist&quot;),f=e(&quot;./themelist&quot;),l={Bright:[],Dark:[]};f.themes.forEach(function(e){l[e.isDark?&quot;Dark&quot;:&quot;Bright&quot;].push({caption:e.caption,value:e.theme})});var c=a.modes.map(function(e){return{caption:e.caption,value:e.mode}}),h={Main:{Mode:{path:&quot;mode&quot;,type:&quot;select&quot;,items:c},Theme:{path:&quot;theme&quot;,type:&quot;select&quot;,items:l},Keybinding:{type:&quot;buttonBar&quot;,path:&quot;keyboardHandler&quot;,items:[{caption:&quot;Ace&quot;,value:null},{caption:&quot;Vim&quot;,value:&quot;ace/keyboard/vim&quot;},{caption:&quot;Emacs&quot;,value:&quot;ace/keyboard/emacs&quot;},{caption:&quot;Sublime&quot;,value:&quot;ace/keyboard/sublime&quot;},{caption:&quot;VSCode&quot;,value:&quot;ace/keyboard/vscode&quot;}]},&quot;Font Size&quot;:{path:&quot;fontSize&quot;,type:&quot;number&quot;,defaultValue:12,defaults:[{caption:&quot;12px&quot;,value:12},{caption:&quot;24px&quot;,value:24}]},&quot;Soft Wrap&quot;:{type:&quot;buttonBar&quot;,path:&quot;wrap&quot;,items:[{caption:&quot;Off&quot;,value:&quot;off&quot;},{caption:&quot;View&quot;,value:&quot;free&quot;},{caption:&quot;margin&quot;,value:&quot;printMargin&quot;},{caption:&quot;40&quot;,value:&quot;40&quot;}]},&quot;Cursor Style&quot;:{path:&quot;cursorStyle&quot;,items:[{caption:&quot;Ace&quot;,value:&quot;ace&quot;},{caption:&quot;Slim&quot;,value:&quot;slim&quot;},{caption:&quot;Smooth&quot;,value:&quot;smooth&quot;},{caption:&quot;Smooth And Slim&quot;,value:&quot;smooth slim&quot;},{caption:&quot;Wide&quot;,value:&quot;wide&quot;}]},Folding:{path:&quot;foldStyle&quot;,items:[{caption:&quot;Manual&quot;,value:&quot;manual&quot;},{caption:&quot;Mark begin&quot;,value:&quot;markbegin&quot;},{caption:&quot;Mark begin and end&quot;,value:&quot;markbeginend&quot;}]},&quot;Soft Tabs&quot;:[{path:&quot;useSoftTabs&quot;},{path:&quot;tabSize&quot;,type:&quot;number&quot;,values:[2,3,4,8,16]}],Overscroll:{type:&quot;buttonBar&quot;,path:&quot;scrollPastEnd&quot;,items:[{caption:&quot;None&quot;,value:0},{caption:&quot;Half&quot;,value:.5},{caption:&quot;Full&quot;,value:1}]}},More:{&quot;Atomic soft tabs&quot;:{path:&quot;navigateWithinSoftTabs&quot;},&quot;Enable Behaviours&quot;:{path:&quot;behavioursEnabled&quot;},&quot;Full Line Selection&quot;:{type:&quot;checkbox&quot;,values:&quot;text|line&quot;,path:&quot;selectionStyle&quot;},&quot;Highlight Active Line&quot;:{path:&quot;highlightActiveLine&quot;},&quot;Show Invisibles&quot;:{path:&quot;showInvisibles&quot;},&quot;Show Indent Guides&quot;:{path:&quot;displayIndentGuides&quot;},&quot;Persistent Scrollbar&quot;:[{path:&quot;hScrollBarAlwaysVisible&quot;},{path:&quot;vScrollBarAlwaysVisible&quot;}],&quot;Animate scrolling&quot;:{path:&quot;animatedScroll&quot;},&quot;Show Gutter&quot;:{path:&quot;showGutter&quot;},&quot;Show Line Numbers&quot;:{path:&quot;showLineNumbers&quot;},&quot;Relative Line Numbers&quot;:{path:&quot;relativeLineNumbers&quot;},&quot;Fixed Gutter Width&quot;:{path:&quot;fixedWidthGutter&quot;},&quot;Show Print Margin&quot;:[{path:&quot;showPrintMargin&quot;},{type:&quot;number&quot;,path:&quot;printMarginColumn&quot;}],&quot;Indented Soft Wrap&quot;:{path:&quot;indentedSoftWrap&quot;},&quot;Highlight selected word&quot;:{path:&quot;highlightSelectedWord&quot;},&quot;Fade Fold Widgets&quot;:{path:&quot;fadeFoldWidgets&quot;},&quot;Use textarea for IME&quot;:{path:&quot;useTextareaForIME&quot;},&quot;Merge Undo Deltas&quot;:{path:&quot;mergeUndoDeltas&quot;,items:[{caption:&quot;Always&quot;,value:&quot;always&quot;},{caption:&quot;Never&quot;,value:&quot;false&quot;},{caption:&quot;Timed&quot;,value:&quot;true&quot;}]},&quot;Elastic Tabstops&quot;:{path:&quot;useElasticTabstops&quot;},&quot;Incremental Search&quot;:{path:&quot;useIncrementalSearch&quot;},&quot;Read-only&quot;:{path:&quot;readOnly&quot;},&quot;Copy without selection&quot;:{path:&quot;copyWithEmptySelection&quot;},&quot;Live Autocompletion&quot;:{path:&quot;enableLiveAutocompletion&quot;}}},p=function(e,t){this.editor=e,this.container=t||document.createElement(&quot;div&quot;),this.groups=[],this.options={}};(function(){i.implement(this,o),this.add=function(e){e.Main&amp;&amp;i.mixin(h.Main,e.Main),e.More&amp;&amp;i.mixin(h.More,e.More)},this.render=function(){this.container.innerHTML=&quot;&quot;,u([&quot;table&quot;,{id:&quot;controls&quot;},this.renderOptionGroup(h.Main),[&quot;tr&quot;,null,[&quot;td&quot;,{colspan:2},[&quot;table&quot;,{id:&quot;more-controls&quot;},this.renderOptionGroup(h.More)]]],[&quot;tr&quot;,null,[&quot;td&quot;,{colspan:2},&quot;version &quot;+s.version]]],this.container)},this.renderOptionGroup=function(e){return Object.keys(e).map(function(t,n){var r=e[t];return r.position||(r.position=n/1e4),r.label||(r.label=t),r}).sort(function(e,t){return e.position-t.position}).map(function(e){return this.renderOption(e.label,e)},this)},this.renderOptionControl=function(e,t){var n=this;if(Array.isArray(t))return t.map(function(t){return n.renderOptionControl(e,t)});var r,i=n.getOption(t);t.values&amp;&amp;t.type!=&quot;checkbox&quot;&amp;&amp;(typeof t.values==&quot;string&quot;&amp;&amp;(t.values=t.values.split(&quot;|&quot;)),t.items=t.values.map(function(e){return{value:e,name:e}}));if(t.type==&quot;buttonBar&quot;)r=[&quot;div&quot;,t.items.map(function(e){return[&quot;button&quot;,{value:e.value,ace_selected_button:i==e.value,onclick:function(){n.setOption(t,e.value);var r=this.parentNode.querySelectorAll(&quot;[ace_selected_button]&quot;);for(var i=0;i&lt;r.length;i++)r[i].removeAttribute(&quot;ace_selected_button&quot;);this.setAttribute(&quot;ace_selected_button&quot;,!0)}},e.desc||e.caption||e.name]})];else if(t.type==&quot;number&quot;)r=[&quot;input&quot;,{type:&quot;number&quot;,value:i||t.defaultValue,style:&quot;width:3em&quot;,oninput:function(){n.setOption(t,parseInt(this.value))}}],t.defaults&amp;&amp;(r=[r,t.defaults.map(function(e){return[&quot;button&quot;,{onclick:function(){var t=this.parentNode.firstChild;t.value=e.value,t.oninput()}},e.caption]})]);else if(t.items){var s=function(e){return e.map(function(e){return[&quot;option&quot;,{value:e.value||e.name},e.desc||e.caption||e.name]})},o=Array.isArray(t.items)?s(t.items):Object.keys(t.items).map(function(e){return[&quot;optgroup&quot;,{label:e},s(t.items[e])]});r=[&quot;select&quot;,{id:e,value:i,onchange:function(){n.setOption(t,this.value)}},o]}else typeof t.values==&quot;string&quot;&amp;&amp;(t.values=t.values.split(&quot;|&quot;)),t.values&amp;&amp;(i=i==t.values[1]),r=[&quot;input&quot;,{type:&quot;checkbox&quot;,id:e,checked:i||null,onchange:function(){var e=this.checked;t.values&amp;&amp;(e=t.values[e?1:0]),n.setOption(t,e)}}],t.type==&quot;checkedNumber&quot;&amp;&amp;(r=[r,[]]);return r},this.renderOption=function(e,t){if(t.path&amp;&amp;!t.onchange&amp;&amp;!this.editor.$options[t.path])return;this.options[t.path]=t;var n=&quot;-&quot;+t.path,r=this.renderOptionControl(n,t);return[&quot;tr&quot;,{&quot;class&quot;:&quot;ace_optionsMenuEntry&quot;},[&quot;td&quot;,[&quot;label&quot;,{&quot;for&quot;:n},e]],[&quot;td&quot;,r]]},this.setOption=function(e,t){typeof e==&quot;string&quot;&amp;&amp;(e=this.options[e]),t==&quot;false&quot;&amp;&amp;(t=!1),t==&quot;true&quot;&amp;&amp;(t=!0),t==&quot;null&quot;&amp;&amp;(t=null),t==&quot;undefined&quot;&amp;&amp;(t=undefined),typeof t==&quot;string&quot;&amp;&amp;parseFloat(t).toString()==t&amp;&amp;(t=parseFloat(t)),e.onchange?e.onchange(t):e.path&amp;&amp;this.editor.setOption(e.path,t),this._signal(&quot;setOption&quot;,{name:e.path,value:t})},this.getOption=function(e){return e.getValue?e.getValue():this.editor.getOption(e.path)}}).call(p.prototype),t.OptionPanel=p}),ace.define(&quot;ace/ext/settings_menu&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/ext/options&quot;,&quot;ace/ext/menu_tools/overlay_page&quot;,&quot;ace/editor&quot;],function(e,t,n){&quot;use strict&quot;;function s(e){if(!document.getElementById(&quot;ace_settingsmenu&quot;)){var t=new r(e);t.render(),t.container.id=&quot;ace_settingsmenu&quot;,i(e,t.container),t.container.querySelector(&quot;select,input,button,checkbox&quot;).focus()}}var r=e(&quot;./options&quot;).OptionPanel,i=e(&quot;./menu_tools/overlay_page&quot;).overlayPage;n.exports.init=function(){var t=e(&quot;../editor&quot;).Editor;t.prototype.showSettingsMenu=function(){s(this)}}});                (function() {\n                    ace.require([&quot;ace/ext/settings_menu&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}\n//{{{\n\n/* Code filename: ace-Macro-Source */\nconfig.commands.aceEdit={text:&quot;aceEdit&quot;,tooltip:&quot;Edit tiddler with ace.js&quot;},config.commands.aceEdit.debug=!0,config.commands.aceDone={},config.commands.aceDone.handler=function(e,t,o){const s=config.commands.aceEdit.debug,n=CSS.escape(o.replace(/ /g,&quot;_&quot;))+&quot;aceViewer&quot;;s&amp;&amp;console.log(&quot;Done event: &quot;,e),s&amp;&amp;console.log(&quot;Done src: &quot;,t),s&amp;&amp;console.log(&quot;Done title: &quot;,o),s&amp;&amp;console.log(&quot;Done sessionTarget: &quot;,n);let i=ace.edit(n),c=config.options.chkEscapeScriptTags?function(e){const t=new RegExp(&quot;// &lt;script&quot;,&quot;g&quot;),o=new RegExp(&quot;// &lt;/script&quot;,&quot;g&quot;);return e.replace(t,&quot;&lt;script&quot;).replace(o,&quot;&lt;/script&quot;)}(i.getSession().getValue()):i.getSession().getValue(),a=story.saveTiddler(o,e.shiftKey);const l=store.getTiddler(a),r=l.tags,d=l.fields;store.saveTiddler(a,a,c,config.options.txtUserName,new Date,r,d),s&amp;&amp;console.log(&quot;Saved title&quot;,a,o);let g=i.selection.getCursor();store.setValue(a,&quot;acerow&quot;,g.row),store.setValue(a,&quot;acecolumn&quot;,g.column),s&amp;&amp;console.log(&quot;Cursor position: &quot;,g)},config.commands.aceEdit.handler=function(e,t,o){const s=config.commands.aceEdit.debug,n=config.options.txtaceFontSize||&quot;12pt&quot;,i=config.options.txtaceSoftTab||&quot;2&quot;,c=&quot;#&quot;+CSS.escape(`tiddler${o.replace(/ /g,&quot;_&quot;)}`)+&quot; &gt; #acehidetweditor&quot;,a=CSS.escape(o.replace(/ /g,&quot;_&quot;))+&quot;aceViewer&quot;;config.commands.editTiddler.handler.call(this,e,t,o);const l=jQuery(&quot;#&quot;+CSS.escape(`tiddler${o.replace(/ /g,&quot;_&quot;)}`)).find(&quot;.toolbar&quot;).find('a[commandname=&quot;saveTiddler&quot;]');l.text(&quot;aceDone&quot;).attr({title:&quot;Close ace.js edited tiddler&quot;}).attr({commandname:&quot;aceDone&quot;}),jQuery(c).hide(),jQuery(&quot;#&quot;+CSS.escape(`tiddler${o.replace(/ /g,&quot;_&quot;)}`)+&quot; &gt; #aceViewer&quot;).attr(&quot;id&quot;,a);const r=&quot;#&quot;+CSS.escape(a);jQuery(r).css(&quot;width&quot;,&quot;100%&quot;).css(&quot;height&quot;,&quot;30px&quot;).css(&quot;font-size&quot;,n),s&amp;&amp;console.clear(),s&amp;&amp;console.log(&quot;Edit event: &quot;,e),s&amp;&amp;console.log(&quot;Edit src: &quot;,t),s&amp;&amp;console.log(&quot;Edit title: &quot;,o),s&amp;&amp;console.log(&quot;Edit sessionTarget: &quot;,a),s&amp;&amp;console.log(&quot;Edit sessionTargetId: &quot;,r),s&amp;&amp;console.log(&quot;Edit buttonChange: &quot;,l),s&amp;&amp;console.log(&quot;Edit fontsize: &quot;,n),ace.config.set(&quot;basePath&quot;,&quot;ace&quot;);let d=isNaN(parseInt(config.options.txtaceBoxLines))?30:parseInt(config.options.txtaceBoxLines);s&amp;&amp;console.log(&quot;No edit lines: &quot;,parseInt(config.options.txtaceBoxLines));var g=ace.edit(a);g.setTheme(&quot;ace/theme/monokai&quot;),g.session.setMode(&quot;ace/mode/javascript&quot;),g.setHighlightActiveLine(!0),g.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,highlightSelectedWord:!0,autoScrollEditorIntoView:!0,minLines:20,maxLines:d}),g.getSession().setTabSize(parseInt(i)),g.getSession().setUseSoftTabs(!0),g.getSession().setValue(config.options.chkEscapeScriptTags?function(e){const t=new RegExp(&quot;&lt;script&quot;,&quot;g&quot;),o=new RegExp(&quot;&lt;/script&quot;,&quot;g&quot;);return e.replace(t,&quot;// &lt;script&quot;).replace(o,&quot;// &lt;/script&quot;)}(store.getTiddlerText(o)):store.getTiddlerText(o)),g.getSession().setUseWrapMode(!0),g.focus(),g.resize(!0),g.scrollToLine(30,!0,!0,function(){});let p=parseInt(store.getValue(o,&quot;acecolumn&quot;,0)),m=parseInt(store.getValue(o,&quot;acerow&quot;,0))+1;g.gotoLine(m,p,!0)};\n//}}}\n//{{{\n\n/* Code filename: mode-javascript.js */\nace.define(&quot;ace/mode/doc_comment_highlight_rules&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/mode/text_highlight_rules&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/oop&quot;),i=e(&quot;./text_highlight_rules&quot;).TextHighlightRules,s=function(){this.$rules={start:[{token:&quot;comment.doc.tag&quot;,regex:&quot;@[\s\sw\s\sd_]+&quot;},s.getTagRule(),{defaultToken:&quot;comment.doc&quot;,caseInsensitive:!0}]}};r.inherits(s,i),s.getTagRule=function(e){return{token:&quot;comment.doc.tag.storage.type&quot;,regex:&quot;\s\sb(?:TODO|FIXME|XXX|HACK)\s\sb&quot;}},s.getStartRule=function(e){return{token:&quot;comment.doc&quot;,regex:&quot;\s\s/\s\s*(?=\s\s*)&quot;,next:e}},s.getEndRule=function(e){return{token:&quot;comment.doc&quot;,regex:&quot;\s\s*\s\s/&quot;,next:e}},t.DocCommentHighlightRules=s}),ace.define(&quot;ace/mode/javascript_highlight_rules&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/mode/doc_comment_highlight_rules&quot;,&quot;ace/mode/text_highlight_rules&quot;],function(e,t,n){&quot;use strict&quot;;function a(){var e=o.replace(&quot;\s\sd&quot;,&quot;\s\sd\s\s-&quot;),t={onMatch:function(e,t,n){var r=e.charAt(1)==&quot;/&quot;?2:1;if(r==1)t!=this.nextState?n.unshift(this.next,this.nextState,0):n.unshift(this.next),n[2]++;else if(r==2&amp;&amp;t==this.nextState){n[1]--;if(!n[1]||n[1]&lt;0)n.shift(),n.shift()}return[{type:&quot;meta.tag.punctuation.&quot;+(r==1?&quot;&quot;:&quot;end-&quot;)+&quot;tag-open.xml&quot;,value:e.slice(0,r)},{type:&quot;meta.tag.tag-name.xml&quot;,value:e.substr(r)}]},regex:&quot;&lt;/?&quot;+e+&quot;&quot;,next:&quot;jsxAttributes&quot;,nextState:&quot;jsx&quot;};this.$rules.start.unshift(t);var n={regex:&quot;{&quot;,token:&quot;paren.quasi.start&quot;,push:&quot;start&quot;};this.$rules.jsx=[n,t,{include:&quot;reference&quot;},{defaultToken:&quot;string&quot;}],this.$rules.jsxAttributes=[{token:&quot;meta.tag.punctuation.tag-close.xml&quot;,regex:&quot;/?&gt;&quot;,onMatch:function(e,t,n){return t==n[0]&amp;&amp;n.shift(),e.length==2&amp;&amp;(n[0]==this.nextState&amp;&amp;n[1]--,(!n[1]||n[1]&lt;0)&amp;&amp;n.splice(0,2)),this.next=n[0]||&quot;start&quot;,[{type:this.token,value:e}]},nextState:&quot;jsx&quot;},n,f(&quot;jsxAttributes&quot;),{token:&quot;entity.other.attribute-name.xml&quot;,regex:e},{token:&quot;keyword.operator.attribute-equals.xml&quot;,regex:&quot;=&quot;},{token:&quot;text.tag-whitespace.xml&quot;,regex:&quot;\s\ss+&quot;},{token:&quot;string.attribute-value.xml&quot;,regex:&quot;'&quot;,stateName:&quot;jsx_attr_q&quot;,push:[{token:&quot;string.attribute-value.xml&quot;,regex:&quot;'&quot;,next:&quot;pop&quot;},{include:&quot;reference&quot;},{defaultToken:&quot;string.attribute-value.xml&quot;}]},{token:&quot;string.attribute-value.xml&quot;,regex:'&quot;',stateName:&quot;jsx_attr_qq&quot;,push:[{token:&quot;string.attribute-value.xml&quot;,regex:'&quot;',next:&quot;pop&quot;},{include:&quot;reference&quot;},{defaultToken:&quot;string.attribute-value.xml&quot;}]},t],this.$rules.reference=[{token:&quot;constant.language.escape.reference.xml&quot;,regex:&quot;(?:&amp;#[0-9]+;)|(?:&amp;#x[0-9a-fA-F]+;)|(?:&amp;[a-zA-Z0-9_:\s\s.-]+;)&quot;}]}function f(e){return[{token:&quot;comment&quot;,regex:/\s/\s*/,next:[i.getTagRule(),{token:&quot;comment&quot;,regex:&quot;\s\s*\s\s/&quot;,next:e||&quot;pop&quot;},{defaultToken:&quot;comment&quot;,caseInsensitive:!0}]},{token:&quot;comment&quot;,regex:&quot;\s\s/\s\s/&quot;,next:[i.getTagRule(),{token:&quot;comment&quot;,regex:&quot;$|^&quot;,next:e||&quot;pop&quot;},{defaultToken:&quot;comment&quot;,caseInsensitive:!0}]}]}var r=e(&quot;../lib/oop&quot;),i=e(&quot;./doc_comment_highlight_rules&quot;).DocCommentHighlightRules,s=e(&quot;./text_highlight_rules&quot;).TextHighlightRules,o=&quot;[a-zA-Z\s\s$_\su00a1-\suffff][a-zA-Z\s\sd\s\s$_\su00a1-\suffff]*&quot;,u=function(e){var t=this.createKeywordMapper({&quot;variable.language&quot;:&quot;Array|Boolean|Date|Function|Iterator|Number|Object|RegExp|String|Proxy|Namespace|QName|XML|XMLList|ArrayBuffer|Float32Array|Float64Array|Int16Array|Int32Array|Int8Array|Uint16Array|Uint32Array|Uint8Array|Uint8ClampedArray|Error|EvalError|InternalError|RangeError|ReferenceError|StopIteration|SyntaxError|TypeError|URIError|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|eval|isFinite|isNaN|parseFloat|parseInt|JSON|Math|this|arguments|prototype|window|document&quot;,keyword:&quot;const|yield|import|get|set|async|await|break|case|catch|continue|default|delete|do|else|finally|for|function|if|in|of|instanceof|new|return|switch|throw|try|typeof|let|var|while|with|debugger|__parent__|__count__|escape|unescape|with|__proto__|class|enum|extends|super|export|implements|private|public|interface|package|protected|static&quot;,&quot;storage.type&quot;:&quot;const|let|var|function&quot;,&quot;constant.language&quot;:&quot;null|Infinity|NaN|undefined&quot;,&quot;support.function&quot;:&quot;alert&quot;,&quot;constant.language.boolean&quot;:&quot;true|false&quot;},&quot;identifier&quot;),n=&quot;case|do|else|finally|in|instanceof|return|throw|try|typeof|yield|void&quot;,r=&quot;\s\s\s\s(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|u{[0-9a-fA-F]{1,6}}|[0-2][0-7]{0,2}|3[0-7][0-7]?|[4-7][0-7]?|.)&quot;;this.$rules={no_regex:[i.getStartRule(&quot;doc-start&quot;),f(&quot;no_regex&quot;),{token:&quot;string&quot;,regex:&quot;'(?=.)&quot;,next:&quot;qstring&quot;},{token:&quot;string&quot;,regex:'&quot;(?=.)',next:&quot;qqstring&quot;},{token:&quot;constant.numeric&quot;,regex:/0(?:[xX][0-9a-fA-F]+|[oO][0-7]+|[bB][01]+)\sb/},{token:&quot;constant.numeric&quot;,regex:/(?:\sd\sd*(?:\s.\sd*)?|\s.\sd+)(?:[eE][+-]?\sd+\sb)?/},{token:[&quot;storage.type&quot;,&quot;punctuation.operator&quot;,&quot;support.function&quot;,&quot;punctuation.operator&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;keyword.operator&quot;],regex:&quot;(&quot;+o+&quot;)(\s\s.)(prototype)(\s\s.)(&quot;+o+&quot;)(\s\ss*)(=)&quot;,next:&quot;function_arguments&quot;},{token:[&quot;storage.type&quot;,&quot;punctuation.operator&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;keyword.operator&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(&quot;+o+&quot;)(\s\s.)(&quot;+o+&quot;)(\s\ss*)(=)(\s\ss*)(function)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:[&quot;entity.name.function&quot;,&quot;text&quot;,&quot;keyword.operator&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(&quot;+o+&quot;)(\s\ss*)(=)(\s\ss*)(function)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:[&quot;storage.type&quot;,&quot;punctuation.operator&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;keyword.operator&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(&quot;+o+&quot;)(\s\s.)(&quot;+o+&quot;)(\s\ss*)(=)(\s\ss*)(function)(\s\ss+)(\s\sw+)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:[&quot;storage.type&quot;,&quot;text&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(function)(\s\ss+)(&quot;+o+&quot;)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:[&quot;entity.name.function&quot;,&quot;text&quot;,&quot;punctuation.operator&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(&quot;+o+&quot;)(\s\ss*)(:)(\s\ss*)(function)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:[&quot;text&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(:)(\s\ss*)(function)(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:&quot;keyword&quot;,regex:&quot;from(?=\s\ss*('|\s&quot;))&quot;},{token:&quot;keyword&quot;,regex:&quot;(?:&quot;+n+&quot;)\s\sb&quot;,next:&quot;start&quot;},{token:[&quot;support.constant&quot;],regex:/that\sb/},{token:[&quot;storage.type&quot;,&quot;punctuation.operator&quot;,&quot;support.function.firebug&quot;],regex:/(console)(\s.)(warn|info|log|error|time|trace|timeEnd|assert)\sb/},{token:t,regex:o},{token:&quot;punctuation.operator&quot;,regex:/[.](?![.])/,next:&quot;property&quot;},{token:&quot;storage.type&quot;,regex:/=&gt;/,next:&quot;start&quot;},{token:&quot;keyword.operator&quot;,regex:/--|\s+\s+|\s.{3}|===|==|=|!=|!==|&lt;+=?|&gt;+=?|!|&amp;&amp;|\s|\s||\s?:|[!$%&amp;*+\s-~\s/^]=?/,next:&quot;start&quot;},{token:&quot;punctuation.operator&quot;,regex:/[?:,;.]/,next:&quot;start&quot;},{token:&quot;paren.lparen&quot;,regex:/[\s[({]/,next:&quot;start&quot;},{token:&quot;paren.rparen&quot;,regex:/[\s])}]/},{token:&quot;comment&quot;,regex:/^#!.*$/}],property:[{token:&quot;text&quot;,regex:&quot;\s\ss+&quot;},{token:[&quot;storage.type&quot;,&quot;punctuation.operator&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;keyword.operator&quot;,&quot;text&quot;,&quot;storage.type&quot;,&quot;text&quot;,&quot;entity.name.function&quot;,&quot;text&quot;,&quot;paren.lparen&quot;],regex:&quot;(&quot;+o+&quot;)(\s\s.)(&quot;+o+&quot;)(\s\ss*)(=)(\s\ss*)(function)(?:(\s\ss+)(\s\sw+))?(\s\ss*)(\s\s()&quot;,next:&quot;function_arguments&quot;},{token:&quot;punctuation.operator&quot;,regex:/[.](?![.])/},{token:&quot;support.function&quot;,regex:/(s(?:h(?:ift|ow(?:Mod(?:elessDialog|alDialog)|Help))|croll(?:X|By(?:Pages|Lines)?|Y|To)?|t(?:op|rike)|i(?:n|zeToContent|debar|gnText)|ort|u(?:p|b(?:str(?:ing)?)?)|pli(?:ce|t)|e(?:nd|t(?:Re(?:sizable|questHeader)|M(?:i(?:nutes|lliseconds)|onth)|Seconds|Ho(?:tKeys|urs)|Year|Cursor|Time(?:out)?|Interval|ZOptions|Date|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Date|FullYear)|FullYear|Active)|arch)|qrt|lice|avePreferences|mall)|h(?:ome|andleEvent)|navigate|c(?:har(?:CodeAt|At)|o(?:s|n(?:cat|textual|firm)|mpile)|eil|lear(?:Timeout|Interval)?|a(?:ptureEvents|ll)|reate(?:StyleSheet|Popup|EventObject))|t(?:o(?:GMTString|S(?:tring|ource)|U(?:TCString|pperCase)|Lo(?:caleString|werCase))|est|a(?:n|int(?:Enabled)?))|i(?:s(?:NaN|Finite)|ndexOf|talics)|d(?:isableExternalCapture|ump|etachEvent)|u(?:n(?:shift|taint|escape|watch)|pdateCommands)|j(?:oin|avaEnabled)|p(?:o(?:p|w)|ush|lugins.refresh|a(?:ddings|rse(?:Int|Float)?)|r(?:int|ompt|eference))|e(?:scape|nableExternalCapture|val|lementFromPoint|x(?:p|ec(?:Script|Command)?))|valueOf|UTC|queryCommand(?:State|Indeterm|Enabled|Value)|f(?:i(?:nd|le(?:ModifiedDate|Size|CreatedDate|UpdatedDate)|xed)|o(?:nt(?:size|color)|rward)|loor|romCharCode)|watch|l(?:ink|o(?:ad|g)|astIndexOf)|a(?:sin|nchor|cos|t(?:tachEvent|ob|an(?:2)?)|pply|lert|b(?:s|ort))|r(?:ou(?:nd|teEvents)|e(?:size(?:By|To)|calc|turnValue|place|verse|l(?:oad|ease(?:Capture|Events)))|andom)|g(?:o|et(?:ResponseHeader|M(?:i(?:nutes|lliseconds)|onth)|Se(?:conds|lection)|Hours|Year|Time(?:zoneOffset)?|Da(?:y|te)|UTC(?:M(?:i(?:nutes|lliseconds)|onth)|Seconds|Hours|Da(?:y|te)|FullYear)|FullYear|A(?:ttention|llResponseHeaders)))|m(?:in|ove(?:B(?:y|elow)|To(?:Absolute)?|Above)|ergeAttributes|a(?:tch|rgins|x))|b(?:toa|ig|o(?:ld|rderWidths)|link|ack))\sb(?=\s()/},{token:&quot;support.function.dom&quot;,regex:/(s(?:ub(?:stringData|mit)|plitText|e(?:t(?:NamedItem|Attribute(?:Node)?)|lect))|has(?:ChildNodes|Feature)|namedItem|c(?:l(?:ick|o(?:se|neNode))|reate(?:C(?:omment|DATASection|aption)|T(?:Head|extNode|Foot)|DocumentFragment|ProcessingInstruction|E(?:ntityReference|lement)|Attribute))|tabIndex|i(?:nsert(?:Row|Before|Cell|Data)|tem)|open|delete(?:Row|C(?:ell|aption)|T(?:Head|Foot)|Data)|focus|write(?:ln)?|a(?:dd|ppend(?:Child|Data))|re(?:set|place(?:Child|Data)|move(?:NamedItem|Child|Attribute(?:Node)?)?)|get(?:NamedItem|Element(?:sBy(?:Name|TagName|ClassName)|ById)|Attribute(?:Node)?)|blur)\sb(?=\s()/},{token:&quot;support.constant&quot;,regex:/(s(?:ystemLanguage|cr(?:ipts|ollbars|een(?:X|Y|Top|Left))|t(?:yle(?:Sheets)?|atus(?:Text|bar)?)|ibling(?:Below|Above)|ource|uffixes|e(?:curity(?:Policy)?|l(?:ection|f)))|h(?:istory|ost(?:name)?|as(?:h|Focus))|y|X(?:MLDocument|SLDocument)|n(?:ext|ame(?:space(?:s|URI)|Prop))|M(?:IN_VALUE|AX_VALUE)|c(?:haracterSet|o(?:n(?:structor|trollers)|okieEnabled|lorDepth|mp(?:onents|lete))|urrent|puClass|l(?:i(?:p(?:boardData)?|entInformation)|osed|asses)|alle(?:e|r)|rypto)|t(?:o(?:olbar|p)|ext(?:Transform|Indent|Decoration|Align)|ags)|SQRT(?:1_2|2)|i(?:n(?:ner(?:Height|Width)|put)|ds|gnoreCase)|zIndex|o(?:scpu|n(?:readystatechange|Line)|uter(?:Height|Width)|p(?:sProfile|ener)|ffscreenBuffering)|NEGATIVE_INFINITY|d(?:i(?:splay|alog(?:Height|Top|Width|Left|Arguments)|rectories)|e(?:scription|fault(?:Status|Ch(?:ecked|arset)|View)))|u(?:ser(?:Profile|Language|Agent)|n(?:iqueID|defined)|pdateInterval)|_content|p(?:ixelDepth|ort|ersonalbar|kcs11|l(?:ugins|atform)|a(?:thname|dding(?:Right|Bottom|Top|Left)|rent(?:Window|Layer)?|ge(?:X(?:Offset)?|Y(?:Offset)?))|r(?:o(?:to(?:col|type)|duct(?:Sub)?|mpter)|e(?:vious|fix)))|e(?:n(?:coding|abledPlugin)|x(?:ternal|pando)|mbeds)|v(?:isibility|endor(?:Sub)?|Linkcolor)|URLUnencoded|P(?:I|OSITIVE_INFINITY)|f(?:ilename|o(?:nt(?:Size|Family|Weight)|rmName)|rame(?:s|Element)|gColor)|E|whiteSpace|l(?:i(?:stStyleType|n(?:eHeight|kColor))|o(?:ca(?:tion(?:bar)?|lName)|wsrc)|e(?:ngth|ft(?:Context)?)|a(?:st(?:M(?:odified|atch)|Index|Paren)|yer(?:s|X)|nguage))|a(?:pp(?:MinorVersion|Name|Co(?:deName|re)|Version)|vail(?:Height|Top|Width|Left)|ll|r(?:ity|guments)|Linkcolor|bove)|r(?:ight(?:Context)?|e(?:sponse(?:XML|Text)|adyState))|global|x|m(?:imeTypes|ultiline|enubar|argin(?:Right|Bottom|Top|Left))|L(?:N(?:10|2)|OG(?:10E|2E))|b(?:o(?:ttom|rder(?:Width|RightWidth|BottomWidth|Style|Color|TopWidth|LeftWidth))|ufferDepth|elow|ackground(?:Color|Image)))\sb/},{token:&quot;identifier&quot;,regex:o},{regex:&quot;&quot;,token:&quot;empty&quot;,next:&quot;no_regex&quot;}],start:[i.getStartRule(&quot;doc-start&quot;),f(&quot;start&quot;),{token:&quot;string.regexp&quot;,regex:&quot;\s\s/&quot;,next:&quot;regex&quot;},{token:&quot;text&quot;,regex:&quot;\s\ss+|^$&quot;,next:&quot;start&quot;},{token:&quot;empty&quot;,regex:&quot;&quot;,next:&quot;no_regex&quot;}],regex:[{token:&quot;regexp.keyword.operator&quot;,regex:&quot;\s\s\s\s(?:u[\s\sda-fA-F]{4}|x[\s\sda-fA-F]{2}|.)&quot;},{token:&quot;string.regexp&quot;,regex:&quot;/[sxngimy]*&quot;,next:&quot;no_regex&quot;},{token:&quot;invalid&quot;,regex:/\s{\sd+\sb,?\sd*\s}[+*]|[+*$^?][+*]|[$^][?]|\s?{3,}/},{token:&quot;constant.language.escape&quot;,regex:/\s(\s?[:=!]|\s)|\s{\sd+\sb,?\sd*\s}|[+*]\s?|[()$^+*?.]/},{token:&quot;constant.language.delimiter&quot;,regex:/\s|/},{token:&quot;constant.language.escape&quot;,regex:/\s[\s^?/,next:&quot;regex_character_class&quot;},{token:&quot;empty&quot;,regex:&quot;$&quot;,next:&quot;no_regex&quot;},{defaultToken:&quot;string.regexp&quot;}],regex_character_class:[{token:&quot;regexp.charclass.keyword.operator&quot;,regex:&quot;\s\s\s\s(?:u[\s\sda-fA-F]{4}|x[\s\sda-fA-F]{2}|.)&quot;},{token:&quot;constant.language.escape&quot;,regex:&quot;]&quot;,next:&quot;regex&quot;},{token:&quot;constant.language.escape&quot;,regex:&quot;-&quot;},{token:&quot;empty&quot;,regex:&quot;$&quot;,next:&quot;no_regex&quot;},{defaultToken:&quot;string.regexp.charachterclass&quot;}],function_arguments:[{token:&quot;variable.parameter&quot;,regex:o},{token:&quot;punctuation.operator&quot;,regex:&quot;[, ]+&quot;},{token:&quot;punctuation.operator&quot;,regex:&quot;$&quot;},{token:&quot;empty&quot;,regex:&quot;&quot;,next:&quot;no_regex&quot;}],qqstring:[{token:&quot;constant.language.escape&quot;,regex:r},{token:&quot;string&quot;,regex:&quot;\s\s\s\s$&quot;,consumeLineEnd:!0},{token:&quot;string&quot;,regex:'&quot;|$',next:&quot;no_regex&quot;},{defaultToken:&quot;string&quot;}],qstring:[{token:&quot;constant.language.escape&quot;,regex:r},{token:&quot;string&quot;,regex:&quot;\s\s\s\s$&quot;,consumeLineEnd:!0},{token:&quot;string&quot;,regex:&quot;'|$&quot;,next:&quot;no_regex&quot;},{defaultToken:&quot;string&quot;}]};if(!e||!e.noES6)this.$rules.no_regex.unshift({regex:&quot;[{}]&quot;,onMatch:function(e,t,n){this.next=e==&quot;{&quot;?this.nextState:&quot;&quot;;if(e==&quot;{&quot;&amp;&amp;n.length)n.unshift(&quot;start&quot;,t);else if(e==&quot;}&quot;&amp;&amp;n.length){n.shift(),this.next=n.shift();if(this.next.indexOf(&quot;string&quot;)!=-1||this.next.indexOf(&quot;jsx&quot;)!=-1)return&quot;paren.quasi.end&quot;}return e==&quot;{&quot;?&quot;paren.lparen&quot;:&quot;paren.rparen&quot;},nextState:&quot;start&quot;},{token:&quot;string.quasi.start&quot;,regex:/`/,push:[{token:&quot;constant.language.escape&quot;,regex:r},{token:&quot;paren.quasi.start&quot;,regex:/\s${/,push:&quot;start&quot;},{token:&quot;string.quasi.end&quot;,regex:/`/,next:&quot;pop&quot;},{defaultToken:&quot;string.quasi&quot;}]}),(!e||e.jsx!=0)&amp;&amp;a.call(this);this.embedRules(i,&quot;doc-&quot;,[i.getEndRule(&quot;no_regex&quot;)]),this.normalizeRules()};r.inherits(u,s),t.JavaScriptHighlightRules=u}),ace.define(&quot;ace/mode/matching_brace_outdent&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/range&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../range&quot;).Range,i=function(){};(function(){this.checkOutdent=function(e,t){return/^\ss+$/.test(e)?/^\ss*\s}/.test(t):!1},this.autoOutdent=function(e,t){var n=e.getLine(t),i=n.match(/^(\ss*\s})/);if(!i)return 0;var s=i[1].length,o=e.findMatchingBracket({row:t,column:s});if(!o||o.row==t)return 0;var u=this.$getIndent(e.getLine(o.row));e.replace(new r(t,0,t,s-1),u)},this.$getIndent=function(e){return e.match(/^\ss*/)[0]}}).call(i.prototype),t.MatchingBraceOutdent=i}),ace.define(&quot;ace/mode/folding/cstyle&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/range&quot;,&quot;ace/mode/folding/fold_mode&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../../lib/oop&quot;),i=e(&quot;../../range&quot;).Range,s=e(&quot;./fold_mode&quot;).FoldMode,o=t.FoldMode=function(e){e&amp;&amp;(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\s|[^|]*?$/,&quot;|&quot;+e.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\s|[^|]*?$/,&quot;|&quot;+e.end)))};r.inherits(o,s),function(){this.foldingStartMarker=/([\s{\s[\s(])[^\s}\s]\s)]*$|^\ss*(\s/\s*)/,this.foldingStopMarker=/^[^\s[\s{\s(]*([\s}\s]\s)])|^[\ss\s*]*(\s*\s/)/,this.singleLineBlockCommentRe=/^\ss*(\s/\s*).*\s*\s/\ss*$/,this.tripleStarBlockCommentRe=/^\ss*(\s/\s*\s*\s*).*\s*\s/\ss*$/,this.startRegionRe=/^\ss*(\s/\s*|\s/\s/)#?region\sb/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(e,t,n){var r=e.getLine(n);if(this.singleLineBlockCommentRe.test(r)&amp;&amp;!this.startRegionRe.test(r)&amp;&amp;!this.tripleStarBlockCommentRe.test(r))return&quot;&quot;;var i=this._getFoldWidgetBase(e,t,n);return!i&amp;&amp;this.startRegionRe.test(r)?&quot;start&quot;:i},this.getFoldWidgetRange=function(e,t,n,r){var i=e.getLine(n);if(this.startRegionRe.test(i))return this.getCommentRegionBlock(e,i,n);var s=i.match(this.foldingStartMarker);if(s){var o=s.index;if(s[1])return this.openingBracketBlock(e,s[1],n,o);var u=e.getCommentFoldRange(n,o+s[0].length,1);return u&amp;&amp;!u.isMultiLine()&amp;&amp;(r?u=this.getSectionRange(e,n):t!=&quot;all&quot;&amp;&amp;(u=null)),u}if(t===&quot;markbegin&quot;)return;var s=i.match(this.foldingStopMarker);if(s){var o=s.index+s[0].length;return s[1]?this.closingBracketBlock(e,s[1],n,o):e.getCommentFoldRange(n,o,-1)}},this.getSectionRange=function(e,t){var n=e.getLine(t),r=n.search(/\sS/),s=t,o=n.length;t+=1;var u=t,a=e.getLength();while(++t&lt;a){n=e.getLine(t);var f=n.search(/\sS/);if(f===-1)continue;if(r&gt;f)break;var l=this.getFoldWidgetRange(e,&quot;all&quot;,t);if(l){if(l.start.row&lt;=s)break;if(l.isMultiLine())t=l.end.row;else if(r==f)break}u=t}return new i(s,o,u,e.getLine(u).length)},this.getCommentRegionBlock=function(e,t,n){var r=t.search(/\ss*$/),s=e.getLength(),o=n,u=/^\ss*(?:\s/\s*|\s/\s/|--)#?(end)?region\sb/,a=1;while(++n&lt;s){t=e.getLine(n);var f=u.exec(t);if(!f)continue;f[1]?a--:a++;if(!a)break}var l=n;if(l&gt;o)return new i(o,r,l,t.length)}}.call(o.prototype)}),ace.define(&quot;ace/mode/javascript&quot;,[&quot;require&quot;,&quot;exports&quot;,&quot;module&quot;,&quot;ace/lib/oop&quot;,&quot;ace/mode/text&quot;,&quot;ace/mode/javascript_highlight_rules&quot;,&quot;ace/mode/matching_brace_outdent&quot;,&quot;ace/worker/worker_client&quot;,&quot;ace/mode/behaviour/cstyle&quot;,&quot;ace/mode/folding/cstyle&quot;],function(e,t,n){&quot;use strict&quot;;var r=e(&quot;../lib/oop&quot;),i=e(&quot;./text&quot;).Mode,s=e(&quot;./javascript_highlight_rules&quot;).JavaScriptHighlightRules,o=e(&quot;./matching_brace_outdent&quot;).MatchingBraceOutdent,u=e(&quot;../worker/worker_client&quot;).WorkerClient,a=e(&quot;./behaviour/cstyle&quot;).CstyleBehaviour,f=e(&quot;./folding/cstyle&quot;).FoldMode,l=function(){this.HighlightRules=s,this.$outdent=new o,this.$behaviour=new a,this.foldingRules=new f};r.inherits(l,i),function(){this.lineCommentStart=&quot;//&quot;,this.blockComment={start:&quot;/*&quot;,end:&quot;*/&quot;},this.$quotes={'&quot;':'&quot;',&quot;'&quot;:&quot;'&quot;,&quot;`&quot;:&quot;`&quot;},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t),i=this.getTokenizer().getLineTokens(t,e),s=i.tokens,o=i.state;if(s.length&amp;&amp;s[s.length-1].type==&quot;comment&quot;)return r;if(e==&quot;start&quot;||e==&quot;no_regex&quot;){var u=t.match(/^.*(?:\sbcase\sb.*:|[\s{\s(\s[])\ss*$/);u&amp;&amp;(r+=n)}else if(e==&quot;doc-start&quot;){if(o==&quot;start&quot;||o==&quot;no_regex&quot;)return&quot;&quot;;var u=t.match(/^\ss*(\s/?)\s*/);u&amp;&amp;(u[1]&amp;&amp;(r+=&quot; &quot;),r+=&quot;* &quot;)}return r},this.checkOutdent=function(e,t,n){return this.$outdent.checkOutdent(t,n)},this.autoOutdent=function(e,t,n){this.$outdent.autoOutdent(t,n)},this.createWorker=function(e){var t=new u([&quot;ace&quot;],&quot;ace/mode/javascript_worker&quot;,&quot;JavaScriptWorker&quot;);return t.attachToDocument(e.getDocument()),t.on(&quot;annotate&quot;,function(t){e.setAnnotations(t.data)}),t.on(&quot;terminate&quot;,function(){e.clearAnnotations()}),t},this.$id=&quot;ace/mode/javascript&quot;}.call(l.prototype),t.Mode=l});                (function() {\n                    ace.require([&quot;ace/mode/javascript&quot;], function(m) {\n                        if (typeof module == &quot;object&quot; &amp;&amp; typeof exports == &quot;object&quot; &amp;&amp; module) {\n                            module.exports = m;\n                        }\n                    });\n                })();\n            \n//}}}</div>
<div tiddler="zzz-Config" modifier="Okido" created="202002021919" modified="202003131515" tags="systemConfig" changecount="5" acerow="2" acecolumn="34">/* Options for ace-Plugin.js */\nconfig.options.chkEscapeScriptTags = true;\nconfig.options.txtaceBoxLines = &quot;50&quot;;\nconfig.options.txtaceEditFontSize = &quot;12pt&quot;; \nconfig.options.txtaceEditSoftTab = &quot;2&quot;;\n\n/* Set the user name */\nconfig.options.txtUserName = &quot;Okido&quot;;</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[

//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */
//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	chkRemoveExtraMarkers: false, // #162
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "https://classic.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b|\\[|\\])"; // #132
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	currBrowser: null,
	browsers: [],
	codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	SystemSettings: '',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|', // #160
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d{1,2}.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isChrome: config.userAgent.indexOf('chrome') > -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs,{
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
		],
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"
});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki"},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	chkRemoveExtraMarkers: "Replace unused transclusion markers with blanks", // #162
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)",
	txtUpgradeCoreURI: "Custom URI to download TiddlyWiki core from (when upgrading)"
});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "TiddlyWiki saved",
	mainDownload: "Downloading/saving main TiddlyWiki file",
	mainDownloadManual: "RIGHT CLICK HERE to download/save main TiddlyWiki file",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"
});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"
});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"
});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"
});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"
});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"
});

merge(config.messages,{
	sizeTemplates:
	[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
	]
});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	placeholder: "",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"
});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"
});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"
});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"
});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"
});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"
});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"
});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"
});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"
});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
		],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
		]
	}
});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
		],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
		]
	},
	listViewTemplateReadOnly: {
		columns: [
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
		],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
		]
	}
});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	errorGettingTiddlerListHttp404: "Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",
	errorGettingTiddlerListHttp: "Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",
	errorGettingTiddlerListFile: "Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
		],
		rowClasses: []
	}
});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
});

merge(config.macros.annotations,{});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"
});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"
});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"
});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"
});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"
});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"
});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"
});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"
});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"
});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
		],
		rowClasses: [],
		buttons: []
	}
});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	SystemSettings: "This tiddler is used to store configuration options for this TiddlyWiki document",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
});
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether this file can be saved back to the same location [Preemption]
window.allowSave = window.allowSave || function(l)
{
	return true;
}

// Whether this file is being viewed locally
window.isLocal = function()
{
	return (document.location.protocol == "file:");
}

// Whether to use the JavaSaver applet
var useJavaSaver = window.isLocal() && (config.browser.isSafari || config.browser.isOpera);

// Allow preemption code a chance to tweak config and useJavaSaver [Preemption]
if (window.tweakConfig) window.tweakConfig();

if(!window || !window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

// Starting up
function main()
{
	window.originalHTML=recreateOriginal();

	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki({config:config});
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	var s;
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	loadOptions();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins("systemConfig");
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	var m;
	for(m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
}

function loadPlugins(tag)
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers(tag);
	tiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	var i;
	for(i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			var i;
			for(i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	var i;
	for(i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		var args = v.parseParams("anon", null, null)[0];
		var title = args.title ? args.title[0] : v;
		var customFields = args.fields ? args.fields[0] : null;
		if(!readOnly) {
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);
			story.focusTiddler(title,"text");
			var i,tags = args.tag || [];
			for(i=0;i<tags.length;i++) {
				story.setTiddlerTag(title,tags[i],+1);
			}
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var i,tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	var n;
	this.formatters = [];
	var pattern = [];
	for(n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			if(s=="float")
				s = "cssFloat";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		var t;
		for(t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE && (config.browser.ieVersion[1] < 10))
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var onmouseover = function() {jQuery(this).addClass("hoverRow");};
		var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
					theRow.onmouseover = onmouseover;
					theRow.onmouseout = onmouseout;
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t,matched;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				jQuery(e).addClass("imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		jQuery(e).remove();
	}
	return html;
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

//--
//-- Macro definitions
//--

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			var allowEval = true;
			if(config.evaluateMacroParameters=="system") {
				if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place,macroName,params,wikifier,paramString)
{
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list) {
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	jQuery(list).empty().addClass("list list-" + type);
	var template = args.template ? store.getTiddlerText(args.template[0]) : false;
	if(!template) {
		template = config.macros.list.template;
	}
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	var t;
	for(t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		var tiddler = results[t];
		if(typeof(tiddler) == 'string') { // deal with missing etc..
				tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
		}
		wikify(template, li, null, tiddler);
	}
	if(results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		var t;
		for(t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	var t;
	for(t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

var macro = config.macros.timeline;
merge(macro, {
	handler: function(place,macroName,params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).
			attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var field = params[0] || "modified";
		var prefix = field.charAt(0);
		var no_prefix_field = prefix === "-" || prefix === "+" ? field.substr(1, field.length) : field;
		var dateFormat = params[2] || this.dateFormat;
		var groupTemplate = macro.groupTemplate.format(no_prefix_field, dateFormat);
		groupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :
			groupTemplate;

		var itemTemplate = macro.itemTemplate;
		itemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :
			itemTemplate;

		var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
			store.reverseLookup("tags", "excludeLists", false, field);
		var lastGroup = "", ul;
		var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;
		var t;
		for(t=tiddlers.length-1; t>=last; t--) {
			var tiddler = tiddlers[t];
			var theGroup = wikifyPlainText(groupTemplate,0,tiddler);
			if(typeof(ul) == "undefined" || theGroup != lastGroup) {
				ul = document.createElement("ul");
				jQuery(ul).addClass("timeline");
				container.appendChild(ul);
				createTiddlyElement(ul,"li",null,"listTitle",theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul,"li",null,"listLink");
			wikify(itemTemplate,item,null,tiddler);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>", 
	itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var allowEval = true;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.length > 0 && config.evaluateMacroParameters == "system") {
		// included tiddler and "system" evaluation required, so check tiddler tagged appropriately
		var title = stack[stack.length-1];
		var pos = title.indexOf(config.textPrimitives.sectionSeparator);
		if(pos != -1) {
			title = title.substr(0,pos); // get the base tiddler title
		}
		var t = store.getTiddler(title);
		if(!t || t.tags.indexOf("systemAllowEval") == -1) {
			allowEval = false;
		}
	}
	params = paramString.parseParams("name",null,allowEval,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.macroArgs=args; // #154
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		var i;
		for(i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		// #162 start
		if (n && config.options.chkRemoveExtraMarkers) for(i=n; i<9; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,"");
		}
		// #162 end
		config.macros.tiddler.renderText(wrapper,text,tiddlerName);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	var btn = createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	var t;
	for(t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var sortby = getParam(params,"sortBy",false);
	var tagged = store.getTaggedTiddlers(title,sortby);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	var t;
	for(t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOption(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	var t;
	for(t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(root[names[nameIndex]]) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(config.macros.view.depth>50)
			return;
		if(config.macros.view.depth>0) {
			if (value==config.macros.view.values[config.macros.view.depth-1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			jQuery(e).addClass("readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	var t;
	for(t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};
//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	var t;
	for(t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(this,title,template,false,null,null); // #161
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	var t;
	for(t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,false,false,false);
	createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	txt.value = getParam(params,"anon","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",getParam(params,"accesskey",this.accessKey));
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	txt.setAttribute("placeholder",getParam(params,"placeholder",this.placeholder));
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 9: // Tab
			return;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout) {
					clearTimeout(me.timeout);
				}
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout) {
				clearTimeout(me.timeout);
			}
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	var t;
	for(t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	var t;
	for(t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			jQuery(tabset.nextSibling).remove();
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOption(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		var t;
		for(t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			jQuery(btn).addClass("command_" + commandName);
			if(className)
				jQuery(btn).addClass(className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	var t;
	for(t=0; t<children.length; t++) {
		var c = children[t];
		if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var t;
	for(t=0; t<params.length; t++) {
		var btn;
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			jQuery(btn).addClass("lessCommand");
			break;
		case ">":
			btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			jQuery(btn).addClass("moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(config.commands[c]) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	var e = story.getTiddlerField(title,config.options.txtEditorFocus||"text");
	if(e) {
		setCaretPosition(e,0);
	}
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	var r;
	for(r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	var i;
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changecount = this.fields.changecount || 0;
	return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").
		replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").
		replace(/<script((?:.|\n)*?)<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown || "";
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown || "";
	var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
	return f.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki(params)
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	if(params && params.config) {
		this.config = config;
	}
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		var t;
		for(t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.isAvailable = function(title) {
	if (!title)
		return false;
	var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
	if(s!=-1)
		title = title.substr(0,s);
	return this.tiddlerExists(title) || this.isShadowTiddler(title);
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	var text = tiddler ? tiddler.text : null;
	if(!tiddler && this.isShadowTiddler(title)) {
		text = this.getShadowTiddlerText(title);
	}
	if(text) {
		if(!section)
			return text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(text);
		if(match) {
			var t = text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var match,lastPos = 0;
	do {
		match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|\x20?([\'\/]{0,2})~?([^\|\s\:\~\'\/]|(?:[^\|\s~\'\/][^\|\n\f\r]*[^\|\s\:\'\/]))\:?\4[\x20\t]*\|[\t\x20]*([^\n\t\x20](?:[^\n]*[^\n\t\x20])?)[\t\x20]*\|$)/gm; // #112
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var t,r = {};
	for(t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var i;
	for(i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler;
	if(title instanceof Tiddler) {
		tiddler = title;
		tiddler.fields = merge(merge({},tiddler.fields),config.defaultCustomFields,true);
		title = tiddler.title;
		newTitle = title;
	} else {
		tiddler = this.fetchTiddler(title);
		if(tiddler) {
			created = created || tiddler.created; // Preserve created date
			creator = creator || tiddler.creator;
			this.deleteTiddler(title);
		} else {
			created = created || modified;
			tiddler = new Tiddler();
		}
		fields = merge(merge({},fields),config.defaultCustomFields,true);
		tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	}
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		var i;
		for(i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var t,results = [];
	for(t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
	    var g,c;
		for(g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)
{
	return this.reverseLookup(field,value,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		var values;
		if(["links", "tags"].contains(lookupField)) {
			values = tiddler[lookupField];
		} else {
			var accessor = TiddlyWiki.standardFieldAccess[lookupField];
			if(accessor) {
				values = [ accessor.get(tiddler) ];
			} else {
				values = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];
			}
		}
		var lookup;
		for(lookup=0; lookup<values.length; lookup++) {
			if(values[lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	return this.sortTiddlers(results,sortField);
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		var n;
		for(n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var t,results = [];
	for(t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		field = field.substr(1);
		break;
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field]) {
		if(field=="title") {
			tiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});
		} else {
			tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
		}
	} else {
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	}
	return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results,match) {
		var title = match[1]||match[4];
		var tiddler = this.fetchTiddler(title);
		if(tiddler) {
			results.pushUnique(tiddler);
		} else if(this.isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title,this.getTiddlerText(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results,match) {
		var m,matched = this.getTaggedTiddlers(match[3]);
		for(m=0; m<matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	},
	sort: function(results,match) {
		return this.sortTiddlers(results,match[3]);
	},
	limit: function(results,match) {
		return results.slice(0,parseInt(match[3],10));
	},
	field: function(results,match) {
		var m,matched = this.getValueTiddlers(match[2],match[3]);
		for (m = 0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	}
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter,results)
{
	var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

	results = results || [];
	if(filter) {
		var match = re.exec(filter);
		while(match) {
			var handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';
			results = config.filters[handler].call(this,results,match);
			match = re.exec(filter);
		}
	}
	return results;
};
// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				var n;
				for(n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
		var sliceType = fieldName.substr(0, 2);
		var sliceName = fieldName.substring(2);
		return store.getTiddlerText("%0%1%2".format(t.title,sliceType,sliceName));
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = TiddlyWiki.standardFieldAccess[fieldName];
		if(accessor) {
			return accessor.get(t);
		}
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n != "tiddler") {
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
			if(result)
				return result;
		}
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		title = title.replace(/_/g, "__").replace(/ /g, "_");
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		if(title) {
			fn.call(this,title,e);
		}
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	var t;
	for(t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,callback)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			var dirty = store.isDirty();
			context.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			if(!window.allowSave())
				store.setDirty(dirty);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		if(callback) {
			callback(context);
		}
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return "";
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType]();
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template==config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE] ? // #166
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				jQuery(tiddlerElem).addClass("isTag");
			else
				jQuery(tiddlerElem).removeClass("isTag");
			if(store.tiddlerExists(title)) {
				jQuery(tiddlerElem).removeClass("shadow");
				jQuery(tiddlerElem).removeClass("missing");
			} else {
				jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	var t;
	for(t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		var ed = story.getTiddlerField(title,"text");
		if(target.tagName.toLowerCase() == "input" && ed.value==config.views.editor.defaultText.format([title])) {
			// moving from input field and editor still contains default text, so select it
			ed.focus();
			ed.select();
			consume = true;
		}
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem) {
		var t,children = tiddlerElem.getElementsByTagName("*");
		for(t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			jQuery(tiddlerElem).remove();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !jQuery(e).hasClass("tiddler")) {
		e = jQuery(e).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var t,c = e.childNodes;
			for(t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
		    var n;
			for(n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
				title = newTitle;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		var n;
		for(n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return store.isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	var i;
	for(i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOption("txtTheme");
	}
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var text = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,text,cmb.open.tooltip,
			function(e) { backstage.show(); return false; },null,"backstageShow");
		text = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,text,cmb.close.tooltip,
			function(e) { backstage.hide(); return false; },null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) { backstage.switchTab(null); };
		createTiddlyText(this.toolbar,cmb.prompt);
		for(var t = 0; t < config.backstageTasks.length; t++)
		{
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
		}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOption("chkBackstage");
		jQuery(this.content).addClass("backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOption("chkBackstage");
			jQuery(this.content).removeClass("backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e) {
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
		}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			jQuery(this.currTabElem).removeClass("backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			jQuery(tabElem).addClass("backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findDocHeight() + "px";
		backstage.cloak.style.display = "block";
		jQuery(backstage.panelBody).empty();
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			jQuery(backstage.currTabElem).removeClass("backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) { backstage.cloak.style.display = "none"; };
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {
			backstage.switchTab(params[0]); return false;
		});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var t,s = wizard.getElement("selTypes");
	for(t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel || t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var t,tagged = store.getTaggedTiddlers("systemServer","title");
	for(t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var file = this.value;
	file = file.replace(/^C:\\fakepath\\/i,''); // remove fakepath (chrome/opera/safari)
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
			file = this.files[0].fileName; // REQUIRES PRIVILEGES.. NULL otherwise
		} catch (ex) {
			// non-priv fallback: combine filename with path to current document
			var path=getLocalPath(document.location.href);
			var slashpos=path.lastIndexOf('/'); if (slashpos==-1) slashpos=path.lastIndexOf('\\'); 
			if (slashpos!=-1) path=path.substr(0,slashpos+1); // remove filename, leave trailing 	slash
			file=path+file;
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	adaptor.openHost(url,null,wizard,me.onOpenHost);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var t,s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var n,list = workspaceList.parseParams("workspace",null,false,true);
		for(n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var browse = wizard.getElement("txtBrowse");
	if (browse.files) context.file = browse.files[0]; // for HTML5 FileReader
	adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		var error = context.statusText||me.errorGettingTiddlerList;
		if(context.host.indexOf("file://") === 0) {
			error = me.errorGettingTiddlerListFile;
		} else {
			error = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :
				me.errorGettingTiddlerListHttp;
		}
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],"");
		jQuery("span.status", wizard.footerEl).html(error); // so error message can be html
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		var n;
		for(n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.getSourceURL = function()
{
	return config.options.txtUpgradeCoreURI || config.macros.upgrade.source;
};

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.getSourceURL(),this.getSourceURL()]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(!window.allowSave()) {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	
	w.setButtons([],me.statusPreparingBackup);
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	var original = loadOriginal(localPath);
	
	w.setButtons([],me.statusSavingBackup);
	var backupSuccess = copyFile(backupPath,localPath) || saveFile(backupPath,original);
	if(!backupSuccess) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setValue("backupPath",backupPath);
	
	w.setButtons([],me.statusLoadingCore);
	var sourceURL = me.getSourceURL();
	var options = {
		type:"GET",
		url:sourceURL,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			me.onLoadCore(true,w,jqXHR.responseText,sourceURL,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			me.onLoadCore(false,w,null,sourceURL,jqXHR);
		}
	};
	ajaxReq(options);
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = addUpgradePartsToURI(document.location.toString(), backupPath);
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

// a helper, splits uri into parts, passes the map of parts to modify and glues parts back
function changeUri(uri, modify)
{
	var uriPartsRE = /^(?:([\w:]+)\/\/)?([^\/\?#]+)?([^\?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;
	var match = uriPartsRE.exec(uri) || [null,'','','','',''];
	var parts = {
		scheme:	match[1],
		host:	match[2],
		path:	match[3],
		query:	match[4],
		hash:	match[5]
	};
	modify(parts);
	var newScheme = parts.scheme === undefined ? '' : (parts.scheme + '//'),
	    newHost   = parts.host || '',
	    newPath   = parts.path || '',
	    newQuery  = parts.query ? ('?' + parts.query) : '',
	    newHash   = parts.hash   === undefined ? '' : ('#' + parts.hash);
	return newScheme + newHost + newPath + newQuery + newHash;
}

function addUpgradePartsToURI(uri, backupPath)
{
	return changeUri(uri, function(uriParts)
	{
		var newParamifier = 'upgrade:[['+ encodeURI(backupPath) +']]';
		uriParts.hash = (uriParts.hash ? uriParts.hash + '%20' : '') + newParamifier;
		
		var newQuery = "time=" + new Date().convertToYYYYMMDDHHMM();
		uriParts.query = (uriParts.query ? uriParts.query + '&' : '') + newQuery;
	});
}

function stripUpgradePartsFromURI(uri)
{
	return changeUri(uri, function(uriParts)
	{
		var queryParts = uriParts.query.split('&'),
		    hashParts = uriParts.hash.split('%20'); // splits paramifiers with a space in argument
		
		for(var i = 0; i < queryParts.length; i++)
			if(queryParts[i].indexOf('time=') == 0)
				queryParts.splice(i--,1);
		
		// relies on the upgrade paramifier being added to the end of hash
		for(i = 0; i < hashParts.length; i++)
			if(hashParts[i].indexOf('upgrade:') == 0)
				hashParts = hashParts.slice(0,i);
		
		uriParts.query = queryParts.join('&');
		uriParts.hash = hashParts.join('%20') || undefined;
	})
}

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = stripUpgradePartsFromURI(window.location.toString());
}

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	jQuery(listWrapper).empty();
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
		var listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);
		wizard.setValue("listView",listView);
		if(!readOnly) {
			wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
		}
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		var t;
		for(t=0; t<rowNames.length; t++) {
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
		}
		autoSaveChanges();
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			var t;
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
		autoSaveChanges();
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes()) {
		var toolbar = createTiddlyElement(msgArea,"div",null,"messageArea__toolbar messageToolbar");
		var btn = createTiddlyButton(toolbar, '', config.messages.messageClose.tooltip, clearMessage,
			"button messageToolbar__button");

		btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" class="messageToolbar__icon">'+
		'	<rect width="1" height="13.1" x="4.5" y="-1.6" transform="rotate(-45 5 5)"/>'+
		'	<rect width="1" height="13.1" x="4.5" y="-1.6" transform="rotate(+45 5 5)"/>'+
		'</svg>';
		// inline SVG is unsupported in old FireFox
		if(window.HTMLUnknownElement && btn.firstChild instanceof window.HTMLUnknownElement) {
			btn.innerHTML = config.messages.messageClose.text;
		} else {
			btn.classList.add('messageToolbar__button_withIcon');
		}
	}
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div",null,"messageArea__text");
}

function displayMessage(text, link)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(!link) {
		e.appendChild(document.createTextNode(text));
	} else {
		createTiddlyElement(e,"a",null,null,text,{ href: link, target: "_blank" });
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		jQuery(msgArea).empty();
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "SystemSettings", notify: onSystemSettingsChange},
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		if (startingUp) return true; // #147
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.macroArgs; // #154
		if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var c,nodes = root.childNodes;
	for(c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	if(!title || !store.isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!store.isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	jQuery(display).empty();
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	jQuery(stash).remove();
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? 'true' : 'false';},
		set: function(name,value) {config.options[name] = value == 'true';}
	}
};

function setOption(name,value)
{
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
	var optType = name.substr(0,3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
	if(safeMode)
		return;
	loadCookies();
	loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
	var cookieList = document.cookie.split(';');
	var i,cookies = {};
	for(i=0; i<cookieList.length; i++) {
		var p = cookieList[i].indexOf('=');
		if(p != -1) {
			var name = cookieList[i].substr(0,p).trim();
			var value = cookieList[i].substr(p+1).trim();
			cookies[name] = value;
		}
	}
	return cookies;
}

function loadCookies()
{
	var i,cookies = getCookies();
	if(cookies['TiddlyWikiClassicOptions']) // TW291 and later //#159
		cookies = cookies['TiddlyWikiClassicOptions'].replace(/%22/g,'"').replace(/%25/g,'%').decodeHashMap(); // #159
	else if(cookies['TiddlyWikiOptions']) // TW290 beta //#159
		cookies = cookies['TiddlyWikiOptions'].replace(/%25/g,'%').decodeHashMap(); // #159
	else if(cookies['TiddlyWiki']) // TW281 and earlier
		cookies = cookies['TiddlyWiki'].decodeHashMap();
	for(i in cookies) {
		if(config.optionsSource[i] != 'setting') {
			setOption(i,cookies[i]);
		}
	}
}

function loadSystemSettings()
{
	var key,settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for(key in settings) {
		setOption(key,settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange()
{
	if(!startingUp) {
		loadSystemSettings();
	}
}

function saveOption(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	saveCookie(name);
	if(config.optionsSource[name] == 'setting') {
		saveSystemSetting(name,true);
	}
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
	var key,cookies = {};
	for(key in config.options) {
		var value = getOption(key);
		value = value == null ? 'false' : value;
		cookies[key] = value;
	}
	// TW291 and later (#159)
	document.cookie = 'TiddlyWikiClassicOptions='
		+ String.encodeHashMap(cookies).replace(/%/g,'%25').replace(/"/g,'%22')
		+ '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';
	cookies = getCookies();
	var c;
	for(c in cookies) {
		var optType = c.substr(0,3);
		if(config.optionHandlers[optType])
			removeCookie(c);
	}
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
	if(systemSettingSave) {
		window.clearTimeout(systemSettingSave);
	}
	systemSettingSave = window.setTimeout(function() {
		var tiddler = store.getTiddler('SystemSettings');
		autoSaveChanges(null,[tiddler]);
	}, 1000);
}

function saveSystemSetting(name,saveFile)
{
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title,name);
	if(readOnly || slice === getOption(name)) {
		return; //# don't save if read-only or the option hasn't changed
	}
	var slices = store.calcAllSlices(title);
	var key;
	for(key in config.optionsSource) {
		var value = getOption(key) || '';
		if(slices[key] !== value) {
			slices[key] = value;
		}
	}
	var text = [];
	for(key in slices) {
		text.push('%0: %1'.format([key,slices[key]]));
	}
	text = text.sort().join('\n');
	var storeWasDirty = store.isDirty();
	var tiddler = store.getTiddler(title);
	if(tiddler) {
		tiddler.text = text;
		tiddler = store.saveTiddler(tiddler);
	} else {
		tiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);
	}
	if(saveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute('type',typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute('option',opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute('title',config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != 'no')
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute('option');
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: 'input',
		valueField: 'value',
		eventName: 'onchange',
		className: 'txtOptionInput',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: 'input',
		valueField: 'checked',
		eventName: 'onclick',
		className: 'chkOptionInput',
		typeValue: 'checkbox',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOption(opt);
	var t,nodes = document.getElementsByTagName(elementType);
	for(t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute('option');
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);
	var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);
	var desc = getParam(params,'desc','no');
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var showUnknown = getParam(params,'showUnknown','no');
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement('markList');
	var chkUnknown = wizard.getElement('chkUnknown');
	chkUnknown.checked = showUnknown == 'yes';
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement('div');
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue('listWrapper',listWrapper);
	this.refreshOptions(listWrapper,showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var n,opts = [];
	for(n in config.options) {
		var opt = {};
		opt.option = '';
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,'no');
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue('listWrapper');
	jQuery(listWrapper).empty();
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				store.allTiddlersAsHtml() + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea divs
	if(!original)
		return null;
	var posOpeningDiv = original.search(startSaveAreaRE);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
	var posClosingDiv = original.lastIndexOf(endSaveArea,start);
	if(posClosingDiv == -1)
		posClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

// get the full HTML of the original file
function loadOriginal(localPath)
{
	return loadFile(localPath) || window.originalHTML || recreateOriginal();
}

function recreateOriginal()
{
	// construct doctype
	var content = "<!DOCTYPE ";
	var t = document.doctype;
	if (!t) 
		content += "html"
	else {
		content += t.name;
		if      (t.publicId)		content+=' PUBLIC "'+t.publicId+'"';
		else if (t.systemId)		content+=' SYSTEM "'+t.systemId+'"';
	}
	content += ' "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"';
	content += '>\n';

	// append current document content
	content += document.documentElement.outerHTML;

	content = content.replace(/<div id="saveTest">savetest<\/div>/,'<div id="saveTest"></div>');
	content = content.replace(/script><applet [^\>]*><\/applet>/g,'script>');
	content = content.replace(/><head>/,'>\n<head>');
	content = content.replace(/\n\n<\/body><\/html>$/,'</'+'body>\n</'+'html>\n'); // #170
	content = content.replace(/(<(meta) [^\>]*[^\/])>/g,'$1 />');
	content = content.replace(/<noscript>[^\<]*<\/noscript>/,
		function(m){ return m.replace(/&lt;/g,'<').replace(/&gt;/g,'>'); });
	content = content.replace(/<div id="copyright">[^\<]*<\/div>/,
		function(m){return m.replace(/\xA9/g,'&copy;');});

	return content;
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(!window.allowSave()) {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	var co = config.options; //# abbreviation
	config.saveByDownload = false;
	config.saveByManualDownload = false;
	saveMain(localPath,original,posDiv);
	if (!config.saveByDownload && !config.saveByManualDownload) {
		if(co.chkSaveBackups)
			saveBackup(localPath,original);
		if(co.chkSaveEmptyTemplate)
			saveEmpty(localPath,original,posDiv);
		if(co.chkGenerateAnRssFeed && saveRss instanceof Function)
			saveRss(localPath);
	}
	if(co.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}


function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		if (!config.saveByManualDownload) {
			if (config.saveByDownload) { //# set by HTML5DownloadSaveFile()
				var link = getDataURI(revised);
				var msg  = config.messages.mainDownload;
			} else {
				var link = "file://" + localPath;
				var msg  = config.messages.mainSaved;
			}
			displayMessage(msg,link);
		}
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backupSuccess = copyFile(backupPath,localPath) || saveFile(backupPath,original);
	if(backupSuccess)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

// Translate URL to local path [Preemption]
window.getLocalPath = window.getLocalPath || function(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,generateRss()))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	var i;
	for(i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

// Copy a file in filesystem [Preemption]
window.copyFile = window.copyFile || function(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

// Save a file in filesystem [Preemption]
window.saveFile = window.saveFile || function(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	if(!r)
		r = HTML5DownloadSaveFile(fileUrl,content);
	if(!r)
		r = manualSaveFile(fileUrl,content);
	return r;
}

// Load a file from filesystem [Preemption]
window.loadFile = window.loadFile || function(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r === null) || (r === false))
		r = ieLoadFile(fileUrl);
	if((r === null) || (r === false))
		r = javaLoadFile(fileUrl);
	return r;
}


function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i = scan.length-1; i >= 0; i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(convertUnicodeToHtmlEntities(content));
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(!window.Components)
		return null;
	
	content = mozConvertUnicodeToUTF8(content);
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
		file.initWithPath(filePath);
		if(!file.exists())
			file.create(0,0x01B4);// 0x01B4 = 0664
		var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
		out.init(file,0x22,0x04,null);
		out.write(content,content.length);
		out.flush();
		out.close();
		return true;
	} catch(ex) {
		return false;
	}
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(!window.Components)
		return null;
	
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
		file.initWithPath(filePath);
		if(!file.exists())
			return null;
		var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
		inputStream.init(file,0x01,0x04,null);
		var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
		sInputStream.init(inputStream);
		var contents = sInputStream.read(sInputStream.available());
		sInputStream.close();
		inputStream.close();
		return mozConvertUTF8ToUnicode(contents);
	} catch(ex) {
		return false;
	}
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

/*
 *
 * in between when the applet has been started
 * and the user has given permission to run the applet
 * we get an applet object, but it doesn't have the methods
 * we expect yet.
 *
 */
var LOG_TIDDLYSAVER = true;
function logTiddlySaverException(msg, ex)
{
	var applet = document.applets['TiddlySaver'];
	console.log(msg + ": " + ex);
	if (LOG_TIDDLYSAVER && applet) {
		try {
			console.log(msg + ": " + applet.getLastErrorMsg());
			console.log(msg + ": " + applet.getLastErrorStackTrace());
		} catch (ex) {}
	}
}

function javaDebugInformation ()
{
	var applet = document.applets['TiddlySaver'];
	var what = [
		["Java Version", applet.getJavaVersion],
		["Last Exception", applet.getLastErrorMsg], // #156
		["Last Exception Stack Trace", applet.getLastErrorStackTrace],
		["System Properties", applet.getSystemProperties] ];

	function formatItem (description, method) {
		try {
			 result = String(method.call(applet));
		} catch (ex) {
			 result = String(ex)
		}
		return description + ": " + result
	}

	return jQuery.map(what, function (item) { return formatItem.apply(this, item) })
			.join('\n\n')
}

function javaSaveFile(filePath,content)
{
	var applet = document.applets['TiddlySaver'];
	try {
		if (applet && filePath) 
			return applet.saveFile(javaUrlToFilename(filePath), "UTF-8", content);
	} catch(ex) {
		logTiddlySaverException("javaSaveFile", ex);
	}
	// is this next block working anywhere ? -- grmble
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex2) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	var applet = document.applets['TiddlySaver'];
	try {
		if (applet && filePath) {
			var ret = applet.loadFile(javaUrlToFilename(filePath),"UTF-8");
			if(!ret)
				return null;
			return String(ret);
		}
	} catch(ex) {
		logTiddlySaverException("javaLoadFile", ex);
	}
	// is this next block working anywhere ? -- grmble
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(String(line));
		r.close();
	} catch(ex2) {
		return null;
	}
	return content.join("\n");
}

function HTML5DownloadSaveFile(filePath,content)
{
	var link = document.createElement("a");
	if(link.download === undefined)
		return null;
	
	config.saveByDownload = true;
	var slashpos = filePath.lastIndexOf("/");
	if (slashpos==-1) slashpos = filePath.lastIndexOf("\\");
	var filename = filePath.substr(slashpos+1);
	var uri = getDataURI(content);
	link.setAttribute("target","_blank");
	link.setAttribute("href",uri);
	link.setAttribute("download",filename);
	document.body.appendChild(link); link.click(); document.body.removeChild(link);
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function manualSaveFile(filePath,content)
{
	// FALLBACK for showing a link to data: URI
	config.saveByManualDownload = true;
	var slashpos = filePath.lastIndexOf("/");
	if (slashpos==-1) slashpos = filePath.lastIndexOf("\\");
	var filename = filePath.substr(slashpos+1);
	var uri = getDataURI(content);
	displayMessage(config.messages.mainDownloadManual,uri);
	return true;
}

// construct data URI (using base64 encoding to preserve multi-byte encodings)
function getDataURI(data)
{
	if (config.browser.isIE)
		return "data:text/html,"+encodeURIComponent(data);
	else
		// manualConvertUnicodeToUTF8 was moved here from convertUnicodeToFileFormat
		// in 2.9.1 it was used only for FireFox but happened to fix download saving non-ASCII in Chrome & Safari as well
		return "data:text/html;base64,"+encodeBase64(manualConvertUnicodeToUTF8(data));
}

function encodeBase64(data)
{
	if (!data) return "";
	var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	var out = "";
	var chr1,chr2,chr3 = "";
	var enc1,enc2,enc3,enc4 = "";
	for (var count = 0, i = 0; i < data.length; )
	{
		chr1 = data.charCodeAt(i++);
		chr2 = data.charCodeAt(i++);
		chr3 = data.charCodeAt(i++);
		enc1 = chr1 >> 2;
		enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
		enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
		enc4 = chr3 & 63;
		if (isNaN(chr2)) enc3 = enc4 = 64;
		else if (isNaN(chr3)) enc4 = 64;
		out += keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);
		chr1 = chr2 = chr3 = enc1 = enc2 = enc3 = enc4 = "";
	}
	return out;
}

//--
//-- Filesystem utilities
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}


function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

// deprecated helper for backward-compatibility with elder extensions
// (browser/saving method-specific convertion is only needed in browser-specific savers)
function convertUnicodeToFileFormat(s)
{
	return s;
}

// deprecated helper for backward-compatibility with elder extensions
function convertUnicodeToUTF8(s)
{
	return s;
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host;
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)
{
	context.status = true;
	context.adaptor.store = new TiddlyWiki();
	if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
		context.statusText = config.messages.invalidFileError.format([context.host]);
		context.status = false;
	}
	context.complete(context,context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context,jqXHR)
{
	context.status = false;
	context.statusText = jqXHR.message;
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type: "GET",
		url: context.host,
		file: context.file, // for HTML5 FileReader
		processData: false,
		success: function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error: function(jqXHR,textStatus,errorThrown) {
			context.xhr = jqXHR;
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		var i;
		for(i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	if(context.adaptor.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if (args.file || args.url.startsWith("file"))  // LOCAL FILE
		return localAjax(args);
	return jQuery.ajax(args);
}

function localAjax(args)
{
	var success = function(data) {
		args.success(data,"success",{ responseText:data });
	};
	var failure = function(who) {
		args.error({ message:who+": cannot read local file" },"error",0);
	};

	if (args.file) try { // HTML5 FileReader (Chrome, FF20+, Safari, etc.)
		var reader = new FileReader();
		reader.onload = function(e)  { success(e.target.result); }
		reader.onerror = function(e) { failure("FileReader"); }
		reader.readAsText(args.file);
		return true;
	} catch (ex) { ; }

	try { // local file I/O (IE, FF with TiddlyFox, Chrome/Safari with TiddlySaver, etc.)
		var data = loadFile(getLocalPath(args.url));
		if (data) success(data);
		else failure("loadFile");
		return true;
	} catch (ex) { ; }

	return true;
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var httpSuccess = function(xhr) {
		try {
			// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
			return (!xhr.status && location.protocol === "file:") ||
				(xhr.status >= 200 && xhr.status < 300) ||
				xhr.status === 304 || xhr.status === 1223;
		} catch(e) {}
		return false;
	};

	var options = {
		type: type,
		url: url,
		processData: false,
		data: data,
		cache: !!allowCache,
		beforeSend: function(xhr) {
			var i;
			for(i in headers)
				xhr.setRequestHeader(i,headers[i]);
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	try {
		if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
			window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	} catch (ex) {
	}
	return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var x1,x2,i,a = ["major","minor","revision"];
	for(i = 0; i<a.length; i++) {
		x1 = v1[a[i]] || 0;
		x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function merge(dst,src,preserveExisting)
{
	var i;
	for(i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(b < g.browsers.length-1 && !g.browsers[b]())
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var n,e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var i,btn = document.createElement("a");
	btn.setAttribute("href","javascript:;");
	if(action) {
		btn.onclick = action;
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	var f = config.messages.externalLinkTooltip;
	link.title = f ? f.format([url]) : url;
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
	    var f;
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			f = config.messages.shadowedTiddlerToolTip;
			classes.pushUnique("shadow");
		} else {
			f = config.messages.undefinedTiddlerToolTip;
			classes.remove("shadow");
		}
		subTitle = f ? f.format([title]) : "";
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var title = jQuery.trim(title);
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	var t;
	for(t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	jQuery(popup).addClass("taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	var t;
	for(t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	var t;
	for(t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	var t;
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {jQuery(element).remove();};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var height = element.scrollHeight;
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {jQuery(element).remove();};
			break;
		case "children":
			c = function(element,properties) {jQuery(element).empty();};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	jQuery(curr.root).addClass("highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var t,pos = -1;
	for(t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	var t;
	for(t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		jQuery(p.root).removeClass("highlight");
		jQuery(p.popup).remove();
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,'form',null,'wizard');
	createTiddlyElement(this.formElem,'h1',null,'wizard__title',title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
	return this.formElem;
};

Wizard.prototype.clear = function()
{
	jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	jQuery(this.footElem).empty();
	for(var t = 0; t < buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
	}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	jQuery(this.bodyElem).empty();
	var w = createTiddlyElement(this.bodyElem,'div');
	createTiddlyElement(w,'h2',null,'wizard__subtitle',stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var t,r = createTiddlyElement(thead,"tr");
	for(t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				jQuery(c).addClass(columnTemplate.className);
		}
	}
	var rc,tbody = createTiddlyElement(table,"tbody");
	for(rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				jQuery(r).addClass(listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		var cc;
		for(cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					jQuery(c).addClass(columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var t,hadOne = false;
	for(t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t;
				for(t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	var i;
	for(i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	var t;
	for(t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	var i;
	for(i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	var i;
	for(i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var i,j,a = [];
	for(i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

//--
//-- Augmented methods for the JavaScript String() object
//--

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var t,s = this.split("-");
	if(s.length > 1) {
		for(t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var match,r = [];
	do {
		match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1],10)]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
    return this.replace(/[\-\/\\\^\$\*\+\?\.\(\)\|\[\]\{\}]/g, '\\$&'); // #157
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p].replace(/\\"/g,'"');
		else if(match[p+1]) // Single quoted
			n = match[p+1].replace(/\\'/g,"'");
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval && config.evaluateMacroParameters != "none") {
					if(config.evaluateMacroParameters == "restricted") {
						if(window.restrictedEval) {
							n = window.restrictedEval(n);
						}
					} else {
						n = window.eval(n);
					}
				}
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var match;
	do {
		match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	var t;
	for(t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
	var p = this.parseParams("list",null,!notAllowEval,true);
	var t,n = [];
	for(t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var t,n = [];
	for(t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var t,results = [];
		for(t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var t,r = {};
	for(t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var t,r = [];
	for(t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var clamp = function(x,min,max) {
		return x < min ? min : (x > max ? max : x);
	};
	return "#" +
			("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	var t;
	for(t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !jQuery(e).hasClass(value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current height of the document
function findDocHeight() {
    var D = document;
    return Math.max(
        Math.max(D.body.scrollHeight, D.documentElement.scrollHeight),
        Math.max(D.body.offsetHeight, D.documentElement.offsetHeight),
        Math.max(D.body.clientHeight, D.documentElement.clientHeight)
    );
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Set the caret position in a text area
function setCaretPosition(e,pos)
{
	if(e.selectionStart || e.selectionStart == '0') {
		e.selectionStart = pos;
		e.selectionEnd = pos;
		e.focus();
	} else if(document.selection) {
		// IE support
		e.focus ();
		var sel = document.selection.createRange();
		sel.moveStart('character', -e.value.length);
		sel.moveStart('character',pos);
		sel.moveEnd('character',0);
		sel.select();
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		var t;
		for(t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{id:id,doc:doc});
}

function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({id:id});
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var t,tiddlers = [];
	for(t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var t,tiddlers = store.getTiddlers("title");
	for(t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var i,attrs = node.attributes;
	for(i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};



//]]>
</script>

<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}


//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.parentNode.removeChild(el);
		}
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
			'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
